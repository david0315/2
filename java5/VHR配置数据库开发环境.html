<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修VHR配置数据库开发环境' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>VHR配置数据库开发环境</center></div><div class='banquan'>原文出处:本文由博客园博主noneplus提供。<br/>
原文连接:https://www.cnblogs.com/noneplus/p/11577793.html</div><br>
    <h1 id="一vhr项目宏观分析">一，vhr项目宏观分析</h1>
<p>目的：实现机关和事业单位的<strong>人事管理信息系统</strong>。</p>
<p>软件使用的对象：面向机关和事业单位内人事信息管理人员和在职开发人员。</p>
<p>【架构选型】</p>
<p>vhr面向的群体范围并不大，并非属于互联网应用，所以市面上鼓吹的高并发，高性能对于这个项目来说并不适用。</p>
<p>盲目上微服务只会徒增成本。</p>
<p><br></p>
<h2 id="系统业务流程设计">系统业务流程设计</h2>
<p><br></p>
<p><strong>1.管理员对员工信息的操作</strong></p>
<p>首先，管理人员登陆进入系统，对员工信息进行增删改查，进而对奖罚、工资、考评等信息进行增删改查，然后实现对部门员工部分信息的统计及修改</p>
<p><br></p>
<p><strong>2.操作员对自己信息的操作</strong></p>
<p>可对自己的信息进行操作</p>
<p><img src="./images/VHR配置数据库开发环境0.png" alt="1569228539173" /></p>
<p><br></p>
<h2 id="系统功能设计">系统功能设计</h2>
<p><img src="./images/VHR配置数据库开发环境1.png" alt="1569228613525" /></p>
<h3 id="员工资料">员工资料</h3>
<p>员工资料包括基本资料和高级资料。</p>
<ul>
<li><p>基本资料</p>
<p>员工编号、员工姓名、性别、出生日期、身份证号、婚姻状况、名族、机关、政治面貌、电子邮箱、联系电话、联系地址、部门、职位、职称、基本工资、聘用形式、最高学历、所属专业、毕业院校、入职日期、在职状态、工号、合同期限。</p></li>
<li><p>高级资料</p>
<p>(1). 奖惩资料：奖惩日期、奖惩分数、奖惩原因。</p>
<p>(2). 培训资料：培训日期、培训内容。</p>
<p>(3). 考评资料：考评日期、考评内容、考评结果。</p>
<p>(4). 调薪资料：调薪日期、调前薪资、调后薪资、调薪原因。</p>
<p>(5). 调动资料：调动日期、调前部门、调前职位、调动原因、调后部门、调后职位、备注。</p>
<p>(6). 工资信息：账套名称、工资月份、应发工资、备注。</p>
<p>(7). 其他信息：管理员可任意备注其他信息。</p></li>
</ul>
<h3 id="人事管理">人事管理</h3>
<p>主要用于对员工奖惩、培训、考评、调薪、调动、工资信息的管理。</p>
<p><br></p>
<p>1.员工资料</p>
<p>即员工的基本资料，显示员工资料，并且可对员工进行模糊查询，即实现员工资料的增删改查。</p>
<p><br></p>
<p>2.员工奖惩</p>
<p>对员工奖励模块的增删改查的实现。</p>
<p><br></p>
<p>3.员工培训</p>
<p>对员工培训模块的增删改查的实现。</p>
<p><br></p>
<p>4.员工好评</p>
<p>对员工好评模块的增删改查的实现。</p>
<p><br></p>
<p>5.员工调薪</p>
<p>对员工调薪模块的增删改查的实现。</p>
<p><br></p>
<p>6.员工调动</p>
<p>对员工调动模块的增删改查的实现。</p>
<p><br></p>
<h3 id="工资管理">工资管理</h3>
<p>实现对员工工资账套管理、员工账套设置、工资表管理、月末处理、工资表查询一系列对员工工资管理的功能。</p>
<p><br></p>
<p>1 工资账套管理</p>
<p>对员工奖金、基本工资、提成等各项的增删改查。</p>
<p><br></p>
<p>2 员工账套设置</p>
<p>根据公司账套（即各部门），查看相应的员工的工资信息，并实现其增删功能。</p>
<p><br></p>
<p>3 工资表管理</p>
<p>集中对同一部门员工工资进行增删改查的功能。</p>
<p><br></p>
<p>4 月末处理</p>
<p>对该月该部门员工工资进行增删改查的功能。</p>
<p><br></p>
<p>5 工资表查询</p>
<p>是一种历史记录查询，可查询某员工在某月的工资情况。</p>
<p><br></p>
<h3 id="统计管理">统计管理</h3>
<p>对员工资料的统一查询管理，包括综合信息统计、员工积分统计、人事信息统、人事记录统计。</p>
<p><br></p>
<p>1 综合信息统计</p>
<p>根据员工出生月份、转正信息等统一管理。</p>
<p><br></p>
<p>2 员工积分统计</p>
<p>根据日期查找员工的积分情况。</p>
<p><br></p>
<p>3 人事信息统计</p>
<p>对员工进行的同一查询管理，可根据性别、工资、职称等查询员工的信息。</p>
<p><br></p>
<p>4 人事记录统计</p>
<p>对员工积分的统一管理，可根据部门、月份等查询其积分信息。</p>
<p><br></p>
<h3 id="系统管理">系统管理</h3>
<p>对系统、管理员等一些操作，包括基础信息设置、系统管理、操作员管理、备份恢复数据、初始化数据库。</p>
<p><br></p>
<p>1 基础信息设置</p>
<p>对部门、职位、职称、奖惩规则和权限组的设置管理，及其个项目的增删改查。</p>
<p><br></p>
<p>2 系统管理</p>
<p>对系统本身的一些设置。</p>
<p><br></p>
<p>3 操作日志管理</p>
<p>记录管理员对数据的操作信息。</p>
<p><br></p>
<p>4 操作员管理</p>
<p>管理员基本信息的管理，及其增删改功能。</p>
<p><br></p>
<p>5 备份恢复数据</p>
<p>可对员工资料数据进行备份，并在适当的时候还原。</p>
<p><br></p>
<p>6 初始化数据库</p>
<p>对整个数据库资料初始化的操作。</p>
<p><br></p>
<h1 id="二数据库表设计">二，数据库表设计</h1>
<p><strong>vhr系统使用者大致可分为两类，一种是系统管理员，另外一种是拥有各种权限的hr员工。</strong></p>
<p>vhr一共有21张表，其中核心的五张表：</p>
<h2 id="hr表">hr表</h2>
<p><img src="./images/VHR配置数据库开发环境2.png" alt="1569291747694" /></p>
<h2 id="role角色表">role角色表</h2>
<p><img src="./images/VHR配置数据库开发环境3.png" alt="1569291609869" /></p>
<h2 id="用户角色关联表hr_role">用户角色关联表【hr_role】</h2>
<p><img src="./images/VHR配置数据库开发环境4.png" alt="1569291667827" /></p>
<p>前面三张表定义了vhr使用的对象及所拥有的权限，</p>
<p>比如hr中第一个id为3的系统管理员对于用户角色关联表中rid为6，而6在role表中对应的是系统管理员权限。</p>
<hr />
<p>下面两张菜单表和菜单角色关联表定义了角色具体拥有的权限。</p>
<h2 id="menu表">menu表</h2>
<p><img src="./images/VHR配置数据库开发环境5.png" alt="1569292019532" /></p>
<h2 id="menu_role表">menu_role表</h2>
<p><img src="./images/VHR配置数据库开发环境6.png" alt="1569292433764" /></p>
<p>这两张表需要结合role表来分析，还是以hr表中id为3的用户举例，在menu_role中rid为3对应的mid为7，7在menu表中的访问内容只有基本资料，那么这个用户可能是个普通员工。以此类推，作者在文档里画了一个图非常形象生动的诠释了这五张表的关系：</p>
<p><img src="./images/VHR配置数据库开发环境7.png" alt="1569292802795" /></p>
<p>剩下的表在往下看功能的时候再慢慢了解吧。</p>
<h1 id="三拆解项目">三，拆解项目</h1>
<h2 id="登录模块">登录模块</h2>
<p>不知道面对整个项目该如何下手，还好在图书馆借了SpringBoot+Vue的书，实战介绍完数据库就到登录模块了。</p>
<p>在没有思路的时候，姑且先从这里开始吧。</p>
<p><br></p>
<p>在研究登录模块之前，当然是先把程序跑起来先。</p>
<p>clone，然后用IDEA打开。</p>
<p><br></p>
<h3 id="第一步就是修改数据库相关配置">第一步就是修改数据库相关配置</h3>
<p>首先建库，把vhr.sql在MySQL里创建出来。【MySQL版本：8.0】</p>
<p>出于个人习惯，</p>
<p>将properties改为yaml，</p>
<p>SpringBoot版本换到了2.1.8，</p>
<p>Druid版本换到了1.1.20，顺带配置Druid监控。</p>
<ul>
<li>关于application.yaml</li>
</ul>
<pre><code><code>spring:
  datasource:
    #   数据源基本配置
    username: noneplus
    password: Noneplus564925080!
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://xx.xxx.xxx.xx:3306/vhr?serverTimezone=UTC
    type: com.alibaba.druid.pool.DruidDataSource
    #   Druid数据源配置
    initialSize: 5
    minIdle: 5
    maxActive: 20
    maxWait: 60000
    timeBetweenEvictionRunsMillis: 60000
    minEvictableIdleTimeMillis: 300000
    validationQuery: SELECT 1 FROM DUAL
    testWhileIdle: true
    testOnBorrow: false
    testOnReturn: false
    poolPreparedStatements: true
    #   配置监控统计拦截的filters，去掉后监控界面sql无法统计，&#39;wall&#39;用于防火墙
    filters: stat,wall,log4j
    maxPoolPreparedStatementPerConnectionSize: 20
    useGlobalDataSourceStat: true
    connectionProperties: druid.stat.mergeSql=true;druid.stat.slowSqlMillis=500
  mail:
    host: smtp.qq.com
    port: 465
    username: 1510161612@qq.com
    password: fhmvfkwxjwmzhhjd
    default-encoding: UTF-8
    properties:
      mail:
        debug: true
      stmp:
        socketFactory:
          class: javax.net.ssl.SSLSocketFactory
pagehelper:
  helperDialect: mysql
  reasonable: true
  supportMethodsArguments: true
  pageSizeZero: false 

server:
  port: 8082

######################################################################################
# 原application.properties
##MySQL配置
#  spring.datasource.type=com.alibaba.druid.pool.DruidDataSource
#  spring.datasource.url=jdbc:mysql://47.103.6.247:3306/vhr?useUnicode=true&amp;characterEncoding=UTF-8
#  spring.datasource.username=noneplus
#  spring.datasource.password=Noneplus564925080!
#  #MyBatis日志配置
#  mybatis.config-location=classpath:/mybatis-config.xml
#  #Redis配置
#  spring.redis.database=0
#  spring.redis.host=192.168.66.130
#  spring.redis.port=6379
#  spring.redis.password=123@456
#  spring.redis.jedis.pool.max-active=8
#  spring.redis.jedis.pool.max-idle=8
#  spring.redis.jedis.pool.max-wait=-1ms
#  spring.redis.jedis.pool.min-idle=0
#  #缓存配置
#  spring.cache.cache-names=menus_cache
#  spring.cache.redis.time-to-live=1800s
#  #端口配置
#  server.port=8082
#
#  spring.mail.host=smtp.qq.com
#  spring.mail.port=465
#  spring.mail.username=1510161612@qq.com
#  spring.mail.password=fhmvfkwxjwmzhhjd
#  spring.mail.default-encoding=UTF-8
#  spring.mail.properties.mail.smtp.socketFactory.class=javax.net.ssl.SSLSocketFactory
#  spring.mail.properties.mail.debug=true</code></code></pre>
<ul>
<li>pom修改的部分</li>
</ul>
<pre><code><code>&lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;2.1.8.RELEASE&lt;/version&gt;
        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;
    &lt;/parent&gt;
    
    &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba&lt;/groupId&gt;
            &lt;artifactId&gt;druid&lt;/artifactId&gt;
            &lt;version&gt;1.1.20&lt;/version&gt;
        &lt;/dependency&gt;</code></code></pre>
<ul>
<li><p>配置DruidConfig监控</p>
<p>在config包下新增一个DruidConfig</p>
<p><img src="./images/VHR配置数据库开发环境8.png" alt="1569297460075" /></p>
<pre><code><code>package org.sang.config;


import com.alibaba.druid.pool.DruidDataSource;
import com.alibaba.druid.support.http.StatViewServlet;
import com.alibaba.druid.support.http.WebStatFilter;
import org.springframework.boot.context.properties.ConfigurationProperties;
import org.springframework.boot.web.servlet.FilterRegistrationBean;
import org.springframework.boot.web.servlet.ServletRegistrationBean;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

import javax.sql.DataSource;
import java.util.Arrays;
import java.util.HashMap;
import java.util.Map;

@Configuration
public class DruidConfig {

    //加载application.yaml中的Druid配置
    @ConfigurationProperties(prefix = &quot;spring.datasource&quot;)
    @Bean
    public DataSource druid(){
        return  new DruidDataSource();
    }

    //配置Druid的监控
    //1、配置一个管理后台的Servlet
    @Bean
    public ServletRegistrationBean statViewServlet(){
        ServletRegistrationBean bean = new ServletRegistrationBean(new StatViewServlet(), &quot;/druid/*&quot;);
        Map&lt;String,String&gt; initParams = new HashMap&lt;&gt;();

        initParams.put(&quot;loginUsername&quot;,&quot;hq&quot;);
        initParams.put(&quot;loginPassword&quot;,&quot;564925080&quot;);
        initParams.put(&quot;allow&quot;,&quot;&quot;);//默认就是允许所有访问
        initParams.put(&quot;deny&quot;,&quot;192.168.15.21&quot;);

        bean.setInitParameters(initParams);
        return bean;
    }


    //2、配置一个web监控的filter
    @Bean
    public FilterRegistrationBean webStatFilter(){
        FilterRegistrationBean bean = new FilterRegistrationBean();
        bean.setFilter(new WebStatFilter());

        Map&lt;String,String&gt; initParams = new HashMap&lt;&gt;();
        initParams.put(&quot;exclusions&quot;,&quot;*.js,*.css,/druid/*&quot;);

        bean.setInitParameters(initParams);

        bean.setUrlPatterns(Arrays.asList(&quot;/*&quot;));

        return  bean;
    }
}</code></code></pre></li>
<li><p>配置Druid监控，还需要配置log4j依赖</p>
<pre><code><code>&lt;dependency&gt;
            &lt;groupId&gt;log4j&lt;/groupId&gt;
            &lt;artifactId&gt;log4j&lt;/artifactId&gt;
            &lt;version&gt;1.2.17&lt;/version&gt;
        &lt;/dependency&gt;</code></code></pre>
<p>log4j.properties【配置在resource路径下】</p>
<pre><code><code># Configure logging for testing: optionally with log file
log4j.rootLogger=WARN, stdout
# log4j.rootLogger=WARN, stdout, logfile

log4j.appender.stdout=org.apache.log4j.ConsoleAppender
log4j.appender.stdout.layout=org.apache.log4j.PatternLayout
log4j.appender.stdout.layout.ConversionPattern=%d %p [%c] - %m%n

log4j.appender.logfile=org.apache.log4j.FileAppender
log4j.appender.logfile.File=target/spring.log
log4j.appender.logfile.layout=org.apache.log4j.PatternLayout
log4j.appender.logfile.layout.ConversionPattern=%d %p [%c] - %m%n</code></code></pre></li>
</ul>
<h3 id="启动项目测试">启动项目测试</h3>
<p>访问：http://localhost:8082/index.html#/</p>
<p><img src="./images/VHR配置数据库开发环境9.png" alt="1569297701060" /></p>
<p>测试Druid监控，访问：http://localhost:8082/druid/</p>
<p>【注：访问Druid监控之前需要先登录获取权限，之后再访问Druid】</p>
<p><img src="./images/VHR配置数据库开发环境10.png" alt="1569297796932" /></p>
<p><br></p>
<h1 id="代码参考">代码参考</h1>
<p>【tips：后续会更新代码，为了方便测试，会打下不同的节点】</p>
<p>https://github.com/Noneplus/vhr/releases/tag/v1.0</p>
<p><img src="./images/VHR配置数据库开发环境11.png" alt="1569303570260" /></p>


</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>