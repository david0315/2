<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修Java 上传解压zip文件，并且解析文件里面的excel和图片' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>Java 上传解压zip文件，并且解析文件里面的excel和图片</center></div><div class='banquan'>原文出处:本文由博客园博主独孤帅提供。<br/>
原文连接:https://www.cnblogs.com/jamespan23/p/11629663.html</div><br>
    <p><strong>需求：上传一个zip文件，zip文件里面包含一个excel和很多图片，需要把excel里面的信息解析出来保存到表中，同时图片也转化成base64保存到数据库表中。</strong></p>
<p>PS:为了方便不同水平的开发人员阅读，我把代码全部写到Controller里面。这个demo的file入参的类型是MultipartFile，很多网上的例子是File类型。这两个类型在解析文件的时候还是有点区别的。</p>
<p>第①个方法：</p>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span>     <span style="color: #008000;">/**</span>
<span style="color: #008080;"> 2</span> <span style="color: #008000;">     * 这个deomo入参的类型是MultipartFile，很多网上的例子是File类型
</span><span style="color: #008080;"> 3</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> file (zip)
</span><span style="color: #008080;"> 4</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> request
</span><span style="color: #008080;"> 5</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> response
</span><span style="color: #008080;"> 6</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@return</span>
<span style="color: #008080;"> 7</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@throws</span><span style="color: #008000;"> Exception
</span><span style="color: #008080;"> 8</span>      <span style="color: #008000;">*/</span>
<span style="color: #008080;"> 9</span>     @PostMapping("/addPersonsFileOfZip"<span style="color: #000000;">)
</span><span style="color: #008080;">10</span>     <span style="color: #0000ff;">public</span> String addPersonsFileOfZip(@RequestParam("file") MultipartFile file, HttpServletRequest request) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> Exception {
</span><span style="color: #008080;">11</span>         String createdId =<span style="color: #000000;"> request.getParameter(KEY_CREATED_ID);
</span><span style="color: #008080;">12</span>         <span style="color: #008000;">//</span><span style="color: #008000;">正常上这里需要检查一下createdId是否为空
</span><span style="color: #008080;">13</span>         
<span style="color: #008080;">14</span>         <span style="color: #008000;">//</span><span style="color: #008000;">原则上这个uploadZipFilesAndParse方法需要写到service和serviceImpl中</span>
<span style="color: #008080;">15</span>         String result =<span style="color: #000000;">uploadZipFilesAndParse(file,createdId);
</span><span style="color: #008080;">16</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;">  result;
</span><span style="color: #008080;">17</span>     }</code></pre>

<p>第②个方法：</p>
<src class="cnblogs_code" onclick="cnblogs_code_show('7d9ad22c-3336-483a-8f54-9b3f1f8dcf77')"><img id="code_img_closed_7d9ad22c-3336-483a-8f54-9b3f1f8dcf77" class="code_img_closed" src="./images/Java 上传解压zip文件，并且解析文件里面的excel和图片0.png" alt="" /><img id="code_img_opened_7d9ad22c-3336-483a-8f54-9b3f1f8dcf77" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('7d9ad22c-3336-483a-8f54-9b3f1f8dcf77',event)" src="./images/Java 上传解压zip文件，并且解析文件里面的excel和图片1.png" alt="" />
<src id="cnblogs_code_open_7d9ad22c-3336-483a-8f54-9b3f1f8dcf77" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span>     <span style="color: #008000;">/**</span>
<span style="color: #008080;"> 2</span> <span style="color: #008000;">     *返回的是批次号
</span><span style="color: #008080;"> 3</span> <span style="color: #008000;">     *同时我另外开了线程处理zip文件里面的图片和excel，
</span><span style="color: #008080;"> 4</span>      <span style="color: #008000;">*/</span>
<span style="color: #008080;"> 5</span> <span style="color: #000000;">    @Override
</span><span style="color: #008080;"> 6</span>     <span style="color: #0000ff;">public</span> String uploadZipFilesAndParse(MultipartFile file, String createdId) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> Exception {
</span><span style="color: #008080;"> 7</span>         String filename =<span style="color: #000000;"> file.getOriginalFilename();
</span><span style="color: #008080;"> 8</span>         String fileType = filename.substring(filename.lastIndexOf(".") + 1<span style="color: #000000;">).toLowerCase(Locale.US);
</span><span style="color: #008080;"> 9</span>         String uuid =<span style="color: #000000;"> UUID.randomUUID().toString();
</span><span style="color: #008080;">10</span>         <span style="color: #008000;">//</span><span style="color: #008000;">判断文件是不是zip类型</span>
<span style="color: #008080;">11</span>         <span style="color: #0000ff;">if</span>(fileType.equals("zip"<span style="color: #000000;">)){
</span><span style="color: #008080;">12</span>             
<span style="color: #008080;">13</span>             <span style="color: #008000;">//</span><span style="color: #008000;">FileConfig.localtion是配置文件和config类生产的，我会在评论区附上这些代码，测试demo的时候大家可以直接把FileConfig.localtion替换成D:/test
</span><span style="color: #008080;">14</span>             <span style="color: #008000;">//</span><span style="color: #008000;">String desPath = FileConfig.localtion + File.separator + uuid.replaceAll("-", "");</span>
<span style="color: #008080;">15</span>             String desPath = "D:/test" + File.separator + uuid.replaceAll("-", ""<span style="color: #000000;">);
</span><span style="color: #008080;">16</span>             
<span style="color: #008080;">17</span>             
<span style="color: #008080;">18</span>             <span style="color: #008000;">//</span><span style="color: #008000;">下面这三行的代码就是把上传文件copy到服务器，一定不要遗漏了。
</span><span style="color: #008080;">19</span>             <span style="color: #008000;">//</span><span style="color: #008000;">遗漏了这个代码，在本地测试环境不会出问题，在服务器上一定会报没有找到文件的错误</span>
<span style="color: #008080;">20</span>             String savePath = FileConfig.localtion +<span style="color: #000000;"> File.separator;
</span><span style="color: #008080;">21</span>             File savefile = <span style="color: #0000ff;">new</span> File(savePath+<span style="color: #000000;">filename);
</span><span style="color: #008080;">22</span> <span style="color: #000000;">            file.transferTo(savefile);
</span><span style="color: #008080;">23</span>             
<span style="color: #008080;">24</span>             FileUtil fileUtil = <span style="color: #0000ff;">new</span><span style="color: #000000;"> FileUtil();
</span><span style="color: #008080;">25</span>             <span style="color: #008000;">//</span><span style="color: #008000;">解压zip文件，我是写在公共类里面，FileUtil类代码评论区见</span>
<span style="color: #008080;">26</span> <span style="color: #000000;">            FileUtil.unZip(file, desPath,savePath);
</span><span style="color: #008080;">27</span>             <span style="color: #0000ff;">new</span> Thread(<span style="color: #0000ff;">new</span><span style="color: #000000;"> Runnable() {
</span><span style="color: #008080;">28</span> <span style="color: #000000;">                @Override
</span><span style="color: #008080;">29</span>                 <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> run() {
</span><span style="color: #008080;">30</span>                     List&lt;File&gt; fileList = <span style="color: #0000ff;">new</span> ArrayList&lt;&gt;<span style="color: #000000;">();
</span><span style="color: #008080;">31</span>                     fileList =<span style="color: #000000;"> fileUtil.getSubFiles(desPath,fileList);
</span><span style="color: #008080;">32</span>                         <span style="color: #0000ff;">for</span><span style="color: #000000;"> (File oneFile : fileList){
</span><span style="color: #008080;">33</span>                             <span style="color: #0000ff;">if</span> (oneFile.getName().toLowerCase().endsWith(".xls") || oneFile.getName().toLowerCase().endsWith(".xlsx"<span style="color: #000000;">) ) {
</span><span style="color: #008080;">34</span>                                 <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;">35</span>                                     <span style="color: #008000;">//</span><span style="color: #008000;">解析处理excel文件</span>
<span style="color: #008080;">36</span> <span style="color: #000000;">                                    parseExcelFile(oneFile,createdId,uuid);
</span><span style="color: #008080;">37</span>                                 } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (Exception e) {
</span><span style="color: #008080;">38</span> <span style="color: #000000;">                                    LogUtils.error(e.getMessage());
</span><span style="color: #008080;">39</span> <span style="color: #000000;">                                }
</span><span style="color: #008080;">40</span>                             }<span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span>(oneFile.getName().toLowerCase().endsWith(".jpg"<span style="color: #000000;">)) {
</span><span style="color: #008080;">41</span>                                 <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;">42</span>                                     <span style="color: #008000;">//</span><span style="color: #008000;">解析处理图片文件</span>
<span style="color: #008080;">43</span> <span style="color: #000000;">                                    parseImageFile(oneFile,createdId,uuid);
</span><span style="color: #008080;">44</span>                                 } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (Exception e) {
</span><span style="color: #008080;">45</span> <span style="color: #000000;">                                    LogUtils.error(e.getMessage());
</span><span style="color: #008080;">46</span> <span style="color: #000000;">                                }
</span><span style="color: #008080;">47</span> <span style="color: #000000;">                            }
</span><span style="color: #008080;">48</span> <span style="color: #000000;">                        }    
</span><span style="color: #008080;">49</span>                         
<span style="color: #008080;">50</span>                         <span style="color: #008000;">//</span><span style="color: #008000;">最后要删除文件，删除文件的方法见评论区FileUtil类</span>
<span style="color: #008080;">51</span> <span style="color: #000000;">                        FileUtil.clearFiles(desPath);
</span><span style="color: #008080;">52</span>                         
<span style="color: #008080;">53</span> <span style="color: #000000;">                }
</span><span style="color: #008080;">54</span> <span style="color: #000000;">            }).start();            
</span><span style="color: #008080;">55</span> 
<span style="color: #008080;">56</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">57</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> uuid;
</span><span style="color: #008080;">58</span>     }    </code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<p>&nbsp;第③个方法：解压zip文件的unzip方法</p>
<src class="cnblogs_code" onclick="cnblogs_code_show('d6e3b1b5-e566-417e-bc1e-23b8855894e9')"><img id="code_img_closed_d6e3b1b5-e566-417e-bc1e-23b8855894e9" class="code_img_closed" src="./images/Java 上传解压zip文件，并且解析文件里面的excel和图片0.png" alt="" /><img id="code_img_opened_d6e3b1b5-e566-417e-bc1e-23b8855894e9" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('d6e3b1b5-e566-417e-bc1e-23b8855894e9',event)" src="./images/Java 上传解压zip文件，并且解析文件里面的excel和图片1.png" alt="" />
<src id="cnblogs_code_open_d6e3b1b5-e566-417e-bc1e-23b8855894e9" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span> unZip(MultipartFile  srcFile, String destDirPath,String savePath) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> RuntimeException, IOException {
</span><span style="color: #008080;"> 2</span>         <span style="color: #0000ff;">long</span> startTime =<span style="color: #000000;"> System.currentTimeMillis();
</span><span style="color: #008080;"> 3</span>         
<span style="color: #008080;"> 4</span>         File file = <span style="color: #0000ff;">null</span><span style="color: #000000;">;  
</span><span style="color: #008080;"> 5</span>         InputStream ins =<span style="color: #000000;"> srcFile.getInputStream();  
</span><span style="color: #008080;"> 6</span>         file=<span style="color: #0000ff;">new</span> File(savePath+<span style="color: #000000;">srcFile.getOriginalFilename()); 
</span><span style="color: #008080;"> 7</span>         LogUtils.info("MultipartFile transform to File,MultipartFile name:"+<span style="color: #000000;">srcFile.getOriginalFilename());
</span><span style="color: #008080;"> 8</span> <span style="color: #000000;">        inputStreamToFile(ins, file);  
</span><span style="color: #008080;"> 9</span>         
<span style="color: #008080;">10</span>         <span style="color: #0000ff;">if</span> (!<span style="color: #000000;">file.exists()) {
</span><span style="color: #008080;">11</span>             <span style="color: #0000ff;">throw</span> <span style="color: #0000ff;">new</span> RuntimeException(file.getPath() + ",file is not found"<span style="color: #000000;">);
</span><span style="color: #008080;">12</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">13</span>         ZipFile zipFile = <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;">14</span>         <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;">15</span>             zipFile = <span style="color: #0000ff;">new</span><span style="color: #000000;"> ZipFile(file);
</span><span style="color: #008080;">16</span>             Enumeration&lt;?&gt; entries =<span style="color: #000000;"> zipFile.entries();
</span><span style="color: #008080;">17</span>             <span style="color: #0000ff;">while</span><span style="color: #000000;"> (entries.hasMoreElements()) {
</span><span style="color: #008080;">18</span>                 ZipEntry entry =<span style="color: #000000;"> (ZipEntry) entries.nextElement();
</span><span style="color: #008080;">19</span>                 LogUtils.info("zipFile context name:"+<span style="color: #000000;">entry.getName());
</span><span style="color: #008080;">20</span>                 <span style="color: #0000ff;">if</span><span style="color: #000000;"> (entry.isDirectory()) {
</span><span style="color: #008080;">21</span>                     String dirPath = destDirPath + File.separator+<span style="color: #000000;"> entry.getName();
</span><span style="color: #008080;">22</span>                     File dir = <span style="color: #0000ff;">new</span><span style="color: #000000;"> File(dirPath);
</span><span style="color: #008080;">23</span> <span style="color: #000000;">                    dir.mkdirs();
</span><span style="color: #008080;">24</span>                 }<span style="color: #0000ff;">else</span><span style="color: #000000;"> {
</span><span style="color: #008080;">25</span>                     File targetFile = <span style="color: #0000ff;">new</span> File(destDirPath + File.separator +<span style="color: #000000;"> entry.getName());
</span><span style="color: #008080;">26</span>                     targetFile.setExecutable(<span style="color: #0000ff;">true</span><span style="color: #000000;">);
</span><span style="color: #008080;">27</span>                     <span style="color: #0000ff;">if</span>(!<span style="color: #000000;">targetFile.getParentFile().exists()){
</span><span style="color: #008080;">28</span> <span style="color: #000000;">                        targetFile.getParentFile().mkdirs();
</span><span style="color: #008080;">29</span> <span style="color: #000000;">                    }
</span><span style="color: #008080;">30</span> <span style="color: #000000;">                    targetFile.createNewFile();
</span><span style="color: #008080;">31</span>                     InputStream is =<span style="color: #000000;"> zipFile.getInputStream(entry);
</span><span style="color: #008080;">32</span>                     FileOutputStream fos = <span style="color: #0000ff;">new</span><span style="color: #000000;"> FileOutputStream(targetFile);
</span><span style="color: #008080;">33</span>                     <span style="color: #0000ff;">int</span><span style="color: #000000;"> len;
</span><span style="color: #008080;">34</span>                     <span style="color: #0000ff;">byte</span>[] buf = <span style="color: #0000ff;">new</span> <span style="color: #0000ff;">byte</span>[1024<span style="color: #000000;">];
</span><span style="color: #008080;">35</span>                     <span style="color: #0000ff;">while</span> ((len = is.read(buf)) != -1<span style="color: #000000;">) {
</span><span style="color: #008080;">36</span>                         fos.write(buf, 0<span style="color: #000000;">, len);
</span><span style="color: #008080;">37</span> <span style="color: #000000;">                    }
</span><span style="color: #008080;">38</span> <span style="color: #000000;">                    fos.close();
</span><span style="color: #008080;">39</span> <span style="color: #000000;">                    is.close();
</span><span style="color: #008080;">40</span> <span style="color: #000000;">                }
</span><span style="color: #008080;">41</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">42</span>             <span style="color: #0000ff;">long</span> endTime =<span style="color: #000000;"> System.currentTimeMillis();
</span><span style="color: #008080;">43</span>             LogUtils.info("unZip time--&gt;" + (endTime - startTime) + " ms"<span style="color: #000000;">);
</span><span style="color: #008080;">44</span>         }<span style="color: #0000ff;">catch</span><span style="color: #000000;">(Exception e) {
</span><span style="color: #008080;">45</span>             <span style="color: #0000ff;">throw</span> <span style="color: #0000ff;">new</span> RuntimeException("unzip error from FileUtil"<span style="color: #000000;">, e);
</span><span style="color: #008080;">46</span>         } <span style="color: #0000ff;">finally</span><span style="color: #000000;"> {
</span><span style="color: #008080;">47</span>             <span style="color: #0000ff;">if</span>(zipFile != <span style="color: #0000ff;">null</span><span style="color: #000000;">){
</span><span style="color: #008080;">48</span>                 <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;">49</span> <span style="color: #000000;">                    zipFile.close();
</span><span style="color: #008080;">50</span>                 } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (IOException e) {
</span><span style="color: #008080;">51</span> <span style="color: #000000;">                    e.printStackTrace();
</span><span style="color: #008080;">52</span> <span style="color: #000000;">                }
</span><span style="color: #008080;">53</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">54</span>             
<span style="color: #008080;">55</span>             <span style="color: #008000;">//</span><span style="color: #008000;">MultipartFile change to file may create a temp file in the project root folder(delete the temp file)</span>
<span style="color: #008080;">56</span>             File del = <span style="color: #0000ff;">new</span><span style="color: #000000;"> File(file.toURI());  
</span><span style="color: #008080;">57</span> <span style="color: #000000;">            del.delete(); 
</span><span style="color: #008080;">58</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">59</span>     }</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<p>第④个方法：unzip方法中的inputStreamToFile方法，这个方法的目的是把MultipartFile转成File类型，但是会在项目根目录下生成一个临时文件，切记要删除</p>
<src class="cnblogs_code" onclick="cnblogs_code_show('667f1cba-3e38-47da-bf61-4ea252a43bee')"><img id="code_img_closed_667f1cba-3e38-47da-bf61-4ea252a43bee" class="code_img_closed" src="./images/Java 上传解压zip文件，并且解析文件里面的excel和图片0.png" alt="" /><img id="code_img_opened_667f1cba-3e38-47da-bf61-4ea252a43bee" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('667f1cba-3e38-47da-bf61-4ea252a43bee',event)" src="./images/Java 上传解压zip文件，并且解析文件里面的excel和图片1.png" alt="" />
<src id="cnblogs_code_open_667f1cba-3e38-47da-bf61-4ea252a43bee" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span>     <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> inputStreamToFile(InputStream ins, File file) {
</span><span style="color: #008080;"> 2</span>         <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;"> 3</span>             OutputStream os = <span style="color: #0000ff;">new</span><span style="color: #000000;"> FileOutputStream(file);
</span><span style="color: #008080;"> 4</span>             <span style="color: #0000ff;">int</span> bytesRead = 0<span style="color: #000000;">;
</span><span style="color: #008080;"> 5</span>             <span style="color: #0000ff;">byte</span>[] buffer = <span style="color: #0000ff;">new</span> <span style="color: #0000ff;">byte</span>[8192<span style="color: #000000;">];
</span><span style="color: #008080;"> 6</span>             <span style="color: #0000ff;">while</span> ((bytesRead = ins.read(buffer, 0, 8192)) != -1<span style="color: #000000;">) {
</span><span style="color: #008080;"> 7</span>                 os.write(buffer, 0<span style="color: #000000;">, bytesRead);
</span><span style="color: #008080;"> 8</span> <span style="color: #000000;">            }
</span><span style="color: #008080;"> 9</span> <span style="color: #000000;">            os.close();
</span><span style="color: #008080;">10</span> <span style="color: #000000;">            ins.close();
</span><span style="color: #008080;">11</span>             LogUtils.info("MultipartFile transform to File completed!"<span style="color: #000000;">);
</span><span style="color: #008080;">12</span>         }<span style="color: #0000ff;">catch</span><span style="color: #000000;">(Exception e) {
</span><span style="color: #008080;">13</span> <span style="color: #000000;">            e.printStackTrace();
</span><span style="color: #008080;">14</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">15</span>     }</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<p>第⑤个方法：parseExcelFile方法是解析excel的方法，里面包括我自己项目的逻辑处理，大家可以删除这些代码，只保留解析excel的代码就好</p>
<src class="cnblogs_code" onclick="cnblogs_code_show('a10080a0-b3e3-4202-8e81-62081a30a19b')"><img id="code_img_closed_a10080a0-b3e3-4202-8e81-62081a30a19b" class="code_img_closed" src="./images/Java 上传解压zip文件，并且解析文件里面的excel和图片0.png" alt="" /><img id="code_img_opened_a10080a0-b3e3-4202-8e81-62081a30a19b" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('a10080a0-b3e3-4202-8e81-62081a30a19b',event)" src="./images/Java 上传解压zip文件，并且解析文件里面的excel和图片1.png" alt="" />
<src id="cnblogs_code_open_a10080a0-b3e3-4202-8e81-62081a30a19b" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span>     <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">void</span> parseExcelFile(File file,String createdId,String uuid) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> Exception {
</span><span style="color: #008080;"> 2</span>         
<span style="color: #008080;"> 3</span>         LogUtils.info("file name:"+<span style="color: #000000;">file.getName());
</span><span style="color: #008080;"> 4</span>         FileInputStream is = <span style="color: #0000ff;">new</span><span style="color: #000000;"> FileInputStream(file); 
</span><span style="color: #008080;"> 5</span>         Workbook workbook =<span style="color: #000000;"> WorkbookFactory.create(is);
</span><span style="color: #008080;"> 6</span>         Sheet sheet = workbook.getSheetAt(0<span style="color: #000000;">);
</span><span style="color: #008080;"> 7</span>         
<span style="color: #008080;"> 8</span>         <span style="color: #0000ff;">int</span> firstRowIndex = sheet.getFirstRowNum() + 1<span style="color: #000000;">;
</span><span style="color: #008080;"> 9</span>         <span style="color: #0000ff;">int</span> lastRowIndex =<span style="color: #000000;"> sheet.getLastRowNum();
</span><span style="color: #008080;">10</span>         
<span style="color: #008080;">11</span>         List&lt;VapBatchPersonInfo&gt; batchPersonList = <span style="color: #0000ff;">new</span> ArrayList&lt;&gt;<span style="color: #000000;">();
</span><span style="color: #008080;">12</span>         <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">int</span> rIndex = firstRowIndex; rIndex &lt;= lastRowIndex; rIndex++<span style="color: #000000;">) {
</span><span style="color: #008080;">13</span>             
<span style="color: #008080;">14</span>             VapBatchPersonInfo vapBatchPersonInfo  = <span style="color: #0000ff;">new</span><span style="color: #000000;"> VapBatchPersonInfo();
</span><span style="color: #008080;">15</span>             Row row =<span style="color: #000000;"> sheet.getRow(rIndex);
</span><span style="color: #008080;">16</span>             <span style="color: #0000ff;">if</span> (row != <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
</span><span style="color: #008080;">17</span>                 <span style="color: #0000ff;">int</span> firstCellIndex =<span style="color: #000000;"> row.getFirstCellNum();
</span><span style="color: #008080;">18</span>                 <span style="color: #0000ff;">int</span> lastCellIndex =<span style="color: #000000;"> row.getLastCellNum();
</span><span style="color: #008080;">19</span>                 JSONObject jsonObject = <span style="color: #0000ff;">new</span><span style="color: #000000;"> JSONObject();
</span><span style="color: #008080;">20</span> <span style="color: #000000;">                jsonObject.put(KEY_CREATED_ID, createdId);
</span><span style="color: #008080;">21</span> 
<span style="color: #008080;">22</span>                 Cell resultCell =<span style="color: #000000;"> row.createCell(lastCellIndex);
</span><span style="color: #008080;">23</span>                 Cell msgCell = row.createCell(lastCellIndex + 1<span style="color: #000000;">);
</span><span style="color: #008080;">24</span>                 Boolean flag = <span style="color: #0000ff;">false</span><span style="color: #000000;">;
</span><span style="color: #008080;">25</span>                 <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">int</span> cIndex = firstCellIndex; cIndex &lt; lastCellIndex; cIndex++<span style="color: #000000;">) {
</span><span style="color: #008080;">26</span>                     Cell cell =<span style="color: #000000;"> row.getCell(cIndex);
</span><span style="color: #008080;">27</span>                     String titleName = sheet.getRow(0<span style="color: #000000;">).getCell(cIndex).toString();
</span><span style="color: #008080;">28</span>                     String checkTitleName =<span style="color: #000000;"> checkTitleName(cIndex, titleName);
</span><span style="color: #008080;">29</span>                     <span style="color: #0000ff;">if</span> (!"SUCCESS"<span style="color: #000000;">.equals(checkTitleName)) {
</span><span style="color: #008080;">30</span> <span style="color: #000000;">                        msgCell.setCellValue(checkTitleName);
</span><span style="color: #008080;">31</span>                         resultCell.setCellValue("Failed"<span style="color: #000000;">);
</span><span style="color: #008080;">32</span>                         flag = <span style="color: #0000ff;">true</span><span style="color: #000000;">;
</span><span style="color: #008080;">33</span>                         <span style="color: #0000ff;">break</span><span style="color: #000000;">;
</span><span style="color: #008080;">34</span> <span style="color: #000000;">                    }
</span><span style="color: #008080;">35</span>                     <span style="color: #0000ff;">if</span> (cell != <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
</span><span style="color: #008080;">36</span> <span style="color: #000000;">                        cell.setCellType(CellType.STRING);
</span><span style="color: #008080;">37</span> <span style="color: #000000;">                        jsonObject.put(titleName, cell.toString());
</span><span style="color: #008080;">38</span> <span style="color: #000000;">                    }
</span><span style="color: #008080;">39</span> 
<span style="color: #008080;">40</span> <span style="color: #000000;">                }
</span><span style="color: #008080;">41</span>                 <span style="color: #0000ff;">if</span><span style="color: #000000;"> (flag) {
</span><span style="color: #008080;">42</span>                     rIndex = 0<span style="color: #000000;">;
</span><span style="color: #008080;">43</span>                     lastRowIndex = 0<span style="color: #000000;">;
</span><span style="color: #008080;">44</span>                 } <span style="color: #0000ff;">else</span><span style="color: #000000;"> {
</span><span style="color: #008080;">45</span> <span style="color: #000000;">                    vapBatchPersonInfo.setBatchNo(uuid);
</span><span style="color: #008080;">46</span>                     vapBatchPersonInfo.setName(jsonObject.getString("fullName"<span style="color: #000000;">));
</span><span style="color: #008080;">47</span>                     vapBatchPersonInfo.setImageName(jsonObject.getString("imageName"<span style="color: #000000;">));
</span><span style="color: #008080;">48</span>                     vapBatchPersonInfo.setConfidenceThreshold(jsonObject.getString("confidenceThreshold"<span style="color: #000000;">));
</span><span style="color: #008080;">49</span>                     vapBatchPersonInfo.setCreatedId(jsonObject.getString("createdId"<span style="color: #000000;">));
</span><span style="color: #008080;">50</span>                     vapBatchPersonInfo.setIdentityNo(jsonObject.getString("identityNo"<span style="color: #000000;">));
</span><span style="color: #008080;">51</span>                     vapBatchPersonInfo.setCreatedDate(<span style="color: #0000ff;">new</span><span style="color: #000000;"> Date());
</span><span style="color: #008080;">52</span>                     vapBatchPersonInfo.setLastUpdatedId(jsonObject.getString("createdId"<span style="color: #000000;">));
</span><span style="color: #008080;">53</span>                     vapBatchPersonInfo.setLastUpdatedDate(<span style="color: #0000ff;">new</span><span style="color: #000000;"> Date());
</span><span style="color: #008080;">54</span> <span style="color: #000000;">                    vapBatchPersonInfo.setStatus(TaskStatus.RUNNING);
</span><span style="color: #008080;">55</span> <span style="color: #000000;">                    batchPersonList.add(vapBatchPersonInfo);
</span><span style="color: #008080;">56</span> <span style="color: #000000;">                }
</span><span style="color: #008080;">57</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">58</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">59</span> <span style="color: #000000;">        batchPersonInfoRepository.saveAll(batchPersonList);
</span><span style="color: #008080;">60</span>         
<span style="color: #008080;">61</span>     }</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<p>第⑥个方法：parseImageFile方法是解析图片的方法</p>
<src class="cnblogs_code" onclick="cnblogs_code_show('d6c29502-6139-44d7-b1b5-0076fdf6d21d')"><img id="code_img_closed_d6c29502-6139-44d7-b1b5-0076fdf6d21d" class="code_img_closed" src="./images/Java 上传解压zip文件，并且解析文件里面的excel和图片0.png" alt="" /><img id="code_img_opened_d6c29502-6139-44d7-b1b5-0076fdf6d21d" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('d6c29502-6139-44d7-b1b5-0076fdf6d21d',event)" src="./images/Java 上传解压zip文件，并且解析文件里面的excel和图片1.png" alt="" />
<src id="cnblogs_code_open_d6c29502-6139-44d7-b1b5-0076fdf6d21d" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span>     <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">void</span> parseImageFile(File file, String createdId, String uuid) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> Exception {
</span><span style="color: #008080;"> 2</span>         
<span style="color: #008080;"> 3</span>         String imgStr =""<span style="color: #000000;">;
</span><span style="color: #008080;"> 4</span>         FileInputStream fis = <span style="color: #0000ff;">new</span><span style="color: #000000;"> FileInputStream(file);
</span><span style="color: #008080;"> 5</span>         <span style="color: #0000ff;">byte</span>[] buffer = <span style="color: #0000ff;">new</span> <span style="color: #0000ff;">byte</span>[(<span style="color: #0000ff;">int</span><span style="color: #000000;">) file.length()]; 
</span><span style="color: #008080;"> 6</span>         <span style="color: #0000ff;">int</span> offset = 0<span style="color: #000000;">; 
</span><span style="color: #008080;"> 7</span>         <span style="color: #0000ff;">int</span> numRead = 0<span style="color: #000000;">; 
</span><span style="color: #008080;"> 8</span>         <span style="color: #0000ff;">while</span> (offset &lt; buffer.length &amp;&amp; (numRead = fis.read(buffer, offset, buffer.length - offset)) &gt;= 0<span style="color: #000000;">) {
</span><span style="color: #008080;"> 9</span>             offset +=<span style="color: #000000;"> numRead;
</span><span style="color: #008080;">10</span> <span style="color: #000000;">        } 
</span><span style="color: #008080;">11</span>         <span style="color: #0000ff;">if</span> (offset !=<span style="color: #000000;"> buffer.length) { 
</span><span style="color: #008080;">12</span>             <span style="color: #0000ff;">throw</span> <span style="color: #0000ff;">new</span> IOException("Could not completely read file " +<span style="color: #000000;"> file.getName()); 
</span><span style="color: #008080;">13</span> <span style="color: #000000;">        } 
</span><span style="color: #008080;">14</span> <span style="color: #000000;">        fis.close(); 
</span><span style="color: #008080;">15</span>         Base64 encoder = <span style="color: #0000ff;">new</span><span style="color: #000000;"> Base64();
</span><span style="color: #008080;">16</span>         imgStr =<span style="color: #000000;"> Base64.encodeBase64String(buffer);
</span><span style="color: #008080;">17</span> <span style="color: #000000;">        imgStr.length();
</span><span style="color: #008080;">18</span>         LogUtils.info("file name:"+<span style="color: #000000;">file.getName());
</span><span style="color: #008080;">19</span> <span style="color: #008000;">//</span><span style="color: #008000;">        LogUtils.info("file imgStr:"+imgStr);
</span><span style="color: #008080;">20</span> <span style="color: #008000;">//</span><span style="color: #008000;">        LogUtils.info("file imgStr.length:"+imgStr.length());</span>
<span style="color: #008080;">21</span> 
<span style="color: #008080;">22</span>     }</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<p>&nbsp;最后附上FileConfig和FileUtil的代码</p>
<p>FileConfig代码：</p>
<src class="cnblogs_code" onclick="cnblogs_code_show('23bdf88c-eef4-4b1e-af07-835772453eb1')"><img id="code_img_closed_23bdf88c-eef4-4b1e-af07-835772453eb1" class="code_img_closed" src="./images/Java 上传解压zip文件，并且解析文件里面的excel和图片0.png" alt="" /><img id="code_img_opened_23bdf88c-eef4-4b1e-af07-835772453eb1" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('23bdf88c-eef4-4b1e-af07-835772453eb1',event)" src="./images/Java 上传解压zip文件，并且解析文件里面的excel和图片1.png" alt="" />
<src id="cnblogs_code_open_23bdf88c-eef4-4b1e-af07-835772453eb1" class="cnblogs_code_hide">
<pre><code><span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.boot.context.properties.ConfigurationProperties;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.core.annotation.Order;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.stereotype.Component;

</span><span style="color: #008000;">/**</span><span style="color: #008000;">
 *Jun 12, 2019
 * 
 * FileConfig.java
 </span><span style="color: #008000;">*/</span><span style="color: #000000;">
@ConfigurationProperties(prefix </span>= "upload"<span style="color: #000000;">)
@Component
@Order
</span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> FileConfig {
    
    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span><span style="color: #000000;"> String localtion;    
    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span><span style="color: #000000;"> String maxFileSize;    
    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span><span style="color: #000000;"> String maxRequestSize;    

    </span><span style="color: #008000;">/**</span><span style="color: #008000;">
     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> localtion the localtion to set
     </span><span style="color: #008000;">*/</span>
    <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> setLocaltion(String localtion) {
        FileConfig.localtion </span>=<span style="color: #000000;"> localtion;
    }

    </span><span style="color: #008000;">/**</span><span style="color: #008000;">
     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> maxFileSize the maxFileSize to set
     </span><span style="color: #008000;">*/</span>
    <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> setMaxFileSize(String maxFileSize) {
        FileConfig.maxFileSize </span>=<span style="color: #000000;"> maxFileSize;
    }

    </span><span style="color: #008000;">/**</span><span style="color: #008000;">
     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> maxRequestSize the maxRequestSize to set
     </span><span style="color: #008000;">*/</span>
    <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> setMaxRequestSize(String maxRequestSize) {
        FileConfig.maxRequestSize </span>=<span style="color: #000000;"> maxRequestSize;
    }
    
    
}</span></code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<p>FileConfig类里面读取的配置文件信息：</p>
<p>配置文件类型是yml,大家也可以自己改成properties文件格式</p>
<src class="cnblogs_code">
<pre><code><span style="color: #000000;">upload: 
  #localtion: ${UPLOAD_DIR:</span>/home/data/<span style="color: #000000;">test}
  localtion: ${UPLOAD_DIR:D:</span>/<span style="color: #000000;">test}
  maxFileSize: 10240KB 
  maxRequestSize: 102400KB  </span></code></pre>

<p>FileUtil类的代码：</p>
<src class="cnblogs_code" onclick="cnblogs_code_show('7992bea0-bc57-4608-9ebb-393734c77256')"><img id="code_img_closed_7992bea0-bc57-4608-9ebb-393734c77256" class="code_img_closed" src="./images/Java 上传解压zip文件，并且解析文件里面的excel和图片0.png" alt="" /><img id="code_img_opened_7992bea0-bc57-4608-9ebb-393734c77256" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('7992bea0-bc57-4608-9ebb-393734c77256',event)" src="./images/Java 上传解压zip文件，并且解析文件里面的excel和图片1.png" alt="" />
<src id="cnblogs_code_open_7992bea0-bc57-4608-9ebb-393734c77256" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;">  1</span> <span style="color: #0000ff;">import</span> java.io.*<span style="color: #000000;">;
</span><span style="color: #008080;">  2</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.nio.channels.FileChannel;
</span><span style="color: #008080;">  3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.nio.file.Files;
</span><span style="color: #008080;">  4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.nio.file.Path;
</span><span style="color: #008080;">  5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.nio.file.Paths;
</span><span style="color: #008080;">  6</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.nio.file.attribute.PosixFilePermission;
</span><span style="color: #008080;">  7</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.ArrayList;
</span><span style="color: #008080;">  8</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.Enumeration;
</span><span style="color: #008080;">  9</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.HashSet;
</span><span style="color: #008080;"> 10</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.List;
</span><span style="color: #008080;"> 11</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.Set;
</span><span style="color: #008080;"> 12</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.zip.ZipEntry;
</span><span style="color: #008080;"> 13</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.zip.ZipFile;
</span><span style="color: #008080;"> 14</span> 
<span style="color: #008080;"> 15</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.web.multipart.MultipartFile;
</span><span style="color: #008080;"> 16</span> 
<span style="color: #008080;"> 17</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> sg.com.mha.ummi.common.util.LogUtils;
</span><span style="color: #008080;"> 18</span> 
<span style="color: #008080;"> 19</span> 
<span style="color: #008080;"> 20</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> FileUtil {
</span><span style="color: #008080;"> 21</span>     
<span style="color: #008080;"> 22</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> clearFiles(String workspaceRootPath) {
</span><span style="color: #008080;"> 23</span>         File file = <span style="color: #0000ff;">new</span><span style="color: #000000;"> File(workspaceRootPath);
</span><span style="color: #008080;"> 24</span> <span style="color: #000000;">        deleteFile(file);
</span><span style="color: #008080;"> 25</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 26</span> 
<span style="color: #008080;"> 27</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> deleteFile(File file) {
</span><span style="color: #008080;"> 28</span>         <span style="color: #0000ff;">if</span><span style="color: #000000;"> (file.exists()) {
</span><span style="color: #008080;"> 29</span>             <span style="color: #0000ff;">if</span><span style="color: #000000;"> (file.isDirectory()) {
</span><span style="color: #008080;"> 30</span>                 File[] files =<span style="color: #000000;"> file.listFiles();
</span><span style="color: #008080;"> 31</span>                 <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">int</span> i = 0; i &lt; files.length; i++<span style="color: #000000;">) {
</span><span style="color: #008080;"> 32</span> <span style="color: #000000;">                    deleteFile(files[i]);
</span><span style="color: #008080;"> 33</span> <span style="color: #000000;">                }
</span><span style="color: #008080;"> 34</span> <span style="color: #000000;">            }
</span><span style="color: #008080;"> 35</span> <span style="color: #000000;">        }
</span><span style="color: #008080;"> 36</span> <span style="color: #000000;">        file.delete();
</span><span style="color: #008080;"> 37</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 38</span> 
<span style="color: #008080;"> 39</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span> fileWrite(String str, String fileNamePath) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> IOException {
</span><span style="color: #008080;"> 40</span>         FileWriter writer = <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 41</span>         <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;"> 42</span>             File file = <span style="color: #0000ff;">new</span><span style="color: #000000;"> File(fileNamePath);
</span><span style="color: #008080;"> 43</span>             <span style="color: #0000ff;">if</span> (!<span style="color: #000000;">file.getParentFile().exists()) {
</span><span style="color: #008080;"> 44</span> <span style="color: #000000;">                file.getParentFile().mkdirs();
</span><span style="color: #008080;"> 45</span> <span style="color: #000000;">                file.createNewFile();
</span><span style="color: #008080;"> 46</span> <span style="color: #000000;">            }
</span><span style="color: #008080;"> 47</span>             writer = <span style="color: #0000ff;">new</span> FileWriter(file, <span style="color: #0000ff;">true</span><span style="color: #000000;">);
</span><span style="color: #008080;"> 48</span>             writer.write(str + System.getProperty("line.separator"<span style="color: #000000;">));
</span><span style="color: #008080;"> 49</span> 
<span style="color: #008080;"> 50</span>         } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (IOException e) {
</span><span style="color: #008080;"> 51</span> <span style="color: #000000;">            LogUtils.error(e.getMessage());
</span><span style="color: #008080;"> 52</span>         } <span style="color: #0000ff;">finally</span><span style="color: #000000;"> {
</span><span style="color: #008080;"> 53</span>             <span style="color: #0000ff;">if</span> (writer != <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
</span><span style="color: #008080;"> 54</span> <span style="color: #000000;">                writer.close();
</span><span style="color: #008080;"> 55</span> <span style="color: #000000;">            }
</span><span style="color: #008080;"> 56</span> <span style="color: #000000;">        }
</span><span style="color: #008080;"> 57</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 58</span> 
<span style="color: #008080;"> 59</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span> changePermission(File dirFile, <span style="color: #0000ff;">int</span> mode) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> IOException {
</span><span style="color: #008080;"> 60</span>         <span style="color: #0000ff;">char</span>[] modes =<span style="color: #000000;"> Integer.toOctalString(mode).toCharArray();
</span><span style="color: #008080;"> 61</span>         <span style="color: #0000ff;">if</span> (modes.length != 3<span style="color: #000000;">) {
</span><span style="color: #008080;"> 62</span>             <span style="color: #0000ff;">return</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 63</span> <span style="color: #000000;">        }
</span><span style="color: #008080;"> 64</span>         Set&lt;PosixFilePermission&gt; perms = <span style="color: #0000ff;">new</span> HashSet&lt;PosixFilePermission&gt;<span style="color: #000000;">();
</span><span style="color: #008080;"> 65</span>         <span style="color: #0000ff;">switch</span> (modes[0<span style="color: #000000;">]) {
</span><span style="color: #008080;"> 66</span>             <span style="color: #0000ff;">case</span> '1'<span style="color: #000000;">:
</span><span style="color: #008080;"> 67</span> <span style="color: #000000;">                perms.add(PosixFilePermission.OWNER_EXECUTE);
</span><span style="color: #008080;"> 68</span>                 <span style="color: #0000ff;">break</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 69</span>             <span style="color: #0000ff;">case</span> '2'<span style="color: #000000;">:
</span><span style="color: #008080;"> 70</span> <span style="color: #000000;">                perms.add(PosixFilePermission.OWNER_WRITE);
</span><span style="color: #008080;"> 71</span>                 <span style="color: #0000ff;">break</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 72</span>             <span style="color: #0000ff;">case</span> '4'<span style="color: #000000;">:
</span><span style="color: #008080;"> 73</span> <span style="color: #000000;">                perms.add(PosixFilePermission.OWNER_READ);
</span><span style="color: #008080;"> 74</span>                 <span style="color: #0000ff;">break</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 75</span>             <span style="color: #0000ff;">case</span> '5'<span style="color: #000000;">:
</span><span style="color: #008080;"> 76</span> <span style="color: #000000;">                perms.add(PosixFilePermission.OWNER_READ);
</span><span style="color: #008080;"> 77</span> <span style="color: #000000;">                perms.add(PosixFilePermission.OWNER_EXECUTE);
</span><span style="color: #008080;"> 78</span>                 <span style="color: #0000ff;">break</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 79</span>             <span style="color: #0000ff;">case</span> '6'<span style="color: #000000;">:
</span><span style="color: #008080;"> 80</span> <span style="color: #000000;">                perms.add(PosixFilePermission.OWNER_READ);
</span><span style="color: #008080;"> 81</span> <span style="color: #000000;">                perms.add(PosixFilePermission.OWNER_WRITE);
</span><span style="color: #008080;"> 82</span>                 <span style="color: #0000ff;">break</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 83</span>             <span style="color: #0000ff;">case</span> '7'<span style="color: #000000;">:
</span><span style="color: #008080;"> 84</span> <span style="color: #000000;">                perms.add(PosixFilePermission.OWNER_READ);
</span><span style="color: #008080;"> 85</span> <span style="color: #000000;">                perms.add(PosixFilePermission.OWNER_WRITE);
</span><span style="color: #008080;"> 86</span> <span style="color: #000000;">                perms.add(PosixFilePermission.OWNER_EXECUTE);
</span><span style="color: #008080;"> 87</span>                 <span style="color: #0000ff;">break</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 88</span> 
<span style="color: #008080;"> 89</span>             <span style="color: #0000ff;">default</span><span style="color: #000000;">:
</span><span style="color: #008080;"> 90</span>                 <span style="color: #0000ff;">break</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 91</span> <span style="color: #000000;">        }
</span><span style="color: #008080;"> 92</span>         <span style="color: #0000ff;">switch</span> (modes[1<span style="color: #000000;">]) {
</span><span style="color: #008080;"> 93</span>             <span style="color: #0000ff;">case</span> '1'<span style="color: #000000;">:
</span><span style="color: #008080;"> 94</span> <span style="color: #000000;">                perms.add(PosixFilePermission.GROUP_EXECUTE);
</span><span style="color: #008080;"> 95</span>                 <span style="color: #0000ff;">break</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 96</span>             <span style="color: #0000ff;">case</span> '2'<span style="color: #000000;">:
</span><span style="color: #008080;"> 97</span> <span style="color: #000000;">                perms.add(PosixFilePermission.GROUP_WRITE);
</span><span style="color: #008080;"> 98</span>                 <span style="color: #0000ff;">break</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 99</span>             <span style="color: #0000ff;">case</span> '4'<span style="color: #000000;">:
</span><span style="color: #008080;">100</span> <span style="color: #000000;">                perms.add(PosixFilePermission.GROUP_READ);
</span><span style="color: #008080;">101</span>                 <span style="color: #0000ff;">break</span><span style="color: #000000;">;
</span><span style="color: #008080;">102</span>             <span style="color: #0000ff;">case</span> '5'<span style="color: #000000;">:
</span><span style="color: #008080;">103</span> <span style="color: #000000;">                perms.add(PosixFilePermission.GROUP_READ);
</span><span style="color: #008080;">104</span> <span style="color: #000000;">                perms.add(PosixFilePermission.GROUP_EXECUTE);
</span><span style="color: #008080;">105</span>                 <span style="color: #0000ff;">break</span><span style="color: #000000;">;
</span><span style="color: #008080;">106</span>             <span style="color: #0000ff;">case</span> '6'<span style="color: #000000;">:
</span><span style="color: #008080;">107</span> <span style="color: #000000;">                perms.add(PosixFilePermission.GROUP_READ);
</span><span style="color: #008080;">108</span> <span style="color: #000000;">                perms.add(PosixFilePermission.GROUP_WRITE);
</span><span style="color: #008080;">109</span>                 <span style="color: #0000ff;">break</span><span style="color: #000000;">;
</span><span style="color: #008080;">110</span>             <span style="color: #0000ff;">case</span> '7'<span style="color: #000000;">:
</span><span style="color: #008080;">111</span> <span style="color: #000000;">                perms.add(PosixFilePermission.GROUP_READ);
</span><span style="color: #008080;">112</span> <span style="color: #000000;">                perms.add(PosixFilePermission.GROUP_WRITE);
</span><span style="color: #008080;">113</span> <span style="color: #000000;">                perms.add(PosixFilePermission.GROUP_EXECUTE);
</span><span style="color: #008080;">114</span>                 <span style="color: #0000ff;">break</span><span style="color: #000000;">;
</span><span style="color: #008080;">115</span>             <span style="color: #0000ff;">default</span><span style="color: #000000;">:
</span><span style="color: #008080;">116</span>                 <span style="color: #0000ff;">break</span><span style="color: #000000;">;
</span><span style="color: #008080;">117</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">118</span>         <span style="color: #0000ff;">switch</span> (modes[2<span style="color: #000000;">]) {
</span><span style="color: #008080;">119</span>             <span style="color: #0000ff;">case</span> '1'<span style="color: #000000;">:
</span><span style="color: #008080;">120</span> <span style="color: #000000;">                perms.add(PosixFilePermission.OTHERS_EXECUTE);
</span><span style="color: #008080;">121</span>                 <span style="color: #0000ff;">break</span><span style="color: #000000;">;
</span><span style="color: #008080;">122</span>             <span style="color: #0000ff;">case</span> '2'<span style="color: #000000;">:
</span><span style="color: #008080;">123</span> <span style="color: #000000;">                perms.add(PosixFilePermission.OTHERS_WRITE);
</span><span style="color: #008080;">124</span>                 <span style="color: #0000ff;">break</span><span style="color: #000000;">;
</span><span style="color: #008080;">125</span>             <span style="color: #0000ff;">case</span> '4'<span style="color: #000000;">:
</span><span style="color: #008080;">126</span> <span style="color: #000000;">                perms.add(PosixFilePermission.OTHERS_READ);
</span><span style="color: #008080;">127</span>                 <span style="color: #0000ff;">break</span><span style="color: #000000;">;
</span><span style="color: #008080;">128</span>             <span style="color: #0000ff;">case</span> '5'<span style="color: #000000;">:
</span><span style="color: #008080;">129</span> <span style="color: #000000;">                perms.add(PosixFilePermission.OTHERS_EXECUTE);
</span><span style="color: #008080;">130</span> <span style="color: #000000;">                perms.add(PosixFilePermission.OTHERS_READ);
</span><span style="color: #008080;">131</span>                 <span style="color: #0000ff;">break</span><span style="color: #000000;">;
</span><span style="color: #008080;">132</span>             <span style="color: #0000ff;">case</span> '6'<span style="color: #000000;">:
</span><span style="color: #008080;">133</span> <span style="color: #000000;">                perms.add(PosixFilePermission.OTHERS_READ);
</span><span style="color: #008080;">134</span> <span style="color: #000000;">                perms.add(PosixFilePermission.OTHERS_WRITE);
</span><span style="color: #008080;">135</span>                 <span style="color: #0000ff;">break</span><span style="color: #000000;">;
</span><span style="color: #008080;">136</span>             <span style="color: #0000ff;">case</span> '7'<span style="color: #000000;">:
</span><span style="color: #008080;">137</span> <span style="color: #000000;">                perms.add(PosixFilePermission.OTHERS_EXECUTE);
</span><span style="color: #008080;">138</span> <span style="color: #000000;">                perms.add(PosixFilePermission.OTHERS_READ);
</span><span style="color: #008080;">139</span> <span style="color: #000000;">                perms.add(PosixFilePermission.OTHERS_WRITE);
</span><span style="color: #008080;">140</span>                 <span style="color: #0000ff;">break</span><span style="color: #000000;">;
</span><span style="color: #008080;">141</span>             <span style="color: #0000ff;">default</span><span style="color: #000000;">:
</span><span style="color: #008080;">142</span>                 <span style="color: #0000ff;">break</span><span style="color: #000000;">;
</span><span style="color: #008080;">143</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">144</span> 
<span style="color: #008080;">145</span>         <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;">146</span>             Path path =<span style="color: #000000;"> Paths.get(dirFile.getAbsolutePath());
</span><span style="color: #008080;">147</span> <span style="color: #000000;">            Files.setPosixFilePermissions(path, perms);
</span><span style="color: #008080;">148</span>         } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (Exception e) {
</span><span style="color: #008080;">149</span> <span style="color: #000000;">            e.printStackTrace();
</span><span style="color: #008080;">150</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">151</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">152</span> 
<span style="color: #008080;">153</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span><span style="color: #000000;"> File mkFile(String fileName) {
</span><span style="color: #008080;">154</span>         File f = <span style="color: #0000ff;">new</span><span style="color: #000000;"> File(fileName);
</span><span style="color: #008080;">155</span>         <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;">156</span>             <span style="color: #0000ff;">if</span><span style="color: #000000;"> (f.exists()) {
</span><span style="color: #008080;">157</span> <span style="color: #000000;">                f.delete();
</span><span style="color: #008080;">158</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">159</span> <span style="color: #000000;">            f.createNewFile();
</span><span style="color: #008080;">160</span>         } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (IOException e) {
</span><span style="color: #008080;">161</span> <span style="color: #000000;">            e.printStackTrace();
</span><span style="color: #008080;">162</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">163</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> f;
</span><span style="color: #008080;">164</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">165</span> 
<span style="color: #008080;">166</span> 
<span style="color: #008080;">167</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span> copyDirAndFile(String oldPath, String newPath) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> IOException {
</span><span style="color: #008080;">168</span>         <span style="color: #0000ff;">if</span> (!(<span style="color: #0000ff;">new</span><span style="color: #000000;"> File(newPath)).exists()) {
</span><span style="color: #008080;">169</span>             (<span style="color: #0000ff;">new</span><span style="color: #000000;"> File(newPath)).mkdir();
</span><span style="color: #008080;">170</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">171</span>         File file = <span style="color: #0000ff;">new</span><span style="color: #000000;"> File(oldPath);
</span><span style="color: #008080;">172</span>         <span style="color: #008000;">//</span><span style="color: #008000;">file name list</span>
<span style="color: #008080;">173</span>         String[] filePaths =<span style="color: #000000;"> file.list();
</span><span style="color: #008080;">174</span>         <span style="color: #0000ff;">for</span><span style="color: #000000;"> (String filePath : filePaths) {
</span><span style="color: #008080;">175</span>             String oldFullPath = oldPath + file.separator +<span style="color: #000000;"> filePath;
</span><span style="color: #008080;">176</span>             String newFullPath = newPath + file.separator +<span style="color: #000000;"> filePath;
</span><span style="color: #008080;">177</span>             File oldFile = <span style="color: #0000ff;">new</span><span style="color: #000000;"> File(oldFullPath);
</span><span style="color: #008080;">178</span>             File newFile = <span style="color: #0000ff;">new</span><span style="color: #000000;"> File(newFullPath);
</span><span style="color: #008080;">179</span>             <span style="color: #0000ff;">if</span><span style="color: #000000;"> (oldFile.isDirectory()) {
</span><span style="color: #008080;">180</span> <span style="color: #000000;">                copyDirAndFile(oldFullPath, newFullPath);
</span><span style="color: #008080;">181</span>             } <span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span><span style="color: #000000;"> (oldFile.isFile()) {
</span><span style="color: #008080;">182</span> <span style="color: #000000;">                copyFile(oldFile, newFile);
</span><span style="color: #008080;">183</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">184</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">185</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">186</span> 
<span style="color: #008080;">187</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span> copyFile(File source, File dest) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> IOException {
</span><span style="color: #008080;">188</span>         FileChannel inputChannel = <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;">189</span>         FileChannel outputChannel = <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;">190</span>         <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;">191</span>             inputChannel = <span style="color: #0000ff;">new</span><span style="color: #000000;"> FileInputStream(source).getChannel();
</span><span style="color: #008080;">192</span>             outputChannel = <span style="color: #0000ff;">new</span><span style="color: #000000;"> FileOutputStream(dest).getChannel();
</span><span style="color: #008080;">193</span>             outputChannel.transferFrom(inputChannel, 0<span style="color: #000000;">, inputChannel.size());
</span><span style="color: #008080;">194</span>         } <span style="color: #0000ff;">finally</span><span style="color: #000000;"> {
</span><span style="color: #008080;">195</span> <span style="color: #000000;">            inputChannel.close();
</span><span style="color: #008080;">196</span> <span style="color: #000000;">            outputChannel.close();
</span><span style="color: #008080;">197</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">198</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">199</span>     
<span style="color: #008080;">200</span>     <span style="color: #008000;">/**</span>
<span style="color: #008080;">201</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@author</span><span style="color: #008000;"> panchaoyuan
</span><span style="color: #008080;">202</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> srcFile    Unzipped file
</span><span style="color: #008080;">203</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> destDirPath   Unzipped destination folder
</span><span style="color: #008080;">204</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@throws</span><span style="color: #008000;"> RuntimeException
</span><span style="color: #008080;">205</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@throws</span><span style="color: #008000;"> IOException 
</span><span style="color: #008080;">206</span>      <span style="color: #008000;">*/</span>
<span style="color: #008080;">207</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span> unZip(MultipartFile  srcFile, String destDirPath,String savePath) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> RuntimeException, IOException {
</span><span style="color: #008080;">208</span>         <span style="color: #0000ff;">long</span> startTime =<span style="color: #000000;"> System.currentTimeMillis();
</span><span style="color: #008080;">209</span>         
<span style="color: #008080;">210</span>         File file = <span style="color: #0000ff;">null</span><span style="color: #000000;">;  
</span><span style="color: #008080;">211</span>         InputStream ins =<span style="color: #000000;"> srcFile.getInputStream();  
</span><span style="color: #008080;">212</span>         file=<span style="color: #0000ff;">new</span> File(savePath+<span style="color: #000000;">srcFile.getOriginalFilename()); 
</span><span style="color: #008080;">213</span>         LogUtils.info("MultipartFile transform to File,MultipartFile name:"+<span style="color: #000000;">srcFile.getOriginalFilename());
</span><span style="color: #008080;">214</span> <span style="color: #000000;">        inputStreamToFile(ins, file);  
</span><span style="color: #008080;">215</span>         
<span style="color: #008080;">216</span>         <span style="color: #0000ff;">if</span> (!<span style="color: #000000;">file.exists()) {
</span><span style="color: #008080;">217</span>             <span style="color: #0000ff;">throw</span> <span style="color: #0000ff;">new</span> RuntimeException(file.getPath() + ",file is not found"<span style="color: #000000;">);
</span><span style="color: #008080;">218</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">219</span>         ZipFile zipFile = <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;">220</span>         <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;">221</span>             zipFile = <span style="color: #0000ff;">new</span><span style="color: #000000;"> ZipFile(file);
</span><span style="color: #008080;">222</span>             Enumeration&lt;?&gt; entries =<span style="color: #000000;"> zipFile.entries();
</span><span style="color: #008080;">223</span>             <span style="color: #0000ff;">while</span><span style="color: #000000;"> (entries.hasMoreElements()) {
</span><span style="color: #008080;">224</span>                 ZipEntry entry =<span style="color: #000000;"> (ZipEntry) entries.nextElement();
</span><span style="color: #008080;">225</span>                 LogUtils.info("zipFile context name:"+<span style="color: #000000;">entry.getName());
</span><span style="color: #008080;">226</span>                 <span style="color: #0000ff;">if</span><span style="color: #000000;"> (entry.isDirectory()) {
</span><span style="color: #008080;">227</span>                     String dirPath = destDirPath + File.separator+<span style="color: #000000;"> entry.getName();
</span><span style="color: #008080;">228</span>                     File dir = <span style="color: #0000ff;">new</span><span style="color: #000000;"> File(dirPath);
</span><span style="color: #008080;">229</span> <span style="color: #000000;">                    dir.mkdirs();
</span><span style="color: #008080;">230</span>                 }<span style="color: #0000ff;">else</span><span style="color: #000000;"> {
</span><span style="color: #008080;">231</span>                     File targetFile = <span style="color: #0000ff;">new</span> File(destDirPath + File.separator +<span style="color: #000000;"> entry.getName());
</span><span style="color: #008080;">232</span>                     targetFile.setExecutable(<span style="color: #0000ff;">true</span><span style="color: #000000;">);
</span><span style="color: #008080;">233</span>                     <span style="color: #0000ff;">if</span>(!<span style="color: #000000;">targetFile.getParentFile().exists()){
</span><span style="color: #008080;">234</span> <span style="color: #000000;">                        targetFile.getParentFile().mkdirs();
</span><span style="color: #008080;">235</span> <span style="color: #000000;">                    }
</span><span style="color: #008080;">236</span> <span style="color: #000000;">                    targetFile.createNewFile();
</span><span style="color: #008080;">237</span>                     InputStream is =<span style="color: #000000;"> zipFile.getInputStream(entry);
</span><span style="color: #008080;">238</span>                     FileOutputStream fos = <span style="color: #0000ff;">new</span><span style="color: #000000;"> FileOutputStream(targetFile);
</span><span style="color: #008080;">239</span>                     <span style="color: #0000ff;">int</span><span style="color: #000000;"> len;
</span><span style="color: #008080;">240</span>                     <span style="color: #0000ff;">byte</span>[] buf = <span style="color: #0000ff;">new</span> <span style="color: #0000ff;">byte</span>[1024<span style="color: #000000;">];
</span><span style="color: #008080;">241</span>                     <span style="color: #0000ff;">while</span> ((len = is.read(buf)) != -1<span style="color: #000000;">) {
</span><span style="color: #008080;">242</span>                         fos.write(buf, 0<span style="color: #000000;">, len);
</span><span style="color: #008080;">243</span> <span style="color: #000000;">                    }
</span><span style="color: #008080;">244</span> <span style="color: #000000;">                    fos.close();
</span><span style="color: #008080;">245</span> <span style="color: #000000;">                    is.close();
</span><span style="color: #008080;">246</span> <span style="color: #000000;">                }
</span><span style="color: #008080;">247</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">248</span>             <span style="color: #0000ff;">long</span> endTime =<span style="color: #000000;"> System.currentTimeMillis();
</span><span style="color: #008080;">249</span>             LogUtils.info("unZip time--&gt;" + (endTime - startTime) + " ms"<span style="color: #000000;">);
</span><span style="color: #008080;">250</span>         }<span style="color: #0000ff;">catch</span><span style="color: #000000;">(Exception e) {
</span><span style="color: #008080;">251</span>             <span style="color: #0000ff;">throw</span> <span style="color: #0000ff;">new</span> RuntimeException("unzip error from FileUtil"<span style="color: #000000;">, e);
</span><span style="color: #008080;">252</span>         } <span style="color: #0000ff;">finally</span><span style="color: #000000;"> {
</span><span style="color: #008080;">253</span>             <span style="color: #0000ff;">if</span>(zipFile != <span style="color: #0000ff;">null</span><span style="color: #000000;">){
</span><span style="color: #008080;">254</span>                 <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;">255</span> <span style="color: #000000;">                    zipFile.close();
</span><span style="color: #008080;">256</span>                 } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (IOException e) {
</span><span style="color: #008080;">257</span> <span style="color: #000000;">                    e.printStackTrace();
</span><span style="color: #008080;">258</span> <span style="color: #000000;">                }
</span><span style="color: #008080;">259</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">260</span>             
<span style="color: #008080;">261</span>             <span style="color: #008000;">//</span><span style="color: #008000;">MultipartFile change to file may create a temp file in the project root folder(delete the temp file)</span>
<span style="color: #008080;">262</span>             File del = <span style="color: #0000ff;">new</span><span style="color: #000000;"> File(file.toURI());  
</span><span style="color: #008080;">263</span> <span style="color: #000000;">            del.delete(); 
</span><span style="color: #008080;">264</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">265</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">266</span> 
<span style="color: #008080;">267</span>     <span style="color: #008000;">/**</span>
<span style="color: #008080;">268</span> <span style="color: #008000;">     * MultipartFile changed to File
</span><span style="color: #008080;">269</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@author</span><span style="color: #008000;"> panchaoyuan
</span><span style="color: #008080;">270</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@return</span> 
<span style="color: #008080;">271</span>      <span style="color: #008000;">*/</span>
<span style="color: #008080;">272</span>     <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> inputStreamToFile(InputStream ins, File file) {
</span><span style="color: #008080;">273</span>         <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;">274</span>             OutputStream os = <span style="color: #0000ff;">new</span><span style="color: #000000;"> FileOutputStream(file);
</span><span style="color: #008080;">275</span>             <span style="color: #0000ff;">int</span> bytesRead = 0<span style="color: #000000;">;
</span><span style="color: #008080;">276</span>             <span style="color: #0000ff;">byte</span>[] buffer = <span style="color: #0000ff;">new</span> <span style="color: #0000ff;">byte</span>[8192<span style="color: #000000;">];
</span><span style="color: #008080;">277</span>             <span style="color: #0000ff;">while</span> ((bytesRead = ins.read(buffer, 0, 8192)) != -1<span style="color: #000000;">) {
</span><span style="color: #008080;">278</span>                 os.write(buffer, 0<span style="color: #000000;">, bytesRead);
</span><span style="color: #008080;">279</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">280</span> <span style="color: #000000;">            os.close();
</span><span style="color: #008080;">281</span> <span style="color: #000000;">            ins.close();
</span><span style="color: #008080;">282</span>             LogUtils.info("MultipartFile transform to File completed!"<span style="color: #000000;">);
</span><span style="color: #008080;">283</span>         }<span style="color: #0000ff;">catch</span><span style="color: #000000;">(Exception e) {
</span><span style="color: #008080;">284</span> <span style="color: #000000;">            e.printStackTrace();
</span><span style="color: #008080;">285</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">286</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">287</span> 
<span style="color: #008080;">288</span>       <span style="color: #008000;">/**</span>
<span style="color: #008080;">289</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@author</span><span style="color: #008000;"> panchaoyuan
</span><span style="color: #008080;">290</span>      <span style="color: #008000;">*/</span>
<span style="color: #008080;">291</span>     <span style="color: #0000ff;">public</span> List&lt;File&gt; getSubFiles(String  desFile,List&lt;File&gt;<span style="color: #000000;"> fileList) {
</span><span style="color: #008080;">292</span>         File file = <span style="color: #0000ff;">new</span><span style="color: #000000;"> File(desFile);
</span><span style="color: #008080;">293</span>         File[] files =<span style="color: #000000;"> file.listFiles();
</span><span style="color: #008080;">294</span>         <span style="color: #0000ff;">for</span><span style="color: #000000;"> (File fileIndex : files) {
</span><span style="color: #008080;">295</span>             <span style="color: #0000ff;">if</span> (!<span style="color: #000000;">fileIndex.exists()) {
</span><span style="color: #008080;">296</span>                 <span style="color: #0000ff;">throw</span> <span style="color: #0000ff;">new</span> NullPointerException("Cannot find " +<span style="color: #000000;"> fileIndex);
</span><span style="color: #008080;">297</span>             } <span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span><span style="color: #000000;"> (fileIndex.isFile()) {
</span><span style="color: #008080;">298</span> <span style="color: #000000;">                fileList.add(fileIndex);
</span><span style="color: #008080;">299</span>             } <span style="color: #0000ff;">else</span><span style="color: #000000;"> {
</span><span style="color: #008080;">300</span>                 <span style="color: #0000ff;">if</span><span style="color: #000000;"> (fileIndex.isDirectory()) {
</span><span style="color: #008080;">301</span> <span style="color: #000000;">                    getSubFiles(fileIndex.getAbsolutePath(),fileList);
</span><span style="color: #008080;">302</span> <span style="color: #000000;">                }
</span><span style="color: #008080;">303</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">304</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">305</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> fileList;
</span><span style="color: #008080;">306</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">307</span>     
<span style="color: #008080;">308</span>     
<span style="color: #008080;">309</span> }</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<p>&nbsp;</p>
<p>水平有限，可能写得不是很完整，大家copy这些代码的时候有可能因为引入包的不同，不一定走得成功，如有疑问，在评论区联系本人，写得不好的地方也欢迎指正。</p>

</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>