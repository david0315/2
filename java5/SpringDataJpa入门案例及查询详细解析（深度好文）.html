<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修SpringDataJpa入门案例及查询详细解析（深度好文）' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>SpringDataJpa入门案例及查询详细解析（深度好文）</center></div><div class='banquan'>原文出处:本文由博客园博主小中配奇提供。<br/>
原文连接:https://www.cnblogs.com/xiaozhongfeixiang/p/11461258.html</div><br>
    <h1>&nbsp;SpringDataJpaSpring Data JPA</h1>
<p><span style="color: #000000;">让我们解脱了DA0层的操作，基本上所有CRUD都可以依赖于它来实现，在实际的工作工程中，推荐使用Spring Data JPA+ORM（如：hibernate）完成操作，这样在切换不同的ORM框架时提供了极大的方便，同时也<strong>使数据库层操作更加简单，方便解耦。</strong></span></p>
<p>&nbsp;</p>
<p><span style="color: #ff6600;"><strong>把JPA规范的代码封装起来，真正进行查询的还是hibernate或mybatis&nbsp; &gt;&gt;（封装了jdbc操作）,然后进行查询或操作数据库。</strong></span></p>
<p><span style="color: #000000;"><strong><img src="./images/SpringDataJpa入门案例及查询详细解析（深度好文）0.png" alt="" width="575" height="341" /></strong></span></p>
<h1>&nbsp;SpringDataJpa入门操作（搭建环境）</h1>
<h2>创建工程，导入坐标</h2>
<src class="cnblogs_code" onclick="cnblogs_code_show('6e85541a-40b6-4dc8-81b4-98b2456f16b5')"><img id="code_img_closed_6e85541a-40b6-4dc8-81b4-98b2456f16b5" class="code_img_closed" src="./images/SpringDataJpa入门案例及查询详细解析（深度好文）1.png" alt="" /><img id="code_img_opened_6e85541a-40b6-4dc8-81b4-98b2456f16b5" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('6e85541a-40b6-4dc8-81b4-98b2456f16b5',event)" src="./images/SpringDataJpa入门案例及查询详细解析（深度好文）2.png" alt="" />
<src id="cnblogs_code_open_6e85541a-40b6-4dc8-81b4-98b2456f16b5" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;">  1</span> &lt;?xml version="1.0" encoding="UTF-8"?&gt;
<span style="color: #008080;">  2</span> &lt;project xmlns="http://maven.apache.org/POM/4.0.0"
<span style="color: #008080;">  3</span>          xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
<span style="color: #008080;">  4</span>          xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
<span style="color: #008080;">  5</span>     &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
<span style="color: #008080;">  6</span> 
<span style="color: #008080;">  7</span>     &lt;groupId&gt;cn.itcast&lt;/groupId&gt;
<span style="color: #008080;">  8</span>     &lt;artifactId&gt;jpa-day02&lt;/artifactId&gt;
<span style="color: #008080;">  9</span>     &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
<span style="color: #008080;"> 10</span> 
<span style="color: #008080;"> 11</span>     &lt;properties&gt;
<span style="color: #008080;"> 12</span>         &lt;spring.version&gt;5.0.2.RELEASE&lt;/spring.version&gt;
<span style="color: #008080;"> 13</span>         &lt;hibernate.version&gt;5.0.7.Final&lt;/hibernate.version&gt;
<span style="color: #008080;"> 14</span>         &lt;s1f4j.version&gt;1.6.6&lt;/s1f4j.version&gt;
<span style="color: #008080;"> 15</span>         &lt;log4j.version&gt;1.2.12&lt;/log4j.version&gt;
<span style="color: #008080;"> 16</span>         &lt;c3pe.version&gt;0.9.1.2&lt;/c3pe.version&gt;
<span style="color: #008080;"> 17</span>         &lt;mysql.version&gt;5.1.6&lt;/mysql.version&gt;
<span style="color: #008080;"> 18</span>     &lt;/properties&gt;
<span style="color: #008080;"> 19</span> 
<span style="color: #008080;"> 20</span>     &lt;dependencies&gt;
<span style="color: #008080;"> 21</span>         &lt;!--junit单元测试--&gt;
<span style="color: #008080;"> 22</span>         &lt;dependency&gt;
<span style="color: #008080;"> 23</span>             &lt;groupId&gt;junit&lt;/groupId&gt;
<span style="color: #008080;"> 24</span>             &lt;artifactId&gt;junit&lt;/artifactId&gt;
<span style="color: #008080;"> 25</span>             &lt;version&gt;4.9&lt;/version&gt;
<span style="color: #008080;"> 26</span>             &lt;scope&gt;test&lt;/scope&gt;
<span style="color: #008080;"> 27</span>         &lt;/dependency&gt;
<span style="color: #008080;"> 28</span>         &lt;!--spring beg--&gt;
<span style="color: #008080;"> 29</span>         &lt;dependency&gt;
<span style="color: #008080;"> 30</span>             &lt;groupId&gt;org.aspectj&lt;/groupId&gt;
<span style="color: #008080;"> 31</span>             &lt;artifactId&gt;aspectjweaver&lt;/artifactId&gt;
<span style="color: #008080;"> 32</span>             &lt;version&gt;1.6.8&lt;/version&gt;
<span style="color: #008080;"> 33</span>         &lt;/dependency&gt;
<span style="color: #008080;"> 34</span>         &lt;dependency&gt;
<span style="color: #008080;"> 35</span>             &lt;groupId&gt;org.springframework&lt;/groupId&gt;
<span style="color: #008080;"> 36</span>             &lt;artifactId&gt;spring-aop&lt;/artifactId&gt;
<span style="color: #008080;"> 37</span>             &lt;version&gt;${spring.version}&lt;/version&gt;
<span style="color: #008080;"> 38</span>         &lt;/dependency&gt;
<span style="color: #008080;"> 39</span>         &lt;dependency&gt;
<span style="color: #008080;"> 40</span>             &lt;groupId&gt;org.springframework&lt;/groupId&gt;
<span style="color: #008080;"> 41</span>             &lt;artifactId&gt;spring-context&lt;/artifactId&gt;
<span style="color: #008080;"> 42</span>             &lt;version&gt;${spring.version}&lt;/version&gt;
<span style="color: #008080;"> 43</span>         &lt;/dependency&gt;
<span style="color: #008080;"> 44</span>         &lt;dependency&gt;
<span style="color: #008080;"> 45</span>             &lt;groupId&gt;org.springframework&lt;/groupId&gt;
<span style="color: #008080;"> 46</span>             &lt;artifactId&gt;spring-context-support&lt;/artifactId&gt;
<span style="color: #008080;"> 47</span>             &lt;version&gt;${spring.version}&lt;/version&gt;
<span style="color: #008080;"> 48</span>         &lt;/dependency&gt;
<span style="color: #008080;"> 49</span>         &lt;!--spring对ORm框架的支持包--&gt;
<span style="color: #008080;"> 50</span>         &lt;dependency&gt;
<span style="color: #008080;"> 51</span>             &lt;groupId&gt;org.springframework&lt;/groupId&gt;
<span style="color: #008080;"> 52</span>             &lt;artifactId&gt;spring-orm&lt;/artifactId&gt;
<span style="color: #008080;"> 53</span>             &lt;version&gt;${spring.version}&lt;/version&gt;
<span style="color: #008080;"> 54</span>         &lt;/dependency&gt;
<span style="color: #008080;"> 55</span>         &lt;dependency&gt;
<span style="color: #008080;"> 56</span>             &lt;groupId&gt;org.springframework&lt;/groupId&gt;
<span style="color: #008080;"> 57</span>             &lt;artifactId&gt;spring-beans&lt;/artifactId&gt;
<span style="color: #008080;"> 58</span>             &lt;version&gt;${spring.version}&lt;/version&gt;
<span style="color: #008080;"> 59</span>         &lt;/dependency&gt;
<span style="color: #008080;"> 60</span>         &lt;dependency&gt;
<span style="color: #008080;"> 61</span>             &lt;groupId&gt;org.springframework&lt;/groupId&gt;
<span style="color: #008080;"> 62</span>             &lt;artifactId&gt;spring-core&lt;/artifactId&gt;
<span style="color: #008080;"> 63</span>             &lt;version&gt;${spring.version}&lt;/version&gt;
<span style="color: #008080;"> 64</span>         &lt;/dependency&gt;
<span style="color: #008080;"> 65</span> 
<span style="color: #008080;"> 66</span>         &lt;!--spring end--&gt;
<span style="color: #008080;"> 67</span> 
<span style="color: #008080;"> 68</span>         &lt;!--hibernate beg--&gt;
<span style="color: #008080;"> 69</span>         &lt;dependency&gt;
<span style="color: #008080;"> 70</span>             &lt;groupId&gt;org.hibernate&lt;/groupId&gt;
<span style="color: #008080;"> 71</span>             &lt;artifactId&gt;hibernate-core&lt;/artifactId&gt;
<span style="color: #008080;"> 72</span>             &lt;version&gt;${hibernate.version}&lt;/version&gt;
<span style="color: #008080;"> 73</span>         &lt;/dependency&gt;
<span style="color: #008080;"> 74</span>         &lt;dependency&gt;
<span style="color: #008080;"> 75</span>             &lt;groupId&gt;org.hibernate&lt;/groupId&gt;
<span style="color: #008080;"> 76</span>             &lt;artifactId&gt;hibernate-entitymanager&lt;/artifactId&gt;
<span style="color: #008080;"> 77</span>             &lt;version&gt;${hibernate.version}&lt;/version&gt;
<span style="color: #008080;"> 78</span>         &lt;/dependency&gt;
<span style="color: #008080;"> 79</span>         &lt;dependency&gt;
<span style="color: #008080;"> 80</span>             &lt;groupId&gt;org.hibernate&lt;/groupId&gt;
<span style="color: #008080;"> 81</span>             &lt;artifactId&gt;hibernate-validator&lt;/artifactId&gt;
<span style="color: #008080;"> 82</span>             &lt;version&gt;5.2.1.Final&lt;/version&gt;
<span style="color: #008080;"> 83</span>         &lt;/dependency&gt;
<span style="color: #008080;"> 84</span> 
<span style="color: #008080;"> 85</span>         &lt;!--hibernate end--&gt;
<span style="color: #008080;"> 86</span> 
<span style="color: #008080;"> 87</span>         &lt;!--c3p0 beg--&gt;
<span style="color: #008080;"> 88</span>         &lt;dependency&gt;
<span style="color: #008080;"> 89</span>             &lt;groupId&gt;c3p0&lt;/groupId&gt;
<span style="color: #008080;"> 90</span>             &lt;artifactId&gt;c3p0&lt;/artifactId&gt;
<span style="color: #008080;"> 91</span>             &lt;version&gt;0.9.1.2&lt;/version&gt;
<span style="color: #008080;"> 92</span>         &lt;/dependency&gt;
<span style="color: #008080;"> 93</span> 
<span style="color: #008080;"> 94</span>         &lt;!--log end--&gt;
<span style="color: #008080;"> 95</span>         &lt;dependency&gt;
<span style="color: #008080;"> 96</span>             &lt;groupId&gt;log4j&lt;/groupId&gt;
<span style="color: #008080;"> 97</span>             &lt;artifactId&gt;log4j&lt;/artifactId&gt;
<span style="color: #008080;"> 98</span>             &lt;version&gt;1.2.17&lt;/version&gt;
<span style="color: #008080;"> 99</span>         &lt;/dependency&gt;
<span style="color: #008080;">100</span>         &lt;dependency&gt;
<span style="color: #008080;">101</span>             &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
<span style="color: #008080;">102</span>             &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;
<span style="color: #008080;">103</span>             &lt;version&gt;1.7.25&lt;/version&gt;
<span style="color: #008080;">104</span>         &lt;/dependency&gt;
<span style="color: #008080;">105</span>         &lt;dependency&gt;
<span style="color: #008080;">106</span>             &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
<span style="color: #008080;">107</span>             &lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt;
<span style="color: #008080;">108</span>             &lt;version&gt;1.6.6&lt;/version&gt;
<span style="color: #008080;">109</span>         &lt;/dependency&gt;
<span style="color: #008080;">110</span>         &lt;!--log end--&gt;
<span style="color: #008080;">111</span> 
<span style="color: #008080;">112</span>         &lt;dependency&gt;
<span style="color: #008080;">113</span>             &lt;groupId&gt;mysq1&lt;/groupId&gt;
<span style="color: #008080;">114</span>             &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
<span style="color: #008080;">115</span>             &lt;version&gt;5.1.6&lt;/version&gt;
<span style="color: #008080;">116</span>         &lt;/dependency&gt;
<span style="color: #008080;">117</span>         &lt;!-- spring data jpa 的坐标 --&gt;
<span style="color: #008080;">118</span>         &lt;dependency&gt;
<span style="color: #008080;">119</span>             &lt;groupId&gt;org.springframework.data&lt;/groupId&gt;
<span style="color: #008080;">120</span>             &lt;artifactId&gt;spring-data-jpa&lt;/artifactId&gt;
<span style="color: #008080;">121</span>             &lt;version&gt;1.9.0.RELEASE&lt;/version&gt;
<span style="color: #008080;">122</span>         &lt;/dependency&gt;
<span style="color: #008080;">123</span>         &lt;dependency&gt;
<span style="color: #008080;">124</span>             &lt;groupId&gt;org.springframework&lt;/groupId&gt;
<span style="color: #008080;">125</span>             &lt;artifactId&gt;spring-test&lt;/artifactId&gt;
<span style="color: #008080;">126</span>             &lt;version&gt;4.2.4.RELEASE&lt;/version&gt;
<span style="color: #008080;">127</span>         &lt;/dependency&gt;
<span style="color: #008080;">128</span> 
<span style="color: #008080;">129</span>         &lt;!--el beg 使用spring data jpa必须引入--&gt;
<span style="color: #008080;">130</span>         &lt;dependency&gt;
<span style="color: #008080;">131</span>             &lt;groupId&gt;javax.el&lt;/groupId&gt;
<span style="color: #008080;">132</span>             &lt;artifactId&gt;javax.el-api&lt;/artifactId&gt;
<span style="color: #008080;">133</span>             &lt;version&gt;2.2.4&lt;/version&gt;
<span style="color: #008080;">134</span>         &lt;/dependency&gt;
<span style="color: #008080;">135</span>         &lt;dependency&gt;
<span style="color: #008080;">136</span>             &lt;groupId&gt;org.glassfish.web&lt;/groupId&gt;
<span style="color: #008080;">137</span>             &lt;artifactId&gt;javax.el&lt;/artifactId&gt;
<span style="color: #008080;">138</span>             &lt;version&gt;2.2.4&lt;/version&gt;
<span style="color: #008080;">139</span>         &lt;/dependency&gt;
<span style="color: #008080;">140</span>         &lt;dependency&gt;
<span style="color: #008080;">141</span>             &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
<span style="color: #008080;">142</span>             &lt;artifactId&gt;lombok&lt;/artifactId&gt;
<span style="color: #008080;">143</span>             &lt;version&gt;1.16.22&lt;/version&gt;
<span style="color: #008080;">144</span>         &lt;/dependency&gt;
<span style="color: #008080;">145</span>     &lt;/dependencies&gt;
<span style="color: #008080;">146</span> &lt;/project&gt;</code></pre>

<span class="cnblogs_code_collapse">项目所需的依赖坐标</span>
<h2>&nbsp;配置Spring的配置文件</h2>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <strong>&lt;!--创建entityManagerFactory对象交给Spring容器管理--&gt;</strong>
<span style="color: #008080;"> 2</span>     &lt;bean id="entityManagerFactory" <span style="background-color: #ffff00;"><span style="color: #0000ff;">class</span>="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean"&gt;   <strong>（权限定位类名）</strong></span>
<span style="color: #008080;"> 3</span>         &lt;property name="dataSource" ref="dataSource"/&gt;     <strong><span style="background-color: #ffff00;">（依赖注入）</span></strong>
<span style="color: #008080;"> 4</span>         &lt;property name="packagesToScan " value="cn.itcast.domain"/&gt;   <span style="color: #ff6600;"><strong><span style="background-color: #ffff00;">（配置的扫描的包，实体类所在的包）</span></strong></span>
<span style="color: #008080;"> 5</span>         &lt;property name="persistenceProvider"&gt;  <strong><span style="background-color: #ffff00;">（JPA的实现厂家）</span></strong>
<span style="color: #008080;"> 6</span>             &lt;bean <span style="color: #0000ff;">class</span>="org.hibernate.jpa.HibernatePersistenceProvider"/&gt;
<span style="color: #008080;"> 7</span>         &lt;/property&gt;
<span style="color: #008080;"> 8</span> 
<span style="color: #008080;"> 9</span>         &lt;!--jpa的供应商适配器--&gt;
<span style="color: #008080;">10</span>         &lt;property name="jpaVendorAdapter"&gt;
<span style="color: #008080;">11</span>             &lt;bean <span style="color: #0000ff;">class</span>="org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter"&gt;
<span style="color: #008080;">12</span>                 <span style="background-color: #ffff00;"><strong>&lt;!--配置是否自动创建数据库表--&gt;</strong></span>
<span style="color: #008080;">13</span>                 <span style="color: #ff6600;">&lt;property name="generateDdl" value="false"/&gt;</span>
<span style="color: #008080;">14</span>                 <span style="background-color: #ffff00;"><strong>&lt;!--指定数据库类型--&gt;</strong></span>
<span style="color: #008080;">15</span>                 <span style="color: #ff6600;">&lt;property name="database" value="MYSQL"/&gt;</span>
<strong><span style="color: #008080;">16</span>                 <span style="background-color: #ffff00;">&lt;!--数据库方言：支持的特有语法（不同数据库有不同的语法）--&gt;</span>
</strong><span style="color: #008080;">17</span>                 <span style="color: #ff6600;">&lt;property name="databasePlatform" value="org.hibernate.<span style="text-decoration: underline;"><strong>dialect</strong></span>.MySQLDialect"/&gt;</span>
<strong><span style="color: #008080;">18</span>                 <span style="background-color: #ffff00;">&lt;!--是否显示sql--&gt;</span>
</strong><span style="color: #008080;">19</span>                 <span style="color: #ff6600;">&lt;property name="showSql" value="true"/&gt;</span>
<span style="color: #008080;">20</span>             &lt;/bean&gt;
<span style="color: #008080;">21</span>         &lt;/property&gt;
<span style="color: #008080;">22</span> 
<span style="color: #008080;">23</span>         &lt;!--jpa的方言 ：高级特性<span style="color: #000000; background-color: #ffff00;"><strong>（配置了谁就拥有了谁的高级特性）</strong></span>--&gt;
<span style="color: #008080;">24</span>         &lt;property name="jpaDialect"&gt;
<span style="color: #008080;">25</span>             &lt;bean <span style="color: #0000ff;">class</span>="org.springframework.orm.jpa.vendor.HibernateJpaDialect"&gt;&lt;/bean&gt;
<span style="color: #008080;">26</span>         &lt;/property&gt;
<span style="color: #008080;">27</span>     &lt;/bean&gt;
<span style="color: #008080;">28</span>    <span style="background-color: #ffff00;"><strong> &lt;!--2.创建数据库连接池--&gt;</strong></span>
<span style="color: #008080;">29</span>     &lt;bean id="dataSource" <span style="color: #0000ff;">class</span>="com.mchange.v2.c3p0.ComboPooledDataSource"&gt;
<span style="color: #008080;">30</span>         &lt;property name="user" value="root"&gt;&lt;/property&gt;
<span style="color: #008080;">31</span>         &lt;property name="password" value="123456"&gt;&lt;/property&gt;
<span style="color: #008080;">32</span>         &lt;property name="jdbcUrl" value="jdbc:mysq1:///jpa"&gt;&lt;/property&gt;
<span style="color: #008080;">33</span>         &lt;property name="driverClass" value="com.mysql.jdbc.Driver"&gt;&lt;/property&gt;
<span style="color: #008080;">34</span>     &lt;/bean&gt;
<span style="color: #008080;">35</span> <span style="color: #ff6600;">（以下的不需要特别记忆）&gt;&gt;&gt;</span>
<span style="color: #008080;">36</span>     &lt;!--3.整合spring dataJpa--&gt;
<span style="color: #008080;">37</span>     &lt;jpa:repositories <span style="color: #ff6600;"><strong>base-package="cn.itcast.dao"</strong></span> transaction-manager-ref="transactionManager"
<span style="color: #008080;">38</span>                       <strong><span style="color: #ff6600;">entity-manager-factory-ref="entityManagerFactory"&gt;</span></strong>&lt;/jpa:repositories&gt;
<span style="color: #008080;">39</span>     &lt;!--4.配置事务管理器--&gt;
<span style="color: #008080;">40</span>     &lt;bean id="transactionManager" <span style="color: #0000ff;">class</span>="org.springframework.orm.jpa.JpaTransactionManager"&gt;
<span style="color: #008080;">41</span>         &lt;property name="entityManagerFactory" ref="entityManagerFactory"&gt;&lt;/property&gt;
<span style="color: #008080;">42</span>     &lt;/bean&gt;
<span style="color: #008080;">43</span>     &lt;!--5.声明式事务--&gt;
<span style="color: #008080;">44</span>     <strong><span style="background-color: #ffff00;">&lt;!--6.配置 包扫描--&gt;</span></strong>
<span style="color: #008080;">45</span>     &lt;context:component-scan base-<span style="color: #0000ff;">package</span>="cn.itcast"&gt;&lt;/context:component-scan&gt;
<span style="color: #008080;">46</span> &lt;/beans&gt;</code></pre>

<h2>&nbsp;编写符合SpringDataJpa规范的dao层接口</h2>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> cn.itcast.dao;
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> cn.itcast.domain.Customer;
</span><span style="color: #008080;"> 4</span> 
<span style="color: #008080;"> 5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.data.jpa.repository.JpaRepository;
</span><span style="color: #008080;"> 6</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.data.jpa.repository.JpaSpecificationExecutor;
</span><span style="color: #008080;"> 7</span> <span style="color: #008000;">/**</span>
<span style="color: #008080;"> 8</span> <span style="color: #008000;"> * 符合springDataJpa的dao层接口规范
</span><span style="color: #008080;"> 9</span> <span style="color: #008000;"> * JpaRepository&lt;操作的实体类类型，实体类中主键属性的类型） &gt;&gt;&gt;封装了基本的CRUD操作
</span><span style="color: #008080;">10</span> <span style="color: #008000;"> * JpaSpecificationExecutor&lt;操作的实体类类型&gt;   &gt;&gt;&gt;封装了复杂查询（）
</span><span style="color: #008080;">11</span>  <span style="color: #008000;">*/</span>
<span style="color: #008080;">12</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">interface</span> CustomerDao <span style="color: #0000ff;">extends</span> JpaRepository&lt;Customer, Long&gt;, JpaSpecificationExecutor&lt;Customer&gt; {}</code></pre>

<p>&nbsp;</p>
<h2>完成客户的增删改查操作</h2>
<h3><span style="color: #ff6600;">根据id查询</span></h3>
<ul>
<li><span style="color: #ff6600;">findOne</span></li>
</ul>
<p><span style="color: #ff6600;">　<span style="color: #000000;">　　　em.find() <strong>立即加载</strong></span></span></p>
<ul>
<li><span style="color: #ff6600;">getOne</span></li>
</ul>
<p><span style="color: #ff6600;">　　　　<span style="text-decoration: underline;">@Transactional</span></span><span style="text-decoration: underline;"><span style="color: #ff6600; text-decoration: underline;">：保证getOne正常运行</span></span></p>
<p><span style="color: #ff6600;"><span style="color: #000000;">　　　　em.getReference() <strong>延迟加载&nbsp; &gt;&gt;返回的是一个客户的动态代理对象，什么时候用、什么时候查询</strong></span></span></p>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #000000;">@Test
</span><span style="color: #008080;">2</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> testFindOne() {
</span><span style="color: #008080;">3</span>         Customer customer = customerDao.findOne(3l<span style="color: #000000;">);
</span><span style="color: #008080;">4</span> <span style="color: #000000;">        System.out.println(customer);
</span><span style="color: #008080;">5</span>     }</code></pre>

<h3>&nbsp;</h3>
<h3><span style="color: #ff6600;">保存和更新（<strong>sava</strong>）</span></h3>
<ul>
<li><strong>&nbsp;如果没有id主键属性：&gt;&gt; 保存</strong></li>
</ul>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #000000;">@Test
</span><span style="color: #008080;">2</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> testSave() {
</span><span style="color: #008080;">3</span>         Customer customer = <span style="color: #0000ff;">new</span><span style="color: #000000;"> Customer();
</span><span style="color: #008080;">4</span>         customer.setCustname("黑马程序员"<span style="color: #000000;">);
</span><span style="color: #008080;">5</span>         customer.setCustaddress("北京"<span style="color: #000000;">);
</span><span style="color: #008080;">6</span>         customer.setCustindustry("IT教育"<span style="color: #000000;">);
</span><span style="color: #008080;">7</span> <span style="color: #000000;">        customerDao.save(customer);
</span><span style="color: #008080;">8</span>     }</code></pre>

<ul>
<li><strong>&nbsp;存在id主键属性:&nbsp; &gt;&gt; 根据id查询数据，更新数据</strong></li>
</ul>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #000000;">@Test
</span><span style="color: #008080;">2</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> testUpdate() {
</span><span style="color: #008080;">3</span>         Customer customer = <span style="color: #0000ff;">new</span><span style="color: #000000;"> Customer();
</span><span style="color: #008080;">4</span>         customer.setCustid(1l<span style="color: #000000;">);
</span><span style="color: #008080;">5</span>         customer.setCustname("播客"<span style="color: #000000;">);
</span><span style="color: #008080;">6</span>         customer.setCustindustry("黑马程序员很厉害"<span style="color: #000000;">);
</span><span style="color: #008080;">7</span> <span style="color: #000000;">        customerDao.save(customer);
</span><span style="color: #008080;">8</span>     }</code></pre>

<p>&nbsp;</p>
<h3><span style="color: #ff6600;">根据id删除（delete）</span></h3>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #000000;">@Test
</span><span style="color: #008080;">2</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> testDelete() {
</span><span style="color: #008080;">3</span>         Customer customer = <span style="color: #0000ff;">new</span><span style="color: #000000;"> Customer();
</span><span style="color: #008080;">4</span>         customerDao.delete(1l<span style="color: #000000;">);
</span><span style="color: #008080;">5</span>     }</code></pre>

<p>&nbsp;</p>
<h3><span style="color: #ff6600;">查询所有客户（findAll）</span></h3>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #000000;">@Test
</span><span style="color: #008080;">2</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> findAll(){
</span><span style="color: #008080;">3</span>         List&lt;Customer&gt; list =<span style="color: #000000;"> customerDao.findAll();
</span><span style="color: #008080;">4</span>         <span style="color: #0000ff;">for</span><span style="color: #000000;"> (Customer customer : list) {
</span><span style="color: #008080;">5</span> <span style="color: #000000;">            System.out.println(customer);
</span><span style="color: #008080;">6</span> <span style="color: #000000;">        }</span></code></pre>

<p>&nbsp;</p>
<h2>SpringDataJpa的运行过程和原理剖析</h2>
<p>　　<span style="color: #000000;">1. 通过JdkDynamicAopProxy的 invoke 方法创建了一个动态代理对象</span><br /><span style="color: #000000;">　　2. simpleJpaRepository当中封装了 JPA的操作（借助JPA的api完成数据库的CRUD）</span><br /><span style="color: #000000;">　　3. 通过 hibernate完成数据库操作（封装了jdbc）</span></p>
<p><img src="./images/SpringDataJpa入门案例及查询详细解析（深度好文）3.png" alt="" width="827" height="372" /></p>
<h2>&nbsp;复杂查询</h2>
<ul>
<li>
<h3><span style="background-color: #ffff00;"><strong>借助接口中的定义好的方法完成查询</strong></span></h3>




















</li>



























</ul>
<p>　　　　findone（id）：根据id查询</p>
<h3><span style="color: #ff6600;">测试统计查询：查询客户的总数量</span></h3>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #000000;">@Test
</span><span style="color: #008080;">2</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> testdount() {
</span><span style="color: #008080;">3</span>         <span style="color: #0000ff;">long</span> count = customerDao.count();<span style="color: #008000;">//</span><span style="color: #008000;">查询全部的客户数量System.out.println（count）；</span>
<span style="color: #008080;">4</span> <span style="color: #000000;">        System.out.println(count);
</span><span style="color: #008080;">5</span>     }</code></pre>

<h4><span style="color: #ff6600;">测试：判断id为3的客户是否存在</span></h4>
<ul>
<li>可以查询以下id为3的客户</li>
</ul>
<p>　　　　如果值为空，代表不存在，如果不为空，代表存在</p>
<ul>
<li>判断数据库中id为3的客户的数量</li>
</ul>
<p>　　　　<span style="color: #ff6600;">如果数量为0，代表不存在（false），如果大于0，代表存在（true）</span></p>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #000000;">@Test
</span><span style="color: #008080;">2</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> testExists() {
</span><span style="color: #008080;">3</span>         <span style="color: #0000ff;">boolean</span> exists = customerDao.exists(3l<span style="color: #000000;">);
</span><span style="color: #008080;">4</span> <span style="color: #000000;">        System.out.println(exists);
</span><span style="color: #008080;">5</span>     }</code></pre>

<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<ul>
<li>
<h3><span style="background-color: #ffff00;"><strong>jpql的查询方式&diams;&diams;</strong></span></h3>
</li>
</ul>
<p>　　　　jpql：jpa query language（ jpq查询语言 ）</p>
<p>　　　　特点：语法或关键字和sql语句类似<br />　　　　查询的是类和类中的属性</p>
<p>　　<span style="color: #ff6600;"><strong>需要将JPQL语句配置到接口方法上</strong></span></p>
<p>　　　　1 .特有的查询：需要在dao接口上配置方法</p>
<p>　　　　2. 在新添加的方法上，使用注解的形式配置jpql查询语句<br />　　　　3. 注解：@Query</p>
<h4><span style="color: #ff6600;">案例：根据客户名称查询名称　&gt;&gt; 使用Jpql的形式查询</span></h4>
<p><span style="color: #000000;"><strong>CustomerDao</strong></span></p>
<p>&nbsp;</p>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">interface</span> CustomerDao <span style="color: #0000ff;">extends</span> JpaRepository&lt;Customer, Long&gt;, JpaSpecificationExecutor&lt;Customer&gt;<span style="color: #000000;"> {
</span><span style="color: #008080;">2</span>     <span style="color: #008000;">/**</span>
<span style="color: #008080;">3</span> <span style="color: #008000;">     * 案例：根据客户名称查询名称
</span><span style="color: #008080;">4</span> <span style="color: #008000;">     *      使用Jpql的形式查询
</span><span style="color: #008080;">5</span> <span style="color: #008000;">     *      jpql： from Customer where custName = ?
</span><span style="color: #008080;">6</span>      <span style="color: #008000;">*/</span>
<span style="color: #008080;">7</span>    <strong><span style="color: #ff6600;"> @Query(value = "from Customer where custname = ?")
</span></strong><span style="color: #008080;">8</span>     <span style="color: #ff6600;">public Customer findJpql(String custname);
</span><span style="color: #008080;">9</span> }</code></pre>

<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #000000;"><strong>&nbsp;JpqlTest</strong></span></p>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #000000;">@Test
</span><span style="color: #008080;">2</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> testFindJpql(){
</span><span style="color: #008080;">3</span>         <span style="color: #ff6600;">Customer customer = customerDao.findJpql("传智");
</span><span style="color: #008080;">4</span> <span style="color: #000000;">        System.out.println(customer);
</span><span style="color: #008080;">5</span>     }</code></pre>

<p>&nbsp;</p>
<h4><span style="color: #ff6600;">案例：根据客户名称和客户id查询客户　&gt;&gt; 使用Jpql的形式查询</span></h4>
<ul>
<li><span style="color: #ff6600;">对于多个占位符参数：&nbsp;</span><span>赋值的时候，默认的情况下，占位符的位置需要和方法参数中的位置保持一致&nbsp; &nbsp;<strong>[&nbsp; custName &gt;&gt;&nbsp;String name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;custId &gt;&gt;&nbsp;Long id&nbsp; ]</strong></span></li>
</ul>
<p>&nbsp;</p>
<p>　　　　@Query(value="from Customer where custName=? and custId=?")<br />　　　　public Customer findCustNameAndId (String name , Long id );</p>
<ul>
<li><span style="color: #ff6600;">也可以指定占位符参数的位置 ：&nbsp; &nbsp;</span>？索引的方式，指定此占位的取值来源</li>
























</ul>
<p>　　　　@Query (value=" from Customer where <span style="color: #ff6600;">custName =<strong> ?2</strong> and custId =<strong> ?1</strong></span> ")</p>
<p>　　　　public Customer findCustNameAndId ( Long id , String name );</p>
<p><span style="color: #000000;"><strong>CustomerDao</strong></span></p>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> @Query(value = "from Customer where custname = ? and custid = ?"<span style="color: #000000;">)
</span><span style="color: #008080;">2</span>     <span style="color: #0000ff;">public</span> Customer findCustNameAndId(String custname, <span style="color: #0000ff;">long</span> id);</code></pre>

<p><span style="color: #ff6600;"><strong><span style="color: #000000;"><strong>&nbsp;JpqlTest</strong>　　</span>&nbsp;</strong></span></p>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #000000;">@Test
</span><span style="color: #008080;">2</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> testCustNameAndId(){
</span><span style="color: #008080;">3</span>         Customer customer = customerDao.findCustNameAndId("黑马",2l<span style="color: #000000;">);
</span><span style="color: #008080;">4</span> <span style="color: #000000;">        System.out.println(customer);
</span><span style="color: #008080;">5</span>     }</code></pre>

<h4><span style="color: #ff6600;">使用jpql完成更新操作案例：</span>根据id更新更新2号客户的名称，将名称改为&ldquo;黑马程序员&rdquo;</h4>
<p><span style="color: #000000;"><strong>CustomerDao</strong></span></p>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> @Query(value = " update Customer set custname = ?2 where custid = ?1 ") <span style="background-color: #ffff00;"><strong><span style="color: #008000;">//</span><span style="color: #008000;">代表的是进行查询</span></strong></span>
<span style="color: #008080;">2</span>     <strong><span style="background-color: #ffff00;">@Modifying <span style="color: #008000;">//</span><span style="color: #008000;">当前执行的是一个更新操作
</span></span></strong><span style="color: #008080;">3</span>     <strong><span style="color: #ff6600;">//更新不需要返回值 选择void</span></strong>
<span style="color: #008080;">4</span>     <span style="color: #0000ff;">public</span> <span style="color: #ff6600;"><strong>void</strong></span> UpdateCustomer( <span style="color: #0000ff;">long</span> custid,String custname);</code></pre>

<h3><strong><span style="color: #000000;"><strong>&nbsp;JpqlTest</strong>　</span>　</strong></h3>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #000000;">@Test
</span><span style="color: #008080;">2</span>     @Transactional <span style="color: #008000;">//</span><span style="color: #008000;">添加对事务的支持</span>
<span style="color: #008080;">3</span>     @Rollback(value = <span style="color: #0000ff;">false</span>) <span style="color: #008000;">//</span><span style="color: #008000;">设置是否自动回滚</span>
<span style="color: #008080;">4</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> testUpdateCustomer(){
</span><span style="color: #008080;">5</span>         customerDao.UpdateCustomer(2l,"黑马程序员"<span style="color: #000000;">);
</span><span style="color: #008080;">6</span>     }</code></pre>

<blockquote>
<p>执行结束后，默认回滚事务，可以通过@Rollback 设置是否自动回滚&nbsp; &gt;&gt;&nbsp; false&nbsp; |&nbsp; true</p>
</blockquote>
<p>&nbsp;</p>
<ul>
<li>
<h3><span style="background-color: #ffff00;">SQL查询方式</span>.</h3>
</li>
</ul>
<p>　　　　1 .特有的查询：需要在dao接口上配置方法</p>
<p>　　　　2. 在新添加的方法上，使用注解的形式配置sql查询语句<br />　　　　<span style="color: #ff6600;">3. 注解：@Query</span></p>
<p><span style="color: #ff6600;">　　　　　　value： jsql&nbsp; &nbsp;<strong>|</strong>&nbsp; sql</span></p>
<p><span style="color: #ff6600;">　　　　　　<strong>nativeQuery : fals（使用jpql查询） l&nbsp; &nbsp;true（使用本地查询：sql查询）</strong></span></p>
<p><strong>CustomerDao</strong></p>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> @Query(value = "select * from cst_customer",nativeQuery = <span style="color: #0000ff;">true</span><span style="color: #000000;">)
</span><span style="color: #008080;">2</span>     <span style="color: #0000ff;">public</span> List&lt;Object[]&gt;findSql();</code></pre>

<h3><strong><strong>&nbsp;JpqlTest</strong>　</strong></h3>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #000000;">@Test
</span><span style="color: #008080;">2</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> testfindSql(){
</span><span style="color: #008080;">3</span>         List&lt;Object[]&gt; list =<span style="color: #000000;"> customerDao.findSql();
</span><span style="color: #008080;">4</span>         <span style="color: #0000ff;">for</span><span style="color: #000000;"> (Object[] obj : list) {
</span><span style="color: #008080;">5</span>             System.out.println(Arrays.toString(obj));<span style="background-color: #ffff00;"><span style="color: #008000;">//</span><span style="color: #008000;">每一个里面都还是object数组，所以需要借助Arrays.toString()方法<em><span style="color: #ff6600;"><strong>打印数组</strong></span></em></span></span>
<span style="color: #008080;">6</span>         }</code></pre>

<ul>
<li>
<h3><span style="background-color: #ffff00;">方法命名规则查询&nbsp;<span style="background-color: #ffffff;">&nbsp; &nbsp; &nbsp;</span></span></h3>
</li>
</ul>
<p>&nbsp;</p>
<h3 style="margin-left: 30px;"><span style="background-color: #ffff00;"><span style="background-color: #ffffff;"> <span style="color: #ff6600;">&gt;&gt;&nbsp;</span></span></span><span style="color: #ff6600;">1: findBy +属性名（首字母大写）</span></h3>
<p>&nbsp;</p>
<p>&nbsp;</p>
<src class="cnblogs_code">
<pre><code><span style="color: #0000ff;">public</span> Customer <span style="background-color: #ffff00;"><strong><span style="color: #ff6600;">findByCustname</span></strong>(</span>String custname);</code></pre>

<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #000000;">@Test
</span><span style="color: #008080;">2</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> testNaming(){
</span><span style="color: #008080;">3</span>         Customer customer = customerDao.findByCustname("传智"<span style="color: #000000;">);
</span><span style="color: #008080;">4</span> <span style="color: #000000;">        System.out.println(customer);
</span><span style="color: #008080;">5</span>     }</code></pre>

<p>&nbsp;</p>
<h3 style="margin-left: 30px;"><span style="color: #ff6600;">&nbsp;&gt;&gt; 2:&nbsp;</span><span style="color: #ff6600;">findBy + 属性名（首字母大写）+ &ldquo;查询方式&rdquo;</span></h3>
<src class="cnblogs_code">
<pre><code><span style="color: #0000ff;">public</span> List&lt;Customer&gt; <strong><span style="background-color: #ffff00; color: #ff6600;">findByCustnameLike</span></strong>(String custname);</code></pre>

<src class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #000000;">@Test
</span><span style="color: #008080;">2</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> testfindByCustnameLike(){
</span><span style="color: #008080;">3</span>         List&lt;Customer&gt; list = customerDao.findByCustnameLike("黑马%"<span style="color: #000000;">);
</span><span style="color: #008080;">4</span>         <span style="color: #0000ff;">for</span><span style="color: #000000;"> (Customer customer : list) {
</span><span style="color: #008080;">5</span> <span style="color: #000000;">            System.out.println(customer);
</span><span style="color: #008080;">6</span>         } }</code></pre>

<p>&nbsp;</p>
<h3 style="margin-left: 30px;"><span style="color: #ff6600;">&gt;&gt; 3:&nbsp;findBy + 属性名（首字母大写）+&nbsp;&ldquo;查询方式&rdquo;&nbsp;+&nbsp; &ldquo;多条件的连接符（and | or）&rdquo; + 属性名 + &ldquo;查询方式&rdquo;</span></h3>
<p>　　　<strong>　使用客户名称模糊匹配和客户所属行业精准匹配的查询</strong></p>
<src class="cnblogs_code">
<pre><code><span style="color: #0000ff;">public</span> <span style="color: #ff6600;"><strong>List&lt;Customer&gt;</strong></span> <span style="color: #ff6600; background-color: #ffff00;"><strong>findByCustnameLikeAndCustindustry</strong></span>(String custname, String custindustry); <span style="color: #339966;">//结果可能是一个或多个，所以选择<strong>List&lt;Customer&gt;</strong></span></code></pre>

<p>&nbsp;</p>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #000000;">@Test
</span><span style="color: #008080;">2</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> testFindByCustnameLikeAndCustindustry(){
</span><span style="color: #008080;">3</span>         List&lt;Customer&gt; list = customerDao.findByCustnameLikeAndCustindustry("黑马%","it教育"<span style="color: #000000;">);
</span><span style="color: #008080;">4</span>         <span style="color: #0000ff;">for</span><span style="color: #000000;"> (Customer customer : list) {
</span><span style="color: #008080;">5</span> <span style="color: #000000;">            System.out.println(customer);
</span><span style="color: #008080;">6</span>         } }</code></pre>

<p>&nbsp;</p>
<p>&nbsp;</p>
<h2><span style="background-color: #ffffff;">Specifications动态查询</span></h2>
<ul>
<li><span style="color: #ff6600;"><strong>root </strong></span>：查询的根对象（查询的任何属性都可以从根对象中获取）</li>
<li><span style="color: #000000;">cirteriaQuery</span>：顶层查询对象，自定义查询方式（了解，一般不用）</li>
<li><span style="color: #ff6600;"><strong>cirteriaBuilder</strong></span>：查询的构造器，封装了很多查询条件</li>
</ul>
<p>　　public Predicate toPredicate(Root&lt;Customer&gt;<strong>&nbsp;<span style="color: #ff6600;">root</span></strong><span style="color: #ff6600;">&nbsp;</span>, CriteriaQuery&lt;?&gt;&nbsp;<span style="color: #000000;"><strong>query</strong>&nbsp;</span>, CriteriaBuilder&nbsp;<span style="color: #ff6600;"><strong>cb</strong></span>) { }&nbsp; <strong><span style="color: #339966;">//封装查询条件</span></strong></p>
<p>&nbsp;</p>
<p><span style="color: #ff6600;"><strong>查询客户名为 &ldquo;传智&rdquo; 的客户</strong></span></p>
<src class="cnblogs_code">
<pre><code><span style="font-size: 13px;"><span style="color: #008080;"> 1</span> <span style="color: #000000;">@Test
</span><span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> testSpec() {<br />　　　　　　　<span style="background-color: #ffff00;"><strong>实现Specification接口（ <span style="color: #000000; background-color: #ff6600;">提供泛型 </span>：查询的对象属性）
</strong></span></span><span style="color: #008080;"> 3</span>         Specification&lt;Customer&gt; spec = <span style="color: #0000ff;">new</span> Specification&lt;Customer&gt;<span style="color: #000000;">() {<br />　　　　　　　<span style="background-color: #ffff00;">实现toPredicate方法（构造查询条件）
</span></span><span style="color: #008080;"> 4</span>             <span style="color: #0000ff;">public</span> Predicate toPredicate(<span style="color: #000000; background-color: #ff6600;"><strong>Root&lt;Customer&gt;</strong></span> root, CriteriaQuery&lt;?&gt;<span style="color: #000000;"> query, CriteriaBuilder cb) {
</span><span style="color: #008080;"> 5</span>                 <span style="color: #008000;">//</span><span style="color: #008000;">1.获取比较的属性</span>
<span style="color: #008080;"> 6</span>                 Path&lt;Object&gt; custname = root.get("custname"<span style="color: #000000;">);
</span><span style="color: #008080;"> 7</span>                 <span style="color: #008000;">//</span><span style="color: #008000;">2.构造查询条件</span>
<span style="color: #008080;"> 8</span>                 Predicate predicate = cb.equal(custname, "传智"<span style="color: #000000;">); <span style="background-color: #ffff00;"><strong><span style="color: #339966;">//进行精准的匹配（custname：比较的属性 ， &ldquo;传智&rdquo;：比较的属性取值）
</span></strong></span></span><span style="color: #008080;"> 9</span>                 <span style="text-decoration: underline;"><span style="color: #ff6600; text-decoration: underline;">return predicate;
</span></span><span style="color: #008080;">10</span> <span style="color: #000000;">            }};
</span><span style="color: #008080;">11</span>         Customer customer =<span style="color: #000000;"> customerDao.findOne(spec);
</span><span style="color: #008080;">12</span> <span style="color: #000000;">        System.out.println(customer);
</span><span style="color: #008080;">13</span>     }</span></code></pre>

<p><span style="color: #ff6600;"><strong>查询客户名为 &ldquo;黑马2&rdquo; 并且行业为 "it教育" 的的客户</strong></span></p>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #000000;">@Test
</span><span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> testSpec1() {
</span><span style="color: #008080;"> 3</span>         Specification&lt;Customer&gt; spec = <span style="color: #0000ff;">new</span> Specification&lt;Customer&gt;<span style="color: #000000;">() {
</span><span style="color: #008080;"> 4</span>             <span style="color: #0000ff;">public</span> Predicate toPredicate(Root&lt;Customer&gt; root, CriteriaQuery&lt;?&gt;<span style="color: #000000;"> query, CriteriaBuilder cb) {
</span><span style="color: #008080;"> 5</span>                 <span style="color: #008000;">//</span><span style="color: #008000;">1.获取比较的属性</span>
<span style="color: #008080;"> 6</span>                 Path&lt;Object&gt; custname = root.get("custname"<span style="color: #000000;">);
</span><span style="color: #008080;"> 7</span>                 Path&lt;Object&gt; custindustry = root.get("custindustry"<span style="color: #000000;">);
</span><span style="color: #008080;"> 8</span>                 <span style="color: #008000;">//</span><span style="color: #008000;">2.构造查询条件</span>
<span style="color: #008080;"> 9</span>                 Predicate p1 = cb.equal(custname, "黑马2"<span style="color: #000000;">);
</span><span style="color: #008080;">10</span>                 Predicate p2 = cb.equal(custindustry, "it教育"<span style="color: #000000;">);<br />　　　　　　　　　　　<span style="background-color: #ffff00;"><span style="background-color: #ff6600;">and（与关系）</span>:满足条件1并且满足条件2    <span style="background-color: #ff6600;">or（或关系）</span>：满足条件1或满足条件2
</span></span><span style="color: #008080;">11</span>                 <strong><span style="background-color: #ffff00; color: #ff6600;">Predicate and = cb.and(p1, p2);
</span></strong><span style="color: #008080;">12</span>                 <span style="color: #0000ff;">return</span><span style="color: #000000;"> and;
</span><span style="color: #008080;">13</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">14</span> <span style="color: #000000;">        };
</span><span style="color: #008080;">15</span>         Customer customer =<span style="color: #000000;"> customerDao.findOne(spec);
</span><span style="color: #008080;">16</span> <span style="color: #000000;">        System.out.println(customer);
</span><span style="color: #008080;">17</span>     }</code></pre>

<p>&nbsp;</p>
<h3><span style="color: #ff6600;"><strong>&nbsp;案例：完成根据客户名称的模糊匹配，返回客户列表&nbsp; &nbsp;&gt;&gt;</strong></span>客户名称以&nbsp; &ldquo;传智播客&rdquo; 开头</h3>
<p><em id="__mceDel"><em id="__mceDel">　　<span style="color: #ff6600;">默认：　</span></em></em>equal：直接得到 path对象（属性），然后进行比较即可</p>
<p>　　<span style="color: #ff6600;">gt（大于），lt（小于），ge（大于等于），le（小于等于），like：</span>得到path对象，根据path指定比较的参数类型，再去进行比较</p>
<p>　　<strong><span style="color: #ff6600;">指定参数类型：path.as（类型的字节码对象）</span></strong></p>
<p>&nbsp;</p>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #000000;">@Test
</span><span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> testSpec2() {
</span><span style="color: #008080;"> 3</span>         Specification&lt;Customer&gt; spec = <span style="color: #0000ff;">new</span> Specification&lt;Customer&gt;<span style="color: #000000;">() {
</span><span style="color: #008080;"> 4</span>             <span style="color: #0000ff;">public</span> Predicate toPredicate(Root&lt;Customer&gt; root, CriteriaQuery&lt;?&gt;<span style="color: #000000;"> query, CriteriaBuilder cb) {
</span><span style="color: #008080;"> 5</span>                 Path&lt;Object&gt; custname = root.get("custname"<span style="color: #000000;">);  <strong><span style="color: #339966;">//查询属性：客户名
</span></strong></span><span style="color: #008080;"> 6</span>                 Predicate predicate = cb.like(custname.as(String.<span style="color: #0000ff;">class</span>), "传智播客%"<span style="color: #000000;">); <span style="color: #339966;"><strong>//查询方式：模糊匹配
</strong></span></span><span style="color: #008080;"> 7</span>                 <span style="color: #0000ff;">return</span><span style="color: #000000;"> predicate;
</span><span style="color: #008080;"> 8</span> <span style="color: #000000;">            }
</span><span style="color: #008080;"> 9</span> <span style="color: #000000;">        };
</span><span style="color: #008080;">10</span>         List&lt;Customer&gt; list =<span style="color: #000000;"> customerDao.findAll(spec);
</span><span style="color: #008080;">11</span>         <span style="color: #0000ff;">for</span><span style="color: #000000;"> (Customer customer : list) {
</span><span style="color: #008080;">12</span> <span style="color: #000000;">            System.out.println(customer);
</span><span style="color: #008080;">13</span>         } }</code></pre>

<p><span style="font-size: 16px; color: #000000; background-color: #ffff00;"><strong>添加排序</strong></span>&nbsp; <strong>&gt;&gt;创建排序对象，需要调用构造方法实例化sort对象</strong></p>
<p>&nbsp; 第一个参数：排序的顺序（倒序，正序）</p>
<ul>
<li>Sort.Direction.DESC：倒序</li>
<li>Sort.Direction.ASC：升序</li>
</ul>
<p>&nbsp; 第二个参数：排序的属性名称</p>
<src class="cnblogs_code">
<pre><code><span style="font-size: 13px;"><span style="color: #008080;">1</span>   Sort sort = <span style="color: #0000ff;">new</span> Sort<span style="color: #ff6600;">(Sort.Direction.DESC, "custid");
</span><span style="color: #008080;">2</span>   List&lt;Customer&gt; list = customerDao.findAll(spec, sort);</span></code></pre>

<p>&nbsp;</p>
<p>&nbsp;</p>
<h3><span style="color: #ff6600;">&nbsp;分页查询</span></h3>
<ul>
<li><strong>不带参数的分页查询</strong></li>
</ul>
<p>　创建PageRequest的过程中，需要调用他的构造方法传入<span style="color: #ff0000;">两个参数</span></p>
<p>　　第一个参数：当前查询的页数（从e开始）</p>
<p>　　第二个参数：每页查询的数量</p>
<p>&nbsp;</p>
<src class="cnblogs_code">
<pre><code><span style="font-size: 13px;"><span style="color: #008080;"> 1</span> <span style="color: #000000;">@Test
</span><span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> testSpec3() {
</span><span style="color: #008080;"> 3</span>         Specification spec = <span style="color: #0000ff;">null</span><span style="color: #000000;">; <strong><span style="color: #339966;">//不带参数
</span></strong></span><span style="color: #008080;"> 4</span>         <span style="color: #ff0000;">Pageable pageable = new PageRequest(0, 2);
</span><span style="color: #008080;"> 5</span>         <span style="color: #008000;">//</span><span style="color: #008000;">分页查询</span>
<span style="color: #008080;"> 6</span>         Page&lt;Customer&gt; page = customerDao.findAll(<span style="color: #0000ff;">null</span><span style="color: #000000;">, pageable);
</span><span style="color: #008080;"> 7</span>         <span style="background-color: #ffff00;">System.out.println(page.getContent());<span style="color: #008000;">//</span><span style="color: #008000;">得到数据集合列表</span></span>
<span style="color: #008080;"> 8</span>         <span style="background-color: #ffff00;">System.out.println(page.getTotalElements());<span style="color: #008000;">//</span><span style="color: #008000;">得到总条数</span></span>
<span style="color: #008080;"> 9</span>         <span style="background-color: #ffff00;">System.out.println(page.getTotalPages());<span style="color: #008000;">//</span><span style="color: #008000;">得到总页数</span></span>
<span style="color: #008080;">10</span>     }</span></code></pre>

<p>&nbsp;</p>
<ul>
<li><strong>&nbsp;带参数分页查询</strong></li>
</ul>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #000000;">@Test
</span><span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> testSpec4() {
</span><span style="color: #008080;"> 3</span>         Specification spec = <span style="color: #0000ff;">new</span><span style="color: #000000;"> Specification() {
</span><span style="color: #008080;"> 4</span>             <span style="color: #0000ff;">public</span><span style="color: #000000;"> Predicate toPredicate(Root root, CriteriaQuery criteriaQuery, CriteriaBuilder criteriaBuilder) {
</span><span style="color: #008080;"> 5</span>                 Path custname = root.get("custname"<span style="color: #000000;">);
</span><span style="color: #008080;"> 6</span>                 Predicate predicate = criteriaBuilder.equal(custname, "传智播客"<span style="color: #000000;">);
</span><span style="color: #008080;"> 7</span>                 <span style="color: #0000ff;">return</span><span style="color: #000000;"> predicate;
</span><span style="color: #008080;"> 8</span> <span style="color: #000000;">            }};
</span><span style="color: #008080;"> 9</span>         Pageable pageable = <span style="color: #0000ff;">new</span> PageRequest(0, 2<span style="color: #000000;">);
</span><span style="color: #008080;">10</span>         <span style="color: #008000;">//</span><span style="color: #008000;">分页查询</span>
<span style="color: #008080;">11</span>         Page&lt;Customer&gt; page =<span style="color: #000000;"> customerDao.findAll(spec, pageable);
</span><span style="color: #008080;">12</span>         System.out.println(page.getContent());<span style="color: #008000;">//</span><span style="color: #008000;">得到数据集合列表</span>
<span style="color: #008080;">13</span>         System.out.println(page.getTotalElements());<span style="color: #008000;">//</span><span style="color: #008000;">得到总条数</span>
<span style="color: #008080;">14</span>         System.out.println(page.getTotalPages());<span style="color: #008000;">//</span><span style="color: #008000;">得到总页数</span>
<span style="color: #008080;">15</span>     }</code></pre>

<p>&nbsp;</p>

</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>