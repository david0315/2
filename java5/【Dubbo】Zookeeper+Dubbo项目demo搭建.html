<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修【Dubbo】Zookeeper+Dubbo项目demo搭建' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>【Dubbo】Zookeeper+Dubbo项目demo搭建</center></div><div class='banquan'>原文出处:本文由博客园博主H-utopia提供。<br/>
原文连接:https://www.cnblogs.com/iUtopia/p/11653098.html</div><br>
    <h1><span style="font-family: Microsoft YaHei;">一、Dubbo的注解配置</span></h1>
<p><span style="font-family: Microsoft YaHei;">在Dubbo 2.6.3及以上版本提供支持。</span></p>
<h2><span style="font-family: Microsoft YaHei;">1、@Service（全路径@org.apache.dubbo.config.annotation.Service）</span></h2>
<p style="margin-left: 30px;"><span style="font-family: Microsoft YaHei;">配置服务提供方用以暴露服务，添加于api接口的实现类上，并可通过注解提供的属性进一步定制化服务。</span></p>
<p style="margin-left: 30px;"><span style="font-family: Microsoft YaHei;">其中比较重要的属性有：</span></p>
<ol>
<li><span style="font-family: Microsoft YaHei;">@Service只能定义在一个类上，用以提供一个服务的具体实现</span></li>
<li><span style="font-family: Microsoft YaHei;">interfaceClass：指定服务提供方实现的interface的类</span></li>
<li><span style="font-family: Microsoft YaHei;">interfaceName：指定服务提供方实现的interface的类名</span></li>
<li><span style="font-family: Microsoft YaHei;">version</span></li>
<li><span style="font-family: Microsoft YaHei;">group：指定服务分组</span></li>
<li><span style="font-family: Microsoft YaHei;">export：是否暴露服务</span></li>
<li><span style="font-family: Microsoft YaHei;">register：是否向注册中心注册服务</span></li>
<li><span style="font-family: Microsoft YaHei;">application：应用配置</span></li>
<li><span style="font-family: Microsoft YaHei;">module：模块配置</span></li>
<li><span style="font-family: Microsoft YaHei;">provider：服务提供方配置</span></li>
<li><span style="font-family: Microsoft YaHei;">protocol：传输层协议配置</span></li>
<li><span style="font-family: Microsoft YaHei;">monitor：监控中心配置</span></li>
<li><span style="font-family: Microsoft YaHei;">registry：注册中心配置</span></li>
</ol>
<p style="margin-left: 30px;"><span style="font-family: Microsoft YaHei;">注意，8-13需要提供对应的spring bean的名字，bean的组装可以通过传统的XML配置方式完成，或者Java Config的方式配置（推荐使用）。</span></p>
<h2><span style="font-family: Microsoft YaHei;">2、@Reference（全路径@org.apache.dubbo,config.annotation.Reference）</span></h2>
<p style="margin-left: 30px;"><span style="font-family: Microsoft YaHei;">服务消费方用以引用服务，通过动态代理来实现接口的引用，同样可通过注解提供的属性进一步定制化服务。</span></p>
<p style="margin-left: 30px;"><span style="font-family: Microsoft YaHei;">其中比较重要的属性有：</span></p>
<ol>
<li><span style="font-family: Microsoft YaHei;">@Reference通常定义在一个字段上，表示一个服务的引用</span></li>
<li><span style="font-family: Microsoft YaHei;">interfaceClass：指定服务的interface的类</span></li>
<li><span style="font-family: Microsoft YaHei;">interfaceName：指定服务的interface的类名</span></li>
<li><span style="font-family: Microsoft YaHei;">version</span></li>
<li><span style="font-family: Microsoft YaHei;">group</span></li>
<li><span style="font-family: Microsoft YaHei;">url：指定服务提供方的URL地址，绕过注册中心直接发起调用</span></li>
<li><span style="font-family: Microsoft YaHei;">application：应用配置</span></li>
<li><span style="font-family: Microsoft YaHei;">module：模块配置</span></li>
<li><span style="font-family: Microsoft YaHei;">consumer：服务消费方配置</span></li>
<li><span style="font-family: Microsoft YaHei;">protocol：协议配置</span></li>
<li><span style="font-family: Microsoft YaHei;">monitor：监控中心配置</span></li>
<li><span style="font-family: Microsoft YaHei;">registry：注册中心配置</span></li>
</ol>
<p style="margin-left: 30px;"><span style="font-family: Microsoft YaHei;">同上，7-12需要提供对应的spring bean的名字，推荐使用Java Config的方式进行组装Bean。</span></p>
<h2><span style="font-family: Microsoft YaHei;">3、@EnableDubbo（全路径org.apache.dubbo.config.spring.context.annotation.EnableDubbo）</span></h2>
<p style="margin-left: 30px;"><span style="font-family: Microsoft YaHei;">@EnableDubbo注解是@EnableDubboConfig和@DubboComponentScan两者组合的便捷表达。</span></p>
<p style="margin-left: 30px;"><span style="font-family: Microsoft YaHei;">@EnableDubbo提供scanBasePackages和scanBasePackageClasses属性，可以在指定的包名或者类中扫描Dubbo的服务提供者（@Service标注）和服务消费者（@Reference标注），扫描到服务的提供者或消费者后，对其进行相应的组装并初始化， 最终完成服务的暴露或引用。</span></p>
<p style="margin-left: 30px;"><span style="font-family: Microsoft YaHei;">扫描提供者和消费者的功能@DubboComponnetScan也可以实现，@EnableDubboConfig提供外部化配置的支持。</span></p>
<h1>二、Dubbo的API属性配置</h1>
<p>　　目前，通过@Service、@Reference、@EnableDubbo注解，实现了服务的暴露和发现引用，除此之外，还需要一些其他的属性配置，诸如应用名、注册中心、协议信息等。</p>
<h2>1、Dubbo中配置类结构</h2>
<p>&nbsp;<img src="./images/【Dubbo】Zookeeper+Dubbo项目demo搭建0.png" alt="" width="1373" height="883" /></p>
<h2>2、注入这些配置属性，有两种方式，分别是采用配置文件和Java Config硬编码的形式。</h2>
<h3>2.1、配置文件方式</h3>
<p>在resources下创建xxx.properties文件，在其中添加各项属性配置，形式如下：</p>
<src class="cnblogs_Highlighter">
<pre><code><span style="font-family: verdana, geneva;">dubbo.application.name=provider
dubbo.registry.address=zookeeper://127.0.0.1:2181
dubbo.protocol.name=dubbo
dubbo.protocol.port=20880</span></code></pre>

<p>然后通过@PropertySource("classpath:/xxx.properties")注解导入配置；</p>
<p>导入属性在启动时，会被自动组装成相应的配置类。</p>
<h3>2.2、Java Config硬编码方式</h3>
<p>创建providerConfiguration类，标注@Configuration注解；</p>
<p>在该类中，通过@Beab的形式分别配置需要的配置类，如下：</p>
<src class="cnblogs_code">
<pre><code><span style="font-family: verdana, geneva;"><span style="color: #008080;"> 1</span> <span style="color: #000000;">@Bean
</span><span style="color: #008080;"> 2</span> <span style="color: #0000ff;">public</span><span style="color: #000000;"> ApplicationConfig applicationConfig() {
</span><span style="color: #008080;"> 3</span> 　　ApplicationConfig applicationConfig = <span style="color: #0000ff;">new</span><span style="color: #000000;"> ApplicationConfig();
</span><span style="color: #008080;"> 4</span> 　　applicationConfig.setName("provider"<span style="color: #000000;">);
</span><span style="color: #008080;"> 5</span> 　　<span style="color: #0000ff;">return</span><span style="color: #000000;"> applicationConfig;
</span><span style="color: #008080;"> 6</span> <span style="color: #000000;">}
</span><span style="color: #008080;"> 7</span> 
<span style="color: #008080;"> 8</span> <span style="color: #000000;">@Bean
</span><span style="color: #008080;"> 9</span> <span style="color: #0000ff;">public</span><span style="color: #000000;"> ProtocolConfig protocolConfig() {
</span><span style="color: #008080;">10</span> 　　ProtocolConfig protocolConfig = <span style="color: #0000ff;">new</span><span style="color: #000000;"> ProtocolConfig();
</span><span style="color: #008080;">11</span> 　　protocolConfig.setName("dubbo"<span style="color: #000000;">);
</span><span style="color: #008080;">12</span> 　　protocolConfig.setPort("20880"<span style="color: #000000;">);
</span><span style="color: #008080;">13</span> 　　<span style="color: #0000ff;">return</span><span style="color: #000000;"> protocolConfig;
</span><span style="color: #008080;">14</span> <span style="color: #000000;">}
</span><span style="color: #008080;">15</span> 
<span style="color: #008080;">16</span> <span style="color: #000000;">@Bean
</span><span style="color: #008080;">17</span> <span style="color: #0000ff;">public</span><span style="color: #000000;"> RegistryConfig registryConfig() {
</span><span style="color: #008080;">18</span> 　　RegistryConfig registryConfig = <span style="color: #0000ff;">new</span><span style="color: #000000;"> RegistryConfig();
</span><span style="color: #008080;">19</span> 　　registryConfig.setProtocol("zookeeper"<span style="color: #000000;">);
</span><span style="color: #008080;">20</span> 　　registryConfig.setAddress("localhost"<span style="color: #000000;">);
</span><span style="color: #008080;">21</span> 　　registryConfig.setPort(2181<span style="color: #000000;">);
</span><span style="color: #008080;">22</span> 　　<span style="color: #0000ff;">return</span><span style="color: #000000;"> registryConfig;
</span><span style="color: #008080;">23</span> }</span></code></pre>

<p>在具体实现中，创建Config类，通过Java Config技术（@Configuration）和annotation扫描（@EnableDubbo）来发现、组装服务提供者和消费者。</p>
<h1>三、其他相关Spring注解</h1>
<h2>1、@Configuration（全路径org.springframework.context.annotation.Configuration）</h2>
<p style="margin-left: 30px;">@Configuration注解用来定义配置类，可替换XML配置文件，被注解类内有多个@Bean标注方法，这些方法会被AnnotationConfigApplicationContext或者AnnotationConfigWebApplicationContext类进行扫描，用于构建bean并初始化spring容器。</p>
<p style="margin-left: 30px;">@Configuration注解的配置类有以下要求：</p>
<ul>
<li style="list-style-type: none;">
<ul>
<li>@Configuration注解的配置类不可以是final类型。</li>
<li>内部嵌套的内部Configuration类必须是静态类。</li>
</ul>
</li>
</ul>
<h3 style="margin-left: 30px;">1.1、@Configuration配置spring并启动spring容器</h3>
<p style="margin-left: 30px;">起到为spring容器配置应用上下文的作用：</p>
<src class="cnblogs_Highlighter" style="margin-left: 30px;">
<pre><code><span style="font-family: verdana, geneva;">ApplicationContext context = new AnnotationConfigApplicationContext(TestConfiguration.class);</span></code></pre>

<p style="margin-left: 30px;">效果等价于用XML文件配置：</p>
<src class="cnblogs_Highlighter" style="margin-left: 30px;">
<pre><code><span style="font-family: verdana, geneva;">ApplicationContext context = new ClassPathXmlApplicationContext("test-spring-context.xml");</span></code></pre>

<h3 style="margin-left: 30px;">1.2、@Configuration启动容器+@Bean注册bean，@Bean下管理bean的生命周期</h3>
<p style="margin-left: 30px;">@Bean标注在方法上，作用相当于注册Bean，注意：</p>
<ul>
<li style="list-style-type: none;">
<ul>
<li>@Bean标注在返回实例的方法上，如果未通过@Bean指定bean的名称，默认与标注方法名同名。</li>
<li>@Bean标注默认bean作用域为单例singleton，可通过@Scope()设置。</li>
<li>@Bean的作用是注册bean，因此也可以用@Component、@Controller、@Service、@Repository等进行注册，不过需要配置@ComponentScan注解进行自动扫描。</li>
<li>可以通过@Bean管理bean的生命周期。</li>
</ul>
</li>
</ul>
<h3 style="margin-left: 30px;">1.3、组合多个配置来源</h3>
<p style="margin-left: 60px;">通过<strong>@ImportSource("classpath:/xxx.xml")</strong>导入XML配置文件；</p>
<p style="margin-left: 60px;">通过<strong>@Import(TestConfiguration.class)</strong>导入其他配置类；</p>
<p style="margin-left: 60px;">通过<strong>@Configuration嵌套</strong>（嵌套额Configuration类必须为静态类）。</p>
<h2>2、@Component、@Service、@Controller、@Repository、@RestController、@Bean</h2>
<p style="margin-left: 30px;">修饰的类均会被扫描到并注入到spring的bean容器中。</p>
<h3 style="margin-left: 30px;">2.1、@Component</h3>
<p style="margin-left: 60px;">通用注解，可以被注入到spring容器进行管理。</p>
<h3 style="margin-left: 30px;">2.2、@Service、@Controller、@Repository是针对不同使用场景采用的特定功能化的注解组件。</h3>
<ul>
<li style="list-style-type: none;">
<ul>
<li>@Service：作用于业务逻辑层</li>
<li>@Controller：作用于表现层（springMVC注解），注解的bean会被spring-mvc框架使用，进行前端请求的处理、转发、重定向，包括调用service层的方法</li>
<li>@Repository：作用于持久层，表明该类是用来执行与数据库相关的操作，并支持自动处理数据库操作产生的异常</li>
</ul>
</li>
</ul>
<h3 style="margin-left: 30px;">2.3、@Controller和@RestController</h3>
<p style="margin-left: 60px;">首先两者都是表明该类可以接受HTTP请求，@RestController相当于@Controller+@ResponseBody的作用。</p>
<p style="margin-left: 60px;">在@RestController中，返回的应该是一个对象，即使没有前端界面的渲染，也可以看到返回的是该对象对应的json字符串，而前端的作用就是利用返回的json进行解析并渲染界面。</p>
<p style="margin-left: 60px;">在@Controller中，返回的是一个字符串，或者代表与字符串匹配的模板名称，与HTML页面配合使用。</p>
<ol>
<li style="list-style-type: none;"><ol>
<li style="margin-left: 30px;">如果只是用@RestController注解，则Controller方法中无法返回jsp页面，配置的视图解析器InternalResourceViewResolver不起作用，返回的内容就是方法中return的值。</li>
<li style="margin-left: 30px;">如需要指定返回某个页面，则需要用@Controller配合视图解析器InternalResourceViewResolver使用。</li>
<li style="margin-left: 30px;">如果需要返回Json、XML或自定义的mediaType内容到页面，@RestController直接就能做到，但在@Controller中需要在相应方法上加上@ResponseBody注解。</li>
</ol></li>
</ol>
<h3 style="margin-left: 30px;">2.4、@Bean和@Component（@Service、@Controller、@Repository）的区别</h3>
<ul>
<li style="margin-left: 30px;">@Component注解表明一个类作为组件类，并告知spring为该类创建bean。</li>
<li style="margin-left: 30px;">@Bean注解告诉spring这个方法将返回一个对象，该对象要注册为spring应用上下文中的bean。</li>
</ul>
<p style="margin-left: 60px;">两者目的都是注册bean到Spring容器中。</p>
<ul>
<li style="margin-left: 30px;">@Component通常是通过类路径扫描来自动侦测并自动装配到spring容器中。作用于类。</li>
<li style="margin-left: 30px;">@Bean注解通常是我们在标有该注解的方法中自定义产生这个bean的逻辑。作用于方法。</li>
</ul>
<h2>3、@Autowired、@Resource</h2>
<p style="margin-left: 30px;"><span style="text-decoration: underline;"><strong>@Autowired默认按照类型装配。</strong></span></p>
<p style="margin-left: 60px;">默认要求依赖的对象必须存在，若允许为NULL，可以设置required属性为false。</p>
<p style="margin-left: 30px;"><span style="text-decoration: underline;"><strong>@Resouce默认按照名称装配。</strong></span></p>
<p style="margin-left: 60px;">可以通过name属性指定，指定了name属性，就只能按照名称装配。</p>
<p style="margin-left: 60px;">有两个重要的属性，name和人type，将name属性解析为bean的名字，type解析为bean的类型。</p>
<p style="margin-left: 60px;">使用了name属性，则使用byName的自动注入策略；而使用type属性，则使用byType的自动注入策略。</p>
<p style="margin-left: 60px;">@Resouce的装配顺序：</p>
<ol>
<li style="margin-left: 60px;">同时指定了name和type属性，从spring上下文找到唯一匹配的bean进行装配，找不到则抛出异常。</li>
<li style="margin-left: 60px;">指定了name属性，从上下文查找名称匹配的bean进行装配，找不到则抛出异常。</li>
<li style="margin-left: 60px;">指定了type属性，从上下文查找类型匹配的唯一bean进行装配，找不到或者找到多个则抛出异常。</li>
<li style="margin-left: 60px;">属性均未指定，则默认按照byName的方式进行查找装配。</li>
</ol>
<h2>4、@PropertySource、@ImportResource</h2>
<p style="margin-left: 30px;"><span style="text-decoration: underline;"><strong>@ImportResource：导入spring的配置文件，如xxx.XML。</strong></span></p>
<p style="margin-left: 30px;"><span style="text-decoration: underline;"><strong>@PropertySource</strong></span></p>
<p style="margin-left: 60px;">@ConfigurationProperties是默认从全局配置文件中获取指定的值，例如@ConfigurationProperties(prefix=&ldquo;person&rdquo;)是从application.yml(properties)中加载person的属性并映射到对应类的属性。</p>
<p style="margin-left: 60px;">如果配置在xxx.properties中（非全局配置文件），就需要用@PropertySource(value={"classpath:/xxx.properties"})导入指定配置文件。</p>
<h1>四、项目搭建流程</h1>
<h2>1、注册中心Zookeeper搭建</h2>
<p style="margin-left: 30px;">Zookeeper的安装不在此介绍，可参考：<a href="http://www.biying.cn" target="_blank"><strong><span style="text-decoration: underline;">Zookeeper单点与集群安装</span> </strong></a></p>
<h2>2、项目框架搭建</h2>
<p style="margin-left: 30px;">创建maven项目hello_dubbo，删掉其中的src文件夹，并添加对spring-boot的依赖，作为整个项目运行环境。</p>
<p style="margin-left: 30px;">新建new module，依次为api（服务接口公共包）、provider（服务提供者模块）、consumer（服务消费者模块）,。</p>
<p style="margin-left: 30px;">此时项目结构如图：</p>
<p style="margin-left: 30px;"><img src="./images/【Dubbo】Zookeeper+Dubbo项目demo搭建1.png" alt="" /></p>
<p style="margin-left: 30px;">pom文件关键信息为：</p>
<src class="cnblogs_code" style="margin-left: 30px;" onclick="cnblogs_code_show('3b725d93-91bc-48b9-854b-5f0f36ea9efb')"><img id="code_img_closed_3b725d93-91bc-48b9-854b-5f0f36ea9efb" class="code_img_closed" src="./images/【Dubbo】Zookeeper+Dubbo项目demo搭建2.png" alt="" /><img id="code_img_opened_3b725d93-91bc-48b9-854b-5f0f36ea9efb" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('3b725d93-91bc-48b9-854b-5f0f36ea9efb',event)" src="./images/【Dubbo】Zookeeper+Dubbo项目demo搭建3.png" alt="" />
<src id="cnblogs_code_open_3b725d93-91bc-48b9-854b-5f0f36ea9efb" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> &lt;groupId&gt;com.li&lt;/groupId&gt;
<span style="color: #008080;"> 2</span> &lt;artifactId&gt;hello_dubbo&lt;/artifactId&gt;
<span style="color: #008080;"> 3</span> &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
<span style="color: #008080;"> 4</span> 
<span style="color: #008080;"> 5</span> &lt;parent&gt;
<span style="color: #008080;"> 6</span>     &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
<span style="color: #008080;"> 7</span>     &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
<span style="color: #008080;"> 8</span>     &lt;version&gt;2.1.9.RELEASE&lt;/version&gt;
<span style="color: #008080;"> 9</span>     &lt;relativePath/&gt;
<span style="color: #008080;">10</span> &lt;/parent&gt;
<span style="color: #008080;">11</span> 
<span style="color: #008080;">12</span> &lt;modules&gt;
<span style="color: #008080;">13</span>     &lt;module&gt;api&lt;/module&gt;
<span style="color: #008080;">14</span>     &lt;module&gt;provider&lt;/module&gt;
<span style="color: #008080;">15</span>     &lt;module&gt;consumer&lt;/module&gt;
<span style="color: #008080;">16</span> &lt;/modules&gt;</code></pre>

<span class="cnblogs_code_collapse">hello_dubbo_pom.xml</span>
<h2>3、api包</h2>
<p style="margin-left: 30px;">在pom文件中配置依赖关系：</p>
<src class="cnblogs_code" style="margin-left: 30px;" onclick="cnblogs_code_show('4cb90ab3-4726-4865-906a-3838bf45667e')"><img id="code_img_closed_4cb90ab3-4726-4865-906a-3838bf45667e" class="code_img_closed" src="./images/【Dubbo】Zookeeper+Dubbo项目demo搭建2.png" alt="" /><img id="code_img_opened_4cb90ab3-4726-4865-906a-3838bf45667e" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('4cb90ab3-4726-4865-906a-3838bf45667e',event)" src="./images/【Dubbo】Zookeeper+Dubbo项目demo搭建3.png" alt="" />
<src id="cnblogs_code_open_4cb90ab3-4726-4865-906a-3838bf45667e" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;">1</span> &lt;parent&gt;
<span style="color: #008080;">2</span>     &lt;groupId&gt;com.li&lt;/groupId&gt;
<span style="color: #008080;">3</span>     &lt;artifactId&gt;hello_dubbo&lt;/artifactId&gt;
<span style="color: #008080;">4</span>     &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
<span style="color: #008080;">5</span> &lt;/parent&gt;
<span style="color: #008080;">6</span> 
<span style="color: #008080;">7</span> &lt;artifactId&gt;api&lt;/artifactId&gt;</code></pre>

<span class="cnblogs_code_collapse">api_pom.xml</span>
<p style="margin-left: 30px;">在api包中创建要对外提供服务的接口类HelloAPI.java：</p>
<src class="cnblogs_code" style="margin-left: 30px;" onclick="cnblogs_code_show('9d0623d8-3076-4973-a14c-2da464cd9883')"><img id="code_img_closed_9d0623d8-3076-4973-a14c-2da464cd9883" class="code_img_closed" src="./images/【Dubbo】Zookeeper+Dubbo项目demo搭建2.png" alt="" /><img id="code_img_opened_9d0623d8-3076-4973-a14c-2da464cd9883" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('9d0623d8-3076-4973-a14c-2da464cd9883',event)" src="./images/【Dubbo】Zookeeper+Dubbo项目demo搭建3.png" alt="" />
<src id="cnblogs_code_open_9d0623d8-3076-4973-a14c-2da464cd9883" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;">1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.li.api;
</span><span style="color: #008080;">2</span> 
<span style="color: #008080;">3</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">interface</span><span style="color: #000000;"> HelloApi {
</span><span style="color: #008080;">4</span> 
<span style="color: #008080;">5</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> String sayHello(String name);
</span><span style="color: #008080;">6</span> }</code></pre>

<span class="cnblogs_code_collapse">HelloApi</span>
<p style="margin-left: 30px;">此时的api模块结构：</p>
<p style="margin-left: 30px;"><img src="./images/【Dubbo】Zookeeper+Dubbo项目demo搭建8.png" alt="" /></p>
<h2>4、provider项目</h2>
<p style="margin-left: 30px;"><strong>1、修改pom文件，添加相关依赖：</strong></p>
<src class="cnblogs_code" style="margin-left: 30px;" onclick="cnblogs_code_show('71aac07f-3f86-4ab1-b123-2a94c3ca2460')"><img id="code_img_closed_71aac07f-3f86-4ab1-b123-2a94c3ca2460" class="code_img_closed" src="./images/【Dubbo】Zookeeper+Dubbo项目demo搭建2.png" alt="" /><img id="code_img_opened_71aac07f-3f86-4ab1-b123-2a94c3ca2460" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('71aac07f-3f86-4ab1-b123-2a94c3ca2460',event)" src="./images/【Dubbo】Zookeeper+Dubbo项目demo搭建3.png" alt="" />
<src id="cnblogs_code_open_71aac07f-3f86-4ab1-b123-2a94c3ca2460" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> &lt;parent&gt;
<span style="color: #008080;"> 2</span>     &lt;groupId&gt;com.li&lt;/groupId&gt;
<span style="color: #008080;"> 3</span>     &lt;artifactId&gt;hello_dubbo&lt;/artifactId&gt;
<span style="color: #008080;"> 4</span>     &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
<span style="color: #008080;"> 5</span> &lt;/parent&gt;
<span style="color: #008080;"> 6</span> 
<span style="color: #008080;"> 7</span> &lt;artifactId&gt;provider&lt;/artifactId&gt;
<span style="color: #008080;"> 8</span> &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
<span style="color: #008080;"> 9</span> &lt;name&gt;provider&lt;/name&gt;
<span style="color: #008080;">10</span> 
<span style="color: #008080;">11</span> &lt;dependencies&gt;
<span style="color: #008080;">12</span>     &lt;!--web支持--&gt;
<span style="color: #008080;">13</span>     &lt;dependency&gt;
<span style="color: #008080;">14</span>         &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
<span style="color: #008080;">15</span>         &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
<span style="color: #008080;">16</span>     &lt;/dependency&gt;
<span style="color: #008080;">17</span>     &lt;!--添加Zookeeper依赖--&gt;
<span style="color: #008080;">18</span>     &lt;dependency&gt;
<span style="color: #008080;">19</span>         &lt;groupId&gt;org.apache.zookeeper&lt;/groupId&gt;
<span style="color: #008080;">20</span>         &lt;artifactId&gt;zookeeper&lt;/artifactId&gt;
<span style="color: #008080;">21</span>         &lt;version&gt;3.5.5&lt;/version&gt;
<span style="color: #008080;">22</span>         &lt;exclusions&gt;
<span style="color: #008080;">23</span>             &lt;exclusion&gt;
<span style="color: #008080;">24</span>                 &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
<span style="color: #008080;">25</span>                 &lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt;
<span style="color: #008080;">26</span>             &lt;/exclusion&gt;
<span style="color: #008080;">27</span>         &lt;/exclusions&gt;
<span style="color: #008080;">28</span>     &lt;/dependency&gt;
<span style="color: #008080;">29</span>     &lt;!--添加Dubbo依赖，已并入apache--&gt;
<span style="color: #008080;">30</span>     &lt;dependency&gt;
<span style="color: #008080;">31</span>         &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;
<span style="color: #008080;">32</span>         &lt;artifactId&gt;dubbo&lt;/artifactId&gt;
<span style="color: #008080;">33</span>         &lt;version&gt;2.7.3&lt;/version&gt;
<span style="color: #008080;">34</span>     &lt;/dependency&gt;
<span style="color: #008080;">35</span>     &lt;!--添加zookeeper客户端框架Curator--&gt;
<span style="color: #008080;">36</span>     &lt;dependency&gt;
<span style="color: #008080;">37</span>         &lt;groupId&gt;org.apache.curator&lt;/groupId&gt;
<span style="color: #008080;">38</span>         &lt;artifactId&gt;curator-framework&lt;/artifactId&gt;
<span style="color: #008080;">39</span>         &lt;version&gt;4.2.0&lt;/version&gt;
<span style="color: #008080;">40</span>     &lt;/dependency&gt;
<span style="color: #008080;">41</span>     &lt;dependency&gt;
<span style="color: #008080;">42</span>         &lt;groupId&gt;org.apache.curator&lt;/groupId&gt;
<span style="color: #008080;">43</span>         &lt;artifactId&gt;curator-recipes&lt;/artifactId&gt;
<span style="color: #008080;">44</span>         &lt;version&gt;4.2.0&lt;/version&gt;
<span style="color: #008080;">45</span>     &lt;/dependency&gt;
<span style="color: #008080;">46</span>     &lt;dependency&gt;
<span style="color: #008080;">47</span>         &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
<span style="color: #008080;">48</span>         &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
<span style="color: #008080;">49</span>         &lt;scope&gt;test&lt;/scope&gt;
<span style="color: #008080;">50</span>     &lt;/dependency&gt;
<span style="color: #008080;">51</span>     &lt;!--添加对API模块的依赖--&gt;
<span style="color: #008080;">52</span>     &lt;dependency&gt;
<span style="color: #008080;">53</span>         &lt;groupId&gt;com.li&lt;/groupId&gt;
<span style="color: #008080;">54</span>         &lt;artifactId&gt;api&lt;/artifactId&gt;
<span style="color: #008080;">55</span>         &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
<span style="color: #008080;">56</span>         &lt;scope&gt;compile&lt;/scope&gt;
<span style="color: #008080;">57</span>     &lt;/dependency&gt;
<span style="color: #008080;">58</span> &lt;/dependencies&gt;</code></pre>

<span class="cnblogs_code_collapse">provider_pom.xml</span>
<p style="margin-left: 30px;"><strong>2、添加service包，在其中创建api接口的实现类，提供服务的具体实现，并用@Service暴露服务：</strong></p>
<src class="cnblogs_code" style="margin-left: 30px;" onclick="cnblogs_code_show('e2b0ab68-70fe-4e77-8e0e-b6bcfba6bc01')"><img id="code_img_closed_e2b0ab68-70fe-4e77-8e0e-b6bcfba6bc01" class="code_img_closed" src="./images/【Dubbo】Zookeeper+Dubbo项目demo搭建2.png" alt="" /><img id="code_img_opened_e2b0ab68-70fe-4e77-8e0e-b6bcfba6bc01" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('e2b0ab68-70fe-4e77-8e0e-b6bcfba6bc01',event)" src="./images/【Dubbo】Zookeeper+Dubbo项目demo搭建3.png" alt="" />
<src id="cnblogs_code_open_e2b0ab68-70fe-4e77-8e0e-b6bcfba6bc01" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.li.provider.service;
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.li.api.HelloApi;
</span><span style="color: #008080;"> 4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.apache.dubbo.config.annotation.Service;
</span><span style="color: #008080;"> 5</span> 
<span style="color: #008080;"> 6</span> <span style="color: #000000;">@Service
</span><span style="color: #008080;"> 7</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> HelloService <span style="color: #0000ff;">implements</span><span style="color: #000000;"> HelloApi {
</span><span style="color: #008080;"> 8</span> 
<span style="color: #008080;"> 9</span> <span style="color: #000000;">    @Override
</span><span style="color: #008080;">10</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> String sayHello(String name) {
</span><span style="color: #008080;">11</span>         <span style="color: #0000ff;">return</span> "hello " +<span style="color: #000000;"> name;
</span><span style="color: #008080;">12</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">13</span> }</code></pre>

<span class="cnblogs_code_collapse">HelloService</span>
<p style="margin-left: 30px;"><strong>3、provider的配置注入方式选择采用properties文件的形式。</strong></p>
<p style="margin-left: 30px;">在resources下添加provider.properties配置文件：</p>
<src class="cnblogs_code" style="margin-left: 30px;" onclick="cnblogs_code_show('1f1f832c-fabf-46f3-b565-b91320c61903')"><img id="code_img_closed_1f1f832c-fabf-46f3-b565-b91320c61903" class="code_img_closed" src="./images/【Dubbo】Zookeeper+Dubbo项目demo搭建2.png" alt="" /><img id="code_img_opened_1f1f832c-fabf-46f3-b565-b91320c61903" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('1f1f832c-fabf-46f3-b565-b91320c61903',event)" src="./images/【Dubbo】Zookeeper+Dubbo项目demo搭建3.png" alt="" />
<src id="cnblogs_code_open_1f1f832c-fabf-46f3-b565-b91320c61903" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;">1</span> dubbo.application.name=<span style="color: #000000;">helloP
</span><span style="color: #008080;">2</span> dubbo.registry.address=zookeeper:<span style="color: #008000;">//</span><span style="color: #008000;">127.0.0.1:2181</span>
<span style="color: #008080;">3</span> dubbo.protocol.name=<span style="color: #000000;">dubbo
</span><span style="color: #008080;">4</span> dubbo.protocol.port=20880
<span style="color: #008080;">5</span> server.port=8001</code></pre>

<span class="cnblogs_code_collapse">provider.properties</span>
<p style="margin-left: 30px;">在主目录下创建Configuration类，作为配置类：</p>
<src class="cnblogs_code" style="margin-left: 30px;" onclick="cnblogs_code_show('bbdd33b8-29a5-4b61-8813-a259a486536b')"><img id="code_img_closed_bbdd33b8-29a5-4b61-8813-a259a486536b" class="code_img_closed" src="./images/【Dubbo】Zookeeper+Dubbo项目demo搭建2.png" alt="" /><img id="code_img_opened_bbdd33b8-29a5-4b61-8813-a259a486536b" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('bbdd33b8-29a5-4b61-8813-a259a486536b',event)" src="./images/【Dubbo】Zookeeper+Dubbo项目demo搭建3.png" alt="" />
<src id="cnblogs_code_open_bbdd33b8-29a5-4b61-8813-a259a486536b" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.li.provider;
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.apache.dubbo.config.spring.context.annotation.EnableDubbo;
</span><span style="color: #008080;"> 4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.context.annotation.Configuration;
</span><span style="color: #008080;"> 5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.context.annotation.PropertySource;
</span><span style="color: #008080;"> 6</span> 
<span style="color: #008080;"> 7</span> <span style="color: #000000;">@Configuration
</span><span style="color: #008080;"> 8</span> @EnableDubbo(scanBasePackages = "com.li.provider.service"<span style="color: #000000;">)
</span><span style="color: #008080;"> 9</span> @PropertySource("classpath:/provider.properties"<span style="color: #000000;">)
</span><span style="color: #008080;">10</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> ProviderConfiguration {
</span><span style="color: #008080;">11</span> }</code></pre>

<span class="cnblogs_code_collapse">ProviderConfiguration</span>
<p style="margin-left: 30px;"><strong>4、启动类选择springBoot启动：</strong></p>
<src class="cnblogs_code" style="margin-left: 30px;" onclick="cnblogs_code_show('bd552af6-76b9-4f82-bd6f-73fbd67182c7')"><img id="code_img_closed_bd552af6-76b9-4f82-bd6f-73fbd67182c7" class="code_img_closed" src="./images/【Dubbo】Zookeeper+Dubbo项目demo搭建2.png" alt="" /><img id="code_img_opened_bd552af6-76b9-4f82-bd6f-73fbd67182c7" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('bd552af6-76b9-4f82-bd6f-73fbd67182c7',event)" src="./images/【Dubbo】Zookeeper+Dubbo项目demo搭建3.png" alt="" />
<src id="cnblogs_code_open_bd552af6-76b9-4f82-bd6f-73fbd67182c7" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.li.provider;
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.boot.SpringApplication;
</span><span style="color: #008080;"> 4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.boot.autoconfigure.SpringBootApplication;
</span><span style="color: #008080;"> 5</span> 
<span style="color: #008080;"> 6</span> <span style="color: #000000;">@SpringBootApplication
</span><span style="color: #008080;"> 7</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> ProviderApplication {
</span><span style="color: #008080;"> 8</span> 
<span style="color: #008080;"> 9</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> main(String[] args) {
</span><span style="color: #008080;">10</span>         SpringApplication.run(ProviderApplication.<span style="color: #0000ff;">class</span><span style="color: #000000;">, args);
</span><span style="color: #008080;">11</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">12</span> 
<span style="color: #008080;">13</span> }</code></pre>

<span class="cnblogs_code_collapse">ProviderApplication</span>
<p style="margin-left: 30px;"><strong>5、至此，Provider模块完成，项目结构如下：</strong></p>
<p style="margin-left: 30px;"><img src="./images/【Dubbo】Zookeeper+Dubbo项目demo搭建19.png" alt="" /></p>
<h2>5、consumer项目</h2>
<p style="margin-left: 30px;"><strong>1、修改pom文件，添加相关依赖：</strong></p>
<src class="cnblogs_code" style="margin-left: 30px;" onclick="cnblogs_code_show('540a2f39-a094-41c1-81f8-13c25e7c5803')"><img id="code_img_closed_540a2f39-a094-41c1-81f8-13c25e7c5803" class="code_img_closed" src="./images/【Dubbo】Zookeeper+Dubbo项目demo搭建2.png" alt="" /><img id="code_img_opened_540a2f39-a094-41c1-81f8-13c25e7c5803" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('540a2f39-a094-41c1-81f8-13c25e7c5803',event)" src="./images/【Dubbo】Zookeeper+Dubbo项目demo搭建3.png" alt="" />
<src id="cnblogs_code_open_540a2f39-a094-41c1-81f8-13c25e7c5803" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> &lt;parent&gt;
<span style="color: #008080;"> 2</span>     &lt;groupId&gt;com.li&lt;/groupId&gt;
<span style="color: #008080;"> 3</span>     &lt;artifactId&gt;hello_dubbo&lt;/artifactId&gt;
<span style="color: #008080;"> 4</span>     &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
<span style="color: #008080;"> 5</span> &lt;/parent&gt;
<span style="color: #008080;"> 6</span> 
<span style="color: #008080;"> 7</span> &lt;artifactId&gt;consumer&lt;/artifactId&gt;
<span style="color: #008080;"> 8</span> &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
<span style="color: #008080;"> 9</span> &lt;name&gt;consumer&lt;/name&gt;
<span style="color: #008080;">10</span> 
<span style="color: #008080;">11</span> &lt;dependencies&gt;
<span style="color: #008080;">12</span>     &lt;!--web支持--&gt;
<span style="color: #008080;">13</span>     &lt;dependency&gt;
<span style="color: #008080;">14</span>         &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
<span style="color: #008080;">15</span>         &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
<span style="color: #008080;">16</span>     &lt;/dependency&gt;
<span style="color: #008080;">17</span>     &lt;!--添加Zookeeper依赖--&gt;
<span style="color: #008080;">18</span>     &lt;dependency&gt;
<span style="color: #008080;">19</span>         &lt;groupId&gt;org.apache.zookeeper&lt;/groupId&gt;
<span style="color: #008080;">20</span>         &lt;artifactId&gt;zookeeper&lt;/artifactId&gt;
<span style="color: #008080;">21</span>         &lt;version&gt;3.5.5&lt;/version&gt;
<span style="color: #008080;">22</span>         &lt;exclusions&gt;
<span style="color: #008080;">23</span>             &lt;exclusion&gt;
<span style="color: #008080;">24</span>                 &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
<span style="color: #008080;">25</span>                 &lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt;
<span style="color: #008080;">26</span>             &lt;/exclusion&gt;
<span style="color: #008080;">27</span>         &lt;/exclusions&gt;
<span style="color: #008080;">28</span>     &lt;/dependency&gt;
<span style="color: #008080;">29</span>     &lt;!--添加Dubbo依赖，已并入apache--&gt;
<span style="color: #008080;">30</span>     &lt;dependency&gt;
<span style="color: #008080;">31</span>         &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;
<span style="color: #008080;">32</span>         &lt;artifactId&gt;dubbo&lt;/artifactId&gt;
<span style="color: #008080;">33</span>         &lt;version&gt;2.7.3&lt;/version&gt;
<span style="color: #008080;">34</span>     &lt;/dependency&gt;
<span style="color: #008080;">35</span>     &lt;!--添加zookeeper客户端框架Curator--&gt;
<span style="color: #008080;">36</span>     &lt;dependency&gt;
<span style="color: #008080;">37</span>         &lt;groupId&gt;org.apache.curator&lt;/groupId&gt;
<span style="color: #008080;">38</span>         &lt;artifactId&gt;curator-framework&lt;/artifactId&gt;
<span style="color: #008080;">39</span>         &lt;version&gt;4.2.0&lt;/version&gt;
<span style="color: #008080;">40</span>     &lt;/dependency&gt;
<span style="color: #008080;">41</span>     &lt;dependency&gt;
<span style="color: #008080;">42</span>         &lt;groupId&gt;org.apache.curator&lt;/groupId&gt;
<span style="color: #008080;">43</span>         &lt;artifactId&gt;curator-recipes&lt;/artifactId&gt;
<span style="color: #008080;">44</span>         &lt;version&gt;4.2.0&lt;/version&gt;
<span style="color: #008080;">45</span>     &lt;/dependency&gt;
<span style="color: #008080;">46</span>     &lt;dependency&gt;
<span style="color: #008080;">47</span>         &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
<span style="color: #008080;">48</span>         &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
<span style="color: #008080;">49</span>         &lt;scope&gt;test&lt;/scope&gt;
<span style="color: #008080;">50</span>     &lt;/dependency&gt;
<span style="color: #008080;">51</span>     &lt;!--添加对API模块的依赖--&gt;
<span style="color: #008080;">52</span>     &lt;dependency&gt;
<span style="color: #008080;">53</span>         &lt;groupId&gt;com.li&lt;/groupId&gt;
<span style="color: #008080;">54</span>         &lt;artifactId&gt;api&lt;/artifactId&gt;
<span style="color: #008080;">55</span>         &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
<span style="color: #008080;">56</span>         &lt;scope&gt;compile&lt;/scope&gt;
<span style="color: #008080;">57</span>     &lt;/dependency&gt;
<span style="color: #008080;">58</span> &lt;/dependencies&gt;</code></pre>

<span class="cnblogs_code_collapse">consumer_pom.xml</span>
<p style="margin-left: 30px;"><strong>2、创建action包，新增HelloAction类，作为MVC框架的service层，提供业务逻辑处理并利用@Reference提供对远程服务的引用：</strong></p>
<src class="cnblogs_code" style="margin-left: 30px;" onclick="cnblogs_code_show('bf2a547b-e34d-4e7a-830f-8e4659fbf483')"><img id="code_img_closed_bf2a547b-e34d-4e7a-830f-8e4659fbf483" class="code_img_closed" src="./images/【Dubbo】Zookeeper+Dubbo项目demo搭建2.png" alt="" /><img id="code_img_opened_bf2a547b-e34d-4e7a-830f-8e4659fbf483" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('bf2a547b-e34d-4e7a-830f-8e4659fbf483',event)" src="./images/【Dubbo】Zookeeper+Dubbo项目demo搭建3.png" alt="" />
<src id="cnblogs_code_open_bf2a547b-e34d-4e7a-830f-8e4659fbf483" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.li.consumer.action;
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.li.api.HelloApi;
</span><span style="color: #008080;"> 4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.apache.dubbo.config.annotation.Reference;
</span><span style="color: #008080;"> 5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.stereotype.Service;
</span><span style="color: #008080;"> 6</span> 
<span style="color: #008080;"> 7</span> @Service    <span style="color: #008000;">//</span><span style="color: #008000;">注意为spring的@Service注解，将其作为bean管理</span>
<span style="color: #008080;"> 8</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> HelloAction {
</span><span style="color: #008080;"> 9</span> 
<span style="color: #008080;">10</span>     @Reference(check = <span style="color: #0000ff;">false</span><span style="color: #000000;">)
</span><span style="color: #008080;">11</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> HelloApi helloApi;
</span><span style="color: #008080;">12</span> 
<span style="color: #008080;">13</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> String doHello(String name) {
</span><span style="color: #008080;">14</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> helloApi.sayHello(name);
</span><span style="color: #008080;">15</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">16</span> }</code></pre>

<span class="cnblogs_code_collapse">HelloAction</span>
<p style="margin-left: 30px;"><strong>3、创建controller包，新增HelloController类，作为MVC框架的controller层，提供前端请求的转发，以及业务逻辑的调用：</strong></p>
<src class="cnblogs_code" style="margin-left: 30px;" onclick="cnblogs_code_show('d8910d32-3b7b-4168-8f08-3037410207d9')"><img id="code_img_closed_d8910d32-3b7b-4168-8f08-3037410207d9" class="code_img_closed" src="./images/【Dubbo】Zookeeper+Dubbo项目demo搭建2.png" alt="" /><img id="code_img_opened_d8910d32-3b7b-4168-8f08-3037410207d9" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('d8910d32-3b7b-4168-8f08-3037410207d9',event)" src="./images/【Dubbo】Zookeeper+Dubbo项目demo搭建3.png" alt="" />
<src id="cnblogs_code_open_d8910d32-3b7b-4168-8f08-3037410207d9" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.li.consumer.controller;
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.li.consumer.action.HelloAction;
</span><span style="color: #008080;"> 4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.beans.factory.annotation.Autowired;
</span><span style="color: #008080;"> 5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.web.bind.annotation.GetMapping;
</span><span style="color: #008080;"> 6</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.web.bind.annotation.RequestParam;
</span><span style="color: #008080;"> 7</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.web.bind.annotation.RestController;
</span><span style="color: #008080;"> 8</span> 
<span style="color: #008080;"> 9</span> <span style="color: #000000;">@RestController
</span><span style="color: #008080;">10</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> HelloController {
</span><span style="color: #008080;">11</span> 
<span style="color: #008080;">12</span> <span style="color: #000000;">    @Autowired
</span><span style="color: #008080;">13</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> HelloAction action;
</span><span style="color: #008080;">14</span> 
<span style="color: #008080;">15</span>     @GetMapping("/hello"<span style="color: #000000;">)
</span><span style="color: #008080;">16</span>     <span style="color: #0000ff;">public</span> String hello(@RequestParam("name"<span style="color: #000000;">)String name) {
</span><span style="color: #008080;">17</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> action.doHello(name);
</span><span style="color: #008080;">18</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">19</span> }</code></pre>

<span class="cnblogs_code_collapse">HelloController</span>
<p style="margin-left: 30px;"><strong>4、consumer的配置注入方式选择采用Java Config硬编码的形式。</strong></p>
<p style="margin-left: 30px;">在resources下添加consumer.properties配置文件：</p>
<src class="cnblogs_code" style="margin-left: 30px;" onclick="cnblogs_code_show('cf65e8b5-da0f-433e-94d9-32c68ab6a1a3')"><img id="code_img_closed_cf65e8b5-da0f-433e-94d9-32c68ab6a1a3" class="code_img_closed" src="./images/【Dubbo】Zookeeper+Dubbo项目demo搭建2.png" alt="" /><img id="code_img_opened_cf65e8b5-da0f-433e-94d9-32c68ab6a1a3" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('cf65e8b5-da0f-433e-94d9-32c68ab6a1a3',event)" src="./images/【Dubbo】Zookeeper+Dubbo项目demo搭建3.png" alt="" />
<src id="cnblogs_code_open_cf65e8b5-da0f-433e-94d9-32c68ab6a1a3" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;">1</span> server.port=8002    <span style="color: #008000;">//</span><span style="color: #008000;">注册对外提供服务的端口</span></code></pre>

<span class="cnblogs_code_collapse">consumer.properties</span>
<p style="margin-left: 30px;">在主目录下创建Configuration类，作为配置类：</p>
<src class="cnblogs_code" style="margin-left: 30px;" onclick="cnblogs_code_show('74134196-e4b1-4b0b-9b78-7fda1c1c8aff')"><img id="code_img_closed_74134196-e4b1-4b0b-9b78-7fda1c1c8aff" class="code_img_closed" src="./images/【Dubbo】Zookeeper+Dubbo项目demo搭建2.png" alt="" /><img id="code_img_opened_74134196-e4b1-4b0b-9b78-7fda1c1c8aff" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('74134196-e4b1-4b0b-9b78-7fda1c1c8aff',event)" src="./images/【Dubbo】Zookeeper+Dubbo项目demo搭建3.png" alt="" />
<src id="cnblogs_code_open_74134196-e4b1-4b0b-9b78-7fda1c1c8aff" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.li.consumer;
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.apache.dubbo.config.ApplicationConfig;
</span><span style="color: #008080;"> 4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.apache.dubbo.config.RegistryConfig;
</span><span style="color: #008080;"> 5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.context.annotation.Bean;
</span><span style="color: #008080;"> 6</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.context.annotation.Configuration;
</span><span style="color: #008080;"> 7</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.context.annotation.PropertySource;
</span><span style="color: #008080;"> 8</span> 
<span style="color: #008080;"> 9</span> <span style="color: #000000;">@Configuration
</span><span style="color: #008080;">10</span> @PropertySource("classpath:/consumer.properties"<span style="color: #000000;">)
</span><span style="color: #008080;">11</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> ConsumerConfiguration {
</span><span style="color: #008080;">12</span> 
<span style="color: #008080;">13</span> <span style="color: #000000;">    @Bean
</span><span style="color: #008080;">14</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> ApplicationConfig applicationConfig() {
</span><span style="color: #008080;">15</span>         ApplicationConfig config = <span style="color: #0000ff;">new</span><span style="color: #000000;"> ApplicationConfig();
</span><span style="color: #008080;">16</span>         config.setName("helloC"<span style="color: #000000;">);
</span><span style="color: #008080;">17</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> config;
</span><span style="color: #008080;">18</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">19</span> 
<span style="color: #008080;">20</span> <span style="color: #000000;">    @Bean
</span><span style="color: #008080;">21</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> RegistryConfig registryConfig() {
</span><span style="color: #008080;">22</span>         RegistryConfig config = <span style="color: #0000ff;">new</span><span style="color: #000000;"> RegistryConfig();
</span><span style="color: #008080;">23</span>         config.setAddress("zookeeper://127.0.0.1:2181"<span style="color: #000000;">);
</span><span style="color: #008080;">24</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> config;
</span><span style="color: #008080;">25</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">26</span> }</code></pre>

<span class="cnblogs_code_collapse">ConsumerConfiguration</span>
<p style="margin-left: 30px;"><strong>5、启动类选择springBoot启动：</strong></p>
<src class="cnblogs_code" style="margin-left: 30px;" onclick="cnblogs_code_show('dee605c1-cdbf-4ff7-b491-450364642a71')"><img id="code_img_closed_dee605c1-cdbf-4ff7-b491-450364642a71" class="code_img_closed" src="./images/【Dubbo】Zookeeper+Dubbo项目demo搭建2.png" alt="" /><img id="code_img_opened_dee605c1-cdbf-4ff7-b491-450364642a71" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('dee605c1-cdbf-4ff7-b491-450364642a71',event)" src="./images/【Dubbo】Zookeeper+Dubbo项目demo搭建3.png" alt="" />
<src id="cnblogs_code_open_dee605c1-cdbf-4ff7-b491-450364642a71" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.li.consumer;
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.boot.SpringApplication;
</span><span style="color: #008080;"> 4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.boot.autoconfigure.SpringBootApplication;
</span><span style="color: #008080;"> 5</span> 
<span style="color: #008080;"> 6</span> <span style="color: #000000;">@SpringBootApplication
</span><span style="color: #008080;"> 7</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> ConsumerApplication {
</span><span style="color: #008080;"> 8</span> 
<span style="color: #008080;"> 9</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> main(String[] args) {
</span><span style="color: #008080;">10</span>         SpringApplication.run(ConsumerApplication.<span style="color: #0000ff;">class</span><span style="color: #000000;">, args);
</span><span style="color: #008080;">11</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">12</span> 
<span style="color: #008080;">13</span> }</code></pre>

<span class="cnblogs_code_collapse">ConsumerApplication</span>
<p style="margin-left: 30px;"><strong>6、至此，Consumer模块完成，项目结构如下：</strong></p>
<p style="margin-left: 30px;"><img src="./images/【Dubbo】Zookeeper+Dubbo项目demo搭建32.png" alt="" /></p>
<h2>6、项目启动</h2>
<p style="margin-left: 30px;">项目启动时，首先启动Zookeeper，命令行执行<span style="text-decoration: underline;"><strong>zkServer.cmd</strong></span>。</p>
<p style="margin-left: 30px;">正常启动顺序应该先启动提供者，然后启动消费者，因为@Reference注解在启动时默认会去注册中心检查所引用服务状态是否正常提供服务，若想先启动消费者，可选择关闭检查功能，<span style="text-decoration: underline;"><strong>@Reference(check=false)</strong></span>。</p>
<p style="margin-left: 30px;">全部启动后，可打开zk客户端查看已注册服务情况。</p>
<p style="margin-left: 30px;"><img src="./images/【Dubbo】Zookeeper+Dubbo项目demo搭建33.png" alt="" /></p>
<p style="margin-left: 30px;">最后打开浏览器，访问<span style="text-decoration: underline;"><strong>localhost:8002/hello?name=world</strong></span>发现正常引用服务。</p>
<p style="margin-left: 30px;"><img src="./images/【Dubbo】Zookeeper+Dubbo项目demo搭建34.png" alt="" width="1893" height="499" /></p>

</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>