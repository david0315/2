<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修网络编程系统化学习(1.1.)--socket基础' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>网络编程系统化学习(1.1.)--socket基础</center></div><div class='banquan'>原文出处:本文由博客园博主姿势帝提供。<br/>
原文连接:https://www.cnblogs.com/newAndHui/p/11624047.html</div><br>
    <h1>大纲</h1>
<p>　　<img src="./images/网络编程系统化学习(1.1.)--socket基础0.png" alt="" /></p>
<p>　　学完该阶段内容,你将会很好的完成如下的面试题</p>
<p>　　socket面试试题相关:</p>
<p>　　1.写一个简单的socket程序,实现客户端发送数据,服务端收到数据后,将该内容转发给客户端</p>
<p>　　2.简要概述一下socket的请求流程</p>
<p>　　3.简要概述一下什么是3次握手,为什么需要3次握手</p>
<p>　　4.简要概述一下什么是4次挥手,为什么需要4次挥手</p>
<p>　　5.简单说一下你对io流的认识</p>
<p>　　6.简要说一下TCP/IP的通信模型</p>
<p>　　7.简要说一下socket的通信模型</p>
<p>　　8.简要说一下OSI通信模型有那7层,tcp协议在那一层?路由选择那一层</p>
<p>　　9.简要说一下socket能否传递java对象,怎么传</p>
<p>　　10.简要说一下如何实现多个客户端同时连接同一个服务端</p>
<p>　　11.socket如何实现多线程传送文件</p>
<p>　　12.简要说一下tcp与udp的区别</p>
<p>　　13.简要说一下你对io \ bio \ nio \ aio 的认识</p>
<h1>1.socket简介</h1>
<p>　　网络上的两个程序通过一个双向的通信连接实现数据的交换，这个连接的一端称为一个socket。建立网络通信连接至少要一对端口号(socket)。</p>
<p>　　socket本质是编程接口(API)，对TCP/IP的封装，TCP/IP也要提供可供程序员做网络开发所用的接口，这就是Socket编程接口；</p>
<p>　　HTTP是轿车，提供了封装或者显示数据的具体形式；Socket是发动机，提供了网络通信的能力。</p>
<p>　　<span style="color: #ff0000;">对于java程序来说</span>,它的实现方式是通过调用网络库(<span style="color: #ff0000;">java.net</span>库)的一些API函数来实现分布在不同主机的相关进程之间的数据交换</p>
<h1>2.socket hello world</h1>
<p>　　需求:写一个简单的服务器程序,客户端向服务端发送数据,服务端收到数据后,返回一句:"你好,我已经收到数据".</p>
<h2>2.1.两个重要的API介绍</h2>
<pre><code><strong>　　ServerSocket</strong> \<strong> Socket</strong></code></pre>
<p>　　API地址:<a href="http://blog.fondme.cn:8000/apidoc/jdk-1.8-google/" target="_blank">http://blog.fondme.cn:8000/apidoc/jdk-1.8-google/</a></p>
<h2>2.2.服务端设计<em>　　</em></h2>
<p>　　服务端设计步骤:<br />　　1.创建socket服务端<br />　　serverSocket = new ServerSocket(1001);<br />　　2.监听客户端(是一个阻塞方法)<br />　　server = serverSocket.accept();<br />　　3.获取输入流<br />　　server.getInputStream()<br />　　4.获取输出流<br />　　server.getOutputStream()<br />　　5.关闭资源<br />　　serverSocket.close();</p>
<p>　　案例代码:</p>
<src class="cnblogs_code" onclick="cnblogs_code_show('1f84b9a0-e185-4441-a4e7-cbd515e6d855')"><img id="code_img_closed_1f84b9a0-e185-4441-a4e7-cbd515e6d855" class="code_img_closed" src="./images/网络编程系统化学习(1.1.)--socket基础1.png" alt="" /><img id="code_img_opened_1f84b9a0-e185-4441-a4e7-cbd515e6d855" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('1f84b9a0-e185-4441-a4e7-cbd515e6d855',event)" src="./images/网络编程系统化学习(1.1.)--socket基础2.png" alt="" />
<src id="cnblogs_code_open_1f84b9a0-e185-4441-a4e7-cbd515e6d855" class="cnblogs_code_hide">
<pre><code><span style="color: #0000ff;">package</span><span style="color: #000000;"> com.wfd360.com.socket;

</span><span style="color: #0000ff;">import</span> java.io.*<span style="color: #000000;">;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> java.net.ServerSocket;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> java.net.Socket;

</span><span style="color: #008000;">/**</span><span style="color: #008000;">
 * @Copyright (C)公众号:java实战分享
 * @Author: 姿势帝-博客园
 * @Date: 2019-09-01 15:14
 * @Description:
 </span><span style="color: #008000;">*/</span>
<span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> ServerSocketDemo {
    </span><span style="color: #008000;">/**</span><span style="color: #008000;">
     * ServerSocket 的构造方法如下所示。
     * ServerSocket()：无参构造方法。
     * ServerSocket(int port)：创建绑定到特定端口的服务器套接字。
     * ServerSocket(int port,int backlog)：使用指定的 backlog 创建服务器套接字并将其绑定到指定的本地端口。
     * ServerSocket(int port,int backlog,InetAddress bindAddr)：使用指定的端口、监听 backlog 和要绑定到本地的 IP 地址创建服务器。
     * &lt;p&gt;
     * ===================================================================================================================
     * ServerSocket 的常用方法如下所示。
     * Server accept()：监听并接收到此套接字的连接。
     * void bind(SocketAddress endpoint)：将 ServerSocket 绑定到指定地址（IP 地址和端口号）。
     * void close()：关闭此套接字。
     * InetAddress getInetAddress()：返回此服务器套接字的本地地址。
     * int getLocalPort()：返回此套接字监听的端口。
     * SocketAddress getLocalSoclcetAddress()：返回此套接字绑定的端口的地址，如果尚未绑定则返回 null。
     * int getReceiveBufferSize()：获取此 ServerSocket 的 SO_RCVBUF 选项的值，该值是从 ServerSocket 接收的套接字的建议缓冲区大小。
     *
     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> args 服务端设计步骤:
     *             1.创建socket服务端
     *             serverSocket = new ServerSocket(1001);
     *             2.监听客户端
     *             server = serverSocket.accept();
     *             3.获取输入流
     *             server.getInputStream()
     *             4.获取输出流
     *             server.getOutputStream()
     *             5.关闭资源
     *             serverSocket.close();
     </span><span style="color: #008000;">*/</span>
    <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> main(String[] args) {
        ServerSocket serverSocket </span>= <span style="color: #0000ff;">null</span><span style="color: #000000;">;
        Socket server </span>= <span style="color: #0000ff;">null</span><span style="color: #000000;">;
        BufferedReader reader </span>= <span style="color: #0000ff;">null</span><span style="color: #000000;">;
        BufferedWriter writer </span>= <span style="color: #0000ff;">null</span><span style="color: #000000;">;
        </span><span style="color: #0000ff;">try</span><span style="color: #000000;"> {
            </span><span style="color: #008000;">//</span><span style="color: #008000;">1.建立socket服务器</span>
            serverSocket = <span style="color: #0000ff;">new</span> ServerSocket(1001<span style="color: #000000;">);
            System.out.println(</span>"服务端创建成功----"<span style="color: #000000;">);
            </span><span style="color: #0000ff;">while</span> (<span style="color: #0000ff;">true</span><span style="color: #000000;">) {
                </span><span style="color: #008000;">//</span><span style="color: #008000;">2.监听客户端连接</span>
                server =<span style="color: #000000;"> serverSocket.accept();
                </span><span style="color: #008000;">//</span><span style="color: #008000;">3.读取客户端数据</span>
                reader = <span style="color: #0000ff;">new</span> BufferedReader(<span style="color: #0000ff;">new</span><span style="color: #000000;"> InputStreamReader(server.getInputStream()));
                String s </span>=<span style="color: #000000;"> reader.readLine();
                System.out.println(</span>"服务端收到数据:" +<span style="color: #000000;"> s);
                </span><span style="color: #008000;">//</span><span style="color: #008000;">4.响应客户端</span>
                writer = <span style="color: #0000ff;">new</span> BufferedWriter(<span style="color: #0000ff;">new</span><span style="color: #000000;"> OutputStreamWriter(server.getOutputStream()));
                writer.write(</span>"已经收到数据[" + s + "]\n"<span style="color: #000000;">);
                </span><span style="color: #008000;">//</span><span style="color: #008000;">清除</span>
<span style="color: #000000;">                writer.flush();
            }

        } </span><span style="color: #0000ff;">catch</span><span style="color: #000000;"> (IOException e) {
            e.printStackTrace();
        } </span><span style="color: #0000ff;">finally</span><span style="color: #000000;"> {
            </span><span style="color: #0000ff;">try</span><span style="color: #000000;"> {
                </span><span style="color: #008000;">//</span><span style="color: #008000;">关闭资源</span>
                <span style="color: #0000ff;">if</span> (writer != <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
                    writer.close();
                }
                </span><span style="color: #0000ff;">if</span> (reader != <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
                    reader.close();
                }
                </span><span style="color: #0000ff;">if</span> (server != <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
                    server.close();
                }
                </span><span style="color: #0000ff;">if</span> (serverSocket != <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
                    serverSocket.close();
                }
            } </span><span style="color: #0000ff;">catch</span><span style="color: #000000;"> (Exception e) {
                e.printStackTrace();
            }
        }
    }
}</span></code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<h2><em>2.3.客户端设计</em></h2>
<p>　　客户端设计逻辑:<br />　　1.创建socket通信,设置连接IP和端口<br />　　socket = new Socket("localhost", 1001);<br />　　2.建立IO输出流,向服务端发送数据<br />　　socket.getOutputStream()<br />　　3.建立IO输入流,读取服务端应答的数据<br />　　socket.getInputStream()<br />　　4.关闭资源<br />　　socket.close();</p>
<p>　　案例代码:</p>
<src class="cnblogs_code" onclick="cnblogs_code_show('2516b554-da63-4908-8bbc-f6c35446c58a')"><img id="code_img_closed_2516b554-da63-4908-8bbc-f6c35446c58a" class="code_img_closed" src="./images/网络编程系统化学习(1.1.)--socket基础1.png" alt="" /><img id="code_img_opened_2516b554-da63-4908-8bbc-f6c35446c58a" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('2516b554-da63-4908-8bbc-f6c35446c58a',event)" src="./images/网络编程系统化学习(1.1.)--socket基础2.png" alt="" />
<src id="cnblogs_code_open_2516b554-da63-4908-8bbc-f6c35446c58a" class="cnblogs_code_hide">
<pre><code><span style="color: #0000ff;">package</span><span style="color: #000000;"> com.wfd360.com.socket;

</span><span style="color: #0000ff;">import</span> java.io.*<span style="color: #000000;">;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> java.net.Socket;

</span><span style="color: #008000;">/**</span><span style="color: #008000;">
 * @公众号: java实战分享
 * @Author: 姿势帝-博客园
 * @Date: 2019-09-01 15:50
 * @Description:
 </span><span style="color: #008000;">*/</span>
<span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> ClientSocketDemo {
    </span><span style="color: #008000;">/**</span><span style="color: #008000;">
     * 客户端设计逻辑:
     * 1.创建socket通信,设置连接IP和端口
     * socket = new Socket("localhost", 1001);
     * 2.建立IO输出流,向服务端发送数据
     * socket.getOutputStream()
     * 3.建立IO输入流,读取服务端应答的数据
     * socket.getInputStream()
     * 4.关闭资源
     * socket.close();
     *
     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> args
     </span><span style="color: #008000;">*/</span>
    <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> main(String[] args) {
        Socket socket </span>= <span style="color: #0000ff;">null</span><span style="color: #000000;">;
        BufferedWriter writer </span>= <span style="color: #0000ff;">null</span><span style="color: #000000;">;
        BufferedReader reader </span>= <span style="color: #0000ff;">null</span><span style="color: #000000;">;
        </span><span style="color: #0000ff;">try</span><span style="color: #000000;"> {
            </span><span style="color: #008000;">//</span><span style="color: #008000;">1.创建socket通信</span>
            socket = <span style="color: #0000ff;">new</span> Socket("localhost", 1001<span style="color: #000000;">);
            </span><span style="color: #008000;">//</span><span style="color: #008000;">2.建立IO输出流,向服务端发送数据</span>
            writer = <span style="color: #0000ff;">new</span> BufferedWriter(<span style="color: #0000ff;">new</span><span style="color: #000000;"> OutputStreamWriter(socket.getOutputStream()));
            </span><span style="color: #008000;">//</span><span style="color: #008000;">注意这里必须加\n,因为是按照行读取</span>
            writer.write("hello world \n"<span style="color: #000000;">);
            writer.flush();
            </span><span style="color: #008000;">//</span><span style="color: #008000;">3.建立IO输入流,读取服务端应答的数据</span>
            reader = <span style="color: #0000ff;">new</span> BufferedReader(<span style="color: #0000ff;">new</span><span style="color: #000000;"> InputStreamReader(socket.getInputStream()));
            String s </span>=<span style="color: #000000;"> reader.readLine();
            System.out.println(</span>"客户端收到数据:" +<span style="color: #000000;"> s);
        } </span><span style="color: #0000ff;">catch</span><span style="color: #000000;"> (IOException e) {
            e.printStackTrace();
        } </span><span style="color: #0000ff;">finally</span><span style="color: #000000;"> {
            </span><span style="color: #0000ff;">try</span><span style="color: #000000;"> {
                </span><span style="color: #0000ff;">if</span> (reader != <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
                    reader.close();
                }
                </span><span style="color: #0000ff;">if</span> (writer != <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
                    writer.close();
                }
                </span><span style="color: #0000ff;">if</span> (socket != <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
                    socket.close();
                }
            } </span><span style="color: #0000ff;">catch</span><span style="color: #000000;"> (Exception e) {
                e.printStackTrace();
            }
        }
    }
}</span></code></pre>

<span class="cnblogs_code_collapse">View Code</span>　
<h2><em>2.4.socket生命周期与请求流程</em></h2>
<p><em>　　<img src="./images/网络编程系统化学习(1.1.)--socket基础5.png" alt="" /></em></p>
<p>&nbsp;　　上图详细的介绍了socket的通信流程:</p>
<p>　　1.建立服务端并绑定端口</p>
<p>　　2.客户端通过ip和端口连接服务端,重要面试(<span style="color: #ff0000;">3次握手</span>)</p>
<p>　　3.服务端监听客户端的链接,注意这里是一个<span style="color: #ff0000;">阻塞线程</span>,效率很低,后面我们讲NIO将会解决这个</p>
<p>　　4.客户端建立IO输出流,向服务端发送数据</p>
<p>　　5.服务端建立IO输入流,获取客户端发来的数据</p>
<p>　　6.服务端建立IO输出流,向客户端发送数据,注意如果要持续不断地发送与接收数据,将重复4\5\6三个步骤</p>
<p>　　7.客户端当数据发送与接收完毕后断开连接,重要面试点(<span style="color: #ff0000;">4次挥手</span>)</p>
<p>　　8.配合客户端断开连接</p>
<h1>3.网络编程中的重要IO操作</h1>
<p>　　<img src="./images/网络编程系统化学习(1.1.)--socket基础6.png" alt="" /></p>
<h2>3.1.IO流的分类</h2>
<p>　　1.根据处理数据类型不同分为:<span style="color: #ff0000;">字符流和字节流</span><br />　　2.根据数据流向不同分为:<span style="color: #ff0000;">输入流和输出流</span><br />　　3.根据功能不同分为:<span style="color: #ff0000;">节点流和处理流</span><br />　　字节流和字符流的区别:<br />　　1.字符流使用了缓冲区，而字节流没有使用缓冲区。<br />　　2.读取单位不同:<br />　　字节流以字节(8bit)为单位,字符流以字符为单位,<br />　　根据码表映射字符,一次可能读多个字节.</p>
<p>　　3.处理对象不同:字节流能处理所有类型的数据(如图片\视频等)<br />　　而字符流只能处理字符类型的数据.<br />　　字节流:一次读入或读出8位二进制.<br />　　字符流:一次读入或读出16位二进制.</p>
<h2>3.2.扩展分析</h2>
<p>　　对字符流而言,在关闭字符流时会强制性地将缓冲区中的内容进行输出，但是如果程序没有关闭，则缓冲区中的内容是无法输出的.(请自己写代码验证)</p>
<p>　　<span style="color: #ff0000;">提问：</span>什么叫缓冲区？在很多地方都碰到缓冲区这个名词，那么到底什么是缓冲区？又有什么作用呢？</p>
<p>　　<span style="color: #ff0000;">回答：</span>缓冲区可以简单地理解为一段内存区域。可以简单地把缓冲区理解为一段特殊的内存。</p>
<p>　　某些情况下，如果一个程序频繁地操作一个资源（如文件或数据库），则性能会很低，此时为了提升性能，</p>
<p>　　就可以将一部分数据暂时读入到内存的一块区域之中，以后直接从此区域中读取数据即可，因为读取内存速度会比较快，这样可以提升程序的性能。</p>
<p>　　在字符流的操作中，所有的字符都是在内存中形成的，在输出前会将所有的内容暂时保存在内存之中，所以使用了缓冲区暂存数据。</p>
<p>　　如果想在不关闭时也可以将字符流的内容全部输出，则可以使用Writer类中的flush()方法完成。</p>
<p>&nbsp;</p>
<p>　　<span style="color: #ff0000;">提问：</span>使用字节流好还是字符流好？</p>
<p>　　学习完字节流和字符流的基本操作后，已经大概地明白了操作流程的各个区别，那么在开发中是使用字节流好还是字符流好呢？<br />　　<span style="color: #ff0000;">回答：</span>使用字节流更好。</p>
<p>　　在回答之前，先为读者讲解这样的一个概念，所有的文件在硬盘或在传输时都是以字节的方式进行的，包括图片等都是按字节的方式存储的，而字符是只有在内存中才会形成，</p>
<p>　　所以在开发中，字节流使用较为广泛。</p>
<p>　　<span style="color: #ff0000;">提问:</span>字节流与字符流主要的区别是他们的的处理方式</p>
<p>　<span style="color: #ff0000;">　分析:</span></p>
<p>　　流分类：<br />　　<strong>1.Java的字节流</strong><br />   　　InputStream是所有字节输入流的祖先，而OutputStream是所有字节输出流的祖先。<br />　　<strong>2.Java的字符流</strong><br />  　　Reader是所有读取字符串输入流的祖先，而writer是所有输出字符串的祖先。</p>
<p>　　InputStream，OutputStream,Reader,writer都是抽象类。所以不能直接new </p>
<p>　　字节流是最基本的，所有的InputStream和OutputStream的子类都是,主要用在处理二进制数据，它是按字节来处理的，</p>
<p>　　但实际中很多的数据是文本，又提出了字符流的概念，它是按虚拟机的Encode来处理，也就是要进行字符集的转化。</p>
<p>　　这两个之间通过 InputStreamReader,OutputStreamWriter来关联，实际上是通过<span style="color: #ff0000;">byte[]</span>和<span style="color: #ff0000;">String</span>来关联。</p>
<p>　　在实际开发中出现的汉字问题实际上都是在字符流和字节流之间转化不统一而造成的。</p>
<p>　　<strong>在从字节流转化为字符流时，实际上就是byte[]转化为String时</strong>，</p>
<p>　　public String(byte bytes[], String charsetName)</p>
<p>　　有一个关键的参数字符集编码，通常我们都省略了，那系统就用操作系统的lang</p>
<p>　　而在字符流转化为字节流时，实际上是String转化为byte[]时，</p>
<p>　　byte[]    String.getBytes(String charsetName)</p>
<p>　　也是一样的道理</p>
<p>　　至于java.io中还出现了许多其他的流，按主要是为了提高性能和使用方便，</p>
<p>　　如BufferedInputStream,PipedInputStream等</p>
<h2>3.3.代码实现将文件a.txt复制到b.txt</h2>
<src class="cnblogs_code" onclick="cnblogs_code_show('36399546-c3ba-4b5f-a942-a32b316b0ae2')"><img id="code_img_closed_36399546-c3ba-4b5f-a942-a32b316b0ae2" class="code_img_closed" src="./images/网络编程系统化学习(1.1.)--socket基础1.png" alt="" /><img id="code_img_opened_36399546-c3ba-4b5f-a942-a32b316b0ae2" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('36399546-c3ba-4b5f-a942-a32b316b0ae2',event)" src="./images/网络编程系统化学习(1.1.)--socket基础2.png" alt="" />
<src id="cnblogs_code_open_36399546-c3ba-4b5f-a942-a32b316b0ae2" class="cnblogs_code_hide">
<pre><code><span style="color: #0000ff;">package</span><span style="color: #000000;"> com.wfd360.com.io;

</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> org.junit.Test;

</span><span style="color: #0000ff;">import</span> java.io.*<span style="color: #000000;">;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.ArrayList;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.List;

</span><span style="color: #008000;">/**</span><span style="color: #008000;">
 * @公众号: java实战分享
 * @Author: 姿势帝-博客园
 * @Date: 2019-09-12 11:15
 * @Description:
 </span><span style="color: #008000;">*/</span>
<span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> FileDemo {

    </span><span style="color: #008000;">/**</span><span style="color: #008000;">
     * 字节操作
     * 需求:
     * 将a.txt 复制到 b.txt
     *
     * </span><span style="color: #808080;">@throws</span><span style="color: #008000;"> Exception
     </span><span style="color: #008000;">*/</span><span style="color: #000000;">
    @Test
    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> test2() <span style="color: #0000ff;">throws</span><span style="color: #000000;"> Exception {
        String filePath </span>= "E:\\test\\a.txt"<span style="color: #000000;">;
        String filePathNew </span>= "E:\\test\\b.txt"<span style="color: #000000;">;
        </span><span style="color: #008000;">//</span><span style="color: #008000;">1.读取本地文件a</span>
        File file = <span style="color: #0000ff;">new</span><span style="color: #000000;"> File(filePath);
        DataInputStream dataInputStream </span>= <span style="color: #0000ff;">new</span> DataInputStream(<span style="color: #0000ff;">new</span><span style="color: #000000;"> FileInputStream(file));
        </span><span style="color: #008000;">//</span><span style="color: #008000;">读取文件名
        </span><span style="color: #008000;">//</span><span style="color: #008000;"> String fileName = dataInputStream.readUTF();
        </span><span style="color: #008000;">//</span><span style="color: #008000;">读取文件大小
        </span><span style="color: #008000;">//</span><span style="color: #008000;"> long fileSize = dataInputStream.readLong();
        </span><span style="color: #008000;">//</span><span style="color: #008000;"> System.out.println("fileName="+fileName+",fileSize="+fileSize);
        </span><span style="color: #008000;">//</span><span style="color: #008000;">准备写入文件对象</span>
        File fileNew = <span style="color: #0000ff;">new</span><span style="color: #000000;"> File(filePathNew);
        </span><span style="color: #008000;">//</span><span style="color: #008000;"> fileNew.createNewFile();</span>
        DataOutputStream dataOutputStream = <span style="color: #0000ff;">new</span> DataOutputStream(<span style="color: #0000ff;">new</span><span style="color: #000000;"> FileOutputStream(fileNew));

        </span><span style="color: #008000;">//</span><span style="color: #008000;">按照字节读取文件</span>
        <span style="color: #0000ff;">byte</span>[] aByte = <span style="color: #0000ff;">new</span> <span style="color: #0000ff;">byte</span>[128<span style="color: #000000;">];
        System.out.println(</span>"length=" +<span style="color: #000000;"> aByte.length);
        </span><span style="color: #0000ff;">int</span> read = dataInputStream.read(aByte, 0<span style="color: #000000;">, aByte.length);
        </span><span style="color: #0000ff;">while</span> (read != -1<span style="color: #000000;">) {
            </span><span style="color: #008000;">//</span><span style="color: #008000;">当前文件内容</span>
            String s = <span style="color: #0000ff;">new</span> String(aByte, "gbk"<span style="color: #000000;">);
            System.out.println(</span>"read=" + read + "s=" +<span style="color: #000000;"> s);
            </span><span style="color: #008000;">//</span><span style="color: #008000;">写入文件</span>
            dataOutputStream.write(aByte, 0<span style="color: #000000;">, read);
            dataOutputStream.flush();
            read </span>= dataInputStream.read(aByte, 0<span style="color: #000000;">, aByte.length);
        }
    }

    </span><span style="color: #008000;">/**</span><span style="color: #008000;">
     * 字符操作
     * 需求:
     * 将a.txt 复制到 b.txt
     * 使用：FileInputStream，FileOutputStream
     *
     * </span><span style="color: #808080;">@throws</span><span style="color: #008000;"> Exception
     </span><span style="color: #008000;">*/</span><span style="color: #000000;">
    @Test
    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> test1() <span style="color: #0000ff;">throws</span><span style="color: #000000;"> Exception {
        </span><span style="color: #008000;">//</span><span style="color: #008000;">1:读取a.txt中的内容
        </span><span style="color: #008000;">//</span><span style="color: #008000;">1.1.建立文件</span>
        File file = <span style="color: #0000ff;">new</span> File("D:\\test\\a.txt"<span style="color: #000000;">);
        </span><span style="color: #008000;">//</span><span style="color: #008000;">1.2.读取文件内容 字节流</span>
        FileInputStream fileInputStream = <span style="color: #0000ff;">new</span><span style="color: #000000;"> FileInputStream(file);
        </span><span style="color: #008000;">//</span><span style="color: #008000;">1.3.转变为处理流 gb2312</span>
        BufferedReader reader = <span style="color: #0000ff;">new</span> BufferedReader(<span style="color: #0000ff;">new</span> InputStreamReader(fileInputStream, "gbk"<span style="color: #000000;">));
        </span><span style="color: #008000;">//</span><span style="color: #008000;">1.4.按照行读取数据</span>
        List&lt;String&gt; content = <span style="color: #0000ff;">new</span> ArrayList&lt;String&gt;<span style="color: #000000;">();
        String line </span>=<span style="color: #000000;"> reader.readLine();
        </span><span style="color: #0000ff;">while</span> (line != <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
            System.out.println(</span>"line=" +<span style="color: #000000;"> line);
            content.add(line);
            </span><span style="color: #008000;">//</span><span style="color: #008000;">读取下一行</span>
            line =<span style="color: #000000;"> reader.readLine();
        }

        </span><span style="color: #008000;">//</span><span style="color: #008000;">2:写入到b.txt中
        </span><span style="color: #008000;">//</span><span style="color: #008000;">2.1.创建文件</span>
        File fileB = <span style="color: #0000ff;">new</span> File("D:\\test\\b.txt"<span style="color: #000000;">);
        </span><span style="color: #0000ff;">boolean</span> newFile =<span style="color: #000000;"> fileB.createNewFile();
        System.out.println(</span>"newFile=" +<span style="color: #000000;"> newFile);
        </span><span style="color: #008000;">//</span><span style="color: #008000;">2.2.创建写入文件字节流</span>
        FileOutputStream fileOutputStream = <span style="color: #0000ff;">new</span><span style="color: #000000;"> FileOutputStream(fileB);
        </span><span style="color: #008000;">//</span><span style="color: #008000;">2.3.转变为处理流</span>
        BufferedWriter writer = <span style="color: #0000ff;">new</span> BufferedWriter(<span style="color: #0000ff;">new</span> OutputStreamWriter(fileOutputStream, "gbk"<span style="color: #000000;">));
        </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (String s : content) {
            writer.write(s);
        }
        writer.flush();
        writer.close();
    }
}</span></code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<h1>4.socket的通信模型</h1>
<h2>4.1.TCP/IP与OSI参考模型</h2>
<p>　　<img src="./images/网络编程系统化学习(1.1.)--socket基础9.png" alt="" /></p>
<p>　　OSI的层次划分：OSI将计算机网络体系结构(architecture)划分为以下七层：</p>
<p>　　<strong>1、物理层&nbsp;</strong> Physical Layer (用什么介质传:光纤等问题,类比:纸)</p>
<p>　　物理接口规范，传输比特流,网卡是工作在物理层的。</p>
<p>　　分析:</p>
<p>　　怎样充分利用资源，用什么物质传又省钱又好用？这就是物理层要解决的问题了，这里展开来就是无线铜线光纤损耗等等的问题。</p>
<p>　　<strong>2、数据链路层</strong>&nbsp; Data Link Layer&nbsp;(怎么传送,类比:文字一行一行的写,信封)</p>
<p>　　成帧，保证帧的无误传输，MAC地址，形成EHTHERNET帧</p>
<p>　　分析:</p>
<p>　　然后知道介质了，怎样把信息传给设备？这就是数据链路层要解决的问题了。</p>
<p>　　这里需要解决信息的封装问题，信息传送机制问题。</p>
<p>　　所以这一层的所有协议设计都是围绕着怎么传信息展开。</p>
<p>　　<strong>3、网络层&nbsp;</strong> Network Layer (找到指定ip,类比:精确找到信交给谁)</p>
<p>　　路由选择，流量控制，IP地址，形成IP包</p>
<p>　　分析:</p>
<p>　　理论上到这里就结束了，但随着入网设备越来越多，就需要被管理了，所以网络层就来解决网络管理的问题。</p>
<p>　　IP层是整个网络分层里承上启下的核心，他主要解决两个问题，一个是编号，一个是找人。网络太大，人太多，认识不过来，所以要用ip地址给人编号。</p>
<p>　　编完号找人，几十亿人一个个问也不可行，也是要讲方法的，所以这里就有了路由技术。</p>
<p>　　网络层的关键是路由技术，路由技术解决怎样快速准确找到对端的问题。</p>
<p>　　<strong>4、传输层</strong>&nbsp; Transport Layer&nbsp;(传输速度和信息的完整性,类比:开车送信,还是马车送信)</p>
<p>　　端口地址，如HTTP对应80端口。TCP和UDP工作于该层,还有就是差错校验和流量控制。　</p>
<p>　　分析:</p>
<p>　　找到对端后，怎样保证对端完整收到信息？这就是传输层要解决的问题了，这里就有传送速度的调节，传送信息的验证，传完信息的确认等等问题，对应的TCP和UDP也是两种不同的实现思路。</p>
<p>　　<strong>5、会话层</strong>&nbsp; Session Layer</p>
<p>　　组织两个会话进程之间的通信,并管理数据的交换使用NETBIOS和WINSOCK协议。QQ等软件进行&nbsp; &nbsp; &nbsp; &nbsp; 通讯因该是工作在会话层的。</p>
<p>　　<strong>6、表示层&nbsp;</strong> Presentation Layer</p>
<p>　　使得不同操作系统之间通信成为可能。</p>
<p>　　<strong>7、应用层</strong> Application Layer</p>
<p>　　对应各应用软件　</p>
<p>　　分析(5,6,7):</p>
<p>　　来到这里，关于网络的问题基本上就结束了，因为终端已经拿到了别人发过来的信息了，至于怎么处理信息，就是会话层，表示层，应用层的问题了。</p>
<p>　　不同的应用程序有着不同的通信协议（Email&mdash;&mdash;SMTP，Web&mdash;&mdash;Http，文件传输&mdash;&mdash;Ftp等），这些通信协议都工作在应用层。</p>
<h2>4.2.socket通信模型</h2>
<p>　　<span style="color: #ff0000;">socket是基于TCP\UDP协议的应用层通信.</span></p>
<p><span style="color: #000000;">　　理解几个概念:<br /></span></p>
<p><span style="color: #000000;">　　SYN：同步序列编号（Synchronize Sequence Numbers）。是TCP/IP建立连接时使用的握手信号。</span></p>
<p>　　ACK:&nbsp; 确认字符(Acknowledge character），在数据通信中，接收站发给发送站的一种传输类控制字符。表示发来的数据已确认接收无误。</p>
<p>　　FIN: 表示关闭连接</p>
<p>　　PSH: 表示有 DATA数据传输</p>
<p>　　RST: 表示连接重置</p>
<p>&nbsp;　&nbsp; <strong>&nbsp;问题1</strong>:什么是tcp长连接的三次握手</p>
<p>　　<img src="./images/网络编程系统化学习(1.1.)--socket基础10.png" alt="" /></p>
<p>　　<span style="color: #ff0000;">第一次握手</span>：建立连接时，客户端发送syn包（syn=j）到服务器，并进入SYN_SENT状态，等待服务器确认；</p>
<p>　　<span style="color: #ff0000;">第二次握手</span>：服务器收到syn包，必须确认客户的SYN（ack=j+1），同时自己也发送一个SYN包（seq=k），即SYN+ACK包，此时服务器进入SYN_RECV状态。</p>
<p>　　<span style="color: #ff0000;">第三次握手</span>：客户端收到服务器的SYN+ACK包，向服务器发送确认包ACK(ack=k+1），此包发送完毕，客户端和服务器进入ESTABLISHED（TCP连接成功）状态，完成三次握手.</p>
<p>　　完成三次握手，客户端与服务器开始传送数据。</p>
<p>　　<strong>问题2</strong>:为什么需要三次握手?</p>
<p>　　假设在信号不好的情况下,用张无忌给赵敏打电话作为例子,下面是连接对话</p>
<p>　<span style="color: #999999;">　<em>张无忌: 亲爱的,你可以听得到我说话吗?(第一次握手)</em></span></p>
<p><span style="color: #999999;"><em>　　赵敏: 我可以听到你说话,你能听到我说话么?(第二次握手)</em></span></p>
<p><span style="color: #999999;"><em>　　张无忌: 可以的,我开始给你说重大事情了.(第三次握手)</em></span></p>
<p>　　三次握手完成后,可以确定这样一件事情,张无忌能听到赵敏说的话,赵敏也能听到张无忌说的话,这样就可以开始正常沟通了</p>
<p>　　如果只有二次握手,赵敏不能确定,张无忌是否能听到自己说的话.</p>
<p>　　如果4次握手,就会造成浪费</p>
<p>　　<strong>问题3</strong>:什么是4次挥手</p>
<p>　　<img src="./images/网络编程系统化学习(1.1.)--socket基础11.png" alt="" /></p>
<p>　　连接终止协议（四次挥手）</p>
<p>　　由于TCP连接是全双工的，因此每个方向都必须单独进行关闭。这原则是当一方完成它的数据发送任务后就能发送一个FIN来终止这个方向的连接。</p>
<p>　　收到一个 FIN只意味着这一方向上没有数据流动，一个TCP连接在收到一个FIN后仍能发送数据。首先进行关闭的一方将执行主动关闭，而另一方执行被动关闭。</p>
<p>　　<span style="color: #ff0000;">第一次挥手</span>:&nbsp;&nbsp;TCP客户端发送一个FIN，用来关闭客户到服务器的数据传送。(告诉服务端,客户端已停止向服务端传输数据,但还可以接收数据)</p>
<p>　　<span style="color: #ff0000;">第二次挥手</span>:&nbsp;&nbsp;服务器收到这个FIN，它发回一个ACK，确认序号为收到的序号加1。和SYN一样，一个FIN将占用一个序号。(服务端已收到关闭请求,但自己还没有准备好关闭)</p>
<p>　　<span style="color: #ff0000;">第三次挥手</span>:&nbsp;&nbsp;服务器关闭客户端的连接，发送一个FIN给客户端。</p>
<p>　　<span style="color: #ff0000;">第四次挥手</span>:&nbsp;&nbsp;客户端发回ACK报文确认，并将确认序号设置为收到序号加1。(告知服务端你也可以关闭连接)</p>
<p>&nbsp;　　<strong>问题4:</strong> 为什么需要4次挥手</p>
<p>　　<span style="color: #ff0000;">确保数据能够完整传输</span></p>
<p>　　分析:</p>
<p>　<span style="color: #999999;"><em>　张无忌给赵敏打电话时,突然明教发生了重大事情,张无忌想挂电话了</em></span><br /><span style="color: #999999;"><em>　　......</em></span><br /><span style="color: #999999;"><em>　　张无忌:亲爱的,我要说的都说完了,你还有什么要说的么?(第一次挥手)</em></span></p>
<p><span style="color: #999999;"><em>　　赵敏:嗯好,我把周芷若的丑事说完就不说了......(第二次挥手)</em></span></p>
<p><span style="color: #999999;"><em>　　赵敏:好,就这些,你一定要记住额,我也说完了(第三次挥手)</em></span></p>
<p><span style="color: #999999;"><em>　　张无忌:好的,记住了,挂了.(第四次握手)</em></span></p>
<h1><em>5.socket传输java对象</em></h1>
<p><em>　　重点:</em></p>
<p><em>　　1.被传输对象实现 Serializable 接口&nbsp;&nbsp;</em></p>
<p><em>　　2.使用</em>ObjectInputStream&nbsp; &nbsp;\&nbsp; &nbsp;&nbsp;<em id="__mceDel">ObjectOutputStream 作为输入输出对象</em></p>
<p><em>　　</em>序列化对象</p>
<src class="cnblogs_code" onclick="cnblogs_code_show('96d7070e-634b-488a-a40c-5acd0c688b73')"><img id="code_img_closed_96d7070e-634b-488a-a40c-5acd0c688b73" class="code_img_closed" src="./images/网络编程系统化学习(1.1.)--socket基础1.png" alt="" /><img id="code_img_opened_96d7070e-634b-488a-a40c-5acd0c688b73" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('96d7070e-634b-488a-a40c-5acd0c688b73',event)" src="./images/网络编程系统化学习(1.1.)--socket基础2.png" alt="" />
<src id="cnblogs_code_open_96d7070e-634b-488a-a40c-5acd0c688b73" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.wfd360.com.socketJava.model;
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.Serializable;
</span><span style="color: #008080;"> 4</span> 
<span style="color: #008080;"> 5</span> <span style="color: #008000;">/**</span>
<span style="color: #008080;"> 6</span> <span style="color: #008000;"> * @公众号: java实战分享
</span><span style="color: #008080;"> 7</span> <span style="color: #008000;"> * @Author: 姿势帝-博客园
</span><span style="color: #008080;"> 8</span> <span style="color: #008000;"> * @Date: 2019-09-12 17:48
</span><span style="color: #008080;"> 9</span> <span style="color: #008000;"> * @Description: &lt;p&gt;
</span><span style="color: #008080;">10</span> <span style="color: #008000;"> * &lt;p&gt;
</span><span style="color: #008080;">11</span> <span style="color: #008000;"> * 什么是对象序列化与对象反序列化
</span><span style="color: #008080;">12</span> <span style="color: #008000;"> * 把java对象转变为字节序列的过程叫:    做对象序列化
</span><span style="color: #008080;">13</span> <span style="color: #008000;"> * 把字节序列恢复为java对象称为    :    对象反序列化
</span><span style="color: #008080;">14</span> <span style="color: #008000;"> * &lt;p&gt;
</span><span style="color: #008080;">15</span> <span style="color: #008000;"> * 对象序列化的作用:
</span><span style="color: #008080;">16</span> <span style="color: #008000;"> * 用于存储
</span><span style="color: #008080;">17</span> <span style="color: #008000;"> * 用于传输
</span><span style="color: #008080;">18</span> <span style="color: #008000;"> * &lt;p&gt;
</span><span style="color: #008080;">19</span> <span style="color: #008000;"> * java对象如何实现序列化
</span><span style="color: #008080;">20</span> <span style="color: #008000;"> * 实现Serializable接口
</span><span style="color: #008080;">21</span>  <span style="color: #008000;">*/</span>
<span style="color: #008080;">22</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> User <span style="color: #0000ff;">implements</span><span style="color: #000000;"> Serializable {
</span><span style="color: #008080;">23</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> String name;
</span><span style="color: #008080;">24</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> Integer age;
</span><span style="color: #008080;">25</span> 
<span style="color: #008080;">26</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> User() {
</span><span style="color: #008080;">27</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">28</span> 
<span style="color: #008080;">29</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> User(String name, Integer age) {
</span><span style="color: #008080;">30</span>         <span style="color: #0000ff;">this</span>.name =<span style="color: #000000;"> name;
</span><span style="color: #008080;">31</span>         <span style="color: #0000ff;">this</span>.age =<span style="color: #000000;"> age;
</span><span style="color: #008080;">32</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">33</span> 
<span style="color: #008080;">34</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> String getName() {
</span><span style="color: #008080;">35</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> name;
</span><span style="color: #008080;">36</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">37</span> 
<span style="color: #008080;">38</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> setName(String name) {
</span><span style="color: #008080;">39</span>         <span style="color: #0000ff;">this</span>.name =<span style="color: #000000;"> name;
</span><span style="color: #008080;">40</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">41</span> 
<span style="color: #008080;">42</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> Integer getAge() {
</span><span style="color: #008080;">43</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> age;
</span><span style="color: #008080;">44</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">45</span> 
<span style="color: #008080;">46</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> setAge(Integer age) {
</span><span style="color: #008080;">47</span>         <span style="color: #0000ff;">this</span>.age =<span style="color: #000000;"> age;
</span><span style="color: #008080;">48</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">49</span> 
<span style="color: #008080;">50</span> <span style="color: #000000;">    @Override
</span><span style="color: #008080;">51</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> String toString() {
</span><span style="color: #008080;">52</span>         <span style="color: #0000ff;">return</span> "User{" +
<span style="color: #008080;">53</span>                 "name='" + name + '\'' +
<span style="color: #008080;">54</span>                 ", age=" + age +
<span style="color: #008080;">55</span>                 '}'<span style="color: #000000;">;
</span><span style="color: #008080;">56</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">57</span> }</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<p>　　服务端</p>
<src class="cnblogs_code" onclick="cnblogs_code_show('07112d61-14d6-4691-842a-4fea99d22e34')"><img id="code_img_closed_07112d61-14d6-4691-842a-4fea99d22e34" class="code_img_closed" src="./images/网络编程系统化学习(1.1.)--socket基础1.png" alt="" /><img id="code_img_opened_07112d61-14d6-4691-842a-4fea99d22e34" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('07112d61-14d6-4691-842a-4fea99d22e34',event)" src="./images/网络编程系统化学习(1.1.)--socket基础2.png" alt="" />
<src id="cnblogs_code_open_07112d61-14d6-4691-842a-4fea99d22e34" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.wfd360.com.socketJava;
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.wfd360.com.socketJava.model.User;
</span><span style="color: #008080;"> 4</span> 
<span style="color: #008080;"> 5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.ObjectInputStream;
</span><span style="color: #008080;"> 6</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.ObjectOutputStream;
</span><span style="color: #008080;"> 7</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.net.ServerSocket;
</span><span style="color: #008080;"> 8</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.net.Socket;
</span><span style="color: #008080;"> 9</span> 
<span style="color: #008080;">10</span> <span style="color: #008000;">/**</span>
<span style="color: #008080;">11</span> <span style="color: #008000;"> * @公众号: java实战分享
</span><span style="color: #008080;">12</span> <span style="color: #008000;"> * @Author: 姿势帝-博客园
</span><span style="color: #008080;">13</span> <span style="color: #008000;"> * @Date: 2019-09-01 15:14
</span><span style="color: #008080;">14</span> <span style="color: #008000;"> * @Description:
</span><span style="color: #008080;">15</span>  <span style="color: #008000;">*/</span>
<span style="color: #008080;">16</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> ServerSocketDemo {
</span><span style="color: #008080;">17</span>     <span style="color: #008000;">/**</span>
<span style="color: #008080;">18</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> args 服务端设计步骤:
</span><span style="color: #008080;">19</span> <span style="color: #008000;">     *             1.创建socket服务端
</span><span style="color: #008080;">20</span> <span style="color: #008000;">     *             2.监听客户端
</span><span style="color: #008080;">21</span> <span style="color: #008000;">     *             3.获取输入流
</span><span style="color: #008080;">22</span> <span style="color: #008000;">     *             4.输出
</span><span style="color: #008080;">23</span>      <span style="color: #008000;">*/</span>
<span style="color: #008080;">24</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> main(String[] args) {
</span><span style="color: #008080;">25</span>         ServerSocket serverSocket = <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;">26</span>         Socket server = <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;">27</span>         ObjectInputStream objectInputStream = <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;">28</span>         ObjectOutputStream objectOutputStream = <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;">29</span>         <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;">30</span>             <span style="color: #008000;">//</span><span style="color: #008000;">1.建立socket服务器</span>
<span style="color: #008080;">31</span>             serverSocket = <span style="color: #0000ff;">new</span> ServerSocket(1002<span style="color: #000000;">);
</span><span style="color: #008080;">32</span>             System.out.println("服务端创建成功----"<span style="color: #000000;">);
</span><span style="color: #008080;">33</span>             <span style="color: #0000ff;">while</span> (<span style="color: #0000ff;">true</span><span style="color: #000000;">) {
</span><span style="color: #008080;">34</span>                 <span style="color: #008000;">//</span><span style="color: #008000;">2.监听客户端连接</span>
<span style="color: #008080;">35</span>                 server =<span style="color: #000000;"> serverSocket.accept();
</span><span style="color: #008080;">36</span>                 <span style="color: #008000;">//</span><span style="color: #008000;">3.读取客户端数据</span>
<span style="color: #008080;">37</span>                 objectInputStream = <span style="color: #0000ff;">new</span><span style="color: #000000;"> ObjectInputStream(server.getInputStream());
</span><span style="color: #008080;">38</span>                 User user =<span style="color: #000000;"> (User) objectInputStream.readObject();
</span><span style="color: #008080;">39</span>                 System.out.println("服务端收到数据:" +<span style="color: #000000;"> user);
</span><span style="color: #008080;">40</span>                 <span style="color: #008000;">//</span><span style="color: #008000;">4.响应客户端</span>
<span style="color: #008080;">41</span>                 objectOutputStream = <span style="color: #0000ff;">new</span><span style="color: #000000;"> ObjectOutputStream(server.getOutputStream());
</span><span style="color: #008080;">42</span>                 user.setName("我来做服务端"<span style="color: #000000;">);
</span><span style="color: #008080;">43</span> <span style="color: #000000;">                objectOutputStream.writeObject(user);
</span><span style="color: #008080;">44</span>                 <span style="color: #008000;">//</span><span style="color: #008000;">清除缓存</span>
<span style="color: #008080;">45</span> <span style="color: #000000;">                objectOutputStream.flush();
</span><span style="color: #008080;">46</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">47</span> 
<span style="color: #008080;">48</span>         } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (Exception e) {
</span><span style="color: #008080;">49</span> <span style="color: #000000;">            e.printStackTrace();
</span><span style="color: #008080;">50</span>         } <span style="color: #0000ff;">finally</span><span style="color: #000000;"> {
</span><span style="color: #008080;">51</span>             <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;">52</span>                 <span style="color: #008000;">//</span><span style="color: #008000;">关闭资源</span>
<span style="color: #008080;">53</span>                 <span style="color: #0000ff;">if</span> (objectOutputStream != <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
</span><span style="color: #008080;">54</span> <span style="color: #000000;">                    objectOutputStream.close();
</span><span style="color: #008080;">55</span> <span style="color: #000000;">                }
</span><span style="color: #008080;">56</span>                 <span style="color: #0000ff;">if</span> (objectInputStream != <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
</span><span style="color: #008080;">57</span> <span style="color: #000000;">                    objectInputStream.close();
</span><span style="color: #008080;">58</span> <span style="color: #000000;">                }
</span><span style="color: #008080;">59</span>                 <span style="color: #0000ff;">if</span> (server != <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
</span><span style="color: #008080;">60</span> <span style="color: #000000;">                    server.close();
</span><span style="color: #008080;">61</span> <span style="color: #000000;">                }
</span><span style="color: #008080;">62</span>                 <span style="color: #0000ff;">if</span> (serverSocket != <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
</span><span style="color: #008080;">63</span> <span style="color: #000000;">                    serverSocket.close();
</span><span style="color: #008080;">64</span> <span style="color: #000000;">                }
</span><span style="color: #008080;">65</span>             } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (Exception e) {
</span><span style="color: #008080;">66</span> <span style="color: #000000;">                e.printStackTrace();
</span><span style="color: #008080;">67</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">68</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">69</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">70</span>     
<span style="color: #008080;">71</span> }</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<p>　　客户端　</p>
<src class="cnblogs_code" onclick="cnblogs_code_show('b5ea8bc7-c981-4d17-ad09-4c9b3fbb1bfc')"><img id="code_img_closed_b5ea8bc7-c981-4d17-ad09-4c9b3fbb1bfc" class="code_img_closed" src="./images/网络编程系统化学习(1.1.)--socket基础1.png" alt="" /><img id="code_img_opened_b5ea8bc7-c981-4d17-ad09-4c9b3fbb1bfc" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('b5ea8bc7-c981-4d17-ad09-4c9b3fbb1bfc',event)" src="./images/网络编程系统化学习(1.1.)--socket基础2.png" alt="" />
<src id="cnblogs_code_open_b5ea8bc7-c981-4d17-ad09-4c9b3fbb1bfc" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.wfd360.com.socketJava;
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.wfd360.com.socketJava.model.User;
</span><span style="color: #008080;"> 4</span> 
<span style="color: #008080;"> 5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.ObjectInputStream;
</span><span style="color: #008080;"> 6</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.ObjectOutputStream;
</span><span style="color: #008080;"> 7</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.net.Socket;
</span><span style="color: #008080;"> 8</span> 
<span style="color: #008080;"> 9</span> <span style="color: #008000;">/**</span>
<span style="color: #008080;">10</span> <span style="color: #008000;"> * @公众号: java实战分享
</span><span style="color: #008080;">11</span> <span style="color: #008000;"> * @Author: 姿势帝-博客园
</span><span style="color: #008080;">12</span> <span style="color: #008000;"> * @Date: 2019-09-01 15:50
</span><span style="color: #008080;">13</span> <span style="color: #008000;"> * @Description:
</span><span style="color: #008080;">14</span>  <span style="color: #008000;">*/</span>
<span style="color: #008080;">15</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> ClientSocketDemo {
</span><span style="color: #008080;">16</span>     <span style="color: #008000;">/**</span>
<span style="color: #008080;">17</span> <span style="color: #008000;">     * 客户端设计逻辑:
</span><span style="color: #008080;">18</span> <span style="color: #008000;">     * 1.创建socket通信,设置IP和端口
</span><span style="color: #008080;">19</span> <span style="color: #008000;">     * 2.建立IO输出流,向服务端发送数据
</span><span style="color: #008080;">20</span> <span style="color: #008000;">     * 3.建立IO输入流,读取服务端应答的数据
</span><span style="color: #008080;">21</span> <span style="color: #008000;">     *
</span><span style="color: #008080;">22</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> args
</span><span style="color: #008080;">23</span>      <span style="color: #008000;">*/</span>
<span style="color: #008080;">24</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> main(String[] args) {
</span><span style="color: #008080;">25</span>         Socket socket = <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;">26</span>         ObjectOutputStream writer = <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;">27</span>         ObjectInputStream reader = <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;">28</span>         <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;">29</span>             <span style="color: #008000;">//</span><span style="color: #008000;">1.创建socket通信</span>
<span style="color: #008080;">30</span>             socket = <span style="color: #0000ff;">new</span> Socket("localhost", 1002<span style="color: #000000;">);
</span><span style="color: #008080;">31</span>             <span style="color: #008000;">//</span><span style="color: #008000;">2.建立IO输出流,向服务端发送数据</span>
<span style="color: #008080;">32</span>             writer = <span style="color: #0000ff;">new</span><span style="color: #000000;"> ObjectOutputStream(socket.getOutputStream());
</span><span style="color: #008080;">33</span>             writer.writeObject(<span style="color: #0000ff;">new</span> User("无忌", 19<span style="color: #000000;">));
</span><span style="color: #008080;">34</span> <span style="color: #000000;">            writer.flush();
</span><span style="color: #008080;">35</span>             <span style="color: #008000;">//</span><span style="color: #008000;">3.建立IO输入流,读取服务端应答的数据</span>
<span style="color: #008080;">36</span>             reader = <span style="color: #0000ff;">new</span><span style="color: #000000;"> ObjectInputStream(socket.getInputStream());
</span><span style="color: #008080;">37</span>             User o =<span style="color: #000000;"> (User) reader.readObject();
</span><span style="color: #008080;">38</span>             System.out.println("==&gt;" +<span style="color: #000000;"> o);
</span><span style="color: #008080;">39</span>         } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (Exception e) {
</span><span style="color: #008080;">40</span> <span style="color: #000000;">            e.printStackTrace();
</span><span style="color: #008080;">41</span>         } <span style="color: #0000ff;">finally</span><span style="color: #000000;"> {
</span><span style="color: #008080;">42</span>             <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;">43</span>                 <span style="color: #0000ff;">if</span> (reader != <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
</span><span style="color: #008080;">44</span> <span style="color: #000000;">                    reader.close();
</span><span style="color: #008080;">45</span> <span style="color: #000000;">                }
</span><span style="color: #008080;">46</span>                 <span style="color: #0000ff;">if</span> (writer != <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
</span><span style="color: #008080;">47</span> <span style="color: #000000;">                    writer.close();
</span><span style="color: #008080;">48</span> <span style="color: #000000;">                }
</span><span style="color: #008080;">49</span>                 <span style="color: #0000ff;">if</span> (socket != <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
</span><span style="color: #008080;">50</span> <span style="color: #000000;">                    socket.close();
</span><span style="color: #008080;">51</span> <span style="color: #000000;">                }
</span><span style="color: #008080;">52</span>             } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (Exception e) {
</span><span style="color: #008080;">53</span> <span style="color: #000000;">                e.printStackTrace();
</span><span style="color: #008080;">54</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">55</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">56</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">57</span> }</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<h1>6.socket的多线程通信</h1>
<p>　　<img src="./images/网络编程系统化学习(1.1.)--socket基础18.png" alt="" /></p>
<p>&nbsp;</p>
<p>　　代码</p>
<p>　　处理线程类</p>
<src class="cnblogs_code" onclick="cnblogs_code_show('1f249206-f511-4ef1-a67e-51803c3bd6ec')"><img id="code_img_closed_1f249206-f511-4ef1-a67e-51803c3bd6ec" class="code_img_closed" src="./images/网络编程系统化学习(1.1.)--socket基础1.png" alt="" /><img id="code_img_opened_1f249206-f511-4ef1-a67e-51803c3bd6ec" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('1f249206-f511-4ef1-a67e-51803c3bd6ec',event)" src="./images/网络编程系统化学习(1.1.)--socket基础2.png" alt="" />
<src id="cnblogs_code_open_1f249206-f511-4ef1-a67e-51803c3bd6ec" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.wfd360.com.socketThread.thread;
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.BufferedReader;
</span><span style="color: #008080;"> 4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.BufferedWriter;
</span><span style="color: #008080;"> 5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.InputStreamReader;
</span><span style="color: #008080;"> 6</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.OutputStreamWriter;
</span><span style="color: #008080;"> 7</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.net.Socket;
</span><span style="color: #008080;"> 8</span> 
<span style="color: #008080;"> 9</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> HandleServerThread <span style="color: #0000ff;">extends</span><span style="color: #000000;"> Thread {
</span><span style="color: #008080;">10</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> Socket socket;
</span><span style="color: #008080;">11</span> 
<span style="color: #008080;">12</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> HandleServerThread() {
</span><span style="color: #008080;">13</span> 
<span style="color: #008080;">14</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">15</span> 
<span style="color: #008080;">16</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> HandleServerThread(Socket socket) {
</span><span style="color: #008080;">17</span>         <span style="color: #0000ff;">this</span>.socket =<span style="color: #000000;"> socket;
</span><span style="color: #008080;">18</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">19</span> 
<span style="color: #008080;">20</span> 
<span style="color: #008080;">21</span> <span style="color: #000000;">    @Override
</span><span style="color: #008080;">22</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> run() {
</span><span style="color: #008080;">23</span>         <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;">24</span>             BufferedReader reader = <span style="color: #0000ff;">new</span> BufferedReader(<span style="color: #0000ff;">new</span><span style="color: #000000;"> InputStreamReader(socket.getInputStream()));
</span><span style="color: #008080;">25</span>             String s =<span style="color: #000000;"> reader.readLine();
</span><span style="color: #008080;">26</span>             System.out.println("收到连接的客户端：ip=" + socket.getInetAddress() + "  port:" + socket.getPort() + "  s=" +<span style="color: #000000;"> s);
</span><span style="color: #008080;">27</span>             BufferedWriter writer = <span style="color: #0000ff;">new</span> BufferedWriter(<span style="color: #0000ff;">new</span><span style="color: #000000;"> OutputStreamWriter(socket.getOutputStream()));
</span><span style="color: #008080;">28</span>             writer.write("服务端收到的数据为[" + s + "]\n"<span style="color: #000000;">);
</span><span style="color: #008080;">29</span> <span style="color: #000000;">            writer.flush();
</span><span style="color: #008080;">30</span> <span style="color: #000000;">            writer.close();
</span><span style="color: #008080;">31</span> <span style="color: #000000;">            reader.close();
</span><span style="color: #008080;">32</span> <span style="color: #000000;">            socket.close();
</span><span style="color: #008080;">33</span>         } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (Exception e) {
</span><span style="color: #008080;">34</span> <span style="color: #000000;">            e.printStackTrace();
</span><span style="color: #008080;">35</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">36</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">37</span> }</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<p>　　服务端</p>
<src class="cnblogs_code" onclick="cnblogs_code_show('13604e97-ec72-4453-bed4-13a360b57efe')"><img id="code_img_closed_13604e97-ec72-4453-bed4-13a360b57efe" class="code_img_closed" src="./images/网络编程系统化学习(1.1.)--socket基础1.png" alt="" /><img id="code_img_opened_13604e97-ec72-4453-bed4-13a360b57efe" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('13604e97-ec72-4453-bed4-13a360b57efe',event)" src="./images/网络编程系统化学习(1.1.)--socket基础2.png" alt="" />
<src id="cnblogs_code_open_13604e97-ec72-4453-bed4-13a360b57efe" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.wfd360.com.socketThread;
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.wfd360.com.socketThread.thread.HandleServerThread;
</span><span style="color: #008080;"> 4</span> 
<span style="color: #008080;"> 5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.IOException;
</span><span style="color: #008080;"> 6</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.net.ServerSocket;
</span><span style="color: #008080;"> 7</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.net.Socket;
</span><span style="color: #008080;"> 8</span> 
<span style="color: #008080;"> 9</span> <span style="color: #008000;">/**</span>
<span style="color: #008080;">10</span> <span style="color: #008000;"> * @公众号: java实战分享
</span><span style="color: #008080;">11</span> <span style="color: #008000;"> * @Author: 姿势帝-博客园
</span><span style="color: #008080;">12</span> <span style="color: #008000;"> * @Date: 2019-09-01 15:14
</span><span style="color: #008080;">13</span> <span style="color: #008000;"> * @Description:
</span><span style="color: #008080;">14</span>  <span style="color: #008000;">*/</span>
<span style="color: #008080;">15</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> ServerSocketDemo {
</span><span style="color: #008080;">16</span>     <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">int</span> port = 1103<span style="color: #000000;">;
</span><span style="color: #008080;">17</span> 
<span style="color: #008080;">18</span>     <span style="color: #008000;">/**</span>
<span style="color: #008080;">19</span> <span style="color: #008000;">     * 服务端开启多线程(为后面讲解NIO做铺垫)
</span><span style="color: #008080;">20</span> <span style="color: #008000;">     * 因为:Socket socket = server.accept();是线程阻塞的;
</span><span style="color: #008080;">21</span> <span style="color: #008000;">     * 如何让多个客户端同时连接到服务端勒?
</span><span style="color: #008080;">22</span> <span style="color: #008000;">     * 思路:当服务端接收到一个客户端就开启一个线程去处理,然后继续监听其他的客户端来连接
</span><span style="color: #008080;">23</span> <span style="color: #008000;">     *
</span><span style="color: #008080;">24</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> args
</span><span style="color: #008080;">25</span>      <span style="color: #008000;">*/</span>
<span style="color: #008080;">26</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span> main(String[] args) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> IOException {
</span><span style="color: #008080;">27</span>         ServerSocket server = <span style="color: #0000ff;">new</span><span style="color: #000000;"> ServerSocket(port);
</span><span style="color: #008080;">28</span>         <span style="color: #0000ff;">int</span> i = 1<span style="color: #000000;">;
</span><span style="color: #008080;">29</span>         System.out.println("服务端已启动----" +<span style="color: #000000;"> i);
</span><span style="color: #008080;">30</span>         <span style="color: #0000ff;">while</span> (<span style="color: #0000ff;">true</span><span style="color: #000000;">) {
</span><span style="color: #008080;">31</span>             System.out.println("等待客户端连接---" +<span style="color: #000000;"> i);
</span><span style="color: #008080;">32</span>             Socket socket =<span style="color: #000000;"> server.accept();
</span><span style="color: #008080;">33</span>             System.out.println("已连接---" +<span style="color: #000000;"> i);
</span><span style="color: #008080;">34</span>             HandleServerThread thread = <span style="color: #0000ff;">new</span><span style="color: #000000;"> HandleServerThread(socket);
</span><span style="color: #008080;">35</span> <span style="color: #000000;">            thread.start();
</span><span style="color: #008080;">36</span>             i++<span style="color: #000000;">;
</span><span style="color: #008080;">37</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">38</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">39</span> }</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<p>　　客户端</p>
<src class="cnblogs_code" onclick="cnblogs_code_show('aa894c53-ca98-49b2-b280-e5940e6ab49d')"><img id="code_img_closed_aa894c53-ca98-49b2-b280-e5940e6ab49d" class="code_img_closed" src="./images/网络编程系统化学习(1.1.)--socket基础1.png" alt="" /><img id="code_img_opened_aa894c53-ca98-49b2-b280-e5940e6ab49d" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('aa894c53-ca98-49b2-b280-e5940e6ab49d',event)" src="./images/网络编程系统化学习(1.1.)--socket基础2.png" alt="" />
<src id="cnblogs_code_open_aa894c53-ca98-49b2-b280-e5940e6ab49d" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.wfd360.com.socketThread;
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span> java.io.*<span style="color: #000000;">;
</span><span style="color: #008080;"> 4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.net.Socket;
</span><span style="color: #008080;"> 5</span> 
<span style="color: #008080;"> 6</span> <span style="color: #008000;">/**</span>
<span style="color: #008080;"> 7</span> <span style="color: #008000;"> * @公众号: java实战分享
</span><span style="color: #008080;"> 8</span> <span style="color: #008000;"> * @Author: 姿势帝-博客园
</span><span style="color: #008080;"> 9</span> <span style="color: #008000;"> * @Date: 2019-09-01 15:50
</span><span style="color: #008080;">10</span> <span style="color: #008000;"> * @Description:
</span><span style="color: #008080;">11</span>  <span style="color: #008000;">*/</span>
<span style="color: #008080;">12</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> ClientSocketDemo {
</span><span style="color: #008080;">13</span>     <span style="color: #0000ff;">static</span> String host = "192.168.0.103"<span style="color: #000000;">;
</span><span style="color: #008080;">14</span>     <span style="color: #0000ff;">static</span> Integer port = 1103<span style="color: #000000;">;
</span><span style="color: #008080;">15</span> 
<span style="color: #008080;">16</span>     <span style="color: #008000;">/**</span>
<span style="color: #008080;">17</span> <span style="color: #008000;">     * 客户端设计逻辑:
</span><span style="color: #008080;">18</span> <span style="color: #008000;">     * 1.创建socket通信,设置IP和端口
</span><span style="color: #008080;">19</span> <span style="color: #008000;">     * 2.建立IO输出流,向服务端发送数据
</span><span style="color: #008080;">20</span> <span style="color: #008000;">     * 3.建立IO输入流,读取服务端应答的数据
</span><span style="color: #008080;">21</span> <span style="color: #008000;">     *
</span><span style="color: #008080;">22</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> args
</span><span style="color: #008080;">23</span>      <span style="color: #008000;">*/</span>
<span style="color: #008080;">24</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> main(String[] args) {
</span><span style="color: #008080;">25</span>         Socket socket = <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;">26</span>         BufferedWriter writer = <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;">27</span>         BufferedReader reader = <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;">28</span>         <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;">29</span> 
<span style="color: #008080;">30</span>             <span style="color: #0000ff;">while</span> (<span style="color: #0000ff;">true</span><span style="color: #000000;">) {
</span><span style="color: #008080;">31</span>                 <span style="color: #008000;">//</span><span style="color: #008000;">1.创建socket通信</span>
<span style="color: #008080;">32</span>                 socket = <span style="color: #0000ff;">new</span><span style="color: #000000;"> Socket(host, port);
</span><span style="color: #008080;">33</span>                 <span style="color: #008000;">//</span><span style="color: #008000;">2.建立IO输出流,向服务端发送数据</span>
<span style="color: #008080;">34</span>                 writer = <span style="color: #0000ff;">new</span> BufferedWriter(<span style="color: #0000ff;">new</span><span style="color: #000000;"> OutputStreamWriter(socket.getOutputStream()));
</span><span style="color: #008080;">35</span>                 <span style="color: #008000;">//</span><span style="color: #008000;">读取控制台输入的数据</span>
<span style="color: #008080;">36</span>                 System.out.print("请输入要发送的数据（结束请输入exit）："<span style="color: #000000;">);
</span><span style="color: #008080;">37</span>                 String sysIn = <span style="color: #0000ff;">new</span> BufferedReader(<span style="color: #0000ff;">new</span><span style="color: #000000;"> InputStreamReader(System.in)).readLine();
</span><span style="color: #008080;">38</span>                 System.out.println("sysIn=" +<span style="color: #000000;"> sysIn);
</span><span style="color: #008080;">39</span>                 <span style="color: #0000ff;">if</span> ("exit"<span style="color: #000000;">.equals(sysIn)) {
</span><span style="color: #008080;">40</span>                     <span style="color: #0000ff;">break</span><span style="color: #000000;">;
</span><span style="color: #008080;">41</span> <span style="color: #000000;">                }
</span><span style="color: #008080;">42</span>                 <span style="color: #008000;">//</span><span style="color: #008000;">注意这里必须加\n,因为是按照行读取</span>
<span style="color: #008080;">43</span>                 writer.write("向服务端发送数据：" + sysIn + "\n"<span style="color: #000000;">);
</span><span style="color: #008080;">44</span> <span style="color: #000000;">                writer.flush();
</span><span style="color: #008080;">45</span>                 <span style="color: #008000;">//</span><span style="color: #008000;">3.建立IO输入流,读取服务端应答的数据</span>
<span style="color: #008080;">46</span>                 reader = <span style="color: #0000ff;">new</span> BufferedReader(<span style="color: #0000ff;">new</span><span style="color: #000000;"> InputStreamReader(socket.getInputStream()));
</span><span style="color: #008080;">47</span>                 String s =<span style="color: #000000;"> reader.readLine();
</span><span style="color: #008080;">48</span>                 System.out.println("客户端收到数据:" +<span style="color: #000000;"> s);
</span><span style="color: #008080;">49</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">50</span> 
<span style="color: #008080;">51</span>         } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (IOException e) {
</span><span style="color: #008080;">52</span> <span style="color: #000000;">            e.printStackTrace();
</span><span style="color: #008080;">53</span>         } <span style="color: #0000ff;">finally</span><span style="color: #000000;"> {
</span><span style="color: #008080;">54</span>             <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;">55</span>                 <span style="color: #0000ff;">if</span> (reader != <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
</span><span style="color: #008080;">56</span> <span style="color: #000000;">                    reader.close();
</span><span style="color: #008080;">57</span> <span style="color: #000000;">                }
</span><span style="color: #008080;">58</span>                 <span style="color: #0000ff;">if</span> (writer != <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
</span><span style="color: #008080;">59</span> <span style="color: #000000;">                    writer.close();
</span><span style="color: #008080;">60</span> <span style="color: #000000;">                }
</span><span style="color: #008080;">61</span>                 <span style="color: #0000ff;">if</span> (socket != <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
</span><span style="color: #008080;">62</span> <span style="color: #000000;">                    socket.close();
</span><span style="color: #008080;">63</span> <span style="color: #000000;">                }
</span><span style="color: #008080;">64</span>             } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (Exception e) {
</span><span style="color: #008080;">65</span> <span style="color: #000000;">                e.printStackTrace();
</span><span style="color: #008080;">66</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">67</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">68</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">69</span> }</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<h1>7.socket实现文件传输(多线程)</h1>
<p>　　线程处理代码</p>
<src class="cnblogs_code" onclick="cnblogs_code_show('de5e0b97-5978-430e-b187-f30dd2783f49')"><img id="code_img_closed_de5e0b97-5978-430e-b187-f30dd2783f49" class="code_img_closed" src="./images/网络编程系统化学习(1.1.)--socket基础1.png" alt="" /><img id="code_img_opened_de5e0b97-5978-430e-b187-f30dd2783f49" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('de5e0b97-5978-430e-b187-f30dd2783f49',event)" src="./images/网络编程系统化学习(1.1.)--socket基础2.png" alt="" />
<src id="cnblogs_code_open_de5e0b97-5978-430e-b187-f30dd2783f49" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.wfd360.com.socketFile.thread;
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.DataInputStream;
</span><span style="color: #008080;"> 4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.DataOutputStream;
</span><span style="color: #008080;"> 5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.File;
</span><span style="color: #008080;"> 6</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.FileOutputStream;
</span><span style="color: #008080;"> 7</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.net.Socket;
</span><span style="color: #008080;"> 8</span> 
<span style="color: #008080;"> 9</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> HandleServerThread <span style="color: #0000ff;">extends</span><span style="color: #000000;"> Thread {
</span><span style="color: #008080;">10</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> Socket socket;
</span><span style="color: #008080;">11</span> 
<span style="color: #008080;">12</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> HandleServerThread() {
</span><span style="color: #008080;">13</span> 
<span style="color: #008080;">14</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">15</span> 
<span style="color: #008080;">16</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> HandleServerThread(Socket socket) {
</span><span style="color: #008080;">17</span>         <span style="color: #0000ff;">this</span>.socket =<span style="color: #000000;"> socket;
</span><span style="color: #008080;">18</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">19</span> 
<span style="color: #008080;">20</span>     <span style="color: #008000;">/**</span>
<span style="color: #008080;">21</span> <span style="color: #008000;">     * 将文件保存到本地
</span><span style="color: #008080;">22</span>      <span style="color: #008000;">*/</span>
<span style="color: #008080;">23</span> <span style="color: #000000;">    @Override
</span><span style="color: #008080;">24</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> run() {
</span><span style="color: #008080;">25</span>         <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;">26</span>             <span style="color: #008000;">//</span><span style="color: #008000;">需要写入的文件</span>
<span style="color: #008080;">27</span>             File file = <span style="color: #0000ff;">new</span> File("E:\\test\\c.txt"<span style="color: #000000;">);
</span><span style="color: #008080;">28</span> <span style="color: #000000;">            file.createNewFile();
</span><span style="color: #008080;">29</span> 
<span style="color: #008080;">30</span>             <span style="color: #008000;">//</span><span style="color: #008000;">处理流 输入</span>
<span style="color: #008080;">31</span>             DataInputStream dataInputStream = <span style="color: #0000ff;">new</span><span style="color: #000000;"> DataInputStream(socket.getInputStream());
</span><span style="color: #008080;">32</span>             String fileName =<span style="color: #000000;"> dataInputStream.readUTF();
</span><span style="color: #008080;">33</span>             <span style="color: #0000ff;">long</span> fileSize =<span style="color: #000000;"> dataInputStream.readLong();
</span><span style="color: #008080;">34</span>             System.out.println("fileName=" + fileName + ",fileSize=" +<span style="color: #000000;"> fileSize);
</span><span style="color: #008080;">35</span>             <span style="color: #008000;">//</span><span style="color: #008000;">处理流 输出</span>
<span style="color: #008080;">36</span>             DataOutputStream dataOutputStream = <span style="color: #0000ff;">new</span> DataOutputStream(<span style="color: #0000ff;">new</span><span style="color: #000000;"> FileOutputStream(file));
</span><span style="color: #008080;">37</span> 
<span style="color: #008080;">38</span>             <span style="color: #008000;">//</span><span style="color: #008000;">采用字节数组读取文件内容</span>
<span style="color: #008080;">39</span>             <span style="color: #0000ff;">byte</span>[] bytes = <span style="color: #0000ff;">new</span> <span style="color: #0000ff;">byte</span>[128<span style="color: #000000;">];
</span><span style="color: #008080;">40</span>             <span style="color: #0000ff;">int</span> readSize = dataInputStream.read(bytes, 0<span style="color: #000000;">, bytes.length);
</span><span style="color: #008080;">41</span>             System.out.println("readSize=" +<span style="color: #000000;"> readSize);
</span><span style="color: #008080;">42</span>             <span style="color: #0000ff;">while</span> (readSize != -1<span style="color: #000000;">) {
</span><span style="color: #008080;">43</span>                 <span style="color: #008000;">//</span><span style="color: #008000;">写入本地文件</span>
<span style="color: #008080;">44</span>                 dataOutputStream.write(bytes, 0<span style="color: #000000;">, readSize);
</span><span style="color: #008080;">45</span> <span style="color: #000000;">                dataOutputStream.flush();
</span><span style="color: #008080;">46</span>                 readSize = dataInputStream.read(bytes, 0<span style="color: #000000;">, bytes.length);
</span><span style="color: #008080;">47</span>                 System.out.println("readSize=" +<span style="color: #000000;"> readSize);
</span><span style="color: #008080;">48</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">49</span>             System.out.println("========文件上传完成=========="<span style="color: #000000;">);
</span><span style="color: #008080;">50</span>         } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (Exception e) {
</span><span style="color: #008080;">51</span> <span style="color: #000000;">            e.printStackTrace();
</span><span style="color: #008080;">52</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">53</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">54</span> }</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<p>　　服务端代码</p>
<src class="cnblogs_code" onclick="cnblogs_code_show('9ecfab1e-d641-41f6-917b-fbdde1ca06a8')"><img id="code_img_closed_9ecfab1e-d641-41f6-917b-fbdde1ca06a8" class="code_img_closed" src="./images/网络编程系统化学习(1.1.)--socket基础1.png" alt="" /><img id="code_img_opened_9ecfab1e-d641-41f6-917b-fbdde1ca06a8" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('9ecfab1e-d641-41f6-917b-fbdde1ca06a8',event)" src="./images/网络编程系统化学习(1.1.)--socket基础2.png" alt="" />
<src id="cnblogs_code_open_9ecfab1e-d641-41f6-917b-fbdde1ca06a8" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.wfd360.com.socketFile;
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.wfd360.com.socketFile.thread.HandleServerThread;
</span><span style="color: #008080;"> 4</span> 
<span style="color: #008080;"> 5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.IOException;
</span><span style="color: #008080;"> 6</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.net.ServerSocket;
</span><span style="color: #008080;"> 7</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.net.Socket;
</span><span style="color: #008080;"> 8</span> 
<span style="color: #008080;"> 9</span> <span style="color: #008000;">/**</span>
<span style="color: #008080;">10</span> <span style="color: #008000;"> * @公众号: java实战分享
</span><span style="color: #008080;">11</span> <span style="color: #008000;"> * @Author: 姿势帝-博客园
</span><span style="color: #008080;">12</span> <span style="color: #008000;"> * @Date: 2019-09-01 15:14
</span><span style="color: #008080;">13</span> <span style="color: #008000;"> * @Description:
</span><span style="color: #008080;">14</span>  <span style="color: #008000;">*/</span>
<span style="color: #008080;">15</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> ServerSocketDemo {
</span><span style="color: #008080;">16</span>     <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">int</span> port = 1103<span style="color: #000000;">;
</span><span style="color: #008080;">17</span> 
<span style="color: #008080;">18</span>     <span style="color: #008000;">/**</span>
<span style="color: #008080;">19</span> <span style="color: #008000;">     * 服务端开启多线程
</span><span style="color: #008080;">20</span> <span style="color: #008000;">     *
</span><span style="color: #008080;">21</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> args
</span><span style="color: #008080;">22</span>      <span style="color: #008000;">*/</span>
<span style="color: #008080;">23</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span> main(String[] args) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> IOException {
</span><span style="color: #008080;">24</span>         ServerSocket server = <span style="color: #0000ff;">new</span><span style="color: #000000;"> ServerSocket(port);
</span><span style="color: #008080;">25</span>         <span style="color: #0000ff;">int</span> i = 1<span style="color: #000000;">;
</span><span style="color: #008080;">26</span>         System.out.println("服务端已启动----" +<span style="color: #000000;"> i);
</span><span style="color: #008080;">27</span>         <span style="color: #0000ff;">while</span> (<span style="color: #0000ff;">true</span><span style="color: #000000;">) {
</span><span style="color: #008080;">28</span>             System.out.println("等待客户端连接---" +<span style="color: #000000;"> i);
</span><span style="color: #008080;">29</span>             Socket socket =<span style="color: #000000;"> server.accept();
</span><span style="color: #008080;">30</span>             System.out.println("已连接---" +<span style="color: #000000;"> i);
</span><span style="color: #008080;">31</span>             HandleServerThread thread = <span style="color: #0000ff;">new</span><span style="color: #000000;"> HandleServerThread(socket);
</span><span style="color: #008080;">32</span> <span style="color: #000000;">            thread.start();
</span><span style="color: #008080;">33</span>             i++<span style="color: #000000;">;
</span><span style="color: #008080;">34</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">35</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">36</span> }</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<p>　　客户端代码</p>
<src class="cnblogs_code" onclick="cnblogs_code_show('8eb92d44-a804-44eb-95f5-5052b6bc3bd8')"><img id="code_img_closed_8eb92d44-a804-44eb-95f5-5052b6bc3bd8" class="code_img_closed" src="./images/网络编程系统化学习(1.1.)--socket基础1.png" alt="" /><img id="code_img_opened_8eb92d44-a804-44eb-95f5-5052b6bc3bd8" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('8eb92d44-a804-44eb-95f5-5052b6bc3bd8',event)" src="./images/网络编程系统化学习(1.1.)--socket基础2.png" alt="" />
<src id="cnblogs_code_open_8eb92d44-a804-44eb-95f5-5052b6bc3bd8" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.wfd360.com.socketFile;
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.DataInputStream;
</span><span style="color: #008080;"> 4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.DataOutputStream;
</span><span style="color: #008080;"> 5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.File;
</span><span style="color: #008080;"> 6</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.FileInputStream;
</span><span style="color: #008080;"> 7</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.net.Socket;
</span><span style="color: #008080;"> 8</span> 
<span style="color: #008080;"> 9</span> <span style="color: #008000;">/**</span>
<span style="color: #008080;">10</span> <span style="color: #008000;"> * @公众号: java实战分享
</span><span style="color: #008080;">11</span> <span style="color: #008000;"> * @Author: 姿势帝-博客园
</span><span style="color: #008080;">12</span> <span style="color: #008000;"> * @Date: 2019-09-01 15:50
</span><span style="color: #008080;">13</span> <span style="color: #008000;"> * @Description:
</span><span style="color: #008080;">14</span>  <span style="color: #008000;">*/</span>
<span style="color: #008080;">15</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> ClientSocketDemo {
</span><span style="color: #008080;">16</span>     <span style="color: #0000ff;">static</span> String host = "192.168.0.103"<span style="color: #000000;">;
</span><span style="color: #008080;">17</span>     <span style="color: #0000ff;">static</span> Integer port = 1103<span style="color: #000000;">;
</span><span style="color: #008080;">18</span> 
<span style="color: #008080;">19</span>     <span style="color: #008000;">/**</span>
<span style="color: #008080;">20</span> <span style="color: #008000;">     * 客户端设计逻辑:
</span><span style="color: #008080;">21</span> <span style="color: #008000;">     * 1.创建socket通信,设置IP和端口
</span><span style="color: #008080;">22</span> <span style="color: #008000;">     * 2.建立IO输出流,向服务端发送数据
</span><span style="color: #008080;">23</span> <span style="color: #008000;">     * 3.建立IO输入流,读取服务端应答的数据
</span><span style="color: #008080;">24</span> <span style="color: #008000;">     *
</span><span style="color: #008080;">25</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> args
</span><span style="color: #008080;">26</span>      <span style="color: #008000;">*/</span>
<span style="color: #008080;">27</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span> main(String[] args) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> Exception {
</span><span style="color: #008080;">28</span>         Socket socket = <span style="color: #0000ff;">new</span><span style="color: #000000;"> Socket(host, port);
</span><span style="color: #008080;">29</span>         <span style="color: #008000;">//</span><span style="color: #008000;">准备上传文件</span>
<span style="color: #008080;">30</span>         File file = <span style="color: #0000ff;">new</span> File("E:\\test\\a.txt"<span style="color: #000000;">);
</span><span style="color: #008080;">31</span>         DataInputStream dataInputStream = <span style="color: #0000ff;">new</span> DataInputStream(<span style="color: #0000ff;">new</span><span style="color: #000000;"> FileInputStream(file));
</span><span style="color: #008080;">32</span>         <span style="color: #008000;">//</span><span style="color: #008000;">准备输出 处理流</span>
<span style="color: #008080;">33</span>         DataOutputStream dataOutputStream = <span style="color: #0000ff;">new</span><span style="color: #000000;"> DataOutputStream(socket.getOutputStream());
</span><span style="color: #008080;">34</span> <span style="color: #000000;">        dataOutputStream.writeUTF(file.getName());
</span><span style="color: #008080;">35</span> <span style="color: #000000;">        dataOutputStream.flush();
</span><span style="color: #008080;">36</span> <span style="color: #000000;">        dataOutputStream.writeLong(file.length());
</span><span style="color: #008080;">37</span> <span style="color: #000000;">        dataOutputStream.flush();
</span><span style="color: #008080;">38</span>         <span style="color: #008000;">//</span><span style="color: #008000;">准备以字节的形式输出</span>
<span style="color: #008080;">39</span>         <span style="color: #0000ff;">byte</span>[] bytes = <span style="color: #0000ff;">new</span> <span style="color: #0000ff;">byte</span>[128<span style="color: #000000;">];
</span><span style="color: #008080;">40</span>         <span style="color: #0000ff;">int</span> readSize = dataInputStream.read(bytes, 0<span style="color: #000000;">, bytes.length);
</span><span style="color: #008080;">41</span>         <span style="color: #0000ff;">while</span> (readSize != -1<span style="color: #000000;">) {
</span><span style="color: #008080;">42</span>             System.out.println("readSize=" +<span style="color: #000000;"> readSize);
</span><span style="color: #008080;">43</span>             dataOutputStream.write(bytes, 0<span style="color: #000000;">, readSize);
</span><span style="color: #008080;">44</span> <span style="color: #000000;">            dataOutputStream.flush();
</span><span style="color: #008080;">45</span>             readSize = dataInputStream.read(bytes, 0<span style="color: #000000;">, bytes.length);
</span><span style="color: #008080;">46</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">47</span>         System.out.println("-----完成-------"<span style="color: #000000;">);
</span><span style="color: #008080;">48</span> <span style="color: #000000;">        dataInputStream.close();
</span><span style="color: #008080;">49</span>         <span style="color: #008000;">//</span><span style="color: #008000;">当关闭的时候，服务端才会停止监听</span>
<span style="color: #008080;">50</span> <span style="color: #000000;">        dataOutputStream.close();
</span><span style="color: #008080;">51</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">52</span> }</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<h1>8.UDP的socket</h1>
<h2>8.1.udp与tcp的区别</h2>
<p>　　UDP协议和TCP协议都是传输层协议。</p>
<p>　　<strong>TCP（Transmission Control Protocol，传输控制协议）</strong>提供的是<span style="color: #ff0000;">面向连接</span>，可靠的<span style="color: #ff0000;">字节流服务</span>。</p>
<p>　　即客户和服务器交换数据前，必须现在双方之间建立一个TCP连接，之后才能传输数据。</p>
<p>　　并且提供超时重发，丢弃重复数据，检验数据，流量控制等功能，保证数据能从一端传到另一端。</p>
<p>　　<strong>UDP（User Data Protocol，用户数据报协议）</strong>是一个简单的面向数据报文的运输层协议。</p>
<p>　　它不提供可靠性，只是把应用程序传给IP层的数据报发送出去，但是不能保证它们能到达目的地。</p>
<p>　　由于UDP在传输数据报前不用再客户和服务器之间建立一个连接，且没有超时重发等机制，所以传输速度很快。</p>
<h2>8.2.基于udp的socket案例</h2>
<p>　　服务端</p>
<src class="cnblogs_code" onclick="cnblogs_code_show('f4aafcd4-96ce-4b26-ac06-b82feff9ec41')"><img id="code_img_closed_f4aafcd4-96ce-4b26-ac06-b82feff9ec41" class="code_img_closed" src="./images/网络编程系统化学习(1.1.)--socket基础1.png" alt="" /><img id="code_img_opened_f4aafcd4-96ce-4b26-ac06-b82feff9ec41" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('f4aafcd4-96ce-4b26-ac06-b82feff9ec41',event)" src="./images/网络编程系统化学习(1.1.)--socket基础2.png" alt="" />
<src id="cnblogs_code_open_f4aafcd4-96ce-4b26-ac06-b82feff9ec41" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.wfd360.com.socketUDP;
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.net.DatagramPacket;
</span><span style="color: #008080;"> 4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.net.DatagramSocket;
</span><span style="color: #008080;"> 5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.net.InetAddress;
</span><span style="color: #008080;"> 6</span> 
<span style="color: #008080;"> 7</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> UDPServer {
</span><span style="color: #008080;"> 8</span>     <span style="color: #008000;">/**</span>
<span style="color: #008080;"> 9</span> <span style="color: #008000;">     * 一、DatagramPacket类：
</span><span style="color: #008080;">10</span> <span style="color: #008000;">     * &lt;p&gt;
</span><span style="color: #008080;">11</span> <span style="color: #008000;">     * 如果把DatagramSocket比作创建的港口码头，那么DatagramPacket就是发送和接收数据的集装箱。
</span><span style="color: #008080;">12</span> <span style="color: #008000;">     * 构造函数：一个用来接收数据，一个用来发送数据
</span><span style="color: #008080;">13</span> <span style="color: #008000;">     * public DatagramPacket(byte[] buf,int length) //接收数据
</span><span style="color: #008080;">14</span> <span style="color: #008000;">     * 构造 DatagramPacket 用来接收长度为 ilength 的包。
</span><span style="color: #008080;">15</span> <span style="color: #008000;">     * public DatagramPacket(byte[] buf,int length,InetAddress address,int port)
</span><span style="color: #008080;">16</span> <span style="color: #008000;">     * 构造数据报文包用来把长度为 ilength 的包传送到指定宿主的指定的端口号。
</span><span style="color: #008080;">17</span> <span style="color: #008000;">     * getAddress()
</span><span style="color: #008080;">18</span> <span style="color: #008000;">     * 返回接收或发送此数据报文的机器的 IP 地址。
</span><span style="color: #008080;">19</span> <span style="color: #008000;">     * getData()
</span><span style="color: #008080;">20</span> <span style="color: #008000;">     * 返回接收的数据或发送出的数据。
</span><span style="color: #008080;">21</span> <span style="color: #008000;">     * getLength()
</span><span style="color: #008080;">22</span> <span style="color: #008000;">     * 返回发送出的或接收到的数据的长度。
</span><span style="color: #008080;">23</span> <span style="color: #008000;">     * getPort()
</span><span style="color: #008080;">24</span> <span style="color: #008000;">     * 返回接收或发送该数据报文的远程主机端口号。
</span><span style="color: #008080;">25</span> <span style="color: #008000;">     * &lt;p&gt;
</span><span style="color: #008080;">26</span> <span style="color: #008000;">     * 二、DatagramSocket类
</span><span style="color: #008080;">27</span> <span style="color: #008000;">     * &lt;p&gt;
</span><span style="color: #008080;">28</span> <span style="color: #008000;">     * 此类表示用来发送和接收数据报包的套接字。 数据报套接字是包投递服务的发送或接收点。
</span><span style="color: #008080;">29</span> <span style="color: #008000;">     * DatagramSocket(int port)     创建数据报套接字并将其绑定到本地主机上的指定端口。
</span><span style="color: #008080;">30</span> <span style="color: #008000;">     * DatagramSocket(int port, InetAddress laddr)     创建数据报套接字，将其绑定到指定的本地地址。
</span><span style="color: #008080;">31</span> <span style="color: #008000;">     * &lt;p&gt;
</span><span style="color: #008080;">32</span> <span style="color: #008000;">     * receive(DatagramPacket p)
</span><span style="color: #008080;">33</span> <span style="color: #008000;">     * 从此套接字接收数据报包。
</span><span style="color: #008080;">34</span> <span style="color: #008000;">     * void send(DatagramPacket p)
</span><span style="color: #008080;">35</span> <span style="color: #008000;">     * 从此套接字发送数据报包。
</span><span style="color: #008080;">36</span> <span style="color: #008000;">     * bind(SocketAddress addr)
</span><span style="color: #008080;">37</span> <span style="color: #008000;">     * 将此 DatagramSocket 绑定到特定的地址和端口。
</span><span style="color: #008080;">38</span> <span style="color: #008000;">     * void close()
</span><span style="color: #008080;">39</span> <span style="color: #008000;">     * 关闭此数据报套接字。
</span><span style="color: #008080;">40</span> <span style="color: #008000;">     * void connect(InetAddress address, int port)
</span><span style="color: #008080;">41</span> <span style="color: #008000;">     * 将套接字连接到此套接字的远程地址。
</span><span style="color: #008080;">42</span> <span style="color: #008000;">     * void connect(SocketAddress addr)
</span><span style="color: #008080;">43</span> <span style="color: #008000;">     * 将此套接字连接到远程套接字地址（IP 地址 + 端口号）。
</span><span style="color: #008080;">44</span> <span style="color: #008000;">     * void disconnect()
</span><span style="color: #008080;">45</span> <span style="color: #008000;">     * 断开套接字的连接。
</span><span style="color: #008080;">46</span> <span style="color: #008000;">     * getInetAddress()
</span><span style="color: #008080;">47</span> <span style="color: #008000;">     * 返回此套接字连接的地址。
</span><span style="color: #008080;">48</span> <span style="color: #008000;">     * InetAddress getLocalAddress()
</span><span style="color: #008080;">49</span> <span style="color: #008000;">     * 获取套接字绑定的本地地址。
</span><span style="color: #008080;">50</span> <span style="color: #008000;">     * &lt;p&gt;
</span><span style="color: #008080;">51</span> <span style="color: #008000;">     * 三、InetAddress类
</span><span style="color: #008080;">52</span> <span style="color: #008000;">     * InetAddress用于表示计算机IP地址的一个类，而在日常应用中的IP地址用"192.168.0.1",
</span><span style="color: #008080;">53</span> <span style="color: #008000;">     * "WWW.it315.org"等字符串格式表示的。
</span><span style="color: #008080;">54</span> <span style="color: #008000;">     * getByName方法
</span><span style="color: #008080;">55</span> <span style="color: #008000;">     * getHostAddress方法
</span><span style="color: #008080;">56</span> <span style="color: #008000;">     *
</span><span style="color: #008080;">57</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> args
</span><span style="color: #008080;">58</span>      <span style="color: #008000;">*/</span>
<span style="color: #008080;">59</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span> main(String[] args) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> Exception {
</span><span style="color: #008080;">60</span>         <span style="color: #0000ff;">int</span> port = 1001<span style="color: #000000;">;
</span><span style="color: #008080;">61</span>         String host = "192.168.0.104"<span style="color: #000000;">;
</span><span style="color: #008080;">62</span>         <span style="color: #008000;">//</span><span style="color: #008000;">1.创建服务端 DatagramSocket(int port, InetAddress laddr)     创建数据报套接字，将其绑定到指定的本地地址。</span>
<span style="color: #008080;">63</span>         DatagramSocket datagramSocket = <span style="color: #0000ff;">new</span><span style="color: #000000;"> DatagramSocket(port);
</span><span style="color: #008080;">64</span>         System.out.println("服务已开启-----"<span style="color: #000000;">);
</span><span style="color: #008080;">65</span>         <span style="color: #008000;">//</span><span style="color: #008000;">2.接收数据</span>
<span style="color: #008080;">66</span>         <span style="color: #0000ff;">byte</span>[] bytes = <span style="color: #0000ff;">new</span> <span style="color: #0000ff;">byte</span>[128<span style="color: #000000;">];
</span><span style="color: #008080;">67</span>         DatagramPacket datagramPacket = <span style="color: #0000ff;">new</span> DatagramPacket(bytes, 0<span style="color: #000000;">, bytes.length);
</span><span style="color: #008080;">68</span>         System.out.println("-----等待接收数据"<span style="color: #000000;">);
</span><span style="color: #008080;">69</span> <span style="color: #000000;">        datagramSocket.receive(datagramPacket);
</span><span style="color: #008080;">70</span>         InetAddress address =<span style="color: #000000;"> datagramPacket.getAddress();
</span><span style="color: #008080;">71</span>         <span style="color: #0000ff;">int</span> port1 =<span style="color: #000000;"> datagramPacket.getPort();
</span><span style="color: #008080;">72</span>         <span style="color: #0000ff;">int</span> length =<span style="color: #000000;"> datagramPacket.getLength();
</span><span style="color: #008080;">73</span>         <span style="color: #0000ff;">byte</span>[] data =<span style="color: #000000;"> datagramPacket.getData();
</span><span style="color: #008080;">74</span>         String s = <span style="color: #0000ff;">new</span><span style="color: #000000;"> String(data);
</span><span style="color: #008080;">75</span>         String format = String.format("address=%s,port=%s,length=%s,data=%s"<span style="color: #000000;">, address, port1, length, s);
</span><span style="color: #008080;">76</span> <span style="color: #000000;">        System.out.println(format);
</span><span style="color: #008080;">77</span>         <span style="color: #008000;">//</span><span style="color: #008000;">3.发送数据包</span>
<span style="color: #008080;">78</span>         String sendData = "发送数据-" +<span style="color: #000000;"> s;
</span><span style="color: #008080;">79</span>         <span style="color: #0000ff;">byte</span>[] bytes1 =<span style="color: #000000;"> sendData.getBytes();
</span><span style="color: #008080;">80</span>         InetAddress byName =<span style="color: #000000;"> InetAddress.getByName(host);
</span><span style="color: #008080;">81</span>         DatagramPacket datagramPacketSend = <span style="color: #0000ff;">new</span> DatagramPacket(bytes1, 0, bytes1.length, byName, 1002<span style="color: #000000;">);
</span><span style="color: #008080;">82</span> <span style="color: #000000;">        datagramSocket.send(datagramPacketSend);
</span><span style="color: #008080;">83</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">84</span> }</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<p>　　客户端</p>
<src class="cnblogs_code" onclick="cnblogs_code_show('fa270cee-8520-4123-b56a-932ece159281')"><img id="code_img_closed_fa270cee-8520-4123-b56a-932ece159281" class="code_img_closed" src="./images/网络编程系统化学习(1.1.)--socket基础1.png" alt="" /><img id="code_img_opened_fa270cee-8520-4123-b56a-932ece159281" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('fa270cee-8520-4123-b56a-932ece159281',event)" src="./images/网络编程系统化学习(1.1.)--socket基础2.png" alt="" />
<src id="cnblogs_code_open_fa270cee-8520-4123-b56a-932ece159281" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.wfd360.com.socketUDP;
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.net.DatagramPacket;
</span><span style="color: #008080;"> 4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.net.DatagramSocket;
</span><span style="color: #008080;"> 5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.net.InetAddress;
</span><span style="color: #008080;"> 6</span> 
<span style="color: #008080;"> 7</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> UDPClient {
</span><span style="color: #008080;"> 8</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span> main(String[] args) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> Exception {
</span><span style="color: #008080;"> 9</span>         <span style="color: #0000ff;">int</span> port = 1002<span style="color: #000000;">;
</span><span style="color: #008080;">10</span>         String host = "192.168.0.104"<span style="color: #000000;">;
</span><span style="color: #008080;">11</span>         <span style="color: #008000;">//</span><span style="color: #008000;">1.创建服务端 DatagramSocket(int port, InetAddress laddr)     创建数据报套接字，将其绑定到指定的本地地址。</span>
<span style="color: #008080;">12</span>         DatagramSocket datagramSocket = <span style="color: #0000ff;">new</span><span style="color: #000000;"> DatagramSocket(port);
</span><span style="color: #008080;">13</span>         <span style="color: #008000;">//</span><span style="color: #008000;">3.发送数据包</span>
<span style="color: #008080;">14</span>         String sendData = "你好吗?"<span style="color: #000000;">;
</span><span style="color: #008080;">15</span>         <span style="color: #0000ff;">byte</span>[] bytes1 =<span style="color: #000000;"> sendData.getBytes();
</span><span style="color: #008080;">16</span>         InetAddress byName =<span style="color: #000000;"> InetAddress.getByName(host);
</span><span style="color: #008080;">17</span>         DatagramPacket datagramPacketSend = <span style="color: #0000ff;">new</span> DatagramPacket(bytes1, 0, bytes1.length, byName, 1001<span style="color: #000000;">);
</span><span style="color: #008080;">18</span> <span style="color: #000000;">        datagramSocket.send(datagramPacketSend);
</span><span style="color: #008080;">19</span>         <span style="color: #008000;">//</span><span style="color: #008000;">2.接收数据</span>
<span style="color: #008080;">20</span>         <span style="color: #0000ff;">byte</span>[] bytes = <span style="color: #0000ff;">new</span> <span style="color: #0000ff;">byte</span>[128<span style="color: #000000;">];
</span><span style="color: #008080;">21</span>         DatagramPacket datagramPacket = <span style="color: #0000ff;">new</span> DatagramPacket(bytes, 0<span style="color: #000000;">, bytes.length);
</span><span style="color: #008080;">22</span>         System.out.println("-----等待接收数据"<span style="color: #000000;">);
</span><span style="color: #008080;">23</span> <span style="color: #000000;">        datagramSocket.receive(datagramPacket);
</span><span style="color: #008080;">24</span>         InetAddress address =<span style="color: #000000;"> datagramPacket.getAddress();
</span><span style="color: #008080;">25</span>         <span style="color: #0000ff;">int</span> port1 =<span style="color: #000000;"> datagramPacket.getPort();
</span><span style="color: #008080;">26</span>         <span style="color: #0000ff;">int</span> length =<span style="color: #000000;"> datagramPacket.getLength();
</span><span style="color: #008080;">27</span>         <span style="color: #0000ff;">byte</span>[] data =<span style="color: #000000;"> datagramPacket.getData();
</span><span style="color: #008080;">28</span>         String s = <span style="color: #0000ff;">new</span><span style="color: #000000;"> String(data);
</span><span style="color: #008080;">29</span>         String format = String.format("address=%s,port=%s,length=%s,data=%s"<span style="color: #000000;">, address, port1, length, s);
</span><span style="color: #008080;">30</span> <span style="color: #000000;">        System.out.println(format);
</span><span style="color: #008080;">31</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">32</span> }</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<p>完美!</p>

</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>