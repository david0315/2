<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='ç”µè„‘,ç”µè„‘è®²è§£,ç”µè„‘æŠ€æœ¯,ç¼–ç¨‹,ç”µè„‘æ•…éšœç»´ä¿®SpringBoot æºç è§£æ ï¼ˆå…«ï¼‰----- Spring Boot ç²¾é«“ï¼šäº‹åŠ¡æºç è§£æ' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>é¦–é¡µ</a></li>
</div><div onclick='hidden1()' >åˆ†äº«</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>SpringBoot æºç è§£æ ï¼ˆå…«ï¼‰----- Spring Boot ç²¾é«“ï¼šäº‹åŠ¡æºç è§£æ</center></div><div class='banquan'>åŸæ–‡å‡ºå¤„:æœ¬æ–‡ç”±åšå®¢å›­åšä¸»chen_haoæä¾›ã€‚<br/>
åŸæ–‡è¿æ¥:https://www.cnblogs.com/java-chen-hao/p/11844523.html</div><br>
    <p>æœ¬ç¯‡æ¥è®²ä¸€ä¸‹SpringBootæ˜¯æ€ä¹ˆè‡ªåŠ¨å¼€å¯äº‹åŠ¡çš„ï¼Œæˆ‘ä»¬å…ˆæ¥å›é¡¾ä¸€ä¸‹ä»¥å‰SSMä¸­æ˜¯å¦‚ä½•ä½¿ç”¨äº‹åŠ¡çš„</p>
<h2>SSMä½¿ç”¨äº‹åŠ¡</h2>
<h3>å¯¼å…¥JDBCä¾èµ–åŒ…</h3>
<p>ä¼—æ‰€å‘¨çŸ¥ï¼Œå‡¡æ˜¯éœ€è¦è·Ÿæ•°æ®åº“æ‰“äº¤é“çš„ï¼ŒåŸºæœ¬ä¸Šéƒ½è¦æ·»åŠ jdbcçš„ä¾èµ–ï¼Œåœ¨Springé¡¹ç›®ä¸­ï¼ŒåŠ å…¥çš„æ˜¯spring-jdbcä¾èµ–ï¼š</p>
<src class="cnblogs_code">
<pre><code><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">dependency</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">groupId</span><span style="color: #0000ff;">&gt;</span>org.springframework<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">groupId</span><span style="color: #0000ff;">&gt;</span>
 <strong>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">artifactId</span><span style="color: #0000ff;">&gt;</span>spring-jdbc<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">artifactId</span><span style="color: #0000ff;">&gt;</span></strong>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">dependency</span><span style="color: #0000ff;">&gt;</span></code></pre>

<h3>é…ç½®ç‰ˆäº‹åŠ¡</h3>
<p>åœ¨ä½¿ç”¨é…ç½®æ–‡ä»¶çš„æ–¹å¼ä¸­ï¼Œé€šå¸¸ä¼šåœ¨Springçš„é…ç½®æ–‡ä»¶ä¸­é…ç½®äº‹åŠ¡ç®¡ç†å™¨ï¼Œå¹¶æ³¨å…¥æ•°æ®æºï¼š</p>
<src class="cnblogs_code">
<pre><code><span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> æ³¨å†Œæ•°æ®æº </span><span style="color: #008000;">--&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">bean </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="dataSource"</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">="..."</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">=""</span><span style="color: #ff0000;"> value</span><span style="color: #0000ff;">=""</span><span style="color: #0000ff;">/&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">bean</span><span style="color: #0000ff;">&gt;</span>

<strong><span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> æ³¨å†Œäº‹åŠ¡ç®¡ç†å™¨ </span><span style="color: #008000;">--&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">bean </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="txManager"</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">="org.springframework.jdbc.datasource.DataSourceTransactionManager"</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="dataSource"</span><span style="color: #ff0000;"> ref</span><span style="color: #0000ff;">="dataSource"</span> <span style="color: #0000ff;">/&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">bean</span><span style="color: #0000ff;">&gt;</span>

<span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> å¼€å¯äº‹åŠ¡æ³¨è§£ </span><span style="color: #008000;">--&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">tx:annotation-driven </span><span style="color: #ff0000;">transaction-manager</span><span style="color: #0000ff;">="txManager"</span> <span style="color: #0000ff;">/&gt;</span></strong></code></pre>

<p>æ¥ä¸‹æ¥å¯ä»¥ç›´æ¥åœ¨ä¸šåŠ¡å±‚Serviceçš„æ–¹æ³•ä¸Šæˆ–è€…ç±»ä¸Šæ·»åŠ <strong>@Transactional</strong>ã€‚</p>
<h3>æ³¨è§£ç‰ˆäº‹åŠ¡</h3>
<p>é¦–å…ˆéœ€è¦æ³¨å†Œä¸¤ä¸ªBeanï¼Œåˆ†åˆ«å¯¹åº”ä¸Šé¢Springé…ç½®æ–‡ä»¶ä¸­çš„ä¸¤ä¸ªBeanï¼š</p>
<src class="cnblogs_code">
<pre><code><strong>@EnableTransactionManagement<span style="color: #008000;">//</span><span style="color: #008000;">é‡è¦</span></strong>
<span style="color: #000000;">@Configuration
</span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> TxConfig {

    @Bean
    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> DataSource dataSource() {
        ComboPooledDataSource dataSource </span>= <span style="color: #0000ff;">new</span><span style="color: #000000;"> ComboPooledDataSource();
        dataSource.setUser(</span>"..."<span style="color: #000000;">);
        dataSource.setPassword(</span>"..."<span style="color: #000000;">);
        dataSource.setDriverClass(</span>"..."<span style="color: #000000;">);
        dataSource.setJdbcUrl(</span>"..."<span style="color: #000000;">);
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> dataSource;
    }
  
    </span><strong><span style="color: #008000;">//</span><span style="color: #008000;">é‡è¦</span>
<span style="color: #000000;">    @Bean
    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> PlatformTransactionManager platformTransactionManager() {
        </span><span style="color: #0000ff;">return</span> <span style="color: #0000ff;">new</span> DataSourceTransactionManager(dataSource());<span style="color: #008000;">//</span><span style="color: #008000;">æ”¾å…¥æ•°æ®æº</span>
</strong><span style="color: #000000;"><strong>    }</strong>
}</span></code></pre>

<p>æˆ‘ä»¬çœ‹åˆ°å¾€Springå®¹å™¨ä¸­æ³¨å…¥äº†DataSource å’ŒPlatformTransactionManager å¯¹è±¡ï¼Œå¹¶ä¸”é€šè¿‡@EnableTransactionManagementæ³¨è§£å¼€å¯äº†äº‹åŠ¡ï¼Œå’Œä¸Šé¢çš„XMLé…ç½®æ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚PlatformTransactionManagerè¿™ä¸ªBeanéå¸¸é‡è¦ï¼Œè¦ä½¿ç”¨äº‹åŠ¡ç®¡ç†ï¼Œå°±å¿…é¡»è¦åœ¨IOCå®¹å™¨ä¸­æ³¨å†Œä¸€ä¸ªäº‹åŠ¡ç®¡ç†å™¨ã€‚</p>
<src class="cnblogs_code">
<pre><code><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">interface</span><span style="color: #000000;"><strong> PlatformTransactionManager</strong> {
    </span><span style="color: #008000;">//</span><span style="color: #008000;">è·å–ä¸€ä¸ªTransaction</span>
    TransactionStatus getTransaction(TransactionDefinition var1) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> TransactionException;
    </span><span style="color: #008000;">//</span><span style="color: #008000;">æäº¤äº‹åŠ¡</span>
    <span style="color: #0000ff;">void</span> commit(TransactionStatus var1) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> TransactionException;
    </span><span style="color: #008000;">//</span><span style="color: #008000;">å›æ»šäº‹åŠ¡</span>
    <span style="color: #0000ff;">void</span> rollback(TransactionStatus var1) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> TransactionException;
}</span></code></pre>

<p>æˆ‘ä»¬çœ‹åˆ°äº‹åŠ¡ç®¡ç†å™¨çš„ä½œç”¨å°±æ˜¯è·å–äº‹åŠ¡ï¼Œæäº¤å›æ»šäº‹åŠ¡ã€‚DataSourceTransactionManageræ˜¯PlatformTransactionManagerçš„ä¸€ä¸ªå®ç°ç±»ï¼Œå¤§å®¶å¯ä»¥çœ‹çœ‹æˆ‘ä»¥å‰çš„æ–‡ç« <a class="entry" href="https://www.cnblogs.com/java-chen-hao/p/11635380.html" target="_blank">spring5 æºç æ·±åº¦è§£æ----- Springäº‹åŠ¡ æ˜¯æ€ä¹ˆé€šè¿‡AOPå®ç°çš„ï¼Ÿï¼ˆ100%ç†è§£Springäº‹åŠ¡ï¼‰</a>&nbsp;çœ‹ä¸€ä¸‹Springçš„å£°æ˜å¼äº‹åŠ¡çš„æºç ã€‚ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹SpringBootæ˜¯å¦‚ä½•è‡ªåŠ¨é…ç½®äº‹åŠ¡çš„</p>
<h2>SpringBootè‡ªåŠ¨é…ç½®äº‹åŠ¡</h2>
<h3>å¼•å…¥JDBC</h3>
<p>ä¼—æ‰€å‘¨çŸ¥ï¼Œåœ¨SpringBootä¸­å‡¡æ˜¯éœ€è¦è·Ÿæ•°æ®åº“æ‰“äº¤é“çš„ï¼ŒåŸºæœ¬ä¸Šéƒ½è¦æ˜¾å¼æˆ–è€…éšå¼æ·»åŠ jdbcçš„ä¾èµ–ï¼š</p>
<src class="cnblogs_code">
<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;<strong>spring-boot-starter-jdbc</strong>&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>

<p>ä¹Ÿå°±æ˜¯jdbcçš„åœºæ™¯å¯åŠ¨å™¨ï¼Œæˆ‘ä»¬ç‚¹è¿›å»çœ‹çœ‹</p>
<p><img src="./images/SpringBoot æºç è§£æ ï¼ˆå…«ï¼‰----- Spring Boot ç²¾é«“ï¼šäº‹åŠ¡æºç è§£æ0.png" alt="" /></p>
<p>å…¶å®ä¹Ÿæ˜¯å¼•å…¥äº†<code class="xml  language-xml">spring-jdbcçš„ä¾èµ–ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è¦çœ‹ä¸¤ä¸ªé‡è¦çš„äº‹åŠ¡è‡ªåŠ¨é…ç½®ç±»</code></p>
<h2>DataSourceTransactionManagerAutoConfiguration</h2>
<p><img src="./images/SpringBoot æºç è§£æ ï¼ˆå…«ï¼‰----- Spring Boot ç²¾é«“ï¼šäº‹åŠ¡æºç è§£æ1.png" alt="" /></p>
<p>æˆ‘ä»¬çœ‹åˆ°åœ¨spring.factoriesä¸­é…ç½®äº†äº‹åŠ¡ç®¡ç†å™¨è‡ªåŠ¨é…ç½®ç±»DataSourceTransactionManagerAutoConfigurationï¼Œæˆ‘ä»¬è¿›å»çœ‹çœ‹</p>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #000000;">@Configuration
</span><span style="color: #008080;"> 2</span> <strong><span style="color: #008000;">//</span><span style="color: #008000;">åœ¨ç±»è·¯å¾„ä¸‹æœ‰è¿™ä¸ªç±»å­˜åœ¨PlatformTransactionManageræ—¶ï¼Œè¿™ä¸ªé…ç½®ç±»æ‰ä¼šç”Ÿæ•ˆ
</span><span style="color: #008080;"> 3</span> <span style="color: #008000;">//</span><span style="color: #008000;">è€Œå‰é¢æˆ‘ä»¬å·²ç»å¼•å…¥äº†spring-boot-starter-jdbcï¼Œé‚£è‡ªç„¶æ˜¯å­˜åœ¨äº†</span>
<span style="color: #008080;"> 4</span> @ConditionalOnClass({ JdbcTemplate.<span style="color: #0000ff;">class</span>, PlatformTransactionManager.<span style="color: #0000ff;">class</span><span style="color: #000000;"> })
</span></strong><span style="color: #008080;"> 5</span> <span style="color: #000000;">@AutoConfigureOrder(Ordered.LOWEST_PRECEDENCE)
</span><span style="color: #008080;"> 6</span> @EnableConfigurationProperties(DataSourceProperties.<span style="color: #0000ff;">class</span><span style="color: #000000;">)
</span><span style="color: #008080;"> 7</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> DataSourceTransactionManagerAutoConfiguration {
</span><span style="color: #008080;"> 8</span> 
<span style="color: #008080;"> 9</span> <span style="color: #000000;">    @Configuration
</span><span style="color: #008080;">10</span>     @ConditionalOnSingleCandidate(DataSource.<span style="color: #0000ff;">class</span><span style="color: #000000;">)
</span><span style="color: #008080;">11</span>     <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> DataSourceTransactionManagerConfiguration {
</span><span style="color: #008080;">12</span> 
<span style="color: #008080;">13</span>         <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">final</span><span style="color: #000000;"> DataSource dataSource;
</span><span style="color: #008080;">14</span> 
<span style="color: #008080;">15</span>         <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">final</span><span style="color: #000000;"> TransactionManagerCustomizers transactionManagerCustomizers;
</span><span style="color: #008080;">16</span> 
<span style="color: #008080;">17</span> <span style="color: #000000;">        DataSourceTransactionManagerConfiguration(DataSource dataSource,
</span><span style="color: #008080;">18</span>                 ObjectProvider&lt;TransactionManagerCustomizers&gt;<span style="color: #000000;"> transactionManagerCustomizers) {
</span><span style="color: #008080;">19</span>             <span style="color: #0000ff;">this</span>.dataSource =<span style="color: #000000;"> dataSource;
</span><span style="color: #008080;">20</span>             <span style="color: #0000ff;">this</span>.transactionManagerCustomizers =<span style="color: #000000;"> transactionManagerCustomizers
</span><span style="color: #008080;">21</span> <span style="color: #000000;">                    .getIfAvailable();
</span><span style="color: #008080;">22</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">23</span> 
<span style="color: #008080;">24</span> <span style="color: #000000;">        @Bean
</span><span style="color: #008080;">25</span>        <strong> <span style="color: #008000;">//</span><span style="color: #008000;">æ²¡æœ‰å½“Springå®¹å™¨ä¸­ä¸å­˜åœ¨PlatformTransactionManagerè¿™ä¸ªå¯¹è±¡æ—¶ï¼Œåˆ›å»ºDataSourceTransactionManager
</span><span style="color: #008080;">26</span>         <span style="color: #008000;">//</span><span style="color: #008000;">ä¹Ÿå°±æ˜¯å¦‚æœæˆ‘ä»¬è‡ªå®šä¹‰äº†DataSourceTransactionManagerå¹¶æ³¨å…¥Springå®¹å™¨ï¼Œè¿™é‡Œå°†ä¸ä¼šæ‰§è¡Œ</span>
<span style="color: #008080;">27</span>         @ConditionalOnMissingBean(PlatformTransactionManager.<span style="color: #0000ff;">class</span><span style="color: #000000;">)
</span><span style="color: #008080;">28</span>         <span style="color: #0000ff;">public</span><span style="color: #000000;"> DataSourceTransactionManager transactionManager(DataSourceProperties properties) {
</span><span style="color: #008080;">29</span>             <span style="color: #008000;">//</span><span style="color: #008000;">åˆ›å»ºDataSourceTransactionManageræ³¨å…¥Springå®¹å™¨ï¼Œå¹¶ä¸”æŠŠdataSourceä¼ è¿›å»</span>
<span style="color: #008080;">30</span>             DataSourceTransactionManager transactionManager = <span style="color: #0000ff;">new</span> DataSourceTransactionManager(<span style="color: #0000ff;">this</span><span style="color: #000000;">.dataSource);
</span></strong><span style="color: #008080;">31</span>             <span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">this</span>.transactionManagerCustomizers != <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
</span><span style="color: #008080;">32</span>                 <span style="color: #0000ff;">this</span><span style="color: #000000;">.transactionManagerCustomizers.customize(transactionManager);
</span><span style="color: #008080;">33</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">34</span>         <strong>    <span style="color: #0000ff;">return</span><span style="color: #000000;"> transactionManager;
</span></strong><span style="color: #008080;">35</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">36</span> 
<span style="color: #008080;">37</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">38</span> 
<span style="color: #008080;">39</span> }</code></pre>

<p>å¾ˆæ˜æ˜¾åªè¦æˆ‘ä»¬å¯¼å…¥äº†<strong>spring-boot-starter-jdbcåœºæ™¯å¯åŠ¨å™¨</strong>ï¼Œå¹¶ä¸”æˆ‘ä»¬æ²¡æœ‰è‡ªå®šä¹‰DataSourceTransactionManagerï¼Œé‚£ä¹ˆäº‹åŠ¡ç®¡ç†å™¨è‡ªåŠ¨é…ç½®ç±»DataSourceTransactionManagerAutoConfigurationä¼šè‡ªåŠ¨ä¸ºæˆ‘ä»¬åˆ›å»ºDataSourceTransactionManagerå¹¶æ³¨å…¥Springå®¹å™¨ä¸­ã€‚ä½†æ˜¯è¿™è¿˜ä¸å¤Ÿï¼Œæˆ‘ä»¬å‰é¢è¿˜æ˜¯éœ€è¦é€šè¿‡<strong>@EnableTransactionManagementå¼€å¯äº‹åŠ¡å‘¢</strong>ï¼Œå¦‚æœä¸å¼€å¯äº‹åŠ¡ï¼Œ@Transactionalæ˜¯ä¸èµ·ä»»ä½•ä½œç”¨çš„ã€‚ä¸‹é¢æˆ‘ä»¬å°±æ¥çœ‹çœ‹æ˜¯å¦‚ä½•å¼€å¯äº‹åŠ¡çš„</p>
<h2>TransactionAutoConfiguration</h2>
<p><strong><img src="./images/SpringBoot æºç è§£æ ï¼ˆå…«ï¼‰----- Spring Boot ç²¾é«“ï¼šäº‹åŠ¡æºç è§£æ2.png" alt="" /></strong></p>
<p>æˆ‘ä»¬çœ‹åˆ°åœ¨spring.factoriesä¸­é…ç½®äº†äº‹åŠ¡è‡ªåŠ¨å¼€å¯é…ç½®ç±»TransactionAutoConfigurationï¼Œæˆ‘ä»¬è¿›å»çœ‹çœ‹</p>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #000000;">@Configuration
</span><span style="color: #008080;"> 2</span> <span style="color: #008000;">//</span><span style="color: #008000;">å’ŒDataSourceTransactionManagerAutoConfigurationä¸­æ˜¯ä¸€æ ·çš„
</span><span style="color: #008080;"> 3</span> <span style="color: #008000;">//</span><span style="color: #008000;">å¼•å…¥äº†spring-boot-starter-jdbcï¼Œé‚£è‡ªç„¶æ˜¯å­˜åœ¨äº†PlatformTransactionManager</span>
<span style="color: #008080;"> 4</span> @ConditionalOnClass({PlatformTransactionManager.<span style="color: #0000ff;">class</span><span style="color: #000000;">})
</span><strong><span style="color: #008080;"> 5</span> <span style="color: #008000;">//</span><span style="color: #008000;">è¿™ä¸ªè‡ªåŠ¨é…ç½®ç±»å¿…é¡»è¦åœ¨DataSourceTransactionManagerAutoConfigurationè¿™ä¸ªè‡ªåŠ¨é…ç½®ç±»ä¹‹åæ‰èƒ½ç”Ÿæ•ˆ
</span><span style="color: #008080;"> 6</span> <span style="color: #008000;">//</span><span style="color: #008000;">ä¹Ÿå°±æ˜¯å‰é¢æˆ‘ä»¬å·²ç»å¾€Springå®¹å™¨ä¸­æ³¨å…¥äº†DataSourceTransactionManagerè¿™ä¸ªå¯¹è±¡æ‰æ‰§è¡Œè¿™ä¸ªé…ç½®ç±»</span>
<span style="color: #008080;"> 7</span> @AutoConfigureAfter({JtaAutoConfiguration.<span style="color: #0000ff;">class</span>, HibernateJpaAutoConfiguration.<span style="color: #0000ff;">class</span>, DataSourceTransactionManagerAutoConfiguration.<span style="color: #0000ff;">class</span>, Neo4jDataAutoConfiguration.<span style="color: #0000ff;">class</span><span style="color: #000000;">})
</span></strong><span style="color: #008080;"> 8</span> @EnableConfigurationProperties({TransactionProperties.<span style="color: #0000ff;">class</span><span style="color: #000000;">})
</span><span style="color: #008080;"> 9</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> TransactionAutoConfiguration {
</span><span style="color: #008080;">10</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> TransactionAutoConfiguration() {
</span><span style="color: #008080;">11</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">12</span> 
<span style="color: #008080;">13</span> <span style="color: #000000;">    @Configuration
</span><span style="color: #008080;">14</span>     @ConditionalOnBean({PlatformTransactionManager.<span style="color: #0000ff;">class</span><span style="color: #000000;">})
</span><span style="color: #008080;">15</span>     @ConditionalOnMissingBean({AbstractTransactionManagementConfiguration.<span style="color: #0000ff;">class</span><span style="color: #000000;">})
</span><span style="color: #008080;">16</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> EnableTransactionManagementConfiguration {
</span><span style="color: #008080;">17</span>         <span style="color: #0000ff;">public</span><span style="color: #000000;"> EnableTransactionManagementConfiguration() {
</span><span style="color: #008080;">18</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">19</span> 
<span style="color: #008080;">20</span> <strong><span style="color: #000000;">        @Configuration
</span><span style="color: #008080;">21</span>         <span style="color: #008000;">//</span><span style="color: #008000;">é‡ç‚¹ï¼šé€šè¿‡ @EnableTransactionManagementæ³¨è§£å¼€å¯äº‹åŠ¡
</span><span style="color: #008080;">22</span>         <span style="color: #008000;">//</span><span style="color: #008000;">å¯ä»¥çœ‹åˆ°å’Œæˆ‘ä»¬è‡ªå·±ä½¿ç”¨@EnableTransactionManagementæ˜¯ä¸€æ ·çš„</span>
<span style="color: #008080;">23</span> <span style="color: #000000;">        @EnableTransactionManagement(
</span></strong><span style="color: #008080;">24</span>             proxyTargetClass = <span style="color: #0000ff;">true</span>
<span style="color: #008080;">25</span> <span style="color: #000000;">        )
</span><span style="color: #008080;">26</span> <span style="color: #000000;">        @ConditionalOnProperty(
</span><span style="color: #008080;">27</span>             prefix = "spring.aop"<span style="color: #000000;">,
</span><span style="color: #008080;">28</span>             name = {"proxy-target-class"<span style="color: #000000;">},
</span><span style="color: #008080;">29</span>             havingValue = "true"<span style="color: #000000;">,
</span><span style="color: #008080;">30</span>             matchIfMissing = <span style="color: #0000ff;">true</span>
<span style="color: #008080;">31</span> <span style="color: #000000;">        )
</span><span style="color: #008080;">32</span>         <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> CglibAutoProxyConfiguration {
</span><span style="color: #008080;">33</span>             <span style="color: #0000ff;">public</span><span style="color: #000000;"> CglibAutoProxyConfiguration() {
</span><span style="color: #008080;">34</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">35</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">36</span> 
<span style="color: #008080;">37</span> <span style="color: #000000;">        @Configuration
</span><span style="color: #008080;">38</span> <span style="color: #000000;">        @EnableTransactionManagement(
</span><span style="color: #008080;">39</span>             proxyTargetClass = <span style="color: #0000ff;">false</span>
<span style="color: #008080;">40</span> <span style="color: #000000;">        )
</span><span style="color: #008080;">41</span> <span style="color: #000000;">        @ConditionalOnProperty(
</span><span style="color: #008080;">42</span>             prefix = "spring.aop"<span style="color: #000000;">,
</span><span style="color: #008080;">43</span>             name = {"proxy-target-class"<span style="color: #000000;">},
</span><span style="color: #008080;">44</span>             havingValue = "false"<span style="color: #000000;">,
</span><span style="color: #008080;">45</span>             matchIfMissing = <span style="color: #0000ff;">false</span>
<span style="color: #008080;">46</span> <span style="color: #000000;">        )
</span><span style="color: #008080;">47</span>         <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> JdkDynamicAutoProxyConfiguration {
</span><span style="color: #008080;">48</span>             <span style="color: #0000ff;">public</span><span style="color: #000000;"> JdkDynamicAutoProxyConfiguration() {
</span><span style="color: #008080;">49</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">50</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">51</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">52</span> 
<span style="color: #008080;">53</span> <span style="color: #000000;">    @Configuration
</span><span style="color: #008080;">54</span>     @ConditionalOnSingleCandidate(PlatformTransactionManager.<span style="color: #0000ff;">class</span><span style="color: #000000;">)
</span><span style="color: #008080;">55</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> TransactionTemplateConfiguration {
</span><span style="color: #008080;">56</span>         <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">final</span><span style="color: #000000;"> PlatformTransactionManager transactionManager;
</span><span style="color: #008080;">57</span> 
<span style="color: #008080;">58</span>         <span style="color: #0000ff;">public</span><span style="color: #000000;"> TransactionTemplateConfiguration(PlatformTransactionManager transactionManager) {
</span><span style="color: #008080;">59</span>             <span style="color: #0000ff;">this</span>.transactionManager =<span style="color: #000000;"> transactionManager;
</span><span style="color: #008080;">60</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">61</span> 
<span style="color: #008080;">62</span> <span style="color: #000000;">        @Bean
</span><span style="color: #008080;">63</span> <span style="color: #000000;">        @ConditionalOnMissingBean
</span><span style="color: #008080;">64</span>         <span style="color: #0000ff;">public</span><span style="color: #000000;"> TransactionTemplate transactionTemplate() {
</span><span style="color: #008080;">65</span>             <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">new</span> TransactionTemplate(<span style="color: #0000ff;">this</span><span style="color: #000000;">.transactionManager);
</span><span style="color: #008080;">66</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">67</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">68</span> }</code></pre>

<p>æˆ‘ä»¬çœ‹åˆ°TransactionAutoConfigurationè¿™ä¸ªè‡ªåŠ¨é…ç½®ç±»å¿…é¡»è¦åœ¨DataSourceTransactionManagerAutoConfigurationè¿™ä¸ªé…ç½®ç±»ä¹‹åæ‰èƒ½ç”Ÿæ•ˆï¼Œä¹Ÿå°±æ˜¯å‰é¢æˆ‘ä»¬å·²ç»å¾€Springå®¹å™¨ä¸­æ³¨å…¥äº†DataSourceTransactionManagerè¿™ä¸ªå¯¹è±¡æ‰æ‰§è¡Œè¿™ä¸ªé…ç½®ç±»ï¼Œç„¶åé€šè¿‡</p>
<p>@EnableTransactionManagementè¿™ä¸ªæ³¨è§£å¼€å¯äº‹åŠ¡ï¼Œå…¶å®å’Œæˆ‘ä»¬è‡ªå·±ä½¿ç”¨@EnableTransactionManagementæ˜¯ä¸€æ ·çš„</p>
<p>å› æ­¤ï¼Œåªè¦æˆ‘ä»¬åœ¨SpringBootä¸­å¼•å…¥äº†<strong>spring-boot-starter-jdbc</strong>è¿™ä¸ªåœºæ™¯å¯åŠ¨å™¨ï¼Œå°±ä¼šå¸®æˆ‘ä»¬è‡ªåŠ¨å¼€å¯äº‹åŠ¡äº†ï¼Œæˆ‘ä»¬åªéœ€è¦ä½¿ç”¨@Transactionalå°±å¯ä»¥äº†</p>
<h2>mybatis-spring-boot-starter</h2>
<p>å¤§å¤šæ•°æ—¶å€™æˆ‘ä»¬åœ¨SpringBootä¸­ä¼šå¼•å…¥Mybatisè¿™ä¸ªormæ¡†æ¶ï¼ŒMybaitsçš„åœºæ™¯å¯åŠ¨å™¨å¦‚ä¸‹</p>
<src class="cnblogs_code">
<pre><code><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">dependency</span><span style="color: #0000ff;">&gt;</span>
  <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">groupId</span><span style="color: #0000ff;">&gt;</span>org.mybatis.spring.boot<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">groupId</span><span style="color: #0000ff;">&gt;</span>
  <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">artifactId</span><span style="color: #0000ff;">&gt;</span><strong>mybatis-spring-boot-starter</strong><span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">artifactId</span><span style="color: #0000ff;">&gt;</span>
  <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">version</span><span style="color: #0000ff;">&gt;</span>1.3.0<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">version</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">dependency</span><span style="color: #0000ff;">&gt;</span></code></pre>

<p>æˆ‘ä»¬ç‚¹è¿›å»çœ‹çœ‹</p>
<p><img src="./images/SpringBoot æºç è§£æ ï¼ˆå…«ï¼‰----- Spring Boot ç²¾é«“ï¼šäº‹åŠ¡æºç è§£æ3.png" alt="" /></p>
<p>æˆ‘ä»¬çœ‹åˆ°mybatis-spring-boot-starterè¿™ä¸ªåœºæ™¯å¯åŠ¨å™¨æ˜¯å¼•å…¥äº†spring-boot-starter-jdbcè¿™ä¸ªåœºæ™¯å¯åŠ¨å™¨çš„ï¼Œå› æ­¤åªè¦æˆ‘ä»¬åœ¨SpringBootä¸­ä½¿ç”¨Mybaitsï¼Œæ˜¯è‡ªåŠ¨å¸®æˆ‘ä»¬å¼€å¯äº†Springäº‹åŠ¡çš„</p>
<h2>æ€»ç»“</h2>
<p>springboot å¼€å¯äº‹ç‰©å¾ˆç®€å•ï¼Œåªéœ€è¦åŠ ä¸€è¡Œæ³¨è§£<strong>@Transactional</strong>å°±å¯ä»¥äº†ï¼Œå‰æä½ ç”¨çš„æ˜¯jdbctemplate, jpa, Mybatisï¼Œè¿™ç§å¸¸è§çš„ormã€‚</p>
<h2 id="h-24">æ—¥å¸¸æ±‚èµ</h2>
<p>å¥½äº†å„ä½ï¼Œä»¥ä¸Šå°±æ˜¯è¿™ç¯‡æ–‡ç« çš„å…¨éƒ¨å†…å®¹äº†ï¼Œèƒ½çœ‹åˆ°è¿™é‡Œçš„äººå‘€ï¼Œéƒ½æ˜¯äººæ‰ã€‚</p>
<p>å¦‚æœè¿™ä¸ªæ–‡ç« å†™å¾—è¿˜ä¸é”™ï¼Œè§‰å¾—å­¦åˆ°äº†ä¸€ç‚¹ä¸œè¥¿çš„è¯&nbsp;æ±‚ç‚¹èµğŸ‘&nbsp;å¯¹æˆ‘æ¥è¯´çœŸçš„&nbsp;éå¸¸æœ‰ç”¨ï¼ï¼ï¼</p>
<p>åˆ›ä½œä¸æ˜“ï¼Œå„ä½çš„æ”¯æŒå’Œè®¤å¯ï¼Œå°±æ˜¯æˆ‘åˆ›ä½œçš„æœ€å¤§åŠ¨åŠ›ï¼Œæˆ‘ä»¬ä¸‹ç¯‡æ–‡ç« è§ï¼</p>
<p>&nbsp;</p>

</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>