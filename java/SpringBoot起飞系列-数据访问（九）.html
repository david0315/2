<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修SpringBoot起飞系列-数据访问（九）' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>SpringBoot起飞系列-数据访问（九）</center></div><div class='banquan'>原文出处:本文由博客园博主Lookings提供。<br/>
原文连接:https://www.cnblogs.com/lookings/p/11736640.html</div><br>
    <h1>一、前言</h1>
<p>前边我们已经学些了开发的基本流程，最重要的一步来了，怎么样和数据库交互才是最重要的，毕竟没有数据那就相当于什么也没做，本文我们来学习使用springboot整合jdbc、mybatis、jpa等我们常用的数据库持久化技术。</p>
<h1>二、整合jdbc</h1>
<h2>2.1 引入maven依赖</h2>
<p>整合jdbc我们需要两个依赖，一个是starter依赖，一个是mysql驱动（访问数据库驱动肯定是比不可少的），starter中我们指定了要使用的数据源。</p>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span>  <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">dependency</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 2</span>      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">groupId</span><span style="color: #0000ff;">&gt;</span>org.springframework.boot<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">groupId</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 3</span>      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">artifactId</span><span style="color: #0000ff;">&gt;</span>spring-boot-starter-jdbc<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">artifactId</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 4</span>  <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">dependency</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 5</span> 
<span style="color: #008080;"> 6</span>  <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">dependency</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 7</span>      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">groupId</span><span style="color: #0000ff;">&gt;</span>mysql<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">groupId</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 8</span>      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">artifactId</span><span style="color: #0000ff;">&gt;</span>mysql-connector-java<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">artifactId</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 9</span>      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">scope</span><span style="color: #0000ff;">&gt;</span>runtime<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">scope</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">10</span>  <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">dependency</span><span style="color: #0000ff;">&gt;</span></code></pre>

<p>在application.yml或者application.properties中添加配置信息：</p>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #000000;">spring:
</span><span style="color: #008080;">2</span> <span style="color: #000000;">  datasource:
</span><span style="color: #008080;">3</span> <span style="color: #000000;">    username: root
</span><span style="color: #008080;">4</span> <span style="color: #000000;">    password: root
</span><span style="color: #008080;">5</span> <span style="color: #000000;">    url: jdbc:mysql://localhost:3306/jdbctest?serverTimezone=UTC
</span><span style="color: #008080;">6</span>     driver-class-name: com.mysql.cj.jdbc.Driver</code></pre>

<h2>2.2 测试数据库连接</h2>
<p>在test中添加测试代码，来测试我们的数据库是否链接成功。</p>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #000000;">@Autowired
</span><span style="color: #008080;"> 2</span> <span style="color: #000000;">DataSource dataSource;
</span><span style="color: #008080;"> 3</span> 
<span style="color: #008080;"> 4</span> <span style="color: #008000;">//</span><span style="color: #008000;">....</span>
<span style="color: #008080;"> 5</span> <span style="color: #000000;">@Test
</span><span style="color: #008080;"> 6</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> jdbcTest() {
</span><span style="color: #008080;"> 7</span> <span style="color: #000000;">    System.out.println(dataSource.getClass());
</span><span style="color: #008080;"> 8</span>     <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;"> 9</span> <span style="color: #000000;">        System.out.println(dataSource.getConnection());
</span><span style="color: #008080;">10</span>     } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (SQLException e) {
</span><span style="color: #008080;">11</span> <span style="color: #000000;">        e.printStackTrace();
</span><span style="color: #008080;">12</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">13</span> }</code></pre>

<p>springboot整个jdbc，默认使用的是<strong>org.apache.tomcat.jdbc.pool.DataSource</strong>作为数据源，据源的相关配置都在<strong>DataSourceProperties</strong>里面。jdbc的自动配置原理在<strong>org.springframework.boot.autoconfigure.jdbc</strong>下。</p>
<h2>2.3 使用数据</h2>
<p>添加一个aciton，使用JdbcTemplate来查询数据：</p>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #000000;">@Autowired
</span><span style="color: #008080;">2</span> <span style="color: #0000ff;">private</span><span style="color: #000000;"> JdbcTemplate jdbcTemplate;
</span><span style="color: #008080;">3</span> 
<span style="color: #008080;">4</span> @RequestMapping("/query"<span style="color: #000000;">)
</span><span style="color: #008080;">5</span>  <span style="color: #0000ff;">public</span> List&lt;Map&lt;String, Object&gt;&gt;<span style="color: #000000;"> query() {
</span><span style="color: #008080;">6</span>      List&lt;Map&lt;String, Object&gt;&gt; list = jdbcTemplate.queryForList("select * from `user`"<span style="color: #000000;">);
</span><span style="color: #008080;">7</span>      <span style="color: #0000ff;">return</span><span style="color: #000000;"> list;
</span><span style="color: #008080;">8</span>  }</code></pre>

<h2><img style="border: 1px solid black;" src="./images/SpringBoot起飞系列-数据访问（九）0.png" alt="" /></h2>
<h1>三、整合Druid数据源</h1>
<p>这里我们整合Druid数据源，这是阿里巴巴的一个数据，整合之后我们可以跟踪sql日志，查询我们sql的执行情况。</p>
<h2>3.1 添加pom依赖</h2>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #008000;">&lt;!--</span><span style="color: #008000;">引入druid数据源</span><span style="color: #008000;">--&gt;</span>
<span style="color: #008080;">2</span> <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> https://mvnrepository.com/artifact/com.alibaba/druid </span><span style="color: #008000;">--&gt;</span>
<span style="color: #008080;">3</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">dependency</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">4</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">groupId</span><span style="color: #0000ff;">&gt;</span>com.alibaba<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">groupId</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">5</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">artifactId</span><span style="color: #0000ff;">&gt;</span>druid<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">artifactId</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">6</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">version</span><span style="color: #0000ff;">&gt;</span>1.1.8<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">version</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">7</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">dependency</span><span style="color: #0000ff;">&gt;</span></code></pre>

<p>在config下添加一个配置项DruidConfig.java：</p>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.example.demo.config;
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.alibaba.druid.pool.DruidDataSource;
</span><span style="color: #008080;"> 4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.alibaba.druid.support.http.StatViewServlet;
</span><span style="color: #008080;"> 5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.alibaba.druid.support.http.WebStatFilter;
</span><span style="color: #008080;"> 6</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.boot.context.properties.ConfigurationProperties;
</span><span style="color: #008080;"> 7</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.boot.web.servlet.FilterRegistrationBean;
</span><span style="color: #008080;"> 8</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.boot.web.servlet.ServletRegistrationBean;
</span><span style="color: #008080;"> 9</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.context.annotation.Bean;
</span><span style="color: #008080;">10</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.context.annotation.Configuration;
</span><span style="color: #008080;">11</span> 
<span style="color: #008080;">12</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.sql.DataSource;
</span><span style="color: #008080;">13</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.Arrays;
</span><span style="color: #008080;">14</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.HashMap;
</span><span style="color: #008080;">15</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.Map;
</span><span style="color: #008080;">16</span> 
<span style="color: #008080;">17</span> <span style="color: #000000;">@Configuration
</span><span style="color: #008080;">18</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> DruidConfig {
</span><span style="color: #008080;">19</span> 
<span style="color: #008080;">20</span>     @ConfigurationProperties(prefix = "spring.datasource"<span style="color: #000000;">)
</span><span style="color: #008080;">21</span> <span style="color: #000000;">    @Bean
</span><span style="color: #008080;">22</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> DataSource druid(){
</span><span style="color: #008080;">23</span>        <span style="color: #0000ff;">return</span>  <span style="color: #0000ff;">new</span><span style="color: #000000;"> DruidDataSource();
</span><span style="color: #008080;">24</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">25</span> 
<span style="color: #008080;">26</span>     <span style="color: #008000;">//</span><span style="color: #008000;">配置Druid的监控
</span><span style="color: #008080;">27</span>     <span style="color: #008000;">//</span><span style="color: #008000;">1、配置一个管理后台的Servlet</span>
<span style="color: #008080;">28</span> <span style="color: #000000;">    @Bean
</span><span style="color: #008080;">29</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> ServletRegistrationBean statViewServlet(){
</span><span style="color: #008080;">30</span>         ServletRegistrationBean bean = <span style="color: #0000ff;">new</span> ServletRegistrationBean(<span style="color: #0000ff;">new</span> StatViewServlet(), "/druid/*"<span style="color: #000000;">);
</span><span style="color: #008080;">31</span>         Map&lt;String,String&gt; initParams = <span style="color: #0000ff;">new</span> HashMap&lt;&gt;<span style="color: #000000;">();
</span><span style="color: #008080;">32</span> 
<span style="color: #008080;">33</span>         initParams.put("loginUsername","admin"<span style="color: #000000;">);
</span><span style="color: #008080;">34</span>         initParams.put("loginPassword","123456"<span style="color: #000000;">);
</span><span style="color: #008080;">35</span>         initParams.put("allow","");<span style="color: #008000;">//</span><span style="color: #008000;">默认就是允许所有访问</span>
<span style="color: #008080;">36</span>         initParams.put("deny","192.168.15.21"<span style="color: #000000;">);
</span><span style="color: #008080;">37</span> 
<span style="color: #008080;">38</span> <span style="color: #000000;">        bean.setInitParameters(initParams);
</span><span style="color: #008080;">39</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> bean;
</span><span style="color: #008080;">40</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">41</span> 
<span style="color: #008080;">42</span> 
<span style="color: #008080;">43</span>     <span style="color: #008000;">//</span><span style="color: #008000;">2、配置一个web监控的filter</span>
<span style="color: #008080;">44</span> <span style="color: #000000;">    @Bean
</span><span style="color: #008080;">45</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> FilterRegistrationBean webStatFilter(){
</span><span style="color: #008080;">46</span>         FilterRegistrationBean bean = <span style="color: #0000ff;">new</span><span style="color: #000000;"> FilterRegistrationBean();
</span><span style="color: #008080;">47</span>         bean.setFilter(<span style="color: #0000ff;">new</span><span style="color: #000000;"> WebStatFilter());
</span><span style="color: #008080;">48</span> 
<span style="color: #008080;">49</span>         Map&lt;String,String&gt; initParams = <span style="color: #0000ff;">new</span> HashMap&lt;&gt;<span style="color: #000000;">();
</span><span style="color: #008080;">50</span>         initParams.put("exclusions","*.js,*.css,/druid/*"<span style="color: #000000;">);
</span><span style="color: #008080;">51</span> 
<span style="color: #008080;">52</span> <span style="color: #000000;">        bean.setInitParameters(initParams);
</span><span style="color: #008080;">53</span> 
<span style="color: #008080;">54</span>         bean.setUrlPatterns(Arrays.asList("/*"<span style="color: #000000;">));
</span><span style="color: #008080;">55</span> 
<span style="color: #008080;">56</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;">  bean;
</span><span style="color: #008080;">57</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">58</span> }</code></pre>

<p>其中statViewServlet是数据库管理后台，便于我们查看数据sql监控，webStatFilter添加一个过滤来使Druid知道哪些请求（附带sql查询的请求）需要捕获到，以便于记录sql日志。</p>
<p>但是Druid后台默认使用的日志框架是log4j，和当前版本你的springboot的日志框架不一样，直接启动会报错，需要再添加一个依赖。参考：<a href="https://blog.csdn.net/lyn_kk/article/details/89086476">https://blog.csdn.net/lyn_kk/article/details/89086476</a></p>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span>  <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">dependency</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">2</span>      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">groupId</span><span style="color: #0000ff;">&gt;</span>org.slf4j<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">groupId</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">3</span>      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">artifactId</span><span style="color: #0000ff;">&gt;</span>slf4j-log4j12<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">artifactId</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">4</span>  <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">dependency</span><span style="color: #0000ff;">&gt;</span></code></pre>

<h2>3.2 数据源配置参数</h2>
<p>在yml添加Druid数据源额外的参数：</p>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #000000;">spring:
</span><span style="color: #008080;"> 2</span> <span style="color: #000000;">  datasource:
</span><span style="color: #008080;"> 3</span> <span style="color: #000000;">    username: root
</span><span style="color: #008080;"> 4</span> <span style="color: #000000;">    password: root
</span><span style="color: #008080;"> 5</span>     url: jdbc:mysql://localhost:3306/jdbctest?serverTimezone=UTC<span style="color: #ff0000;">&amp;useSSL</span><span style="color: #000000;">=false
</span><span style="color: #008080;"> 6</span> <span style="color: #000000;">    driver-class-name: com.mysql.cj.jdbc.Driver
</span><span style="color: #008080;"> 7</span>     
<span style="color: #008080;"> 8</span> <span style="color: #000000;">    #Druid数据源特有的配置
</span><span style="color: #008080;"> 9</span> <span style="color: #000000;">    initialSize: 5
</span><span style="color: #008080;">10</span> <span style="color: #000000;">    minIdle: 5
</span><span style="color: #008080;">11</span> <span style="color: #000000;">    maxActive: 20
</span><span style="color: #008080;">12</span> <span style="color: #000000;">    maxWait: 60000
</span><span style="color: #008080;">13</span> <span style="color: #000000;">    timeBetweenEvictionRunsMillis: 60000
</span><span style="color: #008080;">14</span> <span style="color: #000000;">    minEvictableIdleTimeMillis: 300000
</span><span style="color: #008080;">15</span> <span style="color: #000000;">    validationQuery: SELECT 1 FROM DUAL
</span><span style="color: #008080;">16</span> <span style="color: #000000;">    testWhileIdle: true
</span><span style="color: #008080;">17</span> <span style="color: #000000;">    testOnBorrow: false
</span><span style="color: #008080;">18</span> <span style="color: #000000;">    testOnReturn: false
</span><span style="color: #008080;">19</span> <span style="color: #000000;">    poolPreparedStatements: true
</span><span style="color: #008080;">20</span> <span style="color: #000000;">    #   配置监控统计拦截的filters，去掉后监控界面sql无法统计，'wall'用于防火墙
</span><span style="color: #008080;">21</span> <span style="color: #000000;">    filters: stat,wall,log4j
</span><span style="color: #008080;">22</span> <span style="color: #000000;">    maxPoolPreparedStatementPerConnectionSize: 20
</span><span style="color: #008080;">23</span> <span style="color: #000000;">    useGlobalDataSourceStat: true
</span><span style="color: #008080;">24</span>     connectionProperties: druid.stat.mergeSql=true;druid.stat.slowSqlMillis=500</code></pre>

<p>启动访问&nbsp;<a href="http://localhost:8080/druid/index.html">http://localhost:8080/druid/index.html</a>可以登录sql管理后台来查看监控，当我们访问一次数据库就会有一次监控。</p>
<p><img style="border: 1px solid black;" src="./images/SpringBoot起飞系列-数据访问（九）1.png" alt="" /></p>
<h1>四、整合Mybatis</h1>
<p>前边我们已经整个了jdbc和druid数据源，下面我们就来使用一个操作数据库的框架，我们之前所熟悉的mybatis也整合进来。</p>
<h2>4.1 添加依赖</h2>
<p>接上边的依赖配置，我们添加mybatis的依赖：</p>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #008000;">&lt;!--</span><span style="color: #008000;">引入mybatis</span><span style="color: #008000;">--&gt;</span>
<span style="color: #008080;">2</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">dependency</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">3</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">groupId</span><span style="color: #0000ff;">&gt;</span>org.mybatis.spring.boot<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">groupId</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">4</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">artifactId</span><span style="color: #0000ff;">&gt;</span>mybatis-spring-boot-starter<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">artifactId</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">5</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">version</span><span style="color: #0000ff;">&gt;</span>1.3.1<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">version</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">6</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">dependency</span><span style="color: #0000ff;">&gt;</span></code></pre>

<h2>4.2 添加Mapper（注解版）</h2>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.example.demo.mapper;
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.example.demo.domain.Department;
</span><span style="color: #008080;"> 4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.apache.ibatis.annotations.Mapper;
</span><span style="color: #008080;"> 5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.apache.ibatis.annotations.Select;
</span><span style="color: #008080;"> 6</span> 
<span style="color: #008080;"> 7</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.List;
</span><span style="color: #008080;"> 8</span> 
<span style="color: #008080;"> 9</span> 
<span style="color: #008080;">10</span> <span style="color: #000000;">@Mapper
</span><span style="color: #008080;">11</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">interface</span><span style="color: #000000;"> DepartmentMapper {
</span><span style="color: #008080;">12</span> 
<span style="color: #008080;">13</span>     @Select("select * from department"<span style="color: #000000;">)
</span><span style="color: #008080;">14</span>     List&lt;Department&gt;<span style="color: #000000;"> getAll();
</span><span style="color: #008080;">15</span> 
<span style="color: #008080;">16</span>     @Select("select * from department where id=#{id}"<span style="color: #000000;">)
</span><span style="color: #008080;">17</span> <span style="color: #000000;">    Department getById(Integer id);
</span><span style="color: #008080;">18</span> 
<span style="color: #008080;">19</span> }</code></pre>

<p>添加对应的实体：</p>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> Department {
</span><span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> Integer id;
</span><span style="color: #008080;"> 3</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;">  String name;
</span><span style="color: #008080;"> 4</span> 
<span style="color: #008080;"> 5</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> Integer getId() {
</span><span style="color: #008080;"> 6</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> id;
</span><span style="color: #008080;"> 7</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 8</span> 
<span style="color: #008080;"> 9</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> setId(Integer id) {
</span><span style="color: #008080;">10</span>         <span style="color: #0000ff;">this</span>.id =<span style="color: #000000;"> id;
</span><span style="color: #008080;">11</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">12</span> 
<span style="color: #008080;">13</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> String getName() {
</span><span style="color: #008080;">14</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> name;
</span><span style="color: #008080;">15</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">16</span> 
<span style="color: #008080;">17</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> setName(String name) {
</span><span style="color: #008080;">18</span>         <span style="color: #0000ff;">this</span>.name =<span style="color: #000000;"> name;
</span><span style="color: #008080;">19</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">20</span> 
<span style="color: #008080;">21</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> Department() {
</span><span style="color: #008080;">22</span> 
<span style="color: #008080;">23</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">24</span> 
<span style="color: #008080;">25</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> Department(Integer id, String name) {
</span><span style="color: #008080;">26</span>         <span style="color: #0000ff;">this</span>.id =<span style="color: #000000;"> id;
</span><span style="color: #008080;">27</span>         <span style="color: #0000ff;">this</span>.name =<span style="color: #000000;"> name;
</span><span style="color: #008080;">28</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">29</span> 
<span style="color: #008080;">30</span> <span style="color: #000000;">    @Override
</span><span style="color: #008080;">31</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> String toString() {
</span><span style="color: #008080;">32</span>         <span style="color: #0000ff;">return</span> "Department{" +
<span style="color: #008080;">33</span>                 "id=" + id +
<span style="color: #008080;">34</span>                 ", name='" + name + '\'' +
<span style="color: #008080;">35</span>                 '}'<span style="color: #000000;">;
</span><span style="color: #008080;">36</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">37</span> }</code></pre>

<h2>4.3 添加控制器访问</h2>
<src class="cnblogs_code">
<pre><code><span style="color: #000000;">@RestController
@RequestMapping(</span>"/dept"<span style="color: #000000;">)
</span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> DepartmentController {

    @Autowired
    DepartmentMapper departmentMapper;


    @GetMapping(</span>"list"<span style="color: #000000;">)
    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> Object getAll(){
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> departmentMapper.getAll();
    }

    @GetMapping(</span>"{id}"<span style="color: #000000;">)
    </span><span style="color: #0000ff;">public</span> Object getById(@PathVariable("id"<span style="color: #000000;">) Integer id){
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> departmentMapper.getById(id);
    }
}</span></code></pre>

<p>访问地址：<a href="http://localhost:8080/dept/1">http://localhost:8080/dept/1</a></p>
<p><img style="border: 1px solid black;" src="./images/SpringBoot起飞系列-数据访问（九）2.png" alt="" /></p>
<p>使用<strong>@MapperScan</strong>注解指定包名，可以把该包下边的所有类注册为Mapper，使我们不用再每个类型写注解@Mapper。</p>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #008000;">//</span><span style="color: #008000;">使用MapperScan批量扫描所有的Mapper接口；</span>
<span style="color: #008080;"> 2</span> @MapperScan(value = "com.example.demo.mapper"<span style="color: #000000;">)
</span><span style="color: #008080;"> 3</span> <span style="color: #000000;">@SpringBootApplication
</span><span style="color: #008080;"> 4</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> DemoApplication {
</span><span style="color: #008080;"> 5</span> 
<span style="color: #008080;"> 6</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> main(String[] args) {
</span><span style="color: #008080;"> 7</span>         SpringApplication.run(DemoApplication.<span style="color: #0000ff;">class</span><span style="color: #000000;">, args);
</span><span style="color: #008080;"> 8</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 9</span> 
<span style="color: #008080;">10</span> }</code></pre>

<h2>4.4 Xml配置版</h2>
<p>我们可以在类路径下添加传统的mybatis配置文件，并在application.yml添加如下配置就可以实现配置文件方式的mybatis。</p>
<src class="cnblogs_code">
<pre><code>mybatis:
  config-location: classpath:mybatis/mybatis-config.xml 指定全局配置文件的位置
  mapper-locations: classpath:mybatis/mapper/*.xml  指定sql映射文件的位置</code></pre>

<h1>五、整合SpringData JPA</h1>
<h2>5.1 什么是SpringData JPA</h2>
<p>JPA(Java Persistence API)是Sun官方提出的Java持久化规范. 为Java开发人员提供了一种对象/关联映射工具来管理Java应用中的关系数据. 它的出现是为了简化现有的持久化开发工作和整合ORM技术. 结束各个ORM框架各自为营的局面。</p>
<p>JPA仅仅是一套规范,不是一套产品, 也就是说Hibernate, TopLink等是实现了JPA规范的一套产品。</p>
<p>Spring Data JPA是Spring基于ORM框架、JPA规范的基础上封装的一套JPA应用框架,是基于Hibernate之上构建的JPA使用解决方案,用极简的代码实现了对数据库的访问和操作,包括了增、删、改、查等在内的常用功能。</p>
<p>除此之外还有SpringData Redis、SpringData MongoDb。</p>
<p><img style="border: 1px solid black;" src="./images/SpringBoot起飞系列-数据访问（九）3.png" alt="" /></p>
<h2>5.2 引入依赖</h2>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span>  <span style="color: #008000;">&lt;!--</span><span style="color: #008000;">整合jdbc</span><span style="color: #008000;">--&gt;</span>
<span style="color: #008080;"> 2</span>  <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">dependency</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 3</span>      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">groupId</span><span style="color: #0000ff;">&gt;</span>org.springframework.boot<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">groupId</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 4</span>      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">artifactId</span><span style="color: #0000ff;">&gt;</span>spring-boot-starter-jdbc<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">artifactId</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 5</span>  <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">dependency</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 6</span>  <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">dependency</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 7</span>      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">groupId</span><span style="color: #0000ff;">&gt;</span>mysql<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">groupId</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 8</span>      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">artifactId</span><span style="color: #0000ff;">&gt;</span>mysql-connector-java<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">artifactId</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 9</span>      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">scope</span><span style="color: #0000ff;">&gt;</span>runtime<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">scope</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">10</span>  <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">dependency</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">11</span> 
<span style="color: #008080;">12</span> 
<span style="color: #008080;">13</span>  <span style="color: #008000;">&lt;!--</span><span style="color: #008000;">引入springdata jpa</span><span style="color: #008000;">--&gt;</span>
<span style="color: #008080;">14</span>  <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">dependency</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">15</span>      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">groupId</span><span style="color: #0000ff;">&gt;</span>org.springframework.boot<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">groupId</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">16</span>      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">artifactId</span><span style="color: #0000ff;">&gt;</span>spring-boot-starter-data-jpa<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">artifactId</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">17</span>  <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">dependency</span><span style="color: #0000ff;">&gt;</span></code></pre>

<p>其中前两个都是访问数据库不可缺少的依赖，在整合mybatis的时候也有。</p>
<h2>5.3 添加实体类</h2>
<p>添加一个User类，添加相应注解，SpringData JPA会自动生成到数据库表。</p>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.example.demo.domain;
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span> javax.persistence.*<span style="color: #000000;">;
</span><span style="color: #008080;"> 4</span> 
<span style="color: #008080;"> 5</span> <span style="color: #000000;">@Entity
</span><span style="color: #008080;"> 6</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> User {
</span><span style="color: #008080;"> 7</span> 
<span style="color: #008080;"> 8</span>     @Id <span style="color: #008000;">//</span><span style="color: #008000;">表名这是一个主键</span>
<span style="color: #008080;"> 9</span>     @Column() <span style="color: #008000;">//</span><span style="color: #008000;">是数据库中的列，默认不写把属性名自动作为列，使用注解可以指定列明</span>
<span style="color: #008080;">10</span>     @GeneratedValue(strategy = GenerationType.IDENTITY) <span style="color: #008000;">//</span><span style="color: #008000;">主键自增</span>
<span style="color: #008080;">11</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;">  Integer id;
</span><span style="color: #008080;">12</span> 
<span style="color: #008080;">13</span>     @Column(name = "user_name",length = 50) <span style="color: #008000;">//</span><span style="color: #008000;">这是和数据表对应的一个列</span>
<span style="color: #008080;">14</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;">  String name;
</span><span style="color: #008080;">15</span> 
<span style="color: #008080;">16</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;">  String  email;
</span><span style="color: #008080;">17</span> 
<span style="color: #008080;">18</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> String getEmail() {
</span><span style="color: #008080;">19</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> email;
</span><span style="color: #008080;">20</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">21</span> 
<span style="color: #008080;">22</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> setEmail(String email) {
</span><span style="color: #008080;">23</span>         <span style="color: #0000ff;">this</span>.email =<span style="color: #000000;"> email;
</span><span style="color: #008080;">24</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">25</span> 
<span style="color: #008080;">26</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> Integer getId() {
</span><span style="color: #008080;">27</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> id;
</span><span style="color: #008080;">28</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">29</span> 
<span style="color: #008080;">30</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> setId(Integer id) {
</span><span style="color: #008080;">31</span>         <span style="color: #0000ff;">this</span>.id =<span style="color: #000000;"> id;
</span><span style="color: #008080;">32</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">33</span> 
<span style="color: #008080;">34</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> String getName() {
</span><span style="color: #008080;">35</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> name;
</span><span style="color: #008080;">36</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">37</span> 
<span style="color: #008080;">38</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> setName(String name) {
</span><span style="color: #008080;">39</span>         <span style="color: #0000ff;">this</span>.name =<span style="color: #000000;"> name;
</span><span style="color: #008080;">40</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">41</span> }</code></pre>

<h2>5.4 添加一个仓储</h2>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.example.demo.repository;
</span><span style="color: #008080;">2</span> 
<span style="color: #008080;">3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.example.demo.domain.User;
</span><span style="color: #008080;">4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.data.jpa.repository.JpaRepository;
</span><span style="color: #008080;">5</span> 
<span style="color: #008080;">6</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">interface</span> UserRepository <span style="color: #0000ff;">extends</span> JpaRepository&lt;User,Integer&gt;<span style="color: #000000;"> {
</span><span style="color: #008080;">7</span> 
<span style="color: #008080;">8</span> }</code></pre>

<p>只要继承了JpaRepository&lt;User,Integer&gt;就行了，里边有封装好自带的访问数据库的方法。</p>
<h2>5.5 添加一个控制器</h2>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #000000;">@RestController
</span><span style="color: #008080;"> 2</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> UserController {
</span><span style="color: #008080;"> 3</span> 
<span style="color: #008080;"> 4</span> <span style="color: #000000;">    @Autowired
</span><span style="color: #008080;"> 5</span> <span style="color: #000000;">    UserRepository userRepository;
</span><span style="color: #008080;"> 6</span> 
<span style="color: #008080;"> 7</span>     @GetMapping("/user/{id}"<span style="color: #000000;">)
</span><span style="color: #008080;"> 8</span>     <span style="color: #0000ff;">public</span> User getUser(@PathVariable("id"<span style="color: #000000;">) Integer id){
</span><span style="color: #008080;"> 9</span>         Optional&lt;User&gt; optional =<span style="color: #000000;"> userRepository.findById(id);
</span><span style="color: #008080;">10</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> optional.get();
</span><span style="color: #008080;">11</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">12</span> 
<span style="color: #008080;">13</span>     @GetMapping("/user"<span style="color: #000000;">)
</span><span style="color: #008080;">14</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;">  User insertUser(User user){
</span><span style="color: #008080;">15</span>         User save =<span style="color: #000000;"> userRepository.save(user);
</span><span style="color: #008080;">16</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> save;
</span><span style="color: #008080;">17</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">18</span> }</code></pre>

<p>里边有一个插入的方法和一个获取的方法，我们可以先插入在访问获取方法。</p>
<p>访问：<a href="http://localhost:8080/user?name=dsff&amp;email=526457385@qq.com">http://localhost:8080/user?name=dsff&amp;email=526457385@qq.com</a>来插入数据，访问：<a href="http://localhost:8080/user/1">http://localhost:8080/user/1</a>来获取数据。</p>
<h1>六、总结</h1>
<p>以上就是springboot对数据库访问的整合了，基本上学到这里就可以完全的使用springboot进行开发了，其他的一些细节问题会开发过程中遇见的时候再进行学习就行了。</p>

</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>