<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修(二)springMvc原理和手写springMvc框架' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>(二)springMvc原理和手写springMvc框架</center></div><div class='banquan'>原文出处:本文由博客园博主咸鱼也要有梦想提供。<br/>
原文连接:https://www.cnblogs.com/hang-on/p/11419298.html</div><br>
    <h4 style="margin-left: 30px;">我们从两个方面了解springmvc执行原理，首先我们去熟悉springmvc执行的过程，然后知道原理后通过手写springmvc去深入了解代码中执行过程。</h4>
<h3 style="margin-left: 30px;">（一）SpringMVC流程图</h3>
<p><img src="./images/(二)springMvc原理和手写springMvc框架0.png" alt="" /></p>
<h3 style="margin-left: 30px;">(二)SpringMVC流程</h3>
<p style="margin-left: 30px;" align="left">1、&nbsp; 用户发送请求至前端控制器DispatcherServlet。</p>
<p style="margin-left: 30px;" align="left">2、&nbsp; DispatcherServlet收到请求调用HandlerMapping处理器映射器。</p>
<p style="margin-left: 30px;" align="left">3、&nbsp; 处理器映射器找到具体的处理器(可以根据xml配置、注解进行查找)，生成处理器对象及处理器拦截器(如果有则生成)一并返回给DispatcherServlet。</p>
<p style="margin-left: 30px;" align="left">4、&nbsp; DispatcherServlet调用HandlerAdapter处理器适配器。</p>
<p style="margin-left: 30px;" align="left">5、&nbsp; HandlerAdapter经过适配调用具体的处理器(Controller，也叫后端控制器)。</p>
<p style="margin-left: 30px;" align="left">6、&nbsp; Controller执行完成返回ModelAndView。</p>
<p style="margin-left: 30px;" align="left">7、&nbsp; HandlerAdapter将controller执行结果ModelAndView返回给DispatcherServlet。</p>
<p style="margin-left: 30px;" align="left">8、&nbsp; DispatcherServlet将ModelAndView传给ViewReslover视图解析器。</p>
<p style="margin-left: 30px;" align="left">9、&nbsp; ViewReslover解析后返回具体View。</p>
<p style="margin-left: 30px;" align="left">10、DispatcherServlet根据View进行渲染视图（即将模型数据填充至视图中）。</p>
<p style="margin-left: 30px;" align="left">11、 DispatcherServlet响应用户。</p>
<h3 style="margin-left: 30px;">（三）SpringMVC核心组件讲解</h3>
<p style="margin-left: 30px;"><strong>1、前端控制器DispatcherServlet</strong><br />作用：接收请求，响应结果，相当于转发器，中央处理器。有了dispatcherServlet减少了其它组件之间的耦合度。<br />用户请求到达前端控制器，它就相当于mvc模式中的c，dispatcherServlet是整个流程控制的中心，由它调用其它组件处理用户的请求，dispatcherServlet的存在降低了组件之间的耦合性。</p>
<p style="margin-left: 30px;"><strong>2、处理器映射器HandlerMapping</strong><br />作用：根据请求的url查找Handler<br />HandlerMapping负责根据用户请求找到Handler即处理器，springmvc提供了不同的映射器实现不同的映射方式，例如：配置文件方式，实现接口方式，注解方式等。</p>
<p style="margin-left: 30px;"><strong>3、处理器适配器HandlerAdapter</strong><br />作用：按照特定规则（HandlerAdapter要求的规则）去执行Handler<br />通过HandlerAdapter对处理器进行执行，这是适配器模式的应用，通过扩展适配器可以对更多类型的处理器进行执行。</p>
<p style="margin-left: 30px;"><strong>4、处理器Handler</strong><br />Handler 是继DispatcherServlet前端控制器的后端控制器，在DispatcherServlet的控制下Handler对具体的用户请求进行处理。<br />由于Handler涉及到具体的用户业务请求，所以一般情况需要工程师根据业务需求开发Handler。</p>
<p style="margin-left: 30px;"><strong>5、视图解析器View resolver(不需要工程师开发),由框架提供</strong><br />作用：进行视图解析，根据逻辑视图名解析成真正的视图（view）<br />View Resolver负责将处理结果生成View视图，View Resolver首先根据逻辑视图名解析成物理视图名即具体的页面地址，再生成View视图对象，最后对View进行渲染将处理结果通过页面展示给用户。 springmvc框架提供了很多的View视图类型，包括：jstlView、freemarkerView、pdfView等。<br />一般情况下需要通过页面标签或页面模版技术将模型数据通过页面展示给用户，需要由工程师根据业务需求开发具体的页面。</p>
<p style="margin-left: 30px;"><strong>6、视图View</strong><br />View是一个接口，实现类支持不同的View类型（jsp、freemarker、pdf...）</p>
<h3 style="margin-left: 30px;">（四）手写springMvc框架思路：</h3>
<p style="margin-left: 30px;">1、配置web.xml，加载自定义的DispatcherServlet。</p>
<p style="margin-left: 30px;">2、初始化阶段，在DispatcherServlet类中，实现下面几个步骤：</p>
<ol>
<li style="list-style-type: none;"><ol>
<li>加载配置类。</li>
<li>扫描当前项目下的所有文件。</li>
<li>拿到扫描到的类，通过反射机制，实例化。并且放到ioc容器中。</li>
<li>初始化path与方法的映射。</li>
<li>获取请求传入的参数并处理参数通过初始化好的handlerMapping中拿出url对应的方法名，反射调用。</li>

















</ol></li>

















</ol>
<p style="margin-left: 30px;">3、运行阶段，每一次请求将会调用doGet或doPost方法，它会根据url请求去HandlerMapping中匹配到对应的Method，然后利用反射机制调用Controller中的url对应的方法，并得到结果返回。</p>
<h3 style="margin-left: 30px;">（五）代码阶段：</h3>
<p style="margin-left: 30px;">1.web.xm加载</p>
<src class="cnblogs_code" onclick="cnblogs_code_show('0913e03b-e514-4d8e-9ba4-d223a455d9ac')"><img id="code_img_closed_0913e03b-e514-4d8e-9ba4-d223a455d9ac" class="code_img_closed" src="./images/(二)springMvc原理和手写springMvc框架1.png" alt="" /><img id="code_img_opened_0913e03b-e514-4d8e-9ba4-d223a455d9ac" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('0913e03b-e514-4d8e-9ba4-d223a455d9ac',event)" src="./images/(二)springMvc原理和手写springMvc框架2.png" alt="" />
<src id="cnblogs_code_open_0913e03b-e514-4d8e-9ba4-d223a455d9ac" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;?</span><span style="color: #ff00ff;">xml version="1.0" encoding="UTF-8"</span><span style="color: #0000ff;">?&gt;</span>
<span style="color: #008080;"> 2</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">web-app </span><span style="color: #ff0000;">xmlns:xsi</span><span style="color: #0000ff;">="http://www.w3.org/2001/XMLSchema-instance"</span><span style="color: #ff0000;"> xmlns</span><span style="color: #0000ff;">="http://java.sun.com/xml/ns/javaee"</span><span style="color: #ff0000;"> xsi:schemaLocation</span><span style="color: #0000ff;">="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span><span style="color: #ff0000;"> version</span><span style="color: #0000ff;">="2.5"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 3</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">display-name</span><span style="color: #0000ff;">&gt;</span>maven_handmvc<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">display-name</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 4</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">servlet</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 5</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">servlet-name</span><span style="color: #0000ff;">&gt;</span>DispatcherServlet<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">servlet-name</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 6</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">servlet-class</span><span style="color: #0000ff;">&gt;</span>com.zzw.cn.springmvc.dispathcer.DispatcherServlet<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">servlet-class</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 7</span>   <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">servlet</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 8</span>   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">servlet-mapping</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 9</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">servlet-name</span><span style="color: #0000ff;">&gt;</span>DispatcherServlet<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">servlet-name</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">10</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">url-pattern</span><span style="color: #0000ff;">&gt;</span>/<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">url-pattern</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">11</span>   <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">servlet-mapping</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">12</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">web-app</span><span style="color: #0000ff;">&gt;</span></code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<p style="margin-left: 30px;">&nbsp;&nbsp;2.自定义DispatcherServlet</p>
<src class="cnblogs_code" onclick="cnblogs_code_show('7f19110f-4168-47cf-b4d0-877c7c6166c2')"><img id="code_img_closed_7f19110f-4168-47cf-b4d0-877c7c6166c2" class="code_img_closed" src="./images/(二)springMvc原理和手写springMvc框架1.png" alt="" /><img id="code_img_opened_7f19110f-4168-47cf-b4d0-877c7c6166c2" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('7f19110f-4168-47cf-b4d0-877c7c6166c2',event)" src="./images/(二)springMvc原理和手写springMvc框架2.png" alt="" />
<src id="cnblogs_code_open_7f19110f-4168-47cf-b4d0-877c7c6166c2" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;">  1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.zzw.cn.springmvc.dispathcer;
</span><span style="color: #008080;">  2</span> 
<span style="color: #008080;">  3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.zzw.cn.springmvc.annoation.AnController;
</span><span style="color: #008080;">  4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.zzw.cn.springmvc.annoation.AnRequestMapping;
</span><span style="color: #008080;">  5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.zzw.cn.utils.ClassUtils;
</span><span style="color: #008080;">  6</span> 
<span style="color: #008080;">  7</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.ServletConfig;
</span><span style="color: #008080;">  8</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.ServletException;
</span><span style="color: #008080;">  9</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.http.HttpServlet;
</span><span style="color: #008080;"> 10</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.http.HttpServletRequest;
</span><span style="color: #008080;"> 11</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.http.HttpServletResponse;
</span><span style="color: #008080;"> 12</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.IOException;
</span><span style="color: #008080;"> 13</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.lang.reflect.InvocationTargetException;
</span><span style="color: #008080;"> 14</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.lang.reflect.Method;
</span><span style="color: #008080;"> 15</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.List;
</span><span style="color: #008080;"> 16</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.Map;
</span><span style="color: #008080;"> 17</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.concurrent.ConcurrentHashMap;
</span><span style="color: #008080;"> 18</span> 
<span style="color: #008080;"> 19</span> <span style="color: #008000;">/**</span>
<span style="color: #008080;"> 20</span> <span style="color: #008000;"> * </span><span style="color: #808080;">@author</span><span style="color: #008000;"> Simple
</span><span style="color: #008080;"> 21</span> <span style="color: #008000;"> * @date 14:34 2019/8/26
</span><span style="color: #008080;"> 22</span> <span style="color: #008000;"> * @description 手写springmvc框架流程
</span><span style="color: #008080;"> 23</span> <span style="color: #008000;"> * &lt;p&gt;
</span><span style="color: #008080;"> 24</span> <span style="color: #008000;"> * 思路:自定义DispatcherServlet
</span><span style="color: #008080;"> 25</span> <span style="color: #008000;"> * 1.包扫描获取包下面所有的类
</span><span style="color: #008080;"> 26</span> <span style="color: #008000;"> * 2.初始化包下面所有的类
</span><span style="color: #008080;"> 27</span> <span style="color: #008000;"> * 3.初始化HandlerMapping方法,将url和方法对应上
</span><span style="color: #008080;"> 28</span> <span style="color: #008000;"> * 4.实现HttpServlet 重写dopost方法
</span><span style="color: #008080;"> 29</span>  <span style="color: #008000;">*/</span>
<span style="color: #008080;"> 30</span> 
<span style="color: #008080;"> 31</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> DispatcherServlet <span style="color: #0000ff;">extends</span><span style="color: #000000;"> HttpServlet {
</span><span style="color: #008080;"> 32</span> 
<span style="color: #008080;"> 33</span>     <span style="color: #008000;">//</span><span style="color: #008000;">springmvc 容器存放bean</span>
<span style="color: #008080;"> 34</span>     <span style="color: #0000ff;">private</span> ConcurrentHashMap&lt;String, Object&gt; mvcBeans = <span style="color: #0000ff;">new</span> ConcurrentHashMap&lt;&gt;<span style="color: #000000;">();
</span><span style="color: #008080;"> 35</span>     <span style="color: #0000ff;">private</span> ConcurrentHashMap&lt;String, Object&gt; mvcBeanUrl = <span style="color: #0000ff;">new</span> ConcurrentHashMap&lt;&gt;<span style="color: #000000;">();
</span><span style="color: #008080;"> 36</span>     <span style="color: #0000ff;">private</span> ConcurrentHashMap&lt;String, String&gt; mvcMethodUrl = <span style="color: #0000ff;">new</span> ConcurrentHashMap&lt;&gt;<span style="color: #000000;">();
</span><span style="color: #008080;"> 37</span> 
<span style="color: #008080;"> 38</span> 
<span style="color: #008080;"> 39</span> <span style="color: #000000;">    @Override
</span><span style="color: #008080;"> 40</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> init(ServletConfig config) {
</span><span style="color: #008080;"> 41</span>         String packagePath = "com.zzw.cn.springmvc"<span style="color: #000000;">;
</span><span style="color: #008080;"> 42</span>         <span style="color: #008000;">//</span><span style="color: #008000;">1.进行报扫描获取当前包下面所有的类</span>
<span style="color: #008080;"> 43</span>         List&lt;Class&lt;?&gt;&gt; classes =<span style="color: #000000;"> comscanPackage(packagePath);
</span><span style="color: #008080;"> 44</span>         <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;"> 45</span>             <span style="color: #008000;">//</span><span style="color: #008000;">2.初始化springmvcbean</span>
<span style="color: #008080;"> 46</span> <span style="color: #000000;">            initSpringMvcBean(classes);
</span><span style="color: #008080;"> 47</span>         } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (Exception e) {
</span><span style="color: #008080;"> 48</span> <span style="color: #000000;">            e.printStackTrace();
</span><span style="color: #008080;"> 49</span> <span style="color: #000000;">        }
</span><span style="color: #008080;"> 50</span>         <span style="color: #008000;">//</span><span style="color: #008000;">3.将请求地址和方法进行映射</span>
<span style="color: #008080;"> 51</span> <span style="color: #000000;">        initHandMapping(mvcBeans);
</span><span style="color: #008080;"> 52</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 53</span> 
<span style="color: #008080;"> 54</span> 
<span style="color: #008080;"> 55</span>     <span style="color: #0000ff;">public</span> List&lt;Class&lt;?&gt;&gt;<span style="color: #000000;"> comscanPackage(String packagePath) {
</span><span style="color: #008080;"> 56</span>         List&lt;Class&lt;?&gt;&gt; classes =<span style="color: #000000;"> ClassUtils.getClasses(packagePath);
</span><span style="color: #008080;"> 57</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> classes;
</span><span style="color: #008080;"> 58</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 59</span> 
<span style="color: #008080;"> 60</span>     <span style="color: #008000;">/**</span>
<span style="color: #008080;"> 61</span> <span style="color: #008000;">     * 初始化sprignbean
</span><span style="color: #008080;"> 62</span> <span style="color: #008000;">     *
</span><span style="color: #008080;"> 63</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> classes
</span><span style="color: #008080;"> 64</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@throws</span><span style="color: #008000;"> Exception
</span><span style="color: #008080;"> 65</span>      <span style="color: #008000;">*/</span>
<span style="color: #008080;"> 66</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> initSpringMvcBean(List&lt;Class&lt;?&gt;&gt; classes) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> Exception {
</span><span style="color: #008080;"> 67</span>         <span style="color: #0000ff;">if</span> (classes.size() == 0 || <span style="color: #0000ff;">null</span> ==<span style="color: #000000;"> classes) {
</span><span style="color: #008080;"> 68</span>             <span style="color: #0000ff;">throw</span> <span style="color: #0000ff;">new</span> Exception("包扫描后的classes为null"<span style="color: #000000;">);
</span><span style="color: #008080;"> 69</span> <span style="color: #000000;">        }
</span><span style="color: #008080;"> 70</span> 
<span style="color: #008080;"> 71</span>         <span style="color: #0000ff;">for</span> (Class&lt;?&gt;<span style="color: #000000;"> aClass : classes) {
</span><span style="color: #008080;"> 72</span>             <span style="color: #008000;">//</span><span style="color: #008000;">获取被自定义注解的controller将其初始化到自定义sprignmvc容器中</span>
<span style="color: #008080;"> 73</span>             AnController declaredAnnotation = aClass.getDeclaredAnnotation(AnController.<span style="color: #0000ff;">class</span><span style="color: #000000;">);
</span><span style="color: #008080;"> 74</span>             <span style="color: #0000ff;">if</span> (declaredAnnotation != <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
</span><span style="color: #008080;"> 75</span>                 <span style="color: #008000;">//</span><span style="color: #008000;">获取类的名字</span>
<span style="color: #008080;"> 76</span>                 String beanid =<span style="color: #000000;"> lowerFirstCapse(aClass.getSimpleName());
</span><span style="color: #008080;"> 77</span>                 <span style="color: #008000;">//</span><span style="color: #008000;">获取对象</span>
<span style="color: #008080;"> 78</span>                 Object beanObj =<span style="color: #000000;"> aClass.newInstance();
</span><span style="color: #008080;"> 79</span>                 <span style="color: #008000;">//</span><span style="color: #008000;">放入sprign容器</span>
<span style="color: #008080;"> 80</span> <span style="color: #000000;">                mvcBeans.put(beanid, beanObj);
</span><span style="color: #008080;"> 81</span> <span style="color: #000000;">            }
</span><span style="color: #008080;"> 82</span> <span style="color: #000000;">        }
</span><span style="color: #008080;"> 83</span> 
<span style="color: #008080;"> 84</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 85</span> 
<span style="color: #008080;"> 86</span>     <span style="color: #008000;">/**</span>
<span style="color: #008080;"> 87</span> <span style="color: #008000;">     * 初始化HandlerMapping方法
</span><span style="color: #008080;"> 88</span> <span style="color: #008000;">     *
</span><span style="color: #008080;"> 89</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> mvcBeans
</span><span style="color: #008080;"> 90</span>      <span style="color: #008000;">*/</span>
<span style="color: #008080;"> 91</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> initHandMapping(ConcurrentHashMap&lt;String, Object&gt;<span style="color: #000000;"> mvcBeans) {
</span><span style="color: #008080;"> 92</span>         <span style="color: #008000;">//</span><span style="color: #008000;">遍历springmvc 获取注入的对象值</span>
<span style="color: #008080;"> 93</span>         <span style="color: #0000ff;">for</span> (Map.Entry&lt;String, Object&gt;<span style="color: #000000;"> entry : mvcBeans.entrySet()) {
</span><span style="color: #008080;"> 94</span>             Object objValue =<span style="color: #000000;"> entry.getValue();
</span><span style="color: #008080;"> 95</span>             Class&lt;?&gt; aClass =<span style="color: #000000;"> objValue.getClass();
</span><span style="color: #008080;"> 96</span>             <span style="color: #008000;">//</span><span style="color: #008000;">获取当前类 判断是否有自定义的requestMapping注解</span>
<span style="color: #008080;"> 97</span>             String mappingUrl = <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 98</span>             AnRequestMapping anRequestMapping = aClass.getDeclaredAnnotation(AnRequestMapping.<span style="color: #0000ff;">class</span><span style="color: #000000;">);
</span><span style="color: #008080;"> 99</span>             <span style="color: #0000ff;">if</span> (anRequestMapping != <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
</span><span style="color: #008080;">100</span>                 mappingUrl =<span style="color: #000000;"> anRequestMapping.value();
</span><span style="color: #008080;">101</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">102</span>             <span style="color: #008000;">//</span><span style="color: #008000;">获取当前类所有方法,判断方法上是否有注解</span>
<span style="color: #008080;">103</span>             Method[] declaredMethods =<span style="color: #000000;"> aClass.getDeclaredMethods();
</span><span style="color: #008080;">104</span>             <span style="color: #0000ff;">for</span><span style="color: #000000;"> (Method method : declaredMethods) {
</span><span style="color: #008080;">105</span>                 AnRequestMapping methodDeclaredAnnotation = method.getDeclaredAnnotation(AnRequestMapping.<span style="color: #0000ff;">class</span><span style="color: #000000;">);
</span><span style="color: #008080;">106</span>                 <span style="color: #0000ff;">if</span> (methodDeclaredAnnotation != <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
</span><span style="color: #008080;">107</span>                     String methodUrl =<span style="color: #000000;"> methodDeclaredAnnotation.value();
</span><span style="color: #008080;">108</span>                     mvcBeanUrl.put(mappingUrl +<span style="color: #000000;"> methodUrl, objValue);
</span><span style="color: #008080;">109</span>                     mvcMethodUrl.put(mappingUrl +<span style="color: #000000;"> methodUrl, method.getName());
</span><span style="color: #008080;">110</span> <span style="color: #000000;">                }
</span><span style="color: #008080;">111</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">112</span> 
<span style="color: #008080;">113</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">114</span> 
<span style="color: #008080;">115</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">116</span> 
<span style="color: #008080;">117</span>     <span style="color: #008000;">/**</span>
<span style="color: #008080;">118</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> str
</span><span style="color: #008080;">119</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@return</span><span style="color: #008000;"> 类名首字母小写
</span><span style="color: #008080;">120</span>      <span style="color: #008000;">*/</span>
<span style="color: #008080;">121</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span><span style="color: #000000;"> String lowerFirstCapse(String str) {
</span><span style="color: #008080;">122</span>         <span style="color: #0000ff;">char</span>[] chars =<span style="color: #000000;"> str.toCharArray();
</span><span style="color: #008080;">123</span>         chars[0] += 32<span style="color: #000000;">;
</span><span style="color: #008080;">124</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> String.valueOf(chars);
</span><span style="color: #008080;">125</span> 
<span style="color: #008080;">126</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">127</span> 
<span style="color: #008080;">128</span> <span style="color: #000000;">    @Override
</span><span style="color: #008080;">129</span>     <span style="color: #0000ff;">protected</span> <span style="color: #0000ff;">void</span> doPost(HttpServletRequest req, HttpServletResponse resp) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> ServletException, IOException {
</span><span style="color: #008080;">130</span>         <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;">131</span> <span style="color: #000000;">            doServelt(req, resp);
</span><span style="color: #008080;">132</span>         } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (NoSuchMethodException e) {
</span><span style="color: #008080;">133</span> <span style="color: #000000;">            e.printStackTrace();
</span><span style="color: #008080;">134</span>         } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (InvocationTargetException e) {
</span><span style="color: #008080;">135</span> <span style="color: #000000;">            e.printStackTrace();
</span><span style="color: #008080;">136</span>         } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (IllegalAccessException e) {
</span><span style="color: #008080;">137</span> <span style="color: #000000;">            e.printStackTrace();
</span><span style="color: #008080;">138</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">139</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">140</span> 
<span style="color: #008080;">141</span>     <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">void</span> doServelt(HttpServletRequest req, HttpServletResponse resp) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> IOException, NoSuchMethodException, InvocationTargetException, IllegalAccessException, ServletException {
</span><span style="color: #008080;">142</span>         <span style="color: #008000;">//</span><span style="color: #008000;">获取请求地址</span>
<span style="color: #008080;">143</span>         String requestUrl =<span style="color: #000000;"> req.getRequestURI();
</span><span style="color: #008080;">144</span>         <span style="color: #008000;">//</span><span style="color: #008000;">查找地址所对应bean</span>
<span style="color: #008080;">145</span>         Object object =<span style="color: #000000;"> mvcBeanUrl.get(requestUrl);
</span><span style="color: #008080;">146</span>         <span style="color: #0000ff;">if</span> (object == <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
</span><span style="color: #008080;">147</span>             resp.getWriter().println("sorry http is not exit 404"<span style="color: #000000;">);
</span><span style="color: #008080;">148</span>             <span style="color: #0000ff;">return</span><span style="color: #000000;">;
</span><span style="color: #008080;">149</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">150</span>         <span style="color: #008000;">//</span><span style="color: #008000;">获取请求的方法</span>
<span style="color: #008080;">151</span>         String methodName =<span style="color: #000000;"> mvcMethodUrl.get(requestUrl);
</span><span style="color: #008080;">152</span>         <span style="color: #0000ff;">if</span> (methodName == <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
</span><span style="color: #008080;">153</span>             resp.getWriter().println("sorry method is not exit 404"<span style="color: #000000;">);
</span><span style="color: #008080;">154</span>             <span style="color: #0000ff;">return</span><span style="color: #000000;">;
</span><span style="color: #008080;">155</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">156</span>         <span style="color: #008000;">//</span><span style="color: #008000;">通过构反射执行方法</span>
<span style="color: #008080;">157</span>         Class&lt;?&gt; aClass =<span style="color: #000000;"> object.getClass();
</span><span style="color: #008080;">158</span>         Method method =<span style="color: #000000;"> aClass.getMethod(methodName);
</span><span style="color: #008080;">159</span>         String invoke =<span style="color: #000000;"> (String) method.invoke(object);
</span><span style="color: #008080;">160</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 获取后缀信息</span>
<span style="color: #008080;">161</span>         String suffix = ".jsp"<span style="color: #000000;">;
</span><span style="color: #008080;">162</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 页面目录地址</span>
<span style="color: #008080;">163</span>         String prefix = "/"<span style="color: #000000;">;
</span><span style="color: #008080;">164</span>         req.getRequestDispatcher(prefix + invoke +<span style="color: #000000;"> suffix).forward(req, resp);
</span><span style="color: #008080;">165</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">166</span> 
<span style="color: #008080;">167</span> <span style="color: #000000;">    @Override
</span><span style="color: #008080;">168</span>     <span style="color: #0000ff;">protected</span> <span style="color: #0000ff;">void</span> doGet(HttpServletRequest req, HttpServletResponse resp) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> ServletException, IOException {
</span><span style="color: #008080;">169</span>         <span style="color: #0000ff;">this</span><span style="color: #000000;">.doPost(req, resp);
</span><span style="color: #008080;">170</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">171</span> 
<span style="color: #008080;">172</span> 
<span style="color: #008080;">173</span> }</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<p style="margin-left: 30px;">&nbsp;3.ClassUtils工具类封装</p>
<src class="cnblogs_code" onclick="cnblogs_code_show('899c3c5b-8ef5-4135-967f-73851997903b')"><img id="code_img_closed_899c3c5b-8ef5-4135-967f-73851997903b" class="code_img_closed" src="./images/(二)springMvc原理和手写springMvc框架1.png" alt="" /><img id="code_img_opened_899c3c5b-8ef5-4135-967f-73851997903b" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('899c3c5b-8ef5-4135-967f-73851997903b',event)" src="./images/(二)springMvc原理和手写springMvc框架2.png" alt="" />
<src id="cnblogs_code_open_899c3c5b-8ef5-4135-967f-73851997903b" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;">  1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.zzw.cn.utils;
</span><span style="color: #008080;">  2</span> 
<span style="color: #008080;">  3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.File;
</span><span style="color: #008080;">  4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.FileFilter;
</span><span style="color: #008080;">  5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.IOException;
</span><span style="color: #008080;">  6</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.net.JarURLConnection;
</span><span style="color: #008080;">  7</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.net.URL;
</span><span style="color: #008080;">  8</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.net.URLDecoder;
</span><span style="color: #008080;">  9</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.ArrayList;
</span><span style="color: #008080;"> 10</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.Enumeration;
</span><span style="color: #008080;"> 11</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.List;
</span><span style="color: #008080;"> 12</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.jar.JarEntry;
</span><span style="color: #008080;"> 13</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.jar.JarFile;
</span><span style="color: #008080;"> 14</span> 
<span style="color: #008080;"> 15</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> ClassUtils {
</span><span style="color: #008080;"> 16</span> 
<span style="color: #008080;"> 17</span>     <span style="color: #008000;">/**</span>
<span style="color: #008080;"> 18</span> <span style="color: #008000;">     * 从包package中获取所有的Class
</span><span style="color: #008080;"> 19</span> <span style="color: #008000;">     *
</span><span style="color: #008080;"> 20</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> pack
</span><span style="color: #008080;"> 21</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@return</span>
<span style="color: #008080;"> 22</span>      <span style="color: #008000;">*/</span>
<span style="color: #008080;"> 23</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> List&lt;Class&lt;?&gt;&gt;<span style="color: #000000;"> getClasses(String packageName) {
</span><span style="color: #008080;"> 24</span> 
<span style="color: #008080;"> 25</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 第一个class类的集合</span>
<span style="color: #008080;"> 26</span>         List&lt;Class&lt;?&gt;&gt; classes = <span style="color: #0000ff;">new</span> ArrayList&lt;Class&lt;?&gt;&gt;<span style="color: #000000;">();
</span><span style="color: #008080;"> 27</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 是否循环迭代</span>
<span style="color: #008080;"> 28</span>         <span style="color: #0000ff;">boolean</span> recursive = <span style="color: #0000ff;">true</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 29</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 获取包的名字 并进行替换</span>
<span style="color: #008080;"> 30</span>         String packageDirName = packageName.replace('.', '/'<span style="color: #000000;">);
</span><span style="color: #008080;"> 31</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 定义一个枚举的集合 并进行循环来处理这个目录下的things</span>
<span style="color: #008080;"> 32</span>         Enumeration&lt;URL&gt;<span style="color: #000000;"> dirs;
</span><span style="color: #008080;"> 33</span>         <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;"> 34</span>             dirs =<span style="color: #000000;"> Thread.currentThread().getContextClassLoader().getResources(packageDirName);
</span><span style="color: #008080;"> 35</span>             <span style="color: #008000;">//</span><span style="color: #008000;"> 循环迭代下去</span>
<span style="color: #008080;"> 36</span>             <span style="color: #0000ff;">while</span><span style="color: #000000;"> (dirs.hasMoreElements()) {
</span><span style="color: #008080;"> 37</span>                 <span style="color: #008000;">//</span><span style="color: #008000;"> 获取下一个元素</span>
<span style="color: #008080;"> 38</span>                 URL url =<span style="color: #000000;"> dirs.nextElement();
</span><span style="color: #008080;"> 39</span>                 <span style="color: #008000;">//</span><span style="color: #008000;"> 得到协议的名称</span>
<span style="color: #008080;"> 40</span>                 String protocol =<span style="color: #000000;"> url.getProtocol();
</span><span style="color: #008080;"> 41</span>                 <span style="color: #008000;">//</span><span style="color: #008000;"> 如果是以文件的形式保存在服务器上</span>
<span style="color: #008080;"> 42</span>                 <span style="color: #0000ff;">if</span> ("file"<span style="color: #000000;">.equals(protocol)) {
</span><span style="color: #008080;"> 43</span>                     <span style="color: #008000;">//</span><span style="color: #008000;"> 获取包的物理路径</span>
<span style="color: #008080;"> 44</span>                     String filePath = URLDecoder.decode(url.getFile(), "UTF-8"<span style="color: #000000;">);
</span><span style="color: #008080;"> 45</span>                     <span style="color: #008000;">//</span><span style="color: #008000;"> 以文件的方式扫描整个包下的文件 并添加到集合中</span>
<span style="color: #008080;"> 46</span> <span style="color: #000000;">                    findAndAddClassesInPackageByFile(packageName, filePath, recursive, classes);
</span><span style="color: #008080;"> 47</span>                 } <span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span> ("jar"<span style="color: #000000;">.equals(protocol)) {
</span><span style="color: #008080;"> 48</span>                     <span style="color: #008000;">//</span><span style="color: #008000;"> 如果是jar包文件
</span><span style="color: #008080;"> 49</span>                     <span style="color: #008000;">//</span><span style="color: #008000;"> 定义一个JarFile</span>
<span style="color: #008080;"> 50</span> <span style="color: #000000;">                    JarFile jar;
</span><span style="color: #008080;"> 51</span>                     <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;"> 52</span>                         <span style="color: #008000;">//</span><span style="color: #008000;"> 获取jar</span>
<span style="color: #008080;"> 53</span>                         jar =<span style="color: #000000;"> ((JarURLConnection) url.openConnection()).getJarFile();
</span><span style="color: #008080;"> 54</span>                         <span style="color: #008000;">//</span><span style="color: #008000;"> 从此jar包 得到一个枚举类</span>
<span style="color: #008080;"> 55</span>                         Enumeration&lt;JarEntry&gt; entries =<span style="color: #000000;"> jar.entries();
</span><span style="color: #008080;"> 56</span>                         <span style="color: #008000;">//</span><span style="color: #008000;"> 同样的进行循环迭代</span>
<span style="color: #008080;"> 57</span>                         <span style="color: #0000ff;">while</span><span style="color: #000000;"> (entries.hasMoreElements()) {
</span><span style="color: #008080;"> 58</span>                             <span style="color: #008000;">//</span><span style="color: #008000;"> 获取jar里的一个实体 可以是目录 和一些jar包里的其他文件 如META-INF等文件</span>
<span style="color: #008080;"> 59</span>                             JarEntry entry =<span style="color: #000000;"> entries.nextElement();
</span><span style="color: #008080;"> 60</span>                             String name =<span style="color: #000000;"> entry.getName();
</span><span style="color: #008080;"> 61</span>                             <span style="color: #008000;">//</span><span style="color: #008000;"> 如果是以/开头的</span>
<span style="color: #008080;"> 62</span>                             <span style="color: #0000ff;">if</span> (name.charAt(0) == '/'<span style="color: #000000;">) {
</span><span style="color: #008080;"> 63</span>                                 <span style="color: #008000;">//</span><span style="color: #008000;"> 获取后面的字符串</span>
<span style="color: #008080;"> 64</span>                                 name = name.substring(1<span style="color: #000000;">);
</span><span style="color: #008080;"> 65</span> <span style="color: #000000;">                            }
</span><span style="color: #008080;"> 66</span>                             <span style="color: #008000;">//</span><span style="color: #008000;"> 如果前半部分和定义的包名相同</span>
<span style="color: #008080;"> 67</span>                             <span style="color: #0000ff;">if</span><span style="color: #000000;"> (name.startsWith(packageDirName)) {
</span><span style="color: #008080;"> 68</span>                                 <span style="color: #0000ff;">int</span> idx = name.lastIndexOf('/'<span style="color: #000000;">);
</span><span style="color: #008080;"> 69</span>                                 <span style="color: #008000;">//</span><span style="color: #008000;"> 如果以"/"结尾 是一个包</span>
<span style="color: #008080;"> 70</span>                                 <span style="color: #0000ff;">if</span> (idx != -1<span style="color: #000000;">) {
</span><span style="color: #008080;"> 71</span>                                     <span style="color: #008000;">//</span><span style="color: #008000;"> 获取包名 把"/"替换成"."</span>
<span style="color: #008080;"> 72</span>                                     packageName = name.substring(0, idx).replace('/', '.'<span style="color: #000000;">);
</span><span style="color: #008080;"> 73</span> <span style="color: #000000;">                                }
</span><span style="color: #008080;"> 74</span>                                 <span style="color: #008000;">//</span><span style="color: #008000;"> 如果可以迭代下去 并且是一个包</span>
<span style="color: #008080;"> 75</span>                                 <span style="color: #0000ff;">if</span> ((idx != -1) ||<span style="color: #000000;"> recursive) {
</span><span style="color: #008080;"> 76</span>                                     <span style="color: #008000;">//</span><span style="color: #008000;"> 如果是一个.class文件 而且不是目录</span>
<span style="color: #008080;"> 77</span>                                     <span style="color: #0000ff;">if</span> (name.endsWith(".class") &amp;&amp; !<span style="color: #000000;">entry.isDirectory()) {
</span><span style="color: #008080;"> 78</span>                                         <span style="color: #008000;">//</span><span style="color: #008000;"> 去掉后面的".class" 获取真正的类名</span>
<span style="color: #008080;"> 79</span>                                         String className = name.substring(packageName.length() + 1, name.length() - 6<span style="color: #000000;">);
</span><span style="color: #008080;"> 80</span>                                         <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;"> 81</span>                                             <span style="color: #008000;">//</span><span style="color: #008000;"> 添加到classes</span>
<span style="color: #008080;"> 82</span>                                             classes.add(Class.forName(packageName + '.' +<span style="color: #000000;"> className));
</span><span style="color: #008080;"> 83</span>                                         } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (ClassNotFoundException e) {
</span><span style="color: #008080;"> 84</span> <span style="color: #000000;">                                            e.printStackTrace();
</span><span style="color: #008080;"> 85</span> <span style="color: #000000;">                                        }
</span><span style="color: #008080;"> 86</span> <span style="color: #000000;">                                    }
</span><span style="color: #008080;"> 87</span> <span style="color: #000000;">                                }
</span><span style="color: #008080;"> 88</span> <span style="color: #000000;">                            }
</span><span style="color: #008080;"> 89</span> <span style="color: #000000;">                        }
</span><span style="color: #008080;"> 90</span>                     } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (IOException e) {
</span><span style="color: #008080;"> 91</span> <span style="color: #000000;">                        e.printStackTrace();
</span><span style="color: #008080;"> 92</span> <span style="color: #000000;">                    }
</span><span style="color: #008080;"> 93</span> <span style="color: #000000;">                }
</span><span style="color: #008080;"> 94</span> <span style="color: #000000;">            }
</span><span style="color: #008080;"> 95</span>         } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (IOException e) {
</span><span style="color: #008080;"> 96</span> <span style="color: #000000;">            e.printStackTrace();
</span><span style="color: #008080;"> 97</span> <span style="color: #000000;">        }
</span><span style="color: #008080;"> 98</span> 
<span style="color: #008080;"> 99</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> classes;
</span><span style="color: #008080;">100</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">101</span> 
<span style="color: #008080;">102</span>     <span style="color: #008000;">/**</span>
<span style="color: #008080;">103</span> <span style="color: #008000;">     * 以文件的形式来获取包下的所有Class
</span><span style="color: #008080;">104</span> <span style="color: #008000;">     *
</span><span style="color: #008080;">105</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> packageName
</span><span style="color: #008080;">106</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> packagePath
</span><span style="color: #008080;">107</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> recursive
</span><span style="color: #008080;">108</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> classes
</span><span style="color: #008080;">109</span>      <span style="color: #008000;">*/</span>
<span style="color: #008080;">110</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span> findAndAddClassesInPackageByFile(String packageName, String packagePath, <span style="color: #0000ff;">final</span> <span style="color: #0000ff;">boolean</span><span style="color: #000000;"> recursive,
</span><span style="color: #008080;">111</span>                                                         List&lt;Class&lt;?&gt;&gt;<span style="color: #000000;"> classes) {
</span><span style="color: #008080;">112</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 获取此包的目录 建立一个File</span>
<span style="color: #008080;">113</span>         File dir = <span style="color: #0000ff;">new</span><span style="color: #000000;"> File(packagePath);
</span><span style="color: #008080;">114</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 如果不存在或者 也不是目录就直接返回</span>
<span style="color: #008080;">115</span>         <span style="color: #0000ff;">if</span> (!dir.exists() || !<span style="color: #000000;">dir.isDirectory()) {
</span><span style="color: #008080;">116</span>             <span style="color: #0000ff;">return</span><span style="color: #000000;">;
</span><span style="color: #008080;">117</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">118</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 如果存在 就获取包下的所有文件 包括目录</span>
<span style="color: #008080;">119</span>         File[] dirfiles = dir.listFiles(<span style="color: #0000ff;">new</span><span style="color: #000000;"> FileFilter() {
</span><span style="color: #008080;">120</span>             <span style="color: #008000;">//</span><span style="color: #008000;"> 自定义过滤规则 如果可以循环(包含子目录) 或则是以.class结尾的文件(编译好的java类文件)</span>
<span style="color: #008080;">121</span> <span style="color: #000000;">            @Override
</span><span style="color: #008080;">122</span>             <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">boolean</span><span style="color: #000000;"> accept(File file) {
</span><span style="color: #008080;">123</span>                 <span style="color: #0000ff;">return</span> (recursive &amp;&amp; file.isDirectory()) || (file.getName().endsWith(".class"<span style="color: #000000;">));
</span><span style="color: #008080;">124</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">125</span> <span style="color: #000000;">        });
</span><span style="color: #008080;">126</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 循环所有文件</span>
<span style="color: #008080;">127</span>         <span style="color: #0000ff;">for</span><span style="color: #000000;"> (File file : dirfiles) {
</span><span style="color: #008080;">128</span>             <span style="color: #008000;">//</span><span style="color: #008000;"> 如果是目录 则继续扫描</span>
<span style="color: #008080;">129</span>             <span style="color: #0000ff;">if</span><span style="color: #000000;"> (file.isDirectory()) {
</span><span style="color: #008080;">130</span>                 findAndAddClassesInPackageByFile(packageName + "." +<span style="color: #000000;"> file.getName(), file.getAbsolutePath(), recursive,
</span><span style="color: #008080;">131</span> <span style="color: #000000;">                        classes);
</span><span style="color: #008080;">132</span>             } <span style="color: #0000ff;">else</span><span style="color: #000000;"> {
</span><span style="color: #008080;">133</span>                 <span style="color: #008000;">//</span><span style="color: #008000;"> 如果是java类文件 去掉后面的.class 只留下类名</span>
<span style="color: #008080;">134</span>                 String className = file.getName().substring(0, file.getName().length() - 6<span style="color: #000000;">);
</span><span style="color: #008080;">135</span>                 <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;">136</span>                     <span style="color: #008000;">//</span><span style="color: #008000;"> 添加到集合中去</span>
<span style="color: #008080;">137</span>                     classes.add(Class.forName(packageName + '.' +<span style="color: #000000;"> className));
</span><span style="color: #008080;">138</span>                 } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (ClassNotFoundException e) {
</span><span style="color: #008080;">139</span> <span style="color: #000000;">                    e.printStackTrace();
</span><span style="color: #008080;">140</span> <span style="color: #000000;">                }
</span><span style="color: #008080;">141</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">142</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">143</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">144</span> }</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<p style="margin-left: 30px;">&nbsp;4.自定义注解类AnController</p>
<src class="cnblogs_code" onclick="cnblogs_code_show('0aeb08bb-a7d4-4c71-83b2-a7d9eb4cf5fd')"><img id="code_img_closed_0aeb08bb-a7d4-4c71-83b2-a7d9eb4cf5fd" class="code_img_closed" src="./images/(二)springMvc原理和手写springMvc框架1.png" alt="" /><img id="code_img_opened_0aeb08bb-a7d4-4c71-83b2-a7d9eb4cf5fd" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('0aeb08bb-a7d4-4c71-83b2-a7d9eb4cf5fd',event)" src="./images/(二)springMvc原理和手写springMvc框架2.png" alt="" />
<src id="cnblogs_code_open_0aeb08bb-a7d4-4c71-83b2-a7d9eb4cf5fd" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.zzw.cn.springmvc.annoation;
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.lang.annotation.ElementType;
</span><span style="color: #008080;"> 4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.lang.annotation.Retention;
</span><span style="color: #008080;"> 5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.lang.annotation.RetentionPolicy;
</span><span style="color: #008080;"> 6</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.lang.annotation.Target;
</span><span style="color: #008080;"> 7</span> 
<span style="color: #008080;"> 8</span> <span style="color: #008000;">/**</span>
<span style="color: #008080;"> 9</span> <span style="color: #008000;"> * </span><span style="color: #808080;">@author</span><span style="color: #008000;"> Simple
</span><span style="color: #008080;">10</span> <span style="color: #008000;"> * @date 14:06 2019/8/27
</span><span style="color: #008080;">11</span> <span style="color: #008000;"> * @description
</span><span style="color: #008080;">12</span>  <span style="color: #008000;">*/</span>
<span style="color: #008080;">13</span> <span style="color: #000000;">@Target({ElementType.TYPE,ElementType.METHOD})
</span><span style="color: #008080;">14</span> <span style="color: #000000;">@Retention(RetentionPolicy.RUNTIME)
</span><span style="color: #008080;">15</span> <span style="color: #0000ff;">public</span> @<span style="color: #0000ff;">interface</span><span style="color: #000000;"> AnController {
</span><span style="color: #008080;">16</span> }</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<p style="margin-left: 30px;">&nbsp;5.自定义注解类AnRequestMapping</p>
<src class="cnblogs_code" onclick="cnblogs_code_show('62cfb4a6-60c2-41ee-b29e-222313d82eca')"><img id="code_img_closed_62cfb4a6-60c2-41ee-b29e-222313d82eca" class="code_img_closed" src="./images/(二)springMvc原理和手写springMvc框架1.png" alt="" /><img id="code_img_opened_62cfb4a6-60c2-41ee-b29e-222313d82eca" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('62cfb4a6-60c2-41ee-b29e-222313d82eca',event)" src="./images/(二)springMvc原理和手写springMvc框架2.png" alt="" />
<src id="cnblogs_code_open_62cfb4a6-60c2-41ee-b29e-222313d82eca" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.zzw.cn.springmvc.annoation;
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span> java.lang.annotation.*<span style="color: #000000;">;
</span><span style="color: #008080;"> 4</span> 
<span style="color: #008080;"> 5</span> <span style="color: #008000;">/**</span>
<span style="color: #008080;"> 6</span> <span style="color: #008000;"> * </span><span style="color: #808080;">@author</span><span style="color: #008000;"> Simple
</span><span style="color: #008080;"> 7</span> <span style="color: #008000;"> * @date 14:07 2019/8/27
</span><span style="color: #008080;"> 8</span> <span style="color: #008000;"> * @description
</span><span style="color: #008080;"> 9</span>  <span style="color: #008000;">*/</span>
<span style="color: #008080;">10</span> <span style="color: #000000;">@Target({ElementType.METHOD, ElementType.TYPE})
</span><span style="color: #008080;">11</span> <span style="color: #000000;">@Retention(RetentionPolicy.RUNTIME)
</span><span style="color: #008080;">12</span> <span style="color: #000000;">@Documented
</span><span style="color: #008080;">13</span> <span style="color: #0000ff;">public</span> @<span style="color: #0000ff;">interface</span><span style="color: #000000;"> AnRequestMapping {
</span><span style="color: #008080;">14</span>     String value() <span style="color: #0000ff;">default</span> ""<span style="color: #000000;">;
</span><span style="color: #008080;">15</span> }</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<p style="margin-left: 30px;">&nbsp;6.HelloWorld类</p>
<src class="cnblogs_code" onclick="cnblogs_code_show('6959cc84-68ea-4cff-850e-54a836430bd8')"><img id="code_img_closed_6959cc84-68ea-4cff-850e-54a836430bd8" class="code_img_closed" src="./images/(二)springMvc原理和手写springMvc框架1.png" alt="" /><img id="code_img_opened_6959cc84-68ea-4cff-850e-54a836430bd8" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('6959cc84-68ea-4cff-850e-54a836430bd8',event)" src="./images/(二)springMvc原理和手写springMvc框架2.png" alt="" />
<src id="cnblogs_code_open_6959cc84-68ea-4cff-850e-54a836430bd8" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.zzw.cn.springmvc.controller;
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.zzw.cn.springmvc.annoation.AnController;
</span><span style="color: #008080;"> 4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.zzw.cn.springmvc.annoation.AnRequestMapping;
</span><span style="color: #008080;"> 5</span> 
<span style="color: #008080;"> 6</span> <span style="color: #008000;">/**</span>
<span style="color: #008080;"> 7</span> <span style="color: #008000;"> * </span><span style="color: #808080;">@author</span><span style="color: #008000;"> Simple
</span><span style="color: #008080;"> 8</span> <span style="color: #008000;"> * @date 15:15 2019/8/27
</span><span style="color: #008080;"> 9</span> <span style="color: #008000;"> * @description
</span><span style="color: #008080;">10</span>  <span style="color: #008000;">*/</span>
<span style="color: #008080;">11</span> <span style="color: #000000;">@AnController
</span><span style="color: #008080;">12</span> @AnRequestMapping(value = "/hello"<span style="color: #000000;">)
</span><span style="color: #008080;">13</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> HelloWorld {
</span><span style="color: #008080;">14</span>     @AnRequestMapping("/method"<span style="color: #000000;">)
</span><span style="color: #008080;">15</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> String method(){
</span><span style="color: #008080;">16</span>         <span style="color: #0000ff;">return</span> "index"<span style="color: #000000;">;
</span><span style="color: #008080;">17</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">18</span> }</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<p style="margin-left: 30px;">&nbsp;7.index.jsp</p>
<src class="cnblogs_code" onclick="cnblogs_code_show('fb1f4f28-7e0c-47e9-833e-0e55f3fd2c6e')"><img id="code_img_closed_fb1f4f28-7e0c-47e9-833e-0e55f3fd2c6e" class="code_img_closed" src="./images/(二)springMvc原理和手写springMvc框架1.png" alt="" /><img id="code_img_opened_fb1f4f28-7e0c-47e9-833e-0e55f3fd2c6e" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('fb1f4f28-7e0c-47e9-833e-0e55f3fd2c6e',event)" src="./images/(二)springMvc原理和手写springMvc框架2.png" alt="" />
<src id="cnblogs_code_open_fb1f4f28-7e0c-47e9-833e-0e55f3fd2c6e" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;">1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">html</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">2</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">3</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">h2</span><span style="color: #0000ff;">&gt;</span>Hello World!<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">h2</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">4</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">5</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">html</span><span style="color: #0000ff;">&gt;</span></code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<p style="margin-left: 30px;">8.访问地址:http://localhost:8080/hello/method</p>
<p style="margin-left: 30px;">9.成功结果:</p>
<p style="margin-left: 30px;"><img src="./images/(二)springMvc原理和手写springMvc框架15.png" alt="" /></p>
<p style="margin-left: 30px;">10.错误结果</p>
<p style="margin-left: 30px;"><img src="./images/(二)springMvc原理和手写springMvc框架16.png" alt="" /></p>
<p style="margin-left: 30px;">现在代码已经完成了，也许开始你对很多东西不理解，但是没关系可以当作了解，多敲敲。</p>

</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>