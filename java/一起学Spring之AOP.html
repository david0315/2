<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修一起学Spring之AOP' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>一起学Spring之AOP</center></div><div class='banquan'>原文出处:本文由博客园博主Alan.hsiang提供。<br/>
原文连接:https://www.cnblogs.com/hsiang/p/11710138.html</div><br>
    <h2><span style="color: #339966;">概述</span></h2>
<p>在软件开发中，我们重点关注的是业务逻辑代码，但在实际开发中，需要写的代码却不仅仅是业务逻辑，还需要处理记录日志，异常处理，事务控制等一些与业务无关的事情。而且这些代码也是服务端必须的，类似这样的代码分散在系统中的各个地方，如：几乎所有的重要操作方法前面都会加上日志记录代码，这样的代码写起来繁琐，又占用开发时间和精力，而且不容易维护。我们统一把这类代码成为【切面代码】，如何让我们从这些繁琐的工作中抽身而退，更加专注于业务逻辑，这就需要用到Spring的AOP技术。</p>
<p>AOP原理：将复杂的需求分解成不同的方面，将散落在系统中的公共功能集中解决，如下图所示：</p>
<p><img src="./images/一起学Spring之AOP0.png" alt="" width="301" height="224" /></p>
<h2><span style="color: #339966;">通知(Advice)的分类</span></h2>
<p>分类如下：</p>
<ul>
<li>前置通知：在某个切入点之前执行的通知</li>
<li>后置通知：在某个切入点之后执行的通知</li>
<li>异常通知：在某个切入点出现异常时候的通知</li>
<li>环绕通知：包围某个切入点的通知，功能最强大</li>
</ul>
<h2><span style="color: #339966;">准备工作</span></h2>
<h3><span style="color: #800080;">AOP需要的jar包</span></h3>
<p>除Spring必备的五个jar包外，还需要以下三个来支撑AOP：</p>
<ul>
<li>aopalliance-1.0.jar</li>
<li>aspectjweaver-1.5.3.jar</li>
<li>spring-aop-4.0.6.RELEASE.jar</li>
</ul>
<h3><span style="color: #800080;">定义一个接口和实现类</span></h3>
<p>如下所示：</p>
<p>IStudentService接口 代码如下：</p>
<src class="cnblogs_code" onclick="cnblogs_code_show('75ad5b3f-b011-40ec-bfb4-f91bd5ed0185')"><img id="code_img_closed_75ad5b3f-b011-40ec-bfb4-f91bd5ed0185" class="code_img_closed" src="./images/一起学Spring之AOP1.png" alt="" /><img id="code_img_opened_75ad5b3f-b011-40ec-bfb4-f91bd5ed0185" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('75ad5b3f-b011-40ec-bfb4-f91bd5ed0185',event)" src="./images/一起学Spring之AOP2.png" alt="" />
<src id="cnblogs_code_open_75ad5b3f-b011-40ec-bfb4-f91bd5ed0185" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.hex.second;
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #008000;">/**</span>
<span style="color: #008080;"> 4</span> <span style="color: #008000;"> * 学生服务接口
</span><span style="color: #008080;"> 5</span> <span style="color: #008000;"> * </span><span style="color: #808080;">@author</span><span style="color: #008000;"> Administrator
</span><span style="color: #008080;"> 6</span> <span style="color: #008000;"> *
</span><span style="color: #008080;"> 7</span>  <span style="color: #008000;">*/</span>
<span style="color: #008080;"> 8</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">interface</span><span style="color: #000000;"> IStudentService {
</span><span style="color: #008080;"> 9</span>     
<span style="color: #008080;">10</span>     <span style="color: #008000;">/**</span>
<span style="color: #008080;">11</span> <span style="color: #008000;">     * 新增学生
</span><span style="color: #008080;">12</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> student
</span><span style="color: #008080;">13</span>      <span style="color: #008000;">*/</span>
<span style="color: #008080;">14</span>     <span style="color: #0000ff;">void</span><span style="color: #000000;"> addStudent(Student student);
</span><span style="color: #008080;">15</span>     <span style="color: #008000;">/**</span>
<span style="color: #008080;">16</span> <span style="color: #008000;">     * 删除学生
</span><span style="color: #008080;">17</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> id
</span><span style="color: #008080;">18</span>      <span style="color: #008000;">*/</span>
<span style="color: #008080;">19</span>     <span style="color: #0000ff;">void</span> deleteStudent(<span style="color: #0000ff;">int</span><span style="color: #000000;"> id);
</span><span style="color: #008080;">20</span>     
<span style="color: #008080;">21</span>     <span style="color: #008000;">/**</span>
<span style="color: #008080;">22</span> <span style="color: #008000;">     * 修改学生
</span><span style="color: #008080;">23</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> id
</span><span style="color: #008080;">24</span>      <span style="color: #008000;">*/</span>
<span style="color: #008080;">25</span>     <span style="color: #0000ff;">void</span> updateStudent(<span style="color: #0000ff;">int</span><span style="color: #000000;"> id);
</span><span style="color: #008080;">26</span> }</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<p>StudentServiceImpl类 代码如下：</p>
<src class="cnblogs_code" onclick="cnblogs_code_show('ee63b8aa-d6ae-4ade-a14e-7e2a072f6db6')"><img id="code_img_closed_ee63b8aa-d6ae-4ade-a14e-7e2a072f6db6" class="code_img_closed" src="./images/一起学Spring之AOP1.png" alt="" /><img id="code_img_opened_ee63b8aa-d6ae-4ade-a14e-7e2a072f6db6" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('ee63b8aa-d6ae-4ade-a14e-7e2a072f6db6',event)" src="./images/一起学Spring之AOP2.png" alt="" />
<src id="cnblogs_code_open_ee63b8aa-d6ae-4ade-a14e-7e2a072f6db6" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.hex.second;
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #008000;">/**</span>
<span style="color: #008080;"> 4</span> <span style="color: #008000;"> * 学生服务事项类
</span><span style="color: #008080;"> 5</span> <span style="color: #008000;"> * </span><span style="color: #808080;">@author</span><span style="color: #008000;"> Administrator
</span><span style="color: #008080;"> 6</span> <span style="color: #008000;"> *
</span><span style="color: #008080;"> 7</span>  <span style="color: #008000;">*/</span>
<span style="color: #008080;"> 8</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> StudentServiceImpl <span style="color: #0000ff;">implements</span><span style="color: #000000;"> IStudentService {
</span><span style="color: #008080;"> 9</span> 
<span style="color: #008080;">10</span>     <span style="color: #008000;">/**</span>
<span style="color: #008080;">11</span> <span style="color: #008000;">     * 新增学生
</span><span style="color: #008080;">12</span>      <span style="color: #008000;">*/</span>
<span style="color: #008080;">13</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> addStudent(Student student) {
</span><span style="color: #008080;">14</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> TODO Auto-generated method stub</span>
<span style="color: #008080;">15</span>         System.out.println("新增加学生。。。"<span style="color: #000000;">);
</span><span style="color: #008080;">16</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">17</span>     
<span style="color: #008080;">18</span>     <span style="color: #008000;">/**</span>
<span style="color: #008080;">19</span> <span style="color: #008000;">     * 删除学生
</span><span style="color: #008080;">20</span>      <span style="color: #008000;">*/</span>
<span style="color: #008080;">21</span> <span style="color: #000000;">    @Override
</span><span style="color: #008080;">22</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> deleteStudent(<span style="color: #0000ff;">int</span><span style="color: #000000;"> id) {
</span><span style="color: #008080;">23</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> TODO Auto-generated method stub</span>
<span style="color: #008080;">24</span>         System.out.println("删除学生。。。"<span style="color: #000000;">);
</span><span style="color: #008080;">25</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">26</span> 
<span style="color: #008080;">27</span>     <span style="color: #008000;">/**</span>
<span style="color: #008080;">28</span> <span style="color: #008000;">     * 修改学生
</span><span style="color: #008080;">29</span>      <span style="color: #008000;">*/</span>
<span style="color: #008080;">30</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> updateStudent(<span style="color: #0000ff;">int</span><span style="color: #000000;"> id) {
</span><span style="color: #008080;">31</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> TODO Auto-generated method stub</span>
<span style="color: #008080;">32</span>         System.out.println("修改学生"<span style="color: #000000;">);
</span><span style="color: #008080;">33</span>         <span style="color: #0000ff;">int</span> i=1/0<span style="color: #000000;">;
</span><span style="color: #008080;">34</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">35</span> }</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<h2><span style="color: #339966;">前置通知</span></h2>
<h3><span style="color: #800080;">1. 实现接口</span></h3>
<p>前置通知类，需要实现【MethodBeforeAdvice】接口中的before方法，如下所示：</p>
<p>Method method 表示执行的目标方法</p>
<p>Object[] args 表示传入的参数数组</p>
<p>Object target 表示目标对象，即切入点所示的对象</p>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.hex.second;
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.lang.reflect.Method;
</span><span style="color: #008080;"> 4</span> 
<span style="color: #008080;"> 5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.aop.MethodBeforeAdvice;
</span><span style="color: #008080;"> 6</span> 
<span style="color: #008080;"> 7</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> LogBefore <span style="color: #0000ff;">implements</span><span style="color: #000000;"> MethodBeforeAdvice {
</span><span style="color: #008080;"> 8</span> 
<span style="color: #008080;"> 9</span>     <span style="color: #008000;">/**</span><span style="color: #008000;">*
</span><span style="color: #008080;">10</span> <span style="color: #008000;">     * 前置通知
</span><span style="color: #008080;">11</span> <span style="color: #008000;">     * method:表示调用的方法，即切入点
</span><span style="color: #008080;">12</span> <span style="color: #008000;">     * args:表示调用方法的参数
</span><span style="color: #008080;">13</span> <span style="color: #008000;">     * target：表示方法所在的目标对象
</span><span style="color: #008080;">14</span>      <span style="color: #008000;">*/</span>
<span style="color: #008080;">15</span> <span style="color: #000000;">    @Override
</span><span style="color: #008080;">16</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> before(Method method, Object[] args, Object target) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> Throwable {
</span><span style="color: #008080;">17</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> TODO Auto-generated method stub</span>
<span style="color: #008080;">18</span>         System.out.println("前置通知。。。"<span style="color: #000000;">);
</span><span style="color: #008080;">19</span>         System.out.println("method="+method+",args数量="+args.length+",target="+<span style="color: #000000;">target);
</span><span style="color: #008080;">20</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">21</span> }</code></pre>

<h3><span style="color: #800080;">2. 配置applicationContext.xml文件</span></h3>
<p>如果要支持AOP，需要引入命名空间，如下所示：</p>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #0000ff;">&lt;?</span><span style="color: #ff00ff;">xml version="1.0" encoding="UTF-8"</span><span style="color: #0000ff;">?&gt;</span>
<span style="color: #008080;">2</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">beans </span><span style="color: #ff0000;">xmlns</span><span style="color: #0000ff;">="http://www.springframework.org/schema/beans"</span>
<span style="color: #008080;">3</span> <span style="color: #ff0000;">xmlns:xsi</span><span style="color: #0000ff;">="http://www.w3.org/2001/XMLSchema-instance"</span>
<span style="color: #008080;">4</span> <span style="color: #ff0000;">xmlns:p</span><span style="color: #0000ff;">="http://www.springframework.org/schema/p"</span>
<span style="color: #008080;">5</span><strong> <span style="color: #ff0000;">xmlns:aop</span><span style="color: #0000ff;">="http://www.springframework.org/schema/aop"</span></strong>
<span style="color: #008080;">6</span> <span style="color: #ff0000;">xsi:schemaLocation</span><span style="color: #0000ff;">="http://www.springframework.org/schema/beans
</span><span style="color: #008080;">7</span> <span style="color: #0000ff;"> http://www.springframework.org/schema/beans/spring-beans.xsd
</span><span style="color: #008080;">8</span> <strong><span style="color: #0000ff;"> http://www.springframework.org/schema/aop
</span></strong><span style="color: #008080;">9</span> <span style="color: #0000ff;"><strong> http://www.springframework.org/schema/aop/spring-aop.xsd</strong>"</span><span style="color: #0000ff;">&gt;</span></code></pre>

<h3><span style="color: #800080;">3. 配置两个类对应的bean</span></h3>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> 服务类 </span><span style="color: #008000;">--&gt;</span>
<span style="color: #008080;">2</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">bean </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="studentService"</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">="com.hex.second.StudentServiceImpl"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">bean</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">3</span> <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> 前置通知类 </span><span style="color: #008000;">--&gt;</span>
<span style="color: #008080;">4</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">bean </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="logBefore"</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">="com.hex.second.LogBefore"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">bean</span><span style="color: #0000ff;">&gt;</span></code></pre>

<h3><span style="color: #800080;">4. 配置AOP</span></h3>
<p>通过AOP配置，将通知类和业务逻辑类进行关联，说明如下：</p>
<p>一个配置文件中，可以有多个&lt;aop:config&gt;配置，每一个aop:config中只能有一个aop:pointcut配置，如果有多个切入点需要配置expression，且切入点必须是全路径配置。如下所示：</p>
<src class="cnblogs_code">
<pre><code><span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> 将addStudent和通知进行关联 </span><span style="color: #008000;">--&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">aop:config</span><span style="color: #0000ff;">&gt;</span>
     <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> 每一个config只有一个poingcut，如果有多个，则需要配置多个config </span><span style="color: #008000;">--&gt;</span>
     <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> 配置切入点  id自定义，expression表示切入点的函数名</span><span style="color: #008000;">--&gt;</span>
     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">aop:pointcut </span><span style="color: #ff0000;">expression</span><span style="color: #0000ff;">="execution(public void com.hex.second.StudentServiceImpl.addStudent(com.hex.second.Student))"</span><span style="color: #ff0000;"> id</span><span style="color: #0000ff;">="pc"</span><span style="color: #0000ff;">/&gt;</span>
     <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> 配置通知 </span><span style="color: #008000;">--&gt;</span>
     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">aop:advisor </span><span style="color: #ff0000;">advice-ref</span><span style="color: #0000ff;">="logBefore"</span><span style="color: #ff0000;"> pointcut-ref</span><span style="color: #0000ff;">="pc"</span><span style="color: #0000ff;">/&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">aop:config</span><span style="color: #0000ff;">&gt;</span></code></pre>

<h2><span style="color: #339966;">后置通知</span></h2>
<h3><span style="color: #800080;">1. 实现接口</span></h3>
<p>需要实现【AfterReturningAdvice】接口【afterReturning】方法中的 如下所示：</p>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.hex.second;
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.lang.reflect.Method;
</span><span style="color: #008080;"> 4</span> 
<span style="color: #008080;"> 5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.aop.AfterReturningAdvice;
</span><span style="color: #008080;"> 6</span> 
<span style="color: #008080;"> 7</span> <span style="color: #008000;">/**</span>
<span style="color: #008080;"> 8</span> <span style="color: #008000;"> * 通过实现接口将普通类变成后置通知
</span><span style="color: #008080;"> 9</span> <span style="color: #008000;"> * </span><span style="color: #808080;">@author</span><span style="color: #008000;"> Administrator
</span><span style="color: #008080;">10</span> <span style="color: #008000;"> *
</span><span style="color: #008080;">11</span>  <span style="color: #008000;">*/</span>
<span style="color: #008080;">12</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> LogAfter <span style="color: #0000ff;">implements</span><span style="color: #000000;"> AfterReturningAdvice {
</span><span style="color: #008080;">13</span> 
<span style="color: #008080;">14</span>     <span style="color: #008000;">/**</span>
<span style="color: #008080;">15</span> <span style="color: #008000;">     * 后置通知实现类
</span><span style="color: #008080;">16</span> <span style="color: #008000;">     * returnValue：返回值
</span><span style="color: #008080;">17</span> <span style="color: #008000;">     * method:表示调用的方法，即切入点
</span><span style="color: #008080;">18</span> <span style="color: #008000;">     * args:表示调用方法的参数
</span><span style="color: #008080;">19</span> <span style="color: #008000;">     * target：表示方法所在的目标对象
</span><span style="color: #008080;">20</span>      <span style="color: #008000;">*/</span>
<span style="color: #008080;">21</span> <span style="color: #000000;">    @Override
</span><span style="color: #008080;">22</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> afterReturning(Object returnValue, Method method, Object[] args, Object target) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> Throwable {
</span><span style="color: #008080;">23</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> TODO Auto-generated method stub</span>
<span style="color: #008080;">24</span>         System.out.println("后置通知。。。"<span style="color: #000000;">);
</span><span style="color: #008080;">25</span>         System.out.println("returnValue="+returnValue+",method="+method+",args数量="+args.length+",target="+<span style="color: #000000;">target);
</span><span style="color: #008080;">26</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">27</span> 
<span style="color: #008080;">28</span> }</code></pre>

<h3><span style="color: #800080;">2. 配置切入点和通知的Bean</span></h3>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">bean </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="studentService"</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">="com.hex.second.StudentServiceImpl"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">bean</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">2</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">bean </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="logAfter"</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">="com.hex.second.LogAfter"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">bean</span><span style="color: #0000ff;">&gt;</span></code></pre>

<h3><span style="color: #800080;">3. AOP配置</span></h3>
<p>如果前置通知和后置通知为同一个切入点，则可以配置在一个aop:config节点中，如下所示：</p>
<p>多个切入点用or连接，多个通知就配置多个aop:advisor</p>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> 将addStudent和通知进行关联 </span><span style="color: #008000;">--&gt;</span>
<span style="color: #008080;"> 2</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">aop:config</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 3</span>      <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> 每一个config只有一个poingcut，如果有多个，则需要配置多个config </span><span style="color: #008000;">--&gt;</span>
<span style="color: #008080;"> 4</span>      <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> 配置切入点  id自定义，expression表示切入点的函数名</span><span style="color: #008000;">--&gt;</span>
<span style="color: #008080;"> 5</span>      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">aop:pointcut </span><span style="color: #ff0000;">expression</span><span style="color: #0000ff;">="execution(public void com.hex.second.StudentServiceImpl.deleteStudent(int)) or execution(public void com.hex.second.StudentServiceImpl.addStudent(com.hex.second.Student))"</span><span style="color: #ff0000;"> id</span><span style="color: #0000ff;">="pc"</span><span style="color: #0000ff;">/&gt;</span>
<span style="color: #008080;"> 6</span>      <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> 配置通知 </span><span style="color: #008000;">--&gt;</span>
<span style="color: #008080;"> 7</span>      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">aop:advisor </span><span style="color: #ff0000;">advice-ref</span><span style="color: #0000ff;">="logBefore"</span><span style="color: #ff0000;"> pointcut-ref</span><span style="color: #0000ff;">="pc"</span><span style="color: #0000ff;">/&gt;</span>
<span style="color: #008080;"> 8</span>          
<span style="color: #008080;"> 9</span>      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">aop:advisor </span><span style="color: #ff0000;">advice-ref</span><span style="color: #0000ff;">="logAfter"</span><span style="color: #ff0000;"> pointcut-ref</span><span style="color: #0000ff;">="pc"</span><span style="color: #0000ff;">/&gt;</span>
<span style="color: #008080;">10</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">aop:config</span><span style="color: #0000ff;">&gt;</span></code></pre>

<h2><span style="color: #339966;">异常通知</span></h2>
<h3><span style="color: #800080;">1. 实现接口</span></h3>
<p>异常通知是有异常发生时，才会触发的通知，需要实现【ThrowsAdvice】接口，且此接口没有需要实现的方法，但同时给出了约定：</p>
<p>必须以固定格式实现方法：public void afterThrowing([Method, args, target], ThrowableSubclass);</p>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.hex.second;
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.lang.reflect.Method;
</span><span style="color: #008080;"> 4</span> 
<span style="color: #008080;"> 5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.aop.ThrowsAdvice;
</span><span style="color: #008080;"> 6</span> 
<span style="color: #008080;"> 7</span> <span style="color: #008000;">/**</span>
<span style="color: #008080;"> 8</span> <span style="color: #008000;"> * 异常通知
</span><span style="color: #008080;"> 9</span> <span style="color: #008000;"> * </span><span style="color: #808080;">@author</span><span style="color: #008000;"> Administrator
</span><span style="color: #008080;">10</span> <span style="color: #008000;"> *
</span><span style="color: #008080;">11</span>  <span style="color: #008000;">*/</span>
<span style="color: #008080;">12</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> LogException <span style="color: #0000ff;">implements</span><span style="color: #000000;"> ThrowsAdvice {
</span><span style="color: #008080;">13</span>     
<span style="color: #008080;">14</span>     <span style="color: #008000;">/**</span>
<span style="color: #008080;">15</span> <span style="color: #008000;">     * 异常通知执行
</span><span style="color: #008080;">16</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> method 切入点
</span><span style="color: #008080;">17</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> args 参数个数
</span><span style="color: #008080;">18</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> target 调用目标对象
</span><span style="color: #008080;">19</span> <span style="color: #008000;">     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> ex 异常
</span><span style="color: #008080;">20</span>      <span style="color: #008000;">*/</span>
<span style="color: #008080;">21</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> afterThrowing(Method method, Object[] args, Object target, Exception ex){
</span><span style="color: #008080;">22</span>         System.out.println("异常通知。。。"<span style="color: #000000;">);
</span><span style="color: #008080;">23</span>         System.out.println("method="+method+",args数量="+args.length+",target="+target+",ex="+<span style="color: #000000;">ex);
</span><span style="color: #008080;">24</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">25</span> }</code></pre>

<h3><span style="color: #800080;">2. 配置Bean类</span></h3>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> 服务类 </span><span style="color: #008000;">--&gt;</span>
<span style="color: #008080;">2</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">bean </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="studentService"</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">="com.hex.second.StudentServiceImpl"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">bean</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">3</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">bean </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="logException"</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">="com.hex.second.LogException"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">bean</span><span style="color: #0000ff;">&gt;</span></code></pre>

<h3><span style="color: #800080;">3. 配置AOP</span></h3>
<p>如下所示：参数只需要写参数类型即可，不需要写参数名称</p>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> 可以配置aop:config </span><span style="color: #008000;">--&gt;</span>
<span style="color: #008080;">2</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">aop:config</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">3</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">aop:pointcut </span><span style="color: #ff0000;">expression</span><span style="color: #0000ff;">="execution(public void com.hex.second.StudentServiceImpl.updateStudent(int))"</span><span style="color: #ff0000;"> id</span><span style="color: #0000ff;">="pc1"</span><span style="color: #0000ff;">/&gt;</span>
<span style="color: #008080;">4</span>      <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> 配置通知 </span><span style="color: #008000;">--&gt;</span>
<span style="color: #008080;">5</span>      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">aop:advisor </span><span style="color: #ff0000;">advice-ref</span><span style="color: #0000ff;">="logException"</span><span style="color: #ff0000;"> pointcut-ref</span><span style="color: #0000ff;">="pc1"</span><span style="color: #0000ff;">/&gt;</span>
<span style="color: #008080;">6</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">aop:config</span><span style="color: #0000ff;">&gt;</span></code></pre>

<h2><span style="color: #339966;">环绕通知</span></h2>
<h3><span style="color: #800080;">1. 实现接口</span></h3>
<p>环绕通知，需要实现【MethodInterceptor】接口并实现【invoke】方法，其中obj = invocation.proceed();表示调用目标方法，如果不写此句，则目标方法不会被调用。如下所示：</p>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.hex.second;
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.aopalliance.intercept.MethodInterceptor;
</span><span style="color: #008080;"> 4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.aopalliance.intercept.MethodInvocation;
</span><span style="color: #008080;"> 5</span> 
<span style="color: #008080;"> 6</span> <span style="color: #008000;">/**</span>
<span style="color: #008080;"> 7</span> <span style="color: #008000;"> * 环绕通知
</span><span style="color: #008080;"> 8</span> <span style="color: #008000;"> * 环绕通知的本质上是一个拦截器
</span><span style="color: #008080;"> 9</span> <span style="color: #008000;"> * </span><span style="color: #808080;">@author</span><span style="color: #008000;"> Administrator
</span><span style="color: #008080;">10</span> <span style="color: #008000;"> *
</span><span style="color: #008080;">11</span>  <span style="color: #008000;">*/</span>
<span style="color: #008080;">12</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> LogAround <span style="color: #0000ff;">implements</span><span style="color: #000000;"> MethodInterceptor {
</span><span style="color: #008080;">13</span> 
<span style="color: #008080;">14</span>     <span style="color: #008000;">/**</span>
<span style="color: #008080;">15</span> <span style="color: #008000;">     * 
</span><span style="color: #008080;">16</span>      <span style="color: #008000;">*/</span>
<span style="color: #008080;">17</span> <span style="color: #000000;">    @Override
</span><span style="color: #008080;">18</span>     <span style="color: #0000ff;">public</span> Object invoke(MethodInvocation invocation) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> Throwable {
</span><span style="color: #008080;">19</span>         Object obj = <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;">20</span>         <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;">21</span> 
<span style="color: #008080;">22</span>             <span style="color: #008000;">//</span><span style="color: #008000;"> 前置通知</span>
<span style="color: #008080;">23</span>             System.out.println("环绕实现前置通知。。。"<span style="color: #000000;">);
</span><span style="color: #008080;">24</span>             System.out.println("环绕通知：target="+invocation.getThis()+",method="+invocation.getMethod().getName()+",args="+<span style="color: #000000;">invocation.getArguments().length);
</span><span style="color: #008080;">25</span>             <span style="color: #008000;">//</span><span style="color: #008000;"> 控制目标方法的执行 obj表示目标方法的返回值，表示执行addStudent(student)方法
</span><span style="color: #008080;">26</span>             <span style="color: #008000;">//</span><span style="color: #008000;">此方法控制目标方法的执行，如果不写此方法，则目标方法不会执行，此方法前的是前置通知，此方法后的是后置通知</span>
<span style="color: #008080;">27</span>             obj =<span style="color: #000000;"> invocation.proceed();
</span><span style="color: #008080;">28</span>             <span style="color: #008000;">//</span><span style="color: #008000;"> 后置通知</span>
<span style="color: #008080;">29</span>             System.out.println("环绕实现后置通知。。。"<span style="color: #000000;">);
</span><span style="color: #008080;">30</span>         } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (Exception e) {
</span><span style="color: #008080;">31</span>             <span style="color: #008000;">//</span><span style="color: #008000;"> 异常通知</span>
<span style="color: #008080;">32</span>             System.out.println("环绕实现异常通知。。。"<span style="color: #000000;">);
</span><span style="color: #008080;">33</span>             <span style="color: #0000ff;">throw</span><span style="color: #000000;"> e;
</span><span style="color: #008080;">34</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">35</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> TODO Auto-generated method stub</span>
<span style="color: #008080;">36</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> obj;
</span><span style="color: #008080;">37</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">38</span> 
<span style="color: #008080;">39</span> }</code></pre>

<h3><span style="color: #800080;">2. 配置Bean</span></h3>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> 服务类 </span><span style="color: #008000;">--&gt;</span>
<span style="color: #008080;">2</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">bean </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="studentService"</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">="com.hex.second.StudentServiceImpl"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">bean</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">3</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">bean </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="logAround"</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">="com.hex.second.LogAround"</span><span style="color: #ff0000;">&lt;/bean</span><span style="color: #0000ff;">&gt;</span></code></pre>

<h3><span style="color: #800080;">3. 配置AOP</span></h3>
<p>所有配置切入点通知的方式都是一样的。如下所示：</p>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">aop:config</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">2</span>      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">aop:pointcut </span><span style="color: #ff0000;">expression</span><span style="color: #0000ff;">="execution(public void com.hex.second.StudentServiceImpl.addStudent(com.hex.second.Student))"</span><span style="color: #ff0000;"> id</span><span style="color: #0000ff;">="pc2"</span><span style="color: #0000ff;">/&gt;</span>
<span style="color: #008080;">3</span>      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">aop:advisor </span><span style="color: #ff0000;">advice-ref</span><span style="color: #0000ff;">="logAround"</span><span style="color: #ff0000;"> pointcut-ref</span><span style="color: #0000ff;">="pc2"</span><span style="color: #0000ff;">/&gt;</span>
<span style="color: #008080;">4</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">aop:config</span><span style="color: #0000ff;">&gt;</span></code></pre>

<p>所有的调用方式是一致的，不需要调用通知类，系统会自动调用，如下所示：</p>
<src class="cnblogs_code" onclick="cnblogs_code_show('d29d176d-f6df-4d2c-ae8a-ca25d772f660')"><img id="code_img_closed_d29d176d-f6df-4d2c-ae8a-ca25d772f660" class="code_img_closed" src="./images/一起学Spring之AOP1.png" alt="" /><img id="code_img_opened_d29d176d-f6df-4d2c-ae8a-ca25d772f660" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('d29d176d-f6df-4d2c-ae8a-ca25d772f660',event)" src="./images/一起学Spring之AOP2.png" alt="" />
<src id="cnblogs_code_open_d29d176d-f6df-4d2c-ae8a-ca25d772f660" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.hex.second;
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.context.ApplicationContext;
</span><span style="color: #008080;"> 4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.context.support.ClassPathXmlApplicationContext;
</span><span style="color: #008080;"> 5</span> 
<span style="color: #008080;"> 6</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> TestMain {
</span><span style="color: #008080;"> 7</span> 
<span style="color: #008080;"> 8</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> main(String[] args) {
</span><span style="color: #008080;"> 9</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> TODO Auto-generated method stub
</span><span style="color: #008080;">10</span>         <span style="color: #008000;">//</span><span style="color: #008000;">通过Spring进行注入，Spring上下文对象</span>
<span style="color: #008080;">11</span>         ApplicationContext context=<span style="color: #0000ff;">new</span> ClassPathXmlApplicationContext("applicationContext.xml"<span style="color: #000000;">);
</span><span style="color: #008080;">12</span>         IStudentService studentService=(IStudentService)context.getBean("studentService"<span style="color: #000000;">);
</span><span style="color: #008080;">13</span>         Student student =<span style="color: #0000ff;">new</span><span style="color: #000000;"> Student();
</span><span style="color: #008080;">14</span> <span style="color: #000000;">        studentService.addStudent(student);
</span><span style="color: #008080;">15</span>         <span style="color: #008000;">//</span><span style="color: #008000;">studentService.deleteStudent(1);
</span><span style="color: #008080;">16</span>         <span style="color: #008000;">//</span><span style="color: #008000;">studentService.updateStudent(0);</span>
<span style="color: #008080;">17</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">18</span> 
<span style="color: #008080;">19</span> }</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<p>&nbsp;</p>
<h2><span style="color: #339966;">备注</span></h2>
<p>合抱之木，生于毫末;九层之台，起于累土;千里之行，始于足下。</p>

</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>