<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修分布式id生成器' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>分布式id生成器</center></div><div class='banquan'>原文出处:本文由博客园博主Java知音*提供。<br/>
原文连接:https://www.cnblogs.com/javazhiyin/p/11606357.html</div><br>
    <blockquote>
<p>作者：CoderZS</p>
<p>juejin.im/post/5d8882d8f265da03e369c063</p>
</blockquote>
<p>在高并发或者分表分库情况下怎么保证数据id的幂等性呢</p>
<p>经常用到的解决方案有以下几种。</p>
<blockquote>
<p>微软公司通用唯一识别码（UUID）<br />Twitter公司雪花算法（SnowFlake）<br />基于数据库的id自增<br />对id进行缓存</p>

</blockquote>
<p>这里我们要谈到snowflake算法了</p>
<p>snowflake是Twitter开源的分布式ID生成算法，结果是一个long型的ID。其核心思想是：使用41bit作为毫秒数，10bit作为机器的ID（5个bit是数据中心，5个bit的机器ID），12bit作为毫秒内的流水号，最后还有一个符号位，永远是0。</p>
<p>snowflake算法所生成的ID结构</p>
<p><img class="rich_pages" title="分布式id生成器" src="./images/分布式id生成器0.png" alt="分布式id生成器" data-original="./images/分布式id生成器0.png" /></p>
<p>整个结构是64位，所以我们在Java中可以使用long来进行存储。该算法实现基本就是二进制操作,单机每秒内理论上最多可以生成1024*(2^12)，也就是409.6万个ID(1024 X 4096 = 4194304)</p>
<ul class="list-paddingleft-2">
<li>
<p>0 - 0000000000 0000000000 0000000000 0000000000 0 - 00000 - 00000 - 000000000000</p>

</li>
<li>
<p>1位标识，由于long基本类型在Java中是带符号的，最高位是符号位，正数是0，负数是1，所以id一般是正数，最高位是0</p>

</li>
<li>
<p>41位时间截(毫秒级)，注意，41位时间截不是存储当前时间的时间截，而是存储时间截的差值（当前时间截 - 开始时间截)</p>

</li>
<li>
<p>得到的值），这里的的开始时间截，一般是我们的id生成器开始使用的时间，由我们程序来指定的（如下下面程序IdWorker类的startTime属性）。41位的时间截，可以使用69年，年T = (1L &lt;&lt; 41) / (1000L * 60 * 60 * 24 * 365) = 69</p>

</li>
<li>
<p>10位的数据机器位，可以部署在1024个节点，包括5位datacenterId和5位workerId</p>

</li>
<li>
<p>12位序列，毫秒内的计数，12位的计数顺序号支持每个节点每毫秒(同一机器，同一时间截)产生4096个ID序号</p>

</li>
<li>
<p>加起来刚好64位，为一个Long型。</p>

</li>
<li>
<p>SnowFlake的优点是，整体上按照时间自增排序，并且整个分布式系统内不会产生ID碰撞(由数据中心ID和机器ID作区分)，并且效率较高，经测试，SnowFlake每秒能够产生26万ID左右。</p>

</li>

</ul>
<p><strong>snowFlake算法的优点：</strong></p>
<ol class="list-paddingleft-2">
<li>
<p>生成ID时不依赖于DB，完全在内存生成，高性能高可用。</p>

</li>
<li>
<p>ID呈趋势递增，后续插入索引树的时候性能较好。</p>

</li>

</ol>
<p><strong>SnowFlake算法的缺点：</strong></p>
<p>依赖于系统时钟的一致性。如果某台机器的系统时钟回拨，有可能造成ID冲突，或者ID乱序</p>
<p><strong>算法代码如下</strong></p>
<pre><code><code class="hljs cs"><span class="hljs-keyword">public&nbsp;<span class="hljs-keyword">class&nbsp;<span class="hljs-title">SnowflakeIdWorker&nbsp;{<br />&nbsp;<span class="hljs-comment">//&nbsp;==============================Fields==================<br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">/**&nbsp;开始时间截&nbsp;(2019-08-06)&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">private&nbsp;final&nbsp;<span class="hljs-keyword">long&nbsp;twepoch&nbsp;=&nbsp;<span class="hljs-number">1565020800000L;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">/**&nbsp;机器id所占的位数&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">private&nbsp;final&nbsp;<span class="hljs-keyword">long&nbsp;workerIdBits&nbsp;=&nbsp;<span class="hljs-number">5L;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">/**&nbsp;数据标识id所占的位数&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">private&nbsp;final&nbsp;<span class="hljs-keyword">long&nbsp;datacenterIdBits&nbsp;=&nbsp;<span class="hljs-number">5L;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">/**&nbsp;支持的最大机器id，结果是31&nbsp;(这个移位算法可以很快的计算出几位二进制数所能表示的最大十进制数)&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">private&nbsp;final&nbsp;<span class="hljs-keyword">long&nbsp;maxWorkerId&nbsp;=&nbsp;<span class="hljs-number">-1L&nbsp;^&nbsp;(<span class="hljs-number">-1L&nbsp;&lt;&lt;&nbsp;workerIdBits);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">/**&nbsp;支持的最大数据标识id，结果是31&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">private&nbsp;final&nbsp;<span class="hljs-keyword">long&nbsp;maxDatacenterId&nbsp;=&nbsp;<span class="hljs-number">-1L&nbsp;^&nbsp;(<span class="hljs-number">-1L&nbsp;&lt;&lt;&nbsp;datacenterIdBits);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">/**&nbsp;序列在id中占的位数&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">private&nbsp;final&nbsp;<span class="hljs-keyword">long&nbsp;sequenceBits&nbsp;=&nbsp;<span class="hljs-number">12L;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">/**&nbsp;机器ID向左移12位&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">private&nbsp;final&nbsp;<span class="hljs-keyword">long&nbsp;workerIdShift&nbsp;=&nbsp;sequenceBits;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">/**&nbsp;数据标识id向左移17位(12+5)&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">private&nbsp;final&nbsp;<span class="hljs-keyword">long&nbsp;datacenterIdShift&nbsp;=&nbsp;sequenceBits&nbsp;+&nbsp;workerIdBits;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">/**&nbsp;时间截向左移22位(5+5+12)&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">private&nbsp;final&nbsp;<span class="hljs-keyword">long&nbsp;timestampLeftShift&nbsp;=&nbsp;sequenceBits&nbsp;+&nbsp;workerIdBits&nbsp;+&nbsp;datacenterIdBits;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">/**&nbsp;生成序列的掩码，这里为4095&nbsp;(0b111111111111=0xfff=4095)&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">private&nbsp;final&nbsp;<span class="hljs-keyword">long&nbsp;sequenceMask&nbsp;=&nbsp;<span class="hljs-number">-1L&nbsp;^&nbsp;(<span class="hljs-number">-1L&nbsp;&lt;&lt;&nbsp;sequenceBits);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">/**&nbsp;工作机器ID(0~31)&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">private&nbsp;<span class="hljs-keyword">long&nbsp;workerId;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">/**&nbsp;数据中心ID(0~31)&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">private&nbsp;<span class="hljs-keyword">long&nbsp;datacenterId;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">/**&nbsp;毫秒内序列(0~4095)&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">private&nbsp;<span class="hljs-keyword">long&nbsp;sequence&nbsp;=&nbsp;<span class="hljs-number">0L;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">/**&nbsp;上次生成ID的时间截&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">private&nbsp;<span class="hljs-keyword">long&nbsp;lastTimestamp&nbsp;=&nbsp;<span class="hljs-number">-1L;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//==============================Constructors====================<br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;构造函数<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;workerId&nbsp;工作ID&nbsp;(0~31)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;datacenterId&nbsp;数据中心ID&nbsp;(0~31)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">public&nbsp;<span class="hljs-title">SnowflakeIdWorker(<span class="hljs-params"><span class="hljs-keyword">long&nbsp;workerId,&nbsp;<span class="hljs-keyword">long&nbsp;datacenterId)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if&nbsp;(workerId&nbsp;&gt;&nbsp;maxWorkerId&nbsp;||&nbsp;workerId&nbsp;&lt;&nbsp;<span class="hljs-number">0)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">throw&nbsp;<span class="hljs-keyword">new&nbsp;IllegalArgumentException(String.format(<span class="hljs-string">"worker&nbsp;Id&nbsp;can't&nbsp;be&nbsp;greater&nbsp;than&nbsp;%d&nbsp;or&nbsp;less&nbsp;than&nbsp;0",&nbsp;maxWorkerId));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if&nbsp;(datacenterId&nbsp;&gt;&nbsp;maxDatacenterId&nbsp;||&nbsp;datacenterId&nbsp;&lt;&nbsp;<span class="hljs-number">0)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">throw&nbsp;<span class="hljs-keyword">new&nbsp;IllegalArgumentException(String.format(<span class="hljs-string">"datacenter&nbsp;Id&nbsp;can't&nbsp;be&nbsp;greater&nbsp;than&nbsp;%d&nbsp;or&nbsp;less&nbsp;than&nbsp;0",&nbsp;maxDatacenterId));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this.workerId&nbsp;=&nbsp;workerId;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this.datacenterId&nbsp;=&nbsp;datacenterId;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//&nbsp;==============================Methods=================================<br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;获得下一个ID&nbsp;(该方法是线程安全的)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;SnowflakeId<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">public&nbsp;synchronized&nbsp;<span class="hljs-keyword">long&nbsp;<span class="hljs-title">nextId(<span class="hljs-params">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">long&nbsp;timestamp&nbsp;=&nbsp;timeGen();<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//如果当前时间小于上一次ID生成的时间戳，说明系统时钟回退过这个时候应当抛出异常<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if&nbsp;(timestamp&nbsp;&lt;&nbsp;lastTimestamp)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">throw&nbsp;<span class="hljs-keyword">new&nbsp;RuntimeException(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String.format(<span class="hljs-string">"Clock&nbsp;moved&nbsp;backwards.&nbsp;&nbsp;Refusing&nbsp;to&nbsp;generate&nbsp;id&nbsp;for&nbsp;%d&nbsp;milliseconds",&nbsp;lastTimestamp&nbsp;-&nbsp;timestamp));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//如果是同一时间生成的，则进行毫秒内序列<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if&nbsp;(lastTimestamp&nbsp;==&nbsp;timestamp)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sequence&nbsp;=&nbsp;(sequence&nbsp;+&nbsp;<span class="hljs-number">1)&nbsp;&amp;&nbsp;sequenceMask;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//毫秒内序列溢出<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if&nbsp;(sequence&nbsp;==&nbsp;<span class="hljs-number">0)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//阻塞到下一个毫秒,获得新的时间戳<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;timestamp&nbsp;=&nbsp;tilNextMillis(lastTimestamp);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//时间戳改变，毫秒内序列重置<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sequence&nbsp;=&nbsp;<span class="hljs-number">0L;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//上次生成ID的时间截<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lastTimestamp&nbsp;=&nbsp;timestamp;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//移位并通过或运算拼到一起组成64位的ID<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return&nbsp;((timestamp&nbsp;-&nbsp;twepoch)&nbsp;&lt;&lt;&nbsp;timestampLeftShift)&nbsp;<span class="hljs-comment">//<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;(datacenterId&nbsp;&lt;&lt;&nbsp;datacenterIdShift)&nbsp;<span class="hljs-comment">//<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;(workerId&nbsp;&lt;&lt;&nbsp;workerIdShift)&nbsp;<span class="hljs-comment">//<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;sequence;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;阻塞到下一个毫秒，直到获得新的时间戳<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;lastTimestamp&nbsp;上次生成ID的时间截<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;当前时间戳<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">protected&nbsp;<span class="hljs-keyword">long&nbsp;<span class="hljs-title">tilNextMillis(<span class="hljs-params"><span class="hljs-keyword">long&nbsp;lastTimestamp)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">long&nbsp;timestamp&nbsp;=&nbsp;timeGen();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">while&nbsp;(timestamp&nbsp;&lt;=&nbsp;lastTimestamp)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;timestamp&nbsp;=&nbsp;timeGen();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return&nbsp;timestamp;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;返回以毫秒为单位的当前时间<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;当前时间(毫秒)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">protected&nbsp;<span class="hljs-keyword">long&nbsp;<span class="hljs-title">timeGen(<span class="hljs-params">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return&nbsp;System.currentTimeMillis();<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//==============================Test=============================================<br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">/**&nbsp;测试&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">public&nbsp;<span class="hljs-keyword">static&nbsp;<span class="hljs-keyword">void&nbsp;<span class="hljs-title">main(<span class="hljs-params">String[]&nbsp;args)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SnowflakeIdWorker&nbsp;idWorker&nbsp;=&nbsp;<span class="hljs-keyword">new&nbsp;SnowflakeIdWorker(<span class="hljs-number">0,&nbsp;<span class="hljs-number">0);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">for&nbsp;(<span class="hljs-keyword">int&nbsp;i&nbsp;=&nbsp;<span class="hljs-number">0;&nbsp;i&nbsp;&lt;&nbsp;<span class="hljs-number">1000;&nbsp;i++)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">long&nbsp;id&nbsp;=&nbsp;idWorker.nextId();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.<span class="hljs-keyword">out.println(Long.toBinaryString(id));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.<span class="hljs-keyword">out.println(id);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>
<h3>快速使用snowflake算法只需以下几步</h3>
<p>引入hutool依赖</p>
<pre><code><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">groupId&gt;cn.hutool<span class="hljs-tag">&lt;/<span class="hljs-name">groupId&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">artifactId&gt;hutool-captcha<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">version&gt;${hutool.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version&gt;<br /><span class="hljs-tag">&lt;/<span class="hljs-name">dependency&gt;<br /></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>
<p>ID 生成器</p>
<pre><code><code class="hljs java"><span class="hljs-keyword">public&nbsp;<span class="hljs-class"><span class="hljs-keyword">class&nbsp;<span class="hljs-title">IdGenerator&nbsp;{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">private&nbsp;<span class="hljs-keyword">long&nbsp;workerId&nbsp;=&nbsp;<span class="hljs-number">0;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-meta">@PostConstruct<br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">void&nbsp;<span class="hljs-title">init<span class="hljs-params">()&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">try&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;workerId&nbsp;=&nbsp;NetUtil.ipv4ToLong(NetUtil.getLocalhostStr());<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.info(<span class="hljs-string">"当前机器&nbsp;workerId:&nbsp;{}",&nbsp;workerId);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span class="hljs-keyword">catch&nbsp;(Exception&nbsp;e)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.warn(<span class="hljs-string">"获取机器&nbsp;ID&nbsp;失败",&nbsp;e);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;workerId&nbsp;=&nbsp;NetUtil.getLocalhost().hashCode();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.info(<span class="hljs-string">"当前机器&nbsp;workerId:&nbsp;{}",&nbsp;workerId);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;获取一个批次号，形如&nbsp;2019071015301361000101237<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&lt;p&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;数据库使用&nbsp;char(25)&nbsp;存储<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;<span class="hljs-doctag">@param&nbsp;tenantId&nbsp;租户ID，5&nbsp;位<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;<span class="hljs-doctag">@param&nbsp;module&nbsp;&nbsp;&nbsp;业务模块ID，2&nbsp;位<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;<span class="hljs-doctag">@return&nbsp;返回批次号<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">public&nbsp;<span class="hljs-keyword">synchronized&nbsp;String&nbsp;<span class="hljs-title">batchId<span class="hljs-params">(<span class="hljs-keyword">int&nbsp;tenantId,&nbsp;<span class="hljs-keyword">int&nbsp;<span class="hljs-keyword">module)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;prefix&nbsp;=&nbsp;DateTime.now().toString(DatePattern.PURE_DATETIME_MS_PATTERN);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return&nbsp;prefix&nbsp;+&nbsp;tenantId&nbsp;+&nbsp;<span class="hljs-keyword">module&nbsp;+&nbsp;RandomUtil.randomNumbers(<span class="hljs-number">3);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-meta">@Deprecated<br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">public&nbsp;<span class="hljs-keyword">synchronized&nbsp;String&nbsp;<span class="hljs-title">getBatchId<span class="hljs-params">(<span class="hljs-keyword">int&nbsp;tenantId,&nbsp;<span class="hljs-keyword">int&nbsp;<span class="hljs-keyword">module)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return&nbsp;batchId(tenantId,&nbsp;<span class="hljs-keyword">module);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;生成的是不带-的字符串，类似于：b17f24ff026d40949c85a24f4f375d42<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;<span class="hljs-doctag">@return<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">public&nbsp;String&nbsp;<span class="hljs-title">simpleUUID<span class="hljs-params">()&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return&nbsp;IdUtil.simpleUUID();<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;生成的UUID是带-的字符串，类似于：a5c8a5e8-df2b-4706-bea4-08d0939410e3<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;<span class="hljs-doctag">@return<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">public&nbsp;String&nbsp;<span class="hljs-title">randomUUID<span class="hljs-params">()&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return&nbsp;IdUtil.randomUUID();<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">private&nbsp;Snowflake&nbsp;snowflake&nbsp;=&nbsp;IdUtil.createSnowflake(workerId,&nbsp;<span class="hljs-number">1);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">public&nbsp;<span class="hljs-keyword">synchronized&nbsp;<span class="hljs-keyword">long&nbsp;<span class="hljs-title">snowflakeId<span class="hljs-params">()&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return&nbsp;snowflake.nextId();<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">public&nbsp;<span class="hljs-keyword">synchronized&nbsp;<span class="hljs-keyword">long&nbsp;<span class="hljs-title">snowflakeId<span class="hljs-params">(<span class="hljs-keyword">long&nbsp;workerId,&nbsp;<span class="hljs-keyword">long&nbsp;dataCenterId)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Snowflake&nbsp;snowflake&nbsp;=&nbsp;IdUtil.createSnowflake(workerId,&nbsp;dataCenterId);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return&nbsp;snowflake.nextId();<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;生成类似：5b9e306a4df4f8c54a39fb0c<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&lt;p&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;ObjectId&nbsp;是&nbsp;MongoDB&nbsp;数据库的一种唯一&nbsp;ID&nbsp;生成策略，<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;是 UUID version1 的变种，详细介绍可见：服务化框架－分布式 Unique ID 的生成方法一览。<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;<span class="hljs-doctag">@return<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">public&nbsp;String&nbsp;<span class="hljs-title">objectId<span class="hljs-params">()&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return&nbsp;ObjectId.next();<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />}<br /></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>
<p>测试类</p>
<pre><code><code class="hljs java"><span class="hljs-keyword">public&nbsp;<span class="hljs-class"><span class="hljs-keyword">class&nbsp;<span class="hljs-title">IdGeneratorTest&nbsp;{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-meta">@Autowired<br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">private&nbsp;IdGenerator&nbsp;idGenerator;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-meta">@Test<br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">public&nbsp;<span class="hljs-keyword">void&nbsp;<span class="hljs-title">testBatchId<span class="hljs-params">()&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">for&nbsp;(<span class="hljs-keyword">int&nbsp;i&nbsp;=&nbsp;<span class="hljs-number">0;&nbsp;i&nbsp;&lt;&nbsp;<span class="hljs-number">100;&nbsp;i++)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;batchId&nbsp;=&nbsp;idGenerator.batchId(<span class="hljs-number">1001,&nbsp;<span class="hljs-number">100);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.info(<span class="hljs-string">"批次号:&nbsp;{}",&nbsp;batchId);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-meta">@Test<br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">public&nbsp;<span class="hljs-keyword">void&nbsp;<span class="hljs-title">testSimpleUUID<span class="hljs-params">()&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">for&nbsp;(<span class="hljs-keyword">int&nbsp;i&nbsp;=&nbsp;<span class="hljs-number">0;&nbsp;i&nbsp;&lt;&nbsp;<span class="hljs-number">100;&nbsp;i++)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;simpleUUID&nbsp;=&nbsp;idGenerator.simpleUUID();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.info(<span class="hljs-string">"simpleUUID:&nbsp;{}",&nbsp;simpleUUID);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-meta">@Test<br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">public&nbsp;<span class="hljs-keyword">void&nbsp;<span class="hljs-title">testRandomUUID<span class="hljs-params">()&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">for&nbsp;(<span class="hljs-keyword">int&nbsp;i&nbsp;=&nbsp;<span class="hljs-number">0;&nbsp;i&nbsp;&lt;&nbsp;<span class="hljs-number">100;&nbsp;i++)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;randomUUID&nbsp;=&nbsp;idGenerator.randomUUID();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.info(<span class="hljs-string">"randomUUID:&nbsp;{}",&nbsp;randomUUID);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-meta">@Test<br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">public&nbsp;<span class="hljs-keyword">void&nbsp;<span class="hljs-title">testObjectID<span class="hljs-params">()&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">for&nbsp;(<span class="hljs-keyword">int&nbsp;i&nbsp;=&nbsp;<span class="hljs-number">0;&nbsp;i&nbsp;&lt;&nbsp;<span class="hljs-number">100;&nbsp;i++)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;objectId&nbsp;=&nbsp;idGenerator.objectId();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.info(<span class="hljs-string">"objectId:&nbsp;{}",&nbsp;objectId);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-meta">@Test<br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">public&nbsp;<span class="hljs-keyword">void&nbsp;<span class="hljs-title">testSnowflakeId<span class="hljs-params">()&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ExecutorService&nbsp;executorService&nbsp;=&nbsp;Executors.newFixedThreadPool(<span class="hljs-number">20);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">for&nbsp;(<span class="hljs-keyword">int&nbsp;i&nbsp;=&nbsp;<span class="hljs-number">0;&nbsp;i&nbsp;&lt;&nbsp;<span class="hljs-number">20;&nbsp;i++)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;executorService.execute(()&nbsp;-&gt;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.info(<span class="hljs-string">"分布式&nbsp;ID:&nbsp;{}",&nbsp;idGenerator.snowflakeId());<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;executorService.shutdown();<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />}</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></code></pre>
<p>&nbsp;</p>
<p><img class="rich_pages" title="分布式id生成器" src="./images/分布式id生成器1.png" alt="分布式id生成器" data-original="./images/分布式id生成器1.png" /></p>
<p>在项目中我们只需要注入&nbsp;<code>@Autowired private IdGenerator idGenerator;</code>即可</p>
<p>然后设置id&nbsp;<code>order.setId(idGenerator.snowflakeId() + "");</code></p>
<p><em><strong>推荐阅读(点击即可跳转阅读)</strong></em></p>
<p><strong>1.</strong><a href="https://www.javazhiyin.com/go?url=http://mp.weixin.qq.com/s?__biz=MzI4Njc5NjM1NQ==&amp;mid=2247488811&amp;idx=2&amp;sn=0d054027651bef114ae6bec5a8f62359&amp;chksm=ebd62a07dca1a3111269692dd9b0a5ab8af7d2038b8ec6600a057573364e76db1332adc5fd46&amp;scene=21#wechat_redirect" rel="nofollow" target="_blank">SpringBoot内容聚合</a></p>
<p><strong>2.</strong><a href="https://www.javazhiyin.com/go?url=http://mp.weixin.qq.com/s?__biz=MzI4Njc5NjM1NQ==&amp;mid=2247488811&amp;idx=3&amp;sn=b04d8fdacf575c7ec959de4107f31091&amp;chksm=ebd62a07dca1a31186f7f62de60ba7c7a88db26233562ed7183c6f609c5e7f4ffb448f30375f&amp;scene=21#wechat_redirect" rel="nofollow" target="_blank">面试题内容聚合</a></p>
<p><strong>3.</strong><a href="https://www.javazhiyin.com/go?url=http://mp.weixin.qq.com/s?__biz=MzI4Njc5NjM1NQ==&amp;mid=2247488811&amp;idx=4&amp;sn=ec20f59a5b67a59d98d221bd20d78448&amp;chksm=ebd62a07dca1a31188dafea0e6984b4883fa972a32ff31da2df6f52fcc73b56c6c9454751d73&amp;scene=21#wechat_redirect" rel="nofollow" target="_blank">设计模式内容聚合</a></p>
<p><strong>4.</strong><a href="https://www.javazhiyin.com/go?url=http://mp.weixin.qq.com/s?__biz=MzI4Njc5NjM1NQ==&amp;mid=2247488945&amp;idx=2&amp;sn=2c0326af621ac51f33720e2608121cef&amp;chksm=ebd62a9ddca1a38b8e284b413a8eea08aa452fdeda3c4740325803514d30029a2ab4af5bdfed&amp;scene=21#wechat_redirect" rel="nofollow" target="_blank">Mybatis内容聚合</a></p>
<p><strong>5.</strong><a href="https://www.javazhiyin.com/go?url=http://mp.weixin.qq.com/s?__biz=MzI4Njc5NjM1NQ==&amp;mid=2247488811&amp;idx=6&amp;sn=a769526cf5c4dfc5b0f8e5a40f984cff&amp;chksm=ebd62a07dca1a3116cc6c45ceb7a81d47293b9811c8df97b5ca363c6370ffccfd913bab3599f&amp;scene=21#wechat_redirect" rel="nofollow" target="_blank">多线程内容聚合</a></p>
<p>&nbsp;</p>

</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>