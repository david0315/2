<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修Struts2处理（jQuery）Ajax请求' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>Struts2处理（jQuery）Ajax请求</center></div><div class='banquan'>原文出处:本文由博客园博主我想和你拍照片提供。<br/>
原文连接:https://www.cnblogs.com/1314520wly/p/mylove.html</div><br>
    <p><strong><span style="font-size: 18px;">1. Ajax</span></strong></p>
<p><strong><span style="font-size: 18px;">&nbsp; &nbsp;&nbsp;</span></strong><span style="font-size: 16px;">Ajax(Asynchronous JavaScript and XML，异步JavaScript和XML)时一种创建交互式网页应用的网页开发技术，它并不是一项新的技术，其产生的目的是用于实现页面的局部刷新。通过Ajax技术可以使之前的应用程序在每次提交时不用进行页面的整体刷新，从而提升操作的性能。</span></p>
<p><span style="font-size: 18px;"><strong>2. jQuery</strong></span></p>
<p><span style="font-size: 18px;"><strong>&nbsp; &nbsp;</strong><span style="font-size: 16px;">&nbsp;jQuery是一个JavaScript函数库，极大的简化了JavaScript编程，很容易学习。jQuery是目前最流行的开源js框架，并且提供了大量的扩展。</span></span></p>
<p><span style="font-size: 18px;"><strong>3. Struts2框架</strong></span></p>
<p><span style="font-size: 16px;">&nbsp; &nbsp; 了解一下MVC模式，</span><span style="font-size: 16px;">MVC 模式代表 Model-View-Controller（模型-视图-控制器） 模式。MVC是一种软件设计典范。这种模式用于应用程序的分层开发。</span></p>
<p><span style="font-size: 16px;"><strong>&nbsp; &nbsp; Model（模型）</strong>&nbsp;- 模型代表一个存取数据的对象或 JAVA POJO。它也可以带有逻辑，在数据变化时更新控制器。</span></p>
<p><span style="font-size: 16px;"><strong>&nbsp; &nbsp; View（视图）</strong>&nbsp;- 视图代表模型包含的数据的可视化。</span></p>
<p><span style="font-size: 16px;"><strong>&nbsp; &nbsp; Controller（控制器）</strong>&nbsp;- 控制器作用于模型和视图上。它控制数据流向模型对象，并在数据变化时更新视图。它使视图与模型分离开。</span></p>
<p><span style="font-size: 16px;">&nbsp; &nbsp; Apache Struts是一个免费的开源MVC框架，用于创建优雅的现代Java Web应用程序。它支持约定胜于配置（约定大于配置，简单来说就是简化我们的开发的，使代码更加简洁，并且有很好的可重用性和可扩展性），可以使用插件体系结构进行扩展，并且附带了支持REST，AJAX和JSON的插件。Struts2是一个基于MVC设计模式的Web应用框架，它本质上相当于一个servlet，在MVC设计模式中，Struts2作为控制器(Controller)来建立模型与视图的数据交互。Struts2是在Struts1和WebWork的技术基础上进行全新开发，以WebWork为核心，采用拦截器的机制来处理用户的请求，这样的设计也使得业务逻辑控制器能够与ServletAPI完全脱离开(解耦合)，方便了我们进行Java Web开发。</span></p>
<p><span style="font-size: 18px;"><strong>4. Struts2处理(jQuery)Ajax请求（（发送key/value数据）/发送json数据）</strong></span></p>
<p><span style="font-size: 16px;"><strong>&nbsp; &nbsp; &nbsp;</strong>开发环境：eclipse+Struts2+jsp+jQuery+Ajax+Jackson+tomcat</span></p>
<p><span style="font-size: 18px;"><strong>4.1 Struts2处理(jQuery)Ajax请求（不发送数据，返回普通文本）</strong></span></p>
<p><strong><span style="font-size: 18px;">(1) 搭建环境</span></strong></p>
<p><span style="font-size: 18px;"><span style="font-size: 16px;">&nbsp; &nbsp; &nbsp;在eclipse中新建Java web项目（会自动导入JRE System Library包），比如我把项目名字写为MyStrutsAjaxDemo，并将项目部署到tomcat服务器上，下面是eclipse中项目的目录结构：</span></span></p>
<p><span style="font-size: 18px;"><span style="font-size: 16px;"><img src="./images/Struts2处理（jQuery）Ajax请求0.png" alt="" />&nbsp; &nbsp;&nbsp;<img src="./images/Struts2处理（jQuery）Ajax请求1.png" alt="" /></span></span></p>
<p><span style="font-size: 18px;"><span style="font-size: 16px;">项目结构很简单。这里我们看一下lib目录下的jar包，因为我们使用了Struts2框架进行开发，所以必须导入Struts2开发包。Struts2有很多开发包，这里我们导入我们想用的就行了。如上所示。Struts2开发包：asm三个jar包，commons三个，freemarker的jar包，ongl的jar包，strts2-core和核心jar包，Struts2内置的json插件jar包struts2-json（不可以忘记导入哈！），用来处理json数据。javassist的jar包。还有一个xwork-core核心包。日志jar包：log4j（2个）。Jackson开发包：3个。（不懂的话可以看我上篇博客）。好了，jar包就说完了。下面进行开发。</span></span></p>
<p><span style="font-size: 18px;"><strong>（2）编写jsp文件</strong></span></p>
<p><span style="font-size: 18px;"><span style="font-size: 16px;">&nbsp; &nbsp;客户端不发送数据，服务器端返回一个普通文本。这里我们主要熟悉一下流程，看一下效果，虽然说不发送数据没多大意义。</span></span></p>
<p>&nbsp;</p>
<src class="cnblogs_code">
<pre><code><span style="background-color: #ffff00; color: #000000;">&lt;%</span><span style="background-color: #f5f5f5; color: #000000;">@ page language</span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #800000;">"</span><span style="background-color: #f5f5f5; color: #800000;">java</span><span style="background-color: #f5f5f5; color: #800000;">"</span><span style="background-color: #f5f5f5; color: #000000;"> import</span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #800000;">"</span><span style="background-color: #f5f5f5; color: #800000;">java.util.*</span><span style="background-color: #f5f5f5; color: #800000;">"</span><span style="background-color: #f5f5f5; color: #000000;"> pageEncoding</span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #800000;">"</span><span style="background-color: #f5f5f5; color: #800000;">UTF-8</span><span style="background-color: #f5f5f5; color: #800000;">"</span><span style="background-color: #ffff00; color: #000000;">%&gt;</span>

<span style="background-color: #ffff00; color: #000000;">&lt;%</span><span style="background-color: #f5f5f5; color: #000000;">--</span> <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">%@ taglib uri</span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #800000;">"</span><span style="background-color: #f5f5f5; color: #800000;">http://java.sun.com/jsp/jstl/core</span><span style="background-color: #f5f5f5; color: #800000;">"</span><span style="background-color: #f5f5f5; color: #000000;"> prefix</span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #800000;">"</span><span style="background-color: #f5f5f5; color: #800000;">c</span><span style="background-color: #f5f5f5; color: #800000;">"</span><span style="background-color: #ffff00; color: #000000;">%&gt;</span><span style="color: #000000;"> --%&gt;
</span><span style="background-color: #ffff00; color: #000000;">&lt;%</span>
    <span style="background-color: #f5f5f5; color: #0000ff;">String</span><span style="background-color: #f5f5f5; color: #000000;"> path </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> request.getContextPath();
    </span><span style="background-color: #f5f5f5; color: #0000ff;">String</span><span style="background-color: #f5f5f5; color: #000000;"> basePath </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> request.getScheme() </span><span style="background-color: #f5f5f5; color: #000000;">+</span> <span style="background-color: #f5f5f5; color: #800000;">"</span><span style="background-color: #f5f5f5; color: #800000;">://</span><span style="background-color: #f5f5f5; color: #800000;">"</span> <span style="background-color: #f5f5f5; color: #000000;">+</span><span style="background-color: #f5f5f5; color: #000000;"> request.getServerName() </span><span style="background-color: #f5f5f5; color: #000000;">+</span> <span style="background-color: #f5f5f5; color: #800000;">"</span><span style="background-color: #f5f5f5; color: #800000;">:</span><span style="background-color: #f5f5f5; color: #800000;">"</span> <span style="background-color: #f5f5f5; color: #000000;">+</span><span style="background-color: #f5f5f5; color: #000000;"> request.getServerPort()
            </span><span style="background-color: #f5f5f5; color: #000000;">+</span><span style="background-color: #f5f5f5; color: #000000;"> path </span><span style="background-color: #f5f5f5; color: #000000;">+</span> <span style="background-color: #f5f5f5; color: #800000;">"</span><span style="background-color: #f5f5f5; color: #800000;">/</span><span style="background-color: #f5f5f5; color: #800000;">"</span><span style="background-color: #f5f5f5; color: #000000;">;
</span><span style="background-color: #ffff00; color: #000000;">%&gt;</span>
<span style="color: #0000ff;">&lt;!</span><span style="color: #ff00ff;">DOCTYPE html</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">html</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">head</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">base </span><span style="color: #ff0000;">href</span><span style="color: #0000ff;">="&lt;%=basePath%&gt;"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">title</span><span style="color: #0000ff;">&gt;</span>I LOVE YOU<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">title</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">link </span><span style="color: #ff0000;">rel</span><span style="color: #0000ff;">="stylesheet"</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">="text/css"</span><span style="color: #ff0000;"> href</span><span style="color: #0000ff;">=""</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="text/javascript"</span><span style="color: #ff0000;"> src</span><span style="color: #0000ff;">="myindex.js"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="text/javascript"</span><span style="color: #ff0000;"> src</span><span style="color: #0000ff;">="jquery-3.2.1.min.js"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>


<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">head</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>

<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">button </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="mybutton1"</span><span style="color: #ff0000;"> value</span><span style="color: #0000ff;">="struts2处理（jQuery）Ajax请求"</span><span style="color: #ff0000;"> onclick</span><span style="color: #0000ff;">="fun1()"</span> <span style="color: #0000ff;">&gt;</span>（jquery）ajax请求(不发送数据)<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">button</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">spand </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="show1"</span> <span style="color: #0000ff;">/&gt;</span>

<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">br</span><span style="color: #0000ff;">/&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">hr</span><span style="color: #0000ff;">/&gt;</span>



<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span></code></pre>

<p><span style="font-size: 16px;">index.jsp很简单，就定义了一个按钮。调用对应函数。函数名要和js中所写的对应一致。注意要引入自己编写的js文件和jQuery的js文件（注意路径）。</span></p>
<p>&nbsp;</p>
<p><strong><span style="font-size: 18px;">（3）编写myindex.js文件</span></strong></p>
<p>&nbsp;</p>
<src class="cnblogs_code">
<pre><code><span style="color: #008000;">/*</span><span style="color: #008000;">*
 * 
 </span><span style="color: #008000;">*/</span>
<span style="color: #008000;">//</span><span style="color: #008000;">（jQuery）Ajax请求不发送数据</span>
<span style="color: #0000ff;">function</span><span style="color: #000000;"> fun1(){
    
    $.ajax({
        
        type:</span>"POST"<span style="color: #000000;">,
        url:</span>"UserAction1"<span style="color: #000000;">,
        data:</span>""<span style="color: #000000;">,
        success:</span><span style="color: #0000ff;">function</span><span style="color: #000000;">(data){
            
            $(</span>"#show1"<span style="color: #000000;">).html(data);
            
        }            
    });
        
}</span></code></pre>

<p>&nbsp;</p>
<p><span style="font-size: 16px;">定义了fun1()函数，注意jQuery的元素选择器的id和html定义&lt;span&gt;标签的id保持一致，主要是为了显示内容。么啥好说的，就是发送的使key/value数据。</span></p>
<p>&nbsp;</p>
<p><span style="font-size: 18px;"><strong>（4）新建User实体类</strong></span></p>
<src class="cnblogs_code">
<pre><code><span style="color: #008000;">//
</span><span style="color: #0000ff;">package</span><span style="color: #000000;"> com.entity;

</span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> User {

    </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> String username;

    </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> String password;

    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> String getUsername() {
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> username;
    }

    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> setUsername(String username) {
        </span><span style="color: #0000ff;">this</span>.username =<span style="color: #000000;"> username;
    }

    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> String getPassword() {
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> password;
    }

    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> setPassword(String password) {
        </span><span style="color: #0000ff;">this</span>.password =<span style="color: #000000;"> password;
    }

    @Override
    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> String toString() {
        </span><span style="color: #0000ff;">return</span> "User [username=" + username + ", password=" + password + "]"<span style="color: #000000;">;
    }

}</span></code></pre>

<p><span style="font-size: 16px;">很简单，有2个属性（username和password）。注意Ajax传递的参数名称要和User类的属性保持一致（面向对象。java对象对属性的封装）。</span></p>
<p><strong><span style="font-size: 18px;">（5）编写Action类</span></strong></p>
<p><strong><span style="font-size: 18px;">&nbsp; &nbsp;</span></strong><span style="font-size: 16px;">Action类用来处理请求，响应客户端。</span></p>
<p>&nbsp;</p>
<src class="cnblogs_code">
<pre><code><span style="font-size: 16px;"><span style="color: #0000ff;">package</span><span style="color: #000000;"> com.action;

</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.IOException;

</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.http.HttpServletResponse;

</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> org.apache.struts2.ServletActionContext;

</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> com.opensymphony.xwork2.ActionSupport;

</span><span style="color: #008000;">//</span><span style="color: #008000;">不接受参数，打印简单文本</span>
<span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> UserAction1 <span style="color: #0000ff;">extends</span><span style="color: #000000;"> ActionSupport {

    </span><span style="color: #008000;">//</span><span style="color: #008000;"> 获取response对象</span>
    <span style="color: #0000ff;">private</span> HttpServletResponse response =<span style="color: #000000;"> ServletActionContext.getResponse();

    </span><span style="color: #008000;">//</span><span style="color: #008000;"> 只是打印一个字符串文本内容（也可以给客户端返回json数据，处理一下就行了。这里返回文本，主要看一下不同的效果）</span>
    <span style="color: #0000ff;">public</span><span style="color: #000000;"> String myexcute1() {

        response.setContentType(</span>"text/html;charset=utf-8"<span style="color: #000000;">);
        String str </span>= "我想你了！哈哈哈！"<span style="color: #000000;">;
        </span><span style="color: #0000ff;">try</span><span style="color: #000000;"> {
            response.getWriter().print(str);
        } </span><span style="color: #0000ff;">catch</span><span style="color: #000000;"> (IOException e) {
            </span><span style="color: #008000;">//</span><span style="color: #008000;"> TODO Auto-generated catch block</span>
<span style="color: #000000;">            e.printStackTrace();
        }
        </span><span style="color: #0000ff;">return</span> <span style="color: #0000ff;">null</span><span style="color: #000000;">;
    }
}</span></span></code></pre>

<p>&nbsp;</p>
<p><span style="font-size: 16px;">代码很简单，都有注释。新建一个Action类，继承了ActionSupport。可以通过</span><span style="font-size: 16px;">ServletActionContext.getResponse()方法获取到response对象</span><span style="font-size: 16px;">。ServletActionContext(com.opensymphony.webwork.ServletActionContext),该类直接继承了ActionContext提供直接与Servlet相关对象访问的功能<br />ServletActionContext线程安全。这个类主要用于获取servlet的相关对象。使用response获取打印输出流，输出一个普通文本。说一下ActionSupport类，&nbsp;struts2不要求我们自己设计的action类继承任何的struts基类或struts接口，但是我们为了方便实现我们自己的action，大多数情况下都会继承ActionSupport类，并重写此类里的public String execute() throws Exception方法。因为此类中实现了很多的实用借口，提供了很多默认方法，这些默认方法包括国际化信息的方法、默认的处理用户请求的方法等，这样可以大大的简化Acion的开发。Struts获取请求，</span><span style="font-size: 16px;">怎么知道调用那个Action的方法进行处理呢。下面我们配置Struts2的主配置文件struts.xml。</span></p>
<p><strong><span style="font-size: 18px;">（6）配置struts.xml文件</span></strong></p>
<p>&nbsp;</p>
<src class="cnblogs_code">
<pre><code><span style="color: #0000ff;">&lt;?</span><span style="color: #ff00ff;">xml version="1.0" encoding="UTF-8"</span><span style="color: #0000ff;">?&gt;</span>
<span style="color: #0000ff;">&lt;!</span><span style="color: #ff00ff;">DOCTYPE struts PUBLIC
    "-//Apache Software Foundation//DTD Struts Configuration 2.3//EN"
    "http://struts.apache.org/dtds/struts-2.3.dtd"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">struts</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">constant </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="struts.devMode"</span><span style="color: #ff0000;"> value</span><span style="color: #0000ff;">="true"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">constant</span><span style="color: #0000ff;">&gt;</span>    
   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">constant </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="struts.i18n.encoding"</span><span style="color: #ff0000;"> value</span><span style="color: #0000ff;">="UTF-8"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">constant</span><span style="color: #0000ff;">&gt;</span>
   
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">package </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="default"</span><span style="color: #ff0000;"> namespace</span><span style="color: #0000ff;">="/"</span><span style="color: #ff0000;"> extends</span><span style="color: #0000ff;">="struts-default,json-default"</span><span style="color: #0000ff;">&gt;</span>

        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">action </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="UserAction1"</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">="com.action.UserAction1"</span><span style="color: #ff0000;"> method</span><span style="color: #0000ff;">="myexcute1"</span><span style="color: #0000ff;">&gt;</span>
            <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">result </span><span style="color: #0000ff;">&gt;</span>
                
            <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">result</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">action</span><span style="color: #0000ff;">&gt;</span>  
                  
    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">package</span><span style="color: #0000ff;">&gt;</span>
    
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">struts</span><span style="color: #0000ff;">&gt;</span></code></pre>

<p>&nbsp;</p>
<p><span style="font-size: 16px;">子标签constant：定义一些常量。struts.devMode启动开发者模式。struts.i18n.encoding设置请求的编码。这些常量的定义位于struts2核心开发包的</span><span style="font-size: 16px;">default.proprties资源文件中。子标签pakage：name="default"包名，可以随便取，但是不能重复。一个&lt;pakage&gt;可以配置多个&lt;action&gt;。namespace：命名空间。Struts2请求的访问路径：http://ip地址：端口号/工程名/命名空间/Action的名称</span><span style="font-size: 16px;">。extends代表继承的包，</span><span style="font-size: 16px;">Struts2的默认包&ldquo;default&rdquo;是继承于"Struts-dafault"包的，struts-default包是在struts-default.xml中定义，struts-default.xml也是Struts2默认配置文件，所以Struts2每次都会自动加载&nbsp;struts-default.xml文件。struts-defalut.xml位于</span><span style="font-size: 16px;">struts2-core核心包下面。注意到还继承了一个json-default包，json-default是继承struts-default，json这个result type(返回类型)是在</span><span style="font-size: 16px;">json-default (struts2-json-plugin-2.1.8.1.jar\struts-plugin.xml)里面定义的。&lt;action&gt;标签。用来调用某个Action类对应的方法进行处理客户端请求的。我们先来看配置的第一个&lt;action&gt;。name设置action的请求路径。比如我们设置为name="UserAction1"，</span><span style="font-size: 16px;"><strong>注意Ajax提交请求的url必须和此时设置的action的name保持一致</strong>，不然找不到。class就是Action类的全路径。method就是Action类中的方法名称。上面我们的方法名为myexcute1，所以设置为method="myexcute1"，不要带括号以及参数，只书写方法名称就行了。&lt;result&gt;表示返回的结果集，有2个属性，一个是name：对应Action返回逻辑视图名称，默认为success。一个是type：返回结果类型，默认为dispatcher。因为我们这个方法只返回普通字符串，所以&lt;result&gt;里面就不用写了。空空如也。</span></p>
<p><span style="font-size: 18px;"><strong>（7）配置web.xml文件</strong></span></p>
<p><span style="font-size: 18px;"><strong>&nbsp; </strong>&nbsp;<span style="font-size: 16px;">web.xml文件还是很重要的，它是tomcat的配置文件，当我们启动一个web项目容器的时候，它首先会加载web.xml文件。</span></span></p>
<p>&nbsp;</p>
<src class="cnblogs_code">
<pre><code><span style="color: #0000ff;">&lt;?</span><span style="color: #ff00ff;">xml version="1.0" encoding="UTF-8"</span><span style="color: #0000ff;">?&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">web-app </span><span style="color: #ff0000;">xmlns:xsi</span><span style="color: #0000ff;">="http://www.w3.org/2001/XMLSchema-instance"</span><span style="color: #ff0000;"> xmlns</span><span style="color: #0000ff;">="http://xmlns.jcp.org/xml/ns/javaee"</span><span style="color: #ff0000;"> xsi:schemaLocation</span><span style="color: #0000ff;">="http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"</span><span style="color: #ff0000;"> id</span><span style="color: #0000ff;">="WebApp_ID"</span><span style="color: #ff0000;"> version</span><span style="color: #0000ff;">="3.1"</span><span style="color: #0000ff;">&gt;</span>
  <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">display-name</span><span style="color: #0000ff;">&gt;</span>StrutsProject<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">display-name</span><span style="color: #0000ff;">&gt;</span>
  <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">welcome-file-list</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">welcome-file</span><span style="color: #0000ff;">&gt;</span>index.html<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">welcome-file</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">welcome-file</span><span style="color: #0000ff;">&gt;</span>index.htm<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">welcome-file</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">welcome-file</span><span style="color: #0000ff;">&gt;</span>index.jsp<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">welcome-file</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">welcome-file</span><span style="color: #0000ff;">&gt;</span>default.html<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">welcome-file</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">welcome-file</span><span style="color: #0000ff;">&gt;</span>default.htm<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">welcome-file</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">welcome-file</span><span style="color: #0000ff;">&gt;</span>default.jsp<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">welcome-file</span><span style="color: #0000ff;">&gt;</span>
  <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">welcome-file-list</span><span style="color: #0000ff;">&gt;</span>
  
  
  <span style="color: #008000;">&lt;!--</span><span style="color: #008000;">配置struts2的核心过滤器  </span><span style="color: #008000;">--&gt;</span>
  
       <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">filter</span><span style="color: #0000ff;">&gt;</span>
           <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> 核心过滤器名称 </span><span style="color: #008000;">--&gt;</span>
         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">filter-name</span><span style="color: #0000ff;">&gt;</span>struts2<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">filter-name</span><span style="color: #0000ff;">&gt;</span>
         <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> 费核心过滤器全类路径（包.类） </span><span style="color: #008000;">--&gt;</span>
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">filter-class</span><span style="color: #0000ff;">&gt;</span>org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilter<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">filter-class</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">filter</span><span style="color: #0000ff;">&gt;</span>
     
     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">filter-mapping</span><span style="color: #0000ff;">&gt;</span>
         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">filter-name</span><span style="color: #0000ff;">&gt;</span>struts2<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">filter-name</span><span style="color: #0000ff;">&gt;</span>
         <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> 拦截路径 </span><span style="color: #008000;">--&gt;</span>
         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">url-pattern</span><span style="color: #0000ff;">&gt;</span>/*<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">url-pattern</span><span style="color: #0000ff;">&gt;</span>
     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">filter-mapping</span><span style="color: #0000ff;">&gt;</span>
 
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">web-app</span><span style="color: #0000ff;">&gt;</span></code></pre>

<p>&nbsp;</p>
<p><span style="font-size: 16px;">配置很简单，就配置了一个Struts2的核心过滤器StrutsPrapareAndExcuteFilter。FilterDispatcher是早期struts2的过滤器，后期的都用StrutsPrepareAndExecuteFilter了。</span><span style="font-size: 16px;">StrutsPrepareAndExecuteFilter名字可知，prepare与execute，前者表示准备，可以说是指filter中的init方法，即配制的导入；后者表示进行过滤，指doFilter方法，即将request请求，转发给对应的 action去处理。</span><span style="font-size: 16px;">在使用struts的时候要在web.xml中配置一个过滤器，来拦截用户发起的请求，并进行一些预处理，根据配置文件把请求分配给对应的action并将请求中的参数与action中的字段进行对应赋值。</span></p>
<p><span style="font-size: 18px;"><strong>（8）运行程序</strong></span></p>
<p><span style="font-size: 18px;"><strong>&nbsp; &nbsp;</strong><span style="font-size: 16px;">启动tomcat，在浏览器地址栏输入url，点击按钮，查看效果。完美运行。</span></span></p>
<p><img src="./images/Struts2处理（jQuery）Ajax请求2.png" alt="" /></p>
<p>&nbsp;</p>
<p><strong><span style="font-size: 18px;">4.2 Struts2处理(jQuery)Ajax请求（发送key/value数据，返回json数据）</span></strong></p>
<p><strong><span style="font-size: 18px;">（1）导入Jackson包</span></strong></p>
<p><strong><span style="font-size: 18px;">&nbsp; &nbsp;</span></strong><span style="font-size: 16px;">上面导包已经导好了，这里不多说。jackson所需3个jar包（注意要导全）。</span></p>
<p><span style="font-size: 18px;"><strong>（2）编写jsp文件</strong></span></p>
<p><span style="font-size: 18px;"><strong>&nbsp; </strong>&nbsp;<span style="font-size: 16px;">同理，写一个按钮和显示内容的span标签。</span></span></p>
<src class="cnblogs_code">
<pre><code><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">button </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="mybutton2"</span><span style="color: #ff0000;"> value</span><span style="color: #0000ff;">="struts2处理（jQuery）Ajax请求"</span><span style="color: #ff0000;"> onclick</span><span style="color: #0000ff;">="fun2()"</span> <span style="color: #0000ff;">&gt;</span>发送数据格式为key/value的(jquery)ajax请求<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">button</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">spand </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="show2"</span> <span style="color: #0000ff;">/&gt;&lt;</span><span style="color: #800000;">br</span><span style="color: #0000ff;">/&gt;</span></code></pre>

<p>&nbsp;</p>
<p><span style="font-size: 18px;"><strong>（3）编写js文件</strong></span></p>
<p><span style="font-size: 18px;"><strong>&nbsp; </strong><span style="font-size: 16px;">&nbsp;</span></span></p>
<src class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;">使用jquery提交key/value数据（ajax请求）</span>
<span style="color: #0000ff;">function</span><span style="color: #000000;"> fun2(){
    
    $.ajax({
        
        type:</span>"POST"<span style="color: #000000;">,
        url:</span>"UserAction2"<span style="color: #000000;">,
        data:</span>"username=wly&amp;password=1314520"<span style="color: #000000;">,
        success:</span><span style="color: #0000ff;">function</span><span style="color: #000000;">(data){
            </span><span style="color: #0000ff;">var</span> value=<span style="color: #000000;">JSON.parse(data)；  //json字符串转化为js对象
            $(</span>"#show2").html(value.username+" "+<span style="color: #000000;">value.password);
            
        }            
    });
        
}</span></code></pre>

<p>&nbsp;</p>
<p><span style="font-size: 16px;">提交路径要和strutst.xml的action的name保持一致。返回的json字符串要通过JSON.parse(data)方法解析为js对象（准确来说，是js可以操作的json对象）。</span></p>
<p>&nbsp;</p>
<p><span style="font-size: 18px;"><strong>（4）编写User实体类</strong></span></p>
<p><span style="font-size: 18px;"><strong>&nbsp; &nbsp;</strong><span style="font-size: 16px;">和上面User类一样，有2个属性username和password，提供setter,getter和toSring()方法。</span></span></p>
<p>&nbsp;</p>
<p><span style="font-size: 18px;"><strong>（5）编写Action类</strong></span></p>
<p><span style="font-size: 18px;"><strong>&nbsp; &nbsp;</strong></span></p>
<src class="cnblogs_code">
<pre><code><span style="color: #0000ff;">package</span><span style="color: #000000;"> com.action;

</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.IOException;

</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.http.HttpServletResponse;

</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> org.apache.struts2.ServletActionContext;

</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> com.fasterxml.jackson.core.JsonGenerationException;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> com.fasterxml.jackson.databind.JsonMappingException;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> com.fasterxml.jackson.databind.ObjectMapper;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> com.opensymphony.xwork2.ActionSupport;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> com.opensymphony.xwork2.ModelDriven;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> com.pojo.User;

</span><span style="color: #008000;">//</span><span style="color: #008000;">接受key/value参数，输出json数据</span>
<span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> UserAction2 <span style="color: #0000ff;">extends</span> ActionSupport <span style="color: #0000ff;">implements</span> ModelDriven&lt;User&gt;<span style="color: #000000;"> {

    </span><span style="color: #008000;">//</span><span style="color: #008000;"> 注意一定要new一个实体对象</span>
    <span style="color: #0000ff;">private</span> User user = <span style="color: #0000ff;">new</span><span style="color: #000000;"> User();

    </span><span style="color: #008000;">//</span><span style="color: #008000;"> 获取response对象</span>
    <span style="color: #0000ff;">private</span> HttpServletResponse response =<span style="color: #000000;"> ServletActionContext.getResponse();

    </span><span style="color: #008000;">//</span><span style="color: #008000;"> 返回的结果集，必须提供getter和setter方法</span>
    String result = <span style="color: #0000ff;">null</span><span style="color: #000000;">;

    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> String getResult() {
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> result;
    }

    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> setResult(String result) {
        </span><span style="color: #0000ff;">this</span>.result =<span style="color: #000000;"> result;
    }

    </span><span style="color: #008000;">//</span><span style="color: #008000;"> 返回json数据（利用jackson完成java对象与json的转化）</span>
    <span style="color: #0000ff;">public</span><span style="color: #000000;"> String myexcute2() {

        response.setContentType(</span>"application/json;charset=UTF-8"<span style="color: #000000;">);
        System.out.println(user);
        ObjectMapper json </span>= <span style="color: #0000ff;">new</span> ObjectMapper(); <span style="color: #008000;">//</span><span style="color: #008000;"> 新建json对象</span>

        <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
            result </span>= json.writeValueAsString(user); <span style="color: #008000;">//</span><span style="color: #008000;"> user对象转化为json字符串</span>
<span style="color: #000000;">            System.out.println(result);
        } </span><span style="color: #0000ff;">catch</span><span style="color: #000000;"> (JsonGenerationException e) {
            </span><span style="color: #008000;">//</span><span style="color: #008000;"> TODO Auto-generated catch block</span>
<span style="color: #000000;">            e.printStackTrace();
        } </span><span style="color: #0000ff;">catch</span><span style="color: #000000;"> (JsonMappingException e) {
            </span><span style="color: #008000;">//</span><span style="color: #008000;"> TODO Auto-generated catch block</span>
<span style="color: #000000;">            e.printStackTrace();
        } </span><span style="color: #0000ff;">catch</span><span style="color: #000000;"> (IOException e) {
            </span><span style="color: #008000;">//</span><span style="color: #008000;"> TODO Auto-generated catch block</span>
<span style="color: #000000;">            e.printStackTrace();
        }
        </span><span style="color: #0000ff;">return</span> SUCCESS; <span style="color: #008000;">//</span><span style="color: #008000;"> 返回SUCCESS标志，主配置文件根据result标签的name来跳转页面或者输出内容。
                        </span><span style="color: #008000;">//</span><span style="color: #008000;"> Struts2的常量(SUCCESS、NONE、ERROR、INPUT、LOGIN)</span>
<span style="color: #000000;">    }

    </span><span style="color: #008000;">//</span><span style="color: #008000;"> 实现模型驱动ModelDriven接口的抽象方法</span>
<span style="color: #000000;">    @Override
    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> User getModel() {
        </span><span style="color: #008000;">//</span><span style="color: #008000;"> TODO Auto-generated method stub</span>
        <span style="color: #0000ff;">return</span><span style="color: #000000;"> user;
    }
}</span></code></pre>

<p>&nbsp;</p>
<p><span style="font-size: 16px;">这里所以说一下。Struts2接受前台传来的数据的方法（2种）。第一种：属性驱动。（1）使用变量的方式，把字段写在Action类中，并提供setter和getter方法。（2）使用对象的方式。把user对象当作属性封装到Action中，并提供setter和gettter方法。但是要注意前台传值。要使用</span><span style="font-size: 16px;"><strong>变量.属性</strong>的方式才可以获得到。第二种：模型驱动。也就是本文所使用到的办法。Action类通过实现com.opensymphony.xwork2.ModelDriven&lt;T&gt;接口，并实现接口中的抽象方法 public abstract T getModel()，不需要提供getter和setter方法。但是声名对象的时候一定要实例化。前台传递的参数名称和实体类中的属性名称保持一致即可。这里我们看上面public String myexcute2()个方法，这个方法其实就是获取到user对象，然后利用jackson将user对象转化为json字符串输出。最后返回一个SUCCESS常量，struts2会根据struts.xml配置文件中的&lt;result&gt;的name和type进行页面的跳转或者输出内容。注意这里向客户端输出一个json字符串的结果集，我们用result变量保存起来，并且一定要提供result的setter和getter方法。方法很简单。</span></p>
<p>&nbsp;</p>
<p><span style="font-size: 18px;"><strong>（6）配置struts.xml文件</strong></span></p>
<p><span style="font-size: 18px;"><strong>&nbsp; &nbsp;</strong></span></p>
<src class="cnblogs_code">
<pre><code><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">action </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="UserAction2"</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">="com.action.UserAction2"</span><span style="color: #ff0000;"> method</span><span style="color: #0000ff;">="myexcute2"</span><span style="color: #0000ff;">&gt;</span>         
            <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> 返回json类型数据 </span><span style="color: #008000;">--&gt;</span>
                    
            <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">result </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="success"</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">="json"</span><span style="color: #0000ff;">&gt;</span>               
                <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">param </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="root"</span><span style="color: #0000ff;">&gt;</span>result<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">param</span><span style="color: #0000ff;">&gt;</span>
            <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">result</span><span style="color: #0000ff;">&gt;</span>
 <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">action</span><span style="color: #0000ff;">&gt;</span> </code></pre>

<p>&nbsp;</p>
<p><span style="font-size: 16px;">配置很简单，把这个&lt;action&gt;放入上面那个&lt;package&gt;标签中就可以了（也可以重新写一个&lt;package&gt;），这里为了方便。注意result的name为success，刚才我们返回的是<strong>SUCCESS</strong>（代表action执行成功），这是一个struts2的常量，它的值为</span><span style="font-size: 16px;">public static final String SUCCESS = "success"。struts2其他几个常量</span></p>
<p><span style="font-size: 16px;"><strong>NONE</strong>(action执行成功，不跳转页面)、</span><strong><span style="font-size: 16px;">ERROR</span></strong><span style="font-size: 16px;">（action执行失败）、<strong>INPUT</strong>（action为了执行成功需要多次输入）、<strong>LOGIN</strong>（action不能执行，因为用户没有登录）。&lt;result&gt;标签的type="json"，表示返回的是json数据格式。这里加上了一个param参数。</span><span style="font-size: 16px;">&lt;param name="root"&gt;result&lt;/param&gt;中，result就是刚才我们action返回的结果集（有getter和setter方法）。name="root"表示从result结果集的根部进行遍历。所以就可以正常返回并解析了。</span></p>
<p>&nbsp;</p>
<p><span style="font-size: 18px;"><strong>（7）配置web.xml文件</strong></span></p>
<p><span style="font-size: 18px;"><strong>&nbsp; </strong><span style="font-size: 16px;">&nbsp;web.xml的配置和上面一样，就配置一个struts2核心过滤器就ok了。</span></span></p>
<p><span style="font-size: 18px;"><strong>（8）运行程序</strong></span></p>
<p><span style="font-size: 18px;"><strong>&nbsp; &nbsp;</strong><span style="font-size: 16px;">启动tomcat容器，</span><span style="font-size: 16px;">输入地址，完美运行。</span></span></p>
<p><span style="font-size: 18px;"><span style="font-size: 16px;">&nbsp; &nbsp;&nbsp;<img src="./images/Struts2处理（jQuery）Ajax请求3.png" alt="" /></span></span></p>
<p>&nbsp;</p>
<p><span style="font-size: 18px;"><strong>4.3 Struts2处理(jQuery)Ajax请求（发送json数据，返回json数据）</strong></span></p>
<p><strong><span style="font-size: 18px;">（1）编写jsp文件</span></strong></p>
<p><strong><span style="font-size: 18px;">&nbsp; &nbsp;</span></strong><span style="font-size: 16px;">导入jar包就不说了，就是上面的。</span></p>
<src class="cnblogs_code">
<pre><code><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">button </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="mybutton3"</span><span style="color: #ff0000;"> value</span><span style="color: #0000ff;">="struts2处理（jQuery）Ajax请求"</span><span style="color: #ff0000;"> onclick</span><span style="color: #0000ff;">="fun3()"</span> <span style="color: #0000ff;">&gt;</span>发送数据格式为json的(jquery)ajax请求<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">button</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">spand </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="show3"</span> <span style="color: #0000ff;">/&gt;&lt;</span><span style="color: #800000;">br</span><span style="color: #0000ff;">/&gt;</span></code></pre>

<p><span style="font-size: 16px;">&nbsp; &nbsp;定义了一个按钮和span标签，很简单。</span></p>
<p><strong><span style="font-size: 18px;">（2）编写js文件</span></strong></p>
<p>&nbsp;</p>
<src class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;">使用jquery提交json数据（ajax请求）</span>


<span style="color: #0000ff;">function</span><span style="color: #000000;"> fun3(){
    
    </span><span style="color: #0000ff;">var</span> user=<span style="color: #000000;">{
            </span>"username":"wly"<span style="color: #000000;">,
            </span>"password":"1314520"<span style="color: #000000;">    
    };    
$.ajax({
        
        type:</span>"POST"<span style="color: #000000;">,
        url:</span>"UserAction3"<span style="color: #000000;">,
        contentType:</span>"application/json;charset=UTF-8"<span style="color: #000000;">,
        data:JSON.stringify(user),    </span><span style="color: #008000;">//将js</span><span style="color: #008000;">对象转化为json字符串</span>
        dataType:"json"<span style="color: #000000;">,
        success:</span><span style="color: #0000ff;">function</span><span style="color: #000000;">(data){
            console.log(data);
            </span><span style="color: #0000ff;">var</span> value=<span style="color: #000000;">JSON.parse(data);   //将json字符串解析为js对象
            $(</span>"#show3").html(value.username+" "+<span style="color: #000000;">value.password);            
        }            
    });
}</span></code></pre>

<p>&nbsp;</p>
<p>&nbsp; &nbsp;<span style="font-size: 16px;">上面没啥好说的，就是一些熟悉的内容，不懂的话可以看我前2篇博客。console.log(data)是在web浏览器的控制台进行打印（谷歌浏览器找开发者工具）。</span></p>
<p>&nbsp;</p>
<p><strong><span style="font-size: 18px;">（3）新建User类</span></strong></p>
<p><strong><span style="font-size: 18px;">&nbsp; &nbsp;</span></strong><span style="font-size: 18px;"><span style="font-size: 16px;">不多说，和上面一样。其实我们就只写了一个User类。</span></span></p>
<p><strong><span style="font-size: 18px;">（4）新建Action类</span></strong></p>
<p><strong><span style="font-size: 18px;">&nbsp; &nbsp;</span></strong><span style="font-size: 18px;"><span style="font-size: 16px;">第一步：编写json工具类</span></span></p>
<p><span style="font-size: 18px;"><span style="font-size: 16px;">&nbsp; &nbsp;</span></span></p>
<src class="cnblogs_code">
<pre><code><span style="color: #0000ff;">package</span><span style="color: #000000;"> com.util;

</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.BufferedReader;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.IOException;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.InputStreamReader;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.UnsupportedEncodingException;

</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.http.HttpServletRequest;

</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> com.fasterxml.jackson.databind.ObjectMapper;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> com.pojo.User;

</span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> JsonUtil {

    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> User accept(HttpServletRequest request) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> UnsupportedEncodingException, IOException {

        </span><span style="color: #008000;">//</span><span style="color: #008000;"> 读取请求内容</span>
        BufferedReader br = <span style="color: #0000ff;">new</span> BufferedReader(<span style="color: #0000ff;">new</span> InputStreamReader(request.getInputStream(), "UTF-8"<span style="color: #000000;">));

        String line </span>= <span style="color: #0000ff;">null</span><span style="color: #000000;">;
        StringBuilder sb </span>= <span style="color: #0000ff;">new</span><span style="color: #000000;"> StringBuilder();

        </span><span style="color: #0000ff;">while</span> ((line = br.readLine()) != <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
            sb.append(line);
        }

        </span><span style="color: #008000;">//</span><span style="color: #008000;"> 将json字符串转化为java对象</span>
        ObjectMapper json = <span style="color: #0000ff;">new</span><span style="color: #000000;"> ObjectMapper();
        User user </span>= json.readValue(sb.toString(), User.<span style="color: #0000ff;">class</span><span style="color: #000000;">);
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> user;
    }

}</span></code></pre>

<p>&nbsp;</p>
<p>&nbsp; &nbsp;<span style="font-size: 16px;">这个类没啥好说的，就是通过BufferedReader类来读取请求内容，并把请求内容按行添加到StringBuilder（字符串变量，线程不安全，单线程下效率比较高）对象中，然后再利用Jackson的核心操作类ObjectMapper类把json字符串转化为user对象返回。</span></p>
<p><span style="font-size: 16px;">&nbsp; 第二步：编写Action类</span></p>
<src class="cnblogs_code">
<pre><code><span style="color: #0000ff;">package</span><span style="color: #000000;"> com.action;

</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.IOException;

</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.http.HttpServletRequest;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.http.HttpServletResponse;

</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> org.apache.struts2.ServletActionContext;

</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> com.fasterxml.jackson.core.JsonGenerationException;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> com.fasterxml.jackson.databind.JsonMappingException;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> com.fasterxml.jackson.databind.ObjectMapper;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> com.opensymphony.xwork2.ActionSupport;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> com.pojo.User;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> com.util.JsonUtil;

</span><span style="color: #008000;">//</span><span style="color: #008000;">接受json数据，打印json数据</span>
<span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> UserAction3 <span style="color: #0000ff;">extends</span><span style="color: #000000;"> ActionSupport {

    </span><span style="color: #008000;">//</span><span style="color: #008000;"> 获取response对象</span>
    <span style="color: #0000ff;">private</span> HttpServletResponse response =<span style="color: #000000;"> ServletActionContext.getResponse();

    </span><span style="color: #0000ff;">private</span> HttpServletRequest request =<span style="color: #000000;"> ServletActionContext.getRequest();

    </span><span style="color: #008000;">//</span><span style="color: #008000;"> 返回的结果集，必须提供getter和setter方法</span>
    String result = <span style="color: #0000ff;">null</span><span style="color: #000000;">;

    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> String getResult() {
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> result;
    }

    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> setResult(String result) {
        </span><span style="color: #0000ff;">this</span>.result =<span style="color: #000000;"> result;
    }

    </span><span style="color: #008000;">//</span><span style="color: #008000;"> 返回json数据（利用jackson完成java对象与json的转化）</span>
    <span style="color: #0000ff;">public</span><span style="color: #000000;"> String myexcute3() {

        response.setContentType(</span>"application/json;charset=UTF-8"<span style="color: #000000;">);
        </span><span style="color: #0000ff;">try</span><span style="color: #000000;"> {
            User user </span>=<span style="color: #000000;"> JsonUtil.accept(request);
            System.out.println(user);
            ObjectMapper json </span>= <span style="color: #0000ff;">new</span> ObjectMapper(); <span style="color: #008000;">//</span><span style="color: #008000;"> 新建json对象</span>
            result = json.writeValueAsString(user); <span style="color: #008000;">//</span><span style="color: #008000;"> user对象转化为json字符串</span>
<span style="color: #000000;">            System.out.println(result);
        } </span><span style="color: #0000ff;">catch</span><span style="color: #000000;"> (JsonGenerationException e) {
            </span><span style="color: #008000;">//</span><span style="color: #008000;"> TODO Auto-generated catch block</span>
<span style="color: #000000;">            e.printStackTrace();
        } </span><span style="color: #0000ff;">catch</span><span style="color: #000000;"> (JsonMappingException e) {
            </span><span style="color: #008000;">//</span><span style="color: #008000;"> TODO Auto-generated catch block</span>
<span style="color: #000000;">            e.printStackTrace();
        } </span><span style="color: #0000ff;">catch</span><span style="color: #000000;"> (IOException e) {
            </span><span style="color: #008000;">//</span><span style="color: #008000;"> TODO Auto-generated catch block</span>
<span style="color: #000000;">            e.printStackTrace();
        }
        </span><span style="color: #0000ff;">return</span> SUCCESS; <span style="color: #008000;">//</span><span style="color: #008000;"> 返回SUCCESS标志，主配置文件根据result标签的name来跳转页面或者输出内容。
                        </span><span style="color: #008000;">//</span><span style="color: #008000;"> Struts2的常量(SUCCESS、NONE、ERROR、INPUT、LOGIN)</span>
<span style="color: #000000;">    }

}</span></code></pre>

<p>&nbsp; &nbsp;</p>
<pre><code><span style="font-size: 16px;">这里使用ServletActionContext类获取了response和requset对象，并且结果集result提供相应的getter和setter方法。最后返回一个json字符串。<br /></span></code></pre>
<p>&nbsp;</p>
<p><strong><span style="font-size: 18px;">（5）配置struts.xml</span></strong></p>
<p><strong><span style="font-size: 18px;">&nbsp; &nbsp;</span></strong></p>
<src class="cnblogs_code">
<pre><code><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">action </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="UserAction3"</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">="com.action.UserAction3"</span><span style="color: #ff0000;"> method</span><span style="color: #0000ff;">="myexcute3"</span><span style="color: #0000ff;">&gt;</span>         
            <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> 返回json类型数据 </span><span style="color: #008000;">--&gt;</span>
                  
            <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">result </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="success"</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">="json"</span><span style="color: #0000ff;">&gt;</span>               
                <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">param </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="root"</span><span style="color: #0000ff;">&gt;</span>result<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">param</span><span style="color: #0000ff;">&gt;</span>
            <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">result</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">action</span><span style="color: #0000ff;">&gt;</span> </code></pre>

<p><span style="font-size: 16px;">同理，配置这个Action类。action请求名称设置为UserAction3(要和ajax提交的路径一致)，全类路径要书写正确。&lt;result&gt;表示要返回的内容（或页面）。相关配置上面已经解释，这里不多说。</span></p>
<p>&nbsp;</p>
<p><strong><span style="font-size: 18px;">（6）配置web.xml</span></strong></p>
<p><strong><span style="font-size: 18px;">&nbsp; &nbsp;</span></strong><span style="font-size: 16px;">和上面一样。配置一个struts2核心过滤器。</span></p>
<p><strong><span style="font-size: 18px;">（7）运行程序</span></strong></p>
<p><strong><span style="font-size: 18px;">&nbsp; &nbsp;<img src="./images/Struts2处理（jQuery）Ajax请求4.png" alt="" /></span></strong></p>
<p>&nbsp;</p>
<p><strong><span style="font-size: 18px;">5. 总结</span></strong></p>
<p><span style="font-size: 16px;">（1）从本次开发看出struts的优缺点。优点：支持插件（比如json插件），ajax支持，通过配置文件，就可以掌握整个系统各个部分之间的关系。实现了MVC模式，层次结构清晰。减少配置（有默认值）。</span></p>
<p><span style="font-size: 16px;">（2）struts的缺点（通过本次开发）：缺点：对servlet依赖比较强（我们用到了request和response），Action中取得从jsp中传过来的参数时还是有点麻烦。</span></p>
<p><span style="font-size: 16px;">（3）其实本质上我们还是通过Jackson框架进行json与java对象的相互转化，只不过要依赖于struts-json插件。其实我们只是用符合struts2框架的规范，编写了一些Action类，来响应客户端的请求。其实和之前的编写servlet效果类似。</span></p>
<p><span style="font-size: 16px;">（4）Jackson类库其实还蛮好用的，不信你试试！</span></p>
<p><span style="font-size: 16px;">（5）如果有什么错误欢迎各位大佬指出，在下一定洗耳恭听！哈哈！</span></p>
<p>&nbsp;</p>
<p>&nbsp; <span style="font-size: 16px;">&nbsp;本篇博客源码链接：<a style="cursor: pointer;" onclick="window.open('https://pan.baidu.com/s/1zUvZxO_eVahocHcjMsyOPA','','');return false;" href="https://pan.baidu.com/s/1zUvZxO_eVahocHcjMsyOPA" target="_blank">https://pan.baidu.com/s/1zUvZxO_eVahocHcjMsyOPA</a>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<em id="__mceDel">提取码：nn3g&nbsp;</em></span></p>
<p><em id="__mceDel">&nbsp;</em></p>

</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>