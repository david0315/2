<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修Springboot异常处理和自定义错误页面' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>Springboot异常处理和自定义错误页面</center></div><div class='banquan'>原文出处:本文由博客园博主java一号提供。<br/>
原文连接:https://www.cnblogs.com/javayihao/p/11935418.html</div><br>
    <h1><span style="color: #86ca5e;">1.异常来源<br /></span></h1>
<p>要处理程序发生的异常，首先需要知道异常来自哪里？</p>
<p>1.前端错误的的请求路径，会使得程序发生4xx错误，最常见的就是404，Springboot默认当发生这种错误的请求路径，pc端响应的页面如下</p>
<p><span class="cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected" data-cke-widget-wrapper="1" data-cke-filter="off" data-cke-display-name="图像" data-cke-widget-id="27"><img class="has cke_widget_element" src="./images/Springboot异常处理和自定义错误页面0.png" alt="" width="695" height="168" data-cke-saved-src="./images/Springboot异常处理和自定义错误页面0.png" data-cke-widget-data="{&amp;quot;hasCaption&amp;quot;:false,&amp;quot;src&amp;quot;:&amp;quot;./images/Springboot异常处理和自定义错误页面0.png&amp;quot;,&amp;quot;alt&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;width&amp;quot;:&amp;quot;695&amp;quot;,&amp;quot;height&amp;quot;:&amp;quot;168&amp;quot;,&amp;quot;lock&amp;quot;:true,&amp;quot;align&amp;quot;:&amp;quot;none&amp;quot;,&amp;quot;classes&amp;quot;:{&amp;quot;has&amp;quot;:1}}" data-cke-widget-upcasted="1" data-cke-widget-keep-attr="0" data-widget="image" /></span></p>
<p>如果是移动端（手机端）将会响应json格式的数据，如下</p>
<p><span class="cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected" data-cke-widget-wrapper="1" data-cke-filter="off" data-cke-display-name="图像" data-cke-widget-id="26"><img class="has cke_widget_element" src="./images/Springboot异常处理和自定义错误页面1.png" alt="" width="370" height="102" data-cke-saved-src="./images/Springboot异常处理和自定义错误页面1.png" data-cke-widget-data="{&amp;quot;hasCaption&amp;quot;:false,&amp;quot;src&amp;quot;:&amp;quot;./images/Springboot异常处理和自定义错误页面1.png&amp;quot;,&amp;quot;alt&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;width&amp;quot;:&amp;quot;370&amp;quot;,&amp;quot;height&amp;quot;:&amp;quot;102&amp;quot;,&amp;quot;lock&amp;quot;:true,&amp;quot;align&amp;quot;:&amp;quot;none&amp;quot;,&amp;quot;classes&amp;quot;:{&amp;quot;has&amp;quot;:1}}" data-cke-widget-upcasted="1" data-cke-widget-keep-attr="0" data-widget="image" /></span></p>
<h1><span style="color: #86ca5e;">2.Springboot异常处理原理</span></h1>
<p><span style="color: #86ca5e;">为什么我们请求错误的路径，boot会给我们返回一个上面错误页面或者json格式数据呢？原理是怎样的呢？<br /></span></p>
<p style="margin-left: 0cm;">Springboot项目启动之后，执行有@SpringBootApplication注解的启动类的main方法，通过@EnableAutoConfiguration加载</p>
<p style="margin-left: 0cm;">springbootAutoConfiguration.jar包下的META-INF/spring.factories中的所有配置类（这些配置类加载之后，会将每个配置类里面的组件注入容器然后使用）其中一个自动配置</p>
<p style="margin-left: 0cm;"><span class="cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected" data-cke-widget-wrapper="1" data-cke-filter="off" data-cke-display-name="图像" data-cke-widget-id="25"><img class="has cke_widget_element" src="./images/Springboot异常处理和自定义错误页面2.png" alt="" width="405" height="296" data-cke-saved-src="./images/Springboot异常处理和自定义错误页面2.png" data-cke-widget-data="{&amp;quot;hasCaption&amp;quot;:false,&amp;quot;src&amp;quot;:&amp;quot;./images/Springboot异常处理和自定义错误页面2.png&amp;quot;,&amp;quot;alt&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;width&amp;quot;:&amp;quot;405&amp;quot;,&amp;quot;height&amp;quot;:&amp;quot;296&amp;quot;,&amp;quot;lock&amp;quot;:true,&amp;quot;align&amp;quot;:&amp;quot;none&amp;quot;,&amp;quot;classes&amp;quot;:{&amp;quot;has&amp;quot;:1}}" data-cke-widget-upcasted="1" data-cke-widget-keep-attr="0" data-widget="image" /></span></p>
<p style="margin-left: 0cm;">ErrorMvcAutoConfiguration，通过代码可以看到用到了以下四个组件</p>
<p style="margin-left: 0cm;">DefaultErrorAttributes、BasicErrorController、errorPageCustomizer、DefaultErrorViewResolver</p>
<p style="margin-left: 0cm;"><span class="cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected" data-cke-widget-wrapper="1" data-cke-filter="off" data-cke-display-name="图像" data-cke-widget-id="24"><img class="has cke_widget_element" src="./images/Springboot异常处理和自定义错误页面3.png" alt="" width="825" height="293" data-cke-saved-src="./images/Springboot异常处理和自定义错误页面3.png" data-cke-widget-data="{&amp;quot;hasCaption&amp;quot;:false,&amp;quot;src&amp;quot;:&amp;quot;./images/Springboot异常处理和自定义错误页面3.png&amp;quot;,&amp;quot;alt&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;width&amp;quot;:&amp;quot;825&amp;quot;,&amp;quot;height&amp;quot;:&amp;quot;293&amp;quot;,&amp;quot;lock&amp;quot;:true,&amp;quot;align&amp;quot;:&amp;quot;none&amp;quot;,&amp;quot;classes&amp;quot;:{&amp;quot;has&amp;quot;:1}}" data-cke-widget-upcasted="1" data-cke-widget-keep-attr="0" data-widget="image" /></span></p>
<p style="margin-left: 0cm;">其他三个基本类似，当出现4xx或者5xx等错误时，errorPageCustomizer就会生效，<span style="color: #000000;">this.properties.getError().getPath())<span style="color: #000000;">并来到/error请求，核心代码</span></span></p>
<src class="cke_widget_wrapper cke_widget_block cke_widget_codeSnippet cke_widget_wrapper_has cke_widget_selected" data-cke-widget-wrapper="1" data-cke-filter="off" data-cke-display-name="代码段" data-cke-widget-id="23">
<pre><code><code class="hljs">//errorPageCustomizer
@Value("${error.path:/error}")
    private String path = "/error";
</code></code></pre>

<p>而这个/error请求再由BasicErrorController处理，BasicErrorController是一个Controller，其中里面有两种处理方法，一种是HTML形式，</p>
<p>一种是JSON格式。其中访问者的信息可以从getErrorAttributes从获取。DefaultErrorAttributes是ErrorAttributes的实现类。</p>
<p>关键代码</p>
<src class="cke_widget_wrapper cke_widget_block cke_widget_codeSnippet cke_widget_wrapper_has cke_widget_selected" data-cke-widget-wrapper="1" data-cke-filter="off" data-cke-display-name="代码段" data-cke-widget-id="22">
<pre class="has cke_widget_element" data-cke-widget-data="{&amp;quot;code&amp;quot;:&amp;quot;@RequestMapping(produces = \&amp;quot;text/html\&amp;quot;) //HTML\n    public ModelAndView errorHtml(HttpServletRequest request,\n            HttpServletResponse response) {\n        HttpStatus status = getStatus(request);\n        Map&amp;lt;String, Object&amp;gt; model = Collections.unmodifiableMap(getErrorAttributes(\n                request, isIncludeStackTrace(request, MediaType.TEXT_HTML)));\n        response.setStatus(status.value());\n        ModelAndView modelAndView = resolveErrorView(request, response, status, model);\n        return (modelAndView == null ? new ModelAndView(\&amp;quot;error\&amp;quot;, model) : modelAndView);\n    }\n\n    @RequestMapping\n    @ResponseBody //JSON\n    public ResponseEntity&amp;lt;Map&amp;lt;String, Object&amp;gt;&amp;gt; error(HttpServletRequest request) {\n        Map&amp;lt;String, Object&amp;gt; body = getErrorAttributes(request,\n                isIncludeStackTrace(request, MediaType.ALL));\n        HttpStatus status = getStatus(request);\n        return new ResponseEntity&amp;lt;&amp;gt;(body, status);\n    }\n&amp;quot;,&amp;quot;classes&amp;quot;:{&amp;quot;has&amp;quot;:1}}" data-cke-widget-upcasted="1" data-cke-widget-keep-attr="0" data-widget="codeSnippet"><code class="hljs">@RequestMapping(produces = "text/html") //HTML
    public ModelAndView errorHtml(HttpServletRequest request,
            HttpServletResponse response) {
        HttpStatus status = getStatus(request);
        Map&lt;String, Object&gt; model = Collections.unmodifiableMap(getErrorAttributes(
                request, isIncludeStackTrace(request, MediaType.TEXT_HTML)));
        response.setStatus(status.value());
        ModelAndView modelAndView = resolveErrorView(request, response, status, model);
        return (modelAndView == null ? new ModelAndView("error", model) : modelAndView);
    }

    @RequestMapping
    @ResponseBody //JSON
    public ResponseEntity&lt;Map&lt;String, Object&gt;&gt; error(HttpServletRequest request) {
        Map&lt;String, Object&gt; body = getErrorAttributes(request,
                isIncludeStackTrace(request, MediaType.ALL));
        HttpStatus status = getStatus(request);
        return new ResponseEntity&lt;&gt;(body, status);
    }
</code></code></pre>

<p style="margin-left: 0cm;">当为HTML模式时，就会构建一个resolveErrorView类，而resolverErrorView继续调用ErrorViewResolver。关键代码</p>
<src class="cke_widget_wrapper cke_widget_block cke_widget_codeSnippet cke_widget_wrapper_has cke_widget_selected" data-cke-widget-wrapper="1" data-cke-filter="off" data-cke-display-name="代码段" data-cke-widget-id="21">
<pre class="has cke_widget_element" data-cke-widget-data="{&amp;quot;code&amp;quot;:&amp;quot;protected ModelAndView resolveErrorView(HttpServletRequest request,\n            HttpServletResponse response, HttpStatus status, Map&amp;lt;String, Object&amp;gt; model) {\n        for (ErrorViewResolver resolver : this.errorViewResolvers) {\n            ModelAndView modelAndView = resolver.resolveErrorView(request, status, model);\n            if (modelAndView != null) {\n                return modelAndView;\n            }\n        }\n        return null;\n    }\n\n&amp;quot;,&amp;quot;classes&amp;quot;:{&amp;quot;has&amp;quot;:1}}" data-cke-widget-upcasted="1" data-cke-widget-keep-attr="0" data-widget="codeSnippet"><code class="hljs">protected ModelAndView resolveErrorView(HttpServletRequest request,
            HttpServletResponse response, HttpStatus status, Map&lt;String, Object&gt; model) {
        for (ErrorViewResolver resolver : this.errorViewResolvers) {
            ModelAndView modelAndView = resolver.resolveErrorView(request, status, model);
            if (modelAndView != null) {
                return modelAndView;
            }
        }
        return null;
    }

</code></code></pre>

<p style="margin-left: 0cm;">在我们没有做自定义配置时，ErrorViewResolver就会指向DefaultErrorViewResolver。</p>
<src class="cke_widget_wrapper cke_widget_block cke_widget_codeSnippet cke_widget_wrapper_has cke_widget_selected" data-cke-widget-wrapper="1" data-cke-filter="off" data-cke-display-name="代码段" data-cke-widget-id="20">
<pre class="has cke_widget_element" data-cke-widget-data="{&amp;quot;code&amp;quot;:&amp;quot;static {\n        //可以用4xx,5xx文件名来统一匹配错误,但是会以精确优先的原则\n        Map&amp;lt;Series, String&amp;gt; views = new EnumMap&amp;lt;&amp;gt;(Series.class);\n        views.put(Series.CLIENT_ERROR, \&amp;quot;4xx\&amp;quot;);\n        views.put(Series.SERVER_ERROR, \&amp;quot;5xx\&amp;quot;);\n        SERIES_VIEWS = Collections.unmodifiableMap(views);\n    }\n\n @Override\n    public ModelAndView resolveErrorView(HttpServletRequest request, HttpStatus status,\n                                         Map&amp;lt;String, Object&amp;gt; model) {\n        ModelAndView modelAndView = resolve(String.valueOf(status), model);\n        if (modelAndView == null &amp;amp;&amp;amp; SERIES_VIEWS.containsKey(status.series())) {\n            modelAndView = resolve(SERIES_VIEWS.get(status.series()), model);\n        }\n        return modelAndView;\n    }\n\n    private ModelAndView resolve(String viewName, Map&amp;lt;String, Object&amp;gt; model) {\n        //将错误代码拼接到error后\n        String errorViewName = \&amp;quot;error/\&amp;quot; + viewName;\n        TemplateAvailabilityProvider provider = this.templateAvailabilityProviders\n                .getProvider(errorViewName, this.applicationContext);\n        //如果模版引擎可用就让模版引擎进行解析如：Template/error/404\n        if (provider != null) {\n            return new ModelAndView(errorViewName, model);\n        }\n        //如果模版引擎不可用，就在静态资源文件夹下找资源文件,error/404\n        return resolveResource(errorViewName, model);\n    }\n&amp;quot;,&amp;quot;classes&amp;quot;:{&amp;quot;has&amp;quot;:1}}" data-cke-widget-upcasted="1" data-cke-widget-keep-attr="0" data-widget="codeSnippet"><code class="hljs">static {
        //可以用4xx,5xx文件名来统一匹配错误,但是会以精确优先的原则
        Map&lt;Series, String&gt; views = new EnumMap&lt;&gt;(Series.class);
        views.put(Series.CLIENT_ERROR, "4xx");
        views.put(Series.SERVER_ERROR, "5xx");
        SERIES_VIEWS = Collections.unmodifiableMap(views);
    }

 @Override
    public ModelAndView resolveErrorView(HttpServletRequest request, HttpStatus status,
                                         Map&lt;String, Object&gt; model) {
        ModelAndView modelAndView = resolve(String.valueOf(status), model);
        if (modelAndView == null &amp;&amp; SERIES_VIEWS.containsKey(status.series())) {
            modelAndView = resolve(SERIES_VIEWS.get(status.series()), model);
        }
        return modelAndView;
    }

    private ModelAndView resolve(String viewName, Map&lt;String, Object&gt; model) {
        //将错误代码拼接到error后
        String errorViewName = "error/" + viewName;
        TemplateAvailabilityProvider provider = this.templateAvailabilityProviders
                .getProvider(errorViewName, this.applicationContext);
        //如果模版引擎可用就让模版引擎进行解析如：Template/error/404
        if (provider != null) {
            return new ModelAndView(errorViewName, model);
        }
        //如果模版引擎不可用，就在静态资源文件夹下找资源文件,error/404
        return resolveResource(errorViewName, model);
    }
</code></code></pre>

<h1 id="3.%E5%A6%82%E4%BD%95%E5%AE%9A%E5%88%B6%E9%94%99%E8%AF%AF%E3%80%81%E5%BC%82%E5%B8%B8%E5%93%8D%E5%BA%94"><span style="color: #86ca5e;">3.如何定制错误、异常响应</span></h1>
<p><span style="color: #86ca5e;">明白了boot处理异常机制，我们如何自定义异常响应规则呢？</span></p>
<h2 id="%E7%AC%AC%E4%B8%80%E7%A7%8D%EF%BC%9Apc%E7%AB%AF%E8%BF%94%E5%9B%9E%E9%9D%99%E6%80%81%E9%94%99%E8%AF%AF%E9%A1%B5%E9%9D%A2%EF%BC%8C%E6%89%8B%E6%9C%BA%E7%AB%AF%E8%BF%94%E5%9B%9Eboot%E9%BB%98%E8%AE%A4%E7%9A%84json%E6%95%B0%E6%8D%AE"><span style="color: #86ca5e;">第一种：pc端返回静态错误页面，手机端返回boot默认的json数据</span></h2>
<p>如果项目中有模板引擎（jsp,thmeleaf,freemarker）的情况下，可以将错误页面命名为状态码.html放在模板引擎文件夹下的error文件夹下，</p>
<p>发生异常，不管是前端请求还是后端程序错误会来到对应的错误页面。可以将错误页面命名为4xx和5xx匹配所有的错误，</p>
<p>但是优先返回精确状态码.html页面；并且在模板引擎页面可以获取如下相关信息</p>
<p><span class="cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected" data-cke-widget-wrapper="1" data-cke-filter="off" data-cke-display-name="图像" data-cke-widget-id="19"><img class="has cke_widget_element" src="./images/Springboot异常处理和自定义错误页面4.png" alt="" width="417" height="220" data-cke-saved-src="./images/Springboot异常处理和自定义错误页面4.png" data-cke-widget-data="{&amp;quot;hasCaption&amp;quot;:false,&amp;quot;src&amp;quot;:&amp;quot;./images/Springboot异常处理和自定义错误页面4.png&amp;quot;,&amp;quot;alt&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;width&amp;quot;:&amp;quot;417&amp;quot;,&amp;quot;height&amp;quot;:&amp;quot;220&amp;quot;,&amp;quot;lock&amp;quot;:true,&amp;quot;align&amp;quot;:&amp;quot;none&amp;quot;,&amp;quot;classes&amp;quot;:{&amp;quot;has&amp;quot;:1}}" data-cke-widget-upcasted="1" data-cke-widget-keep-attr="0" data-widget="image" /></span></p>
<p>这里模版引擎使用thmeleaf</p>
<p><span class="cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected" data-cke-widget-wrapper="1" data-cke-filter="off" data-cke-display-name="图像" data-cke-widget-id="18"><img class="has cke_widget_element" src="./images/Springboot异常处理和自定义错误页面5.png" alt="" width="297" height="380" data-cke-saved-src="./images/Springboot异常处理和自定义错误页面5.png" data-cke-widget-data="{&amp;quot;hasCaption&amp;quot;:false,&amp;quot;src&amp;quot;:&amp;quot;./images/Springboot异常处理和自定义错误页面5.png&amp;quot;,&amp;quot;alt&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;width&amp;quot;:&amp;quot;297&amp;quot;,&amp;quot;height&amp;quot;:&amp;quot;380&amp;quot;,&amp;quot;lock&amp;quot;:true,&amp;quot;align&amp;quot;:&amp;quot;none&amp;quot;,&amp;quot;classes&amp;quot;:{&amp;quot;has&amp;quot;:1}}" data-cke-widget-upcasted="1" data-cke-widget-keep-attr="0" data-widget="image" /><span class="cke_reset cke_widget_drag_handler_container" style="background: rgba(220,220,220,0.5); background-image: url('https://csdnimg.cn/release/blog_editor_html/release1.5.9/ckeditor/plugins/widget/images/handle.png');"><span class="cke_image_resizer" title="点击并拖拽以改变尺寸">​</span></span></span></p>
<p>4xx代码</p>
<src class="cke_widget_wrapper cke_widget_block cke_widget_codeSnippet cke_widget_wrapper_has cke_widget_selected" data-cke-widget-wrapper="1" data-cke-filter="off" data-cke-display-name="代码段" data-cke-widget-id="17">
<pre class="has cke_widget_element" data-cke-widget-data="{&amp;quot;code&amp;quot;:&amp;quot;&amp;lt;!DOCTYPE html&amp;gt;\n&amp;lt;html lang=\&amp;quot;en\&amp;quot;&amp;gt;\n&amp;lt;html xmlns:th=\&amp;quot;http://www.thymeleaf.org\&amp;quot;&amp;gt;\n&amp;lt;head&amp;gt;\n    &amp;lt;meta charset=\&amp;quot;UTF-8\&amp;quot;&amp;gt;\n    &amp;lt;title th:text=\&amp;quot;'状态码:'+${status}\&amp;quot;&amp;gt;&amp;lt;/title&amp;gt;\n&amp;lt;/head&amp;gt;\n&amp;lt;body&amp;gt;\n&amp;lt; img src=\&amp;quot;../images/404.jpg\&amp;quot; style=\&amp;quot;width: 40%;\&amp;quot;&amp;gt;\n&amp;lt;h1 th:text=\&amp;quot;'时间:'+${timestamp}\&amp;quot;&amp;gt;&amp;lt;/h1&amp;gt;\n&amp;lt;h1 th:text=\&amp;quot;'错误提示:'+${error}\&amp;quot;&amp;gt;&amp;lt;/h1&amp;gt;\n&amp;lt;h1 th:text=\&amp;quot;'异常对象:'+${exception}\&amp;quot;&amp;gt;&amp;lt;/h1&amp;gt;\n&amp;lt;h1 th:text=\&amp;quot;'异常信息:'+${message}\&amp;quot;&amp;gt;&amp;lt;/h1&amp;gt;\n&amp;lt;/body&amp;gt;\n&amp;lt;/html&amp;gt;&amp;quot;,&amp;quot;classes&amp;quot;:{&amp;quot;has&amp;quot;:1}}" data-cke-widget-upcasted="1" data-cke-widget-keep-attr="0" data-widget="codeSnippet"><code class="hljs">&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;html xmlns:th="http://www.thymeleaf.org"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title th:text="'状态码:'+${status}"&gt;&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt; img src="../images/404.jpg" style="width: 40%;"&gt;
&lt;h1 th:text="'时间:'+${timestamp}"&gt;&lt;/h1&gt;
&lt;h1 th:text="'错误提示:'+${error}"&gt;&lt;/h1&gt;
&lt;h1 th:text="'异常对象:'+${exception}"&gt;&lt;/h1&gt;
&lt;h1 th:text="'异常信息:'+${message}"&gt;&lt;/h1&gt;
&lt;/body&gt;
&lt;/html&gt;</code></code></pre>
5xx代码
<src class="cke_widget_wrapper cke_widget_block cke_widget_codeSnippet cke_widget_wrapper_has cke_widget_selected" data-cke-widget-wrapper="1" data-cke-filter="off" data-cke-display-name="代码段" data-cke-widget-id="16">
<pre class="has cke_widget_element" data-cke-widget-data="{&amp;quot;code&amp;quot;:&amp;quot;&amp;lt;!DOCTYPE html&amp;gt;\n&amp;lt;html lang=\&amp;quot;en\&amp;quot;&amp;gt;\n&amp;lt;html xmlns:th=\&amp;quot;http://www.thymeleaf.org\&amp;quot;&amp;gt;\n&amp;lt;head&amp;gt;\n    &amp;lt;meta charset=\&amp;quot;UTF-8\&amp;quot;&amp;gt;\n    &amp;lt;title th:text=\&amp;quot;'状态码:'+${status}\&amp;quot;&amp;gt;&amp;lt;/title&amp;gt;\n&amp;lt;/head&amp;gt;\n&amp;lt;body&amp;gt;\n&amp;lt;h2&amp;gt;500&amp;lt;/h2&amp;gt;\n&amp;lt;h1 th:text=\&amp;quot;'时间:'+${timestamp}\&amp;quot;&amp;gt;&amp;lt;/h1&amp;gt;\n&amp;lt;h1 th:text=\&amp;quot;'错误提示:'+${error}\&amp;quot;&amp;gt;&amp;lt;/h1&amp;gt;\n&amp;lt;h1 th:text=\&amp;quot;'异常对象:'+${exception}\&amp;quot;&amp;gt;&amp;lt;/h1&amp;gt;\n&amp;lt;h1 th:text=\&amp;quot;'异常信息:'+${message}\&amp;quot;&amp;gt;&amp;lt;/h1&amp;gt;\n&amp;lt;/body&amp;gt;\n&amp;lt;/html&amp;gt;&amp;quot;,&amp;quot;classes&amp;quot;:{&amp;quot;has&amp;quot;:1}}" data-cke-widget-upcasted="1" data-cke-widget-keep-attr="0" data-widget="codeSnippet"><code class="hljs">&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;html xmlns:th="http://www.thymeleaf.org"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title th:text="'状态码:'+${status}"&gt;&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h2&gt;500&lt;/h2&gt;
&lt;h1 th:text="'时间:'+${timestamp}"&gt;&lt;/h1&gt;
&lt;h1 th:text="'错误提示:'+${error}"&gt;&lt;/h1&gt;
&lt;h1 th:text="'异常对象:'+${exception}"&gt;&lt;/h1&gt;
&lt;h1 th:text="'异常信息:'+${message}"&gt;&lt;/h1&gt;
&lt;/body&gt;
&lt;/html&gt;</code></code></pre>
我们请求一个错误的地址路径
<p><span class="cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected" data-cke-widget-wrapper="1" data-cke-filter="off" data-cke-display-name="图像" data-cke-widget-id="15"><img class="has cke_widget_element" src="./images/Springboot异常处理和自定义错误页面6.png" alt="" width="569" height="610" data-cke-saved-src="./images/Springboot异常处理和自定义错误页面6.png" data-cke-widget-data="{&amp;quot;hasCaption&amp;quot;:false,&amp;quot;src&amp;quot;:&amp;quot;./images/Springboot异常处理和自定义错误页面6.png&amp;quot;,&amp;quot;alt&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;width&amp;quot;:&amp;quot;569&amp;quot;,&amp;quot;height&amp;quot;:&amp;quot;610&amp;quot;,&amp;quot;lock&amp;quot;:true,&amp;quot;align&amp;quot;:&amp;quot;none&amp;quot;,&amp;quot;classes&amp;quot;:{&amp;quot;has&amp;quot;:1}}" data-cke-widget-upcasted="1" data-cke-widget-keep-attr="0" data-widget="image" /></span></p>
<p>我们在程序代码中人为制造一个异常，请求响应</p>
<p><span class="cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected" data-cke-widget-wrapper="1" data-cke-filter="off" data-cke-display-name="图像" data-cke-widget-id="14"><img class="has cke_widget_element" src="./images/Springboot异常处理和自定义错误页面7.png" alt="" width="700" height="394" data-cke-saved-src="./images/Springboot异常处理和自定义错误页面7.png" data-cke-widget-data="{&amp;quot;hasCaption&amp;quot;:false,&amp;quot;src&amp;quot;:&amp;quot;./images/Springboot异常处理和自定义错误页面7.png&amp;quot;,&amp;quot;alt&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;width&amp;quot;:&amp;quot;700&amp;quot;,&amp;quot;height&amp;quot;:&amp;quot;394&amp;quot;,&amp;quot;lock&amp;quot;:true,&amp;quot;align&amp;quot;:&amp;quot;none&amp;quot;,&amp;quot;classes&amp;quot;:{&amp;quot;has&amp;quot;:1}}" data-cke-widget-upcasted="1" data-cke-widget-keep-attr="0" data-widget="image" /></span></p>
<p>上面是有模版引擎的情况下处理错误以及异常的方式，</p>
<p style="margin-left: 0cm;">如果项目中没有模板引擎，（模板引擎找不到这个错误页面），静态资源文件夹static下找对应的4xx或者5xx或者更精确的错误页面。但是如果不用模板引擎，页面不能获取上面说的页面信息；</p>
<p style="margin-left: 0cm;"><span class="cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected" data-cke-widget-wrapper="1" data-cke-filter="off" data-cke-display-name="图像" data-cke-widget-id="13"><img class="has cke_widget_element" src="./images/Springboot异常处理和自定义错误页面8.png" alt="" width="249" height="128" data-cke-saved-src="./images/Springboot异常处理和自定义错误页面8.png" data-cke-widget-data="{&amp;quot;hasCaption&amp;quot;:false,&amp;quot;src&amp;quot;:&amp;quot;./images/Springboot异常处理和自定义错误页面8.png&amp;quot;,&amp;quot;alt&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;width&amp;quot;:&amp;quot;249&amp;quot;,&amp;quot;height&amp;quot;:&amp;quot;128&amp;quot;,&amp;quot;lock&amp;quot;:true,&amp;quot;align&amp;quot;:&amp;quot;none&amp;quot;,&amp;quot;classes&amp;quot;:{&amp;quot;has&amp;quot;:1}}" data-cke-widget-upcasted="1" data-cke-widget-keep-attr="0" data-widget="image" /><span class="cke_reset cke_widget_drag_handler_container" style="background: rgba(220,220,220,0.5); background-image: url('https://csdnimg.cn/release/blog_editor_html/release1.5.9/ckeditor/plugins/widget/images/handle.png');"><span class="cke_image_resizer" title="点击并拖拽以改变尺寸">​</span></span></span></p>
<p>上面两种方式使用手机访问返回都是boot默认的json数据</p>
<h2 id="%E7%AC%AC%E4%BA%8C%E7%A7%8D%EF%BC%9Apc%E7%AB%AF%E8%BF%94%E5%9B%9E%E5%8A%A8%E6%80%81json%E6%95%B0%E6%8D%AE%EF%BC%8C%E6%89%8B%E6%9C%BA%E7%AB%AF%E4%B9%9F%E8%BF%94%E5%9B%9E%E5%8A%A8%E6%80%81json%E6%95%B0%E6%8D%AE"><span style="color: #86ca5e;">第二种：pc端返回动态的页面 ，手机端返回动态json数据</span></h2>
<p>上面第一种可以轻松的的处理异常，只需在指定的路径下放静态页面（无模版引擎的情况）或者携带相关信息的页面（有模版引擎），</p>
<p>缺点就是不能在页面携带我们想要展示的数据，比如当我们程序某处放生异常，我们要返回我们自己提示的错误信息。这种异常如果处理呢？</p>
<p>默认情况下，在 Spring Boot 中，所有的异常数据其实就是第一种所展示出来的 5几条数据，这些数据定义在 org.springframework.boot.web.reactive.error.DefaultErrorAttributes 类中，具体定义在 getErrorAttributes 方法中 ：核心代码如下</p>
<src class="cke_widget_wrapper cke_widget_block cke_widget_codeSnippet cke_widget_wrapper_has cke_widget_selected" data-cke-widget-wrapper="1" data-cke-filter="off" data-cke-display-name="代码段" data-cke-widget-id="12">
<pre class="has cke_widget_element" data-cke-widget-data="{&amp;quot;code&amp;quot;:&amp;quot;@Override\npublic Map&amp;lt;String, Object&amp;gt; getErrorAttributes(ServerRequest request,\n                boolean includeStackTrace) {\n        Map&amp;lt;String, Object&amp;gt; errorAttributes = new LinkedHashMap&amp;lt;&amp;gt;();\n        errorAttributes.put(\&amp;quot;timestamp\&amp;quot;, new Date());\n        errorAttributes.put(\&amp;quot;path\&amp;quot;, request.path());\n        Throwable error = getError(request);\n        HttpStatus errorStatus = determineHttpStatus(error);\n        errorAttributes.put(\&amp;quot;status\&amp;quot;, errorStatus.value());\n        errorAttributes.put(\&amp;quot;error\&amp;quot;, errorStatus.getReasonPhrase());\n        errorAttributes.put(\&amp;quot;message\&amp;quot;, determineMessage(error));\n        handleException(errorAttributes, determineException(error), includeStackTrace);\n        return errorAttributes;\n}&amp;quot;,&amp;quot;classes&amp;quot;:{&amp;quot;has&amp;quot;:1}}" data-cke-widget-upcasted="1" data-cke-widget-keep-attr="0" data-widget="codeSnippet"><code class="hljs">@Override
public Map&lt;String, Object&gt; getErrorAttributes(ServerRequest request,
                boolean includeStackTrace) {
        Map&lt;String, Object&gt; errorAttributes = new LinkedHashMap&lt;&gt;();
        errorAttributes.put("timestamp", new Date());
        errorAttributes.put("path", request.path());
        Throwable error = getError(request);
        HttpStatus errorStatus = determineHttpStatus(error);
        errorAttributes.put("status", errorStatus.value());
        errorAttributes.put("error", errorStatus.getReasonPhrase());
        errorAttributes.put("message", determineMessage(error));
        handleException(errorAttributes, determineException(error), includeStackTrace);
        return errorAttributes;
}</code></code></pre>

<p>DefaultErrorAttributes 类本身则是在 org.springframework.boot.autoconfigure.web.servlet.error.ErrorMvcAutoConfiguration 异常自动配置类中定义的，</p>
<p>如果开发者没有自己提供一个 ErrorAttributes 的实例的话，那么 Spring Boot 将自动提供一个 ErrorAttributes 的实例，也就是 DefaultErrorAttributes 。</p>
<p>基于此 ，开发者自定义 ErrorAttributes 有两种方式 实现自定义数据：</p>
<p>&nbsp;&nbsp;&nbsp; 1.直接实现 ErrorAttributes 接口<br />&nbsp;&nbsp;&nbsp; 2.继承 DefaultErrorAttributes（推荐），因为 DefaultErrorAttributes 中对异常数据的处理已经完成，开发者可以直接使用。</p>
<src class="cke_widget_wrapper cke_widget_block cke_widget_codeSnippet cke_widget_wrapper_has cke_widget_selected" data-cke-widget-wrapper="1" data-cke-filter="off" data-cke-display-name="代码段" data-cke-widget-id="11">
<pre class="has cke_widget_element" data-cke-widget-data="{&amp;quot;code&amp;quot;:&amp;quot;package com.javayihao.top.config;\n\nimport org.springframework.boot.web.servlet.error.DefaultErrorAttributes;\nimport org.springframework.stereotype.Component;\nimport org.springframework.web.context.request.WebRequest;\n\nimport java.util.Map;\n\n@Component\npublic class MyErrorAttributes  extends DefaultErrorAttributes {\n    @Override\n    public Map&amp;lt;String, Object&amp;gt; getErrorAttributes(WebRequest webRequest, boolean includeStackTrace) {\n        Map&amp;lt;String, Object&amp;gt; map = super.getErrorAttributes(webRequest, includeStackTrace);\n        if ((Integer)map.get(\&amp;quot;status\&amp;quot;) == 500) {\n            //这里根据自己需求设置\n            map.put(\&amp;quot;message\&amp;quot;, \&amp;quot;服务器内部错误!\&amp;quot;);\n        }\n        if ((Integer)map.get(\&amp;quot;status\&amp;quot;) == 404) {\n            map.put(\&amp;quot;message\&amp;quot;, \&amp;quot;路径不存在!\&amp;quot;);\n        }\n        return map;\n    }\n}&amp;quot;,&amp;quot;classes&amp;quot;:{&amp;quot;has&amp;quot;:1}}" data-cke-widget-upcasted="1" data-cke-widget-keep-attr="0" data-widget="codeSnippet"><code class="hljs">package com.javayihao.top.config;

import org.springframework.boot.web.servlet.error.DefaultErrorAttributes;
import org.springframework.stereotype.Component;
import org.springframework.web.context.request.WebRequest;

import java.util.Map;

@Component
public class MyErrorAttributes  extends DefaultErrorAttributes {
    @Override
    public Map&lt;String, Object&gt; getErrorAttributes(WebRequest webRequest, boolean includeStackTrace) {
        Map&lt;String, Object&gt; map = super.getErrorAttributes(webRequest, includeStackTrace);
        if ((Integer)map.get("status") == 500) {
            //这里根据自己需求设置
            map.put("message", "服务器内部错误!");
        }
        if ((Integer)map.get("status") == 404) {
            map.put("message", "路径不存在!");
        }
        return map;
    }
}</code></code></pre>

<p>我们服务器访问 错误路径</p>
<p><span class="cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected" data-cke-widget-wrapper="1" data-cke-filter="off" data-cke-display-name="图像" data-cke-widget-id="10"><img class="has cke_widget_element" src="./images/Springboot异常处理和自定义错误页面9.png" alt="" width="567" height="586" data-cke-saved-src="./images/Springboot异常处理和自定义错误页面9.png" data-cke-widget-data="{&amp;quot;hasCaption&amp;quot;:false,&amp;quot;src&amp;quot;:&amp;quot;./images/Springboot异常处理和自定义错误页面9.png&amp;quot;,&amp;quot;alt&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;width&amp;quot;:&amp;quot;567&amp;quot;,&amp;quot;height&amp;quot;:&amp;quot;586&amp;quot;,&amp;quot;lock&amp;quot;:true,&amp;quot;align&amp;quot;:&amp;quot;none&amp;quot;,&amp;quot;classes&amp;quot;:{&amp;quot;has&amp;quot;:1}}" data-cke-widget-upcasted="1" data-cke-widget-keep-attr="0" data-widget="image" /><span class="cke_reset cke_widget_drag_handler_container" style="background: rgba(220,220,220,0.5); background-image: url('https://csdnimg.cn/release/blog_editor_html/release1.5.9/ckeditor/plugins/widget/images/handle.png');"><span class="cke_image_resizer" title="点击并拖拽以改变尺寸">​</span></span></span></p>
<p>客户端响应</p>
<p><span class="cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected" data-cke-widget-wrapper="1" data-cke-filter="off" data-cke-display-name="图像" data-cke-widget-id="9"><img class="has cke_widget_element" src="./images/Springboot异常处理和自定义错误页面10.png" alt="" width="403" height="101" data-cke-saved-src="./images/Springboot异常处理和自定义错误页面10.png" data-cke-widget-data="{&amp;quot;hasCaption&amp;quot;:false,&amp;quot;src&amp;quot;:&amp;quot;./images/Springboot异常处理和自定义错误页面10.png&amp;quot;,&amp;quot;alt&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;width&amp;quot;:&amp;quot;403&amp;quot;,&amp;quot;height&amp;quot;:&amp;quot;101&amp;quot;,&amp;quot;lock&amp;quot;:true,&amp;quot;align&amp;quot;:&amp;quot;none&amp;quot;,&amp;quot;classes&amp;quot;:{&amp;quot;has&amp;quot;:1}}" data-cke-widget-upcasted="1" data-cke-widget-keep-attr="0" data-widget="image" /><span class="cke_reset cke_widget_drag_handler_container" style="background: rgba(220,220,220,0.5); background-image: url('https://csdnimg.cn/release/blog_editor_html/release1.5.9/ckeditor/plugins/widget/images/handle.png');"><span class="cke_image_resizer" title="点击并拖拽以改变尺寸">​</span></span></span></p>
<p>访问有异常的的控制器</p>
<p><span class="cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected" data-cke-widget-wrapper="1" data-cke-filter="off" data-cke-display-name="图像" data-cke-widget-id="8"><img class="has cke_widget_element" src="./images/Springboot异常处理和自定义错误页面11.png" alt="" width="627" height="397" data-cke-saved-src="./images/Springboot异常处理和自定义错误页面11.png" data-cke-widget-data="{&amp;quot;hasCaption&amp;quot;:false,&amp;quot;src&amp;quot;:&amp;quot;./images/Springboot异常处理和自定义错误页面11.png&amp;quot;,&amp;quot;alt&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;width&amp;quot;:&amp;quot;627&amp;quot;,&amp;quot;height&amp;quot;:&amp;quot;397&amp;quot;,&amp;quot;lock&amp;quot;:true,&amp;quot;align&amp;quot;:&amp;quot;none&amp;quot;,&amp;quot;classes&amp;quot;:{&amp;quot;has&amp;quot;:1}}" data-cke-widget-upcasted="1" data-cke-widget-keep-attr="0" data-widget="image" /><span class="cke_reset cke_widget_drag_handler_container" style="background: rgba(220,220,220,0.5); background-image: url('https://csdnimg.cn/release/blog_editor_html/release1.5.9/ckeditor/plugins/widget/images/handle.png');"><span class="cke_image_resizer" title="点击并拖拽以改变尺寸">​</span></span></span></p>
<p>客户端响应</p>
<p><span class="cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected" data-cke-widget-wrapper="1" data-cke-filter="off" data-cke-display-name="图像" data-cke-widget-id="7"><img class="has cke_widget_element" src="./images/Springboot异常处理和自定义错误页面12.png" alt="" width="399" height="83" data-cke-saved-src="./images/Springboot异常处理和自定义错误页面12.png" data-cke-widget-data="{&amp;quot;hasCaption&amp;quot;:false,&amp;quot;src&amp;quot;:&amp;quot;./images/Springboot异常处理和自定义错误页面12.png&amp;quot;,&amp;quot;alt&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;width&amp;quot;:&amp;quot;399&amp;quot;,&amp;quot;height&amp;quot;:&amp;quot;83&amp;quot;,&amp;quot;lock&amp;quot;:true,&amp;quot;align&amp;quot;:&amp;quot;none&amp;quot;,&amp;quot;classes&amp;quot;:{&amp;quot;has&amp;quot;:1}}" data-cke-widget-upcasted="1" data-cke-widget-keep-attr="0" data-widget="image" /><span class="cke_reset cke_widget_drag_handler_container" style="background: rgba(220,220,220,0.5); background-image: url('https://csdnimg.cn/release/blog_editor_html/release1.5.9/ckeditor/plugins/widget/images/handle.png');"><span class="cke_image_resizer" title="点击并拖拽以改变尺寸">​</span></span></span></p>
<p>当然上面我可以在程序任意位置抛出异常，使用全局异常处理器处理</p>
<p>自定义异常</p>
<p><span class="cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected" data-cke-widget-wrapper="1" data-cke-filter="off" data-cke-display-name="图像" data-cke-widget-id="6"><img class="has cke_widget_element" src="./images/Springboot异常处理和自定义错误页面13.png" alt="" width="554" height="124" data-cke-saved-src="./images/Springboot异常处理和自定义错误页面13.png" data-cke-widget-data="{&amp;quot;hasCaption&amp;quot;:false,&amp;quot;src&amp;quot;:&amp;quot;./images/Springboot异常处理和自定义错误页面13.png&amp;quot;,&amp;quot;alt&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;width&amp;quot;:&amp;quot;554&amp;quot;,&amp;quot;height&amp;quot;:&amp;quot;124&amp;quot;,&amp;quot;lock&amp;quot;:true,&amp;quot;align&amp;quot;:&amp;quot;none&amp;quot;,&amp;quot;classes&amp;quot;:{&amp;quot;has&amp;quot;:1}}" data-cke-widget-upcasted="1" data-cke-widget-keep-attr="0" data-widget="image" /><span class="cke_reset cke_widget_drag_handler_container" style="background: rgba(220,220,220,0.5); background-image: url('https://csdnimg.cn/release/blog_editor_html/release1.5.9/ckeditor/plugins/widget/images/handle.png');"><span class="cke_image_resizer" title="点击并拖拽以改变尺寸">​</span></span></span></p>
<p>全局异常处理器</p>
<src class="cke_widget_wrapper cke_widget_block cke_widget_codeSnippet cke_widget_wrapper_has cke_widget_selected" data-cke-widget-wrapper="1" data-cke-filter="off" data-cke-display-name="代码段" data-cke-widget-id="5">
<pre class="has cke_widget_element" data-cke-widget-data="{&amp;quot;code&amp;quot;:&amp;quot;@ControllerAdvice\npublic class MyExceptionHandler {\n    @ExceptionHandler(MyException.class)\n    public String jsonErrorHandler(HttpServletRequest request, Exception e) {\n        Map&amp;lt;String, Object&amp;gt; map = new HashMap&amp;lt;&amp;gt;();\n        request.setAttribute(\&amp;quot;java.servlet.error.status_code\&amp;quot;, 500);\n        map.put(\&amp;quot;code\&amp;quot;, -1);\n        map.put(\&amp;quot;msg\&amp;quot;, e.getMessage());\n        request.setAttribute(\&amp;quot;ext\&amp;quot;, map);\n        //转发到error\n        return \&amp;quot;forward:/error\&amp;quot;;\n    }\n}\n&amp;quot;,&amp;quot;classes&amp;quot;:{&amp;quot;has&amp;quot;:1}}" data-cke-widget-upcasted="1" data-cke-widget-keep-attr="0" data-widget="codeSnippet"><code class="hljs">@ControllerAdvice
public class MyExceptionHandler {
    @ExceptionHandler(MyException.class)
    public String jsonErrorHandler(HttpServletRequest request, Exception e) {
        Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();
        request.setAttribute("java.servlet.error.status_code", 500);
        map.put("code", -1);
        map.put("msg", e.getMessage());
        request.setAttribute("ext", map);
        //转发到error
        return "forward:/error";
    }
}
</code></code></pre>

<p>&nbsp;自定义ErrorAttributes</p>
<src class="cke_widget_wrapper cke_widget_block cke_widget_codeSnippet cke_widget_wrapper_has cke_widget_selected" data-cke-widget-wrapper="1" data-cke-filter="off" data-cke-display-name="代码段" data-cke-widget-id="4">
<pre class="has cke_widget_element" data-cke-widget-data="{&amp;quot;code&amp;quot;:&amp;quot;@Component\npublic class MyErrorAttributes extends DefaultErrorAttributes {\n    //返回的map就是页面或者json能获取的所有字段\n    @Override\n    public Map&amp;lt;String, Object&amp;gt; getErrorAttributes(WebRequest webRequest, boolean includeStackTrace) {\n        Map&amp;lt;String, Object&amp;gt; map = super.getErrorAttributes(webRequest, includeStackTrace);\n        //可以额外添加内容\n        map.put(\&amp;quot;company\&amp;quot;, \&amp;quot;javayihao\&amp;quot;);\n        //取出异常处理器中的携带的数据\n        Map&amp;lt;String, Object&amp;gt; ext = (Map&amp;lt;String, Object&amp;gt;) webRequest.getAttribute(\&amp;quot;ext\&amp;quot;, 0);//传入0代表从request中获取\n        map.put(\&amp;quot;ext\&amp;quot;, ext);\n        return map;\n    }\n}\n&amp;quot;,&amp;quot;classes&amp;quot;:{&amp;quot;has&amp;quot;:1}}" data-cke-widget-upcasted="1" data-cke-widget-keep-attr="0" data-widget="codeSnippet"><code class="hljs">@Component
public class MyErrorAttributes extends DefaultErrorAttributes {
    //返回的map就是页面或者json能获取的所有字段
    @Override
    public Map&lt;String, Object&gt; getErrorAttributes(WebRequest webRequest, boolean includeStackTrace) {
        Map&lt;String, Object&gt; map = super.getErrorAttributes(webRequest, includeStackTrace);
        //可以额外添加内容
        map.put("company", "javayihao");
        //取出异常处理器中的携带的数据
        Map&lt;String, Object&gt; ext = (Map&lt;String, Object&gt;) webRequest.getAttribute("ext", 0);//传入0代表从request中获取
        map.put("ext", ext);
        return map;
    }
}
</code></code></pre>

<p>&nbsp;</p>
<h2 id="%E7%AC%AC%E4%B8%89%E7%A7%8D%EF%BC%9Apc%E7%AB%AF%E8%BF%94%E5%9B%9E%E5%8A%A8%E6%80%81%E7%9A%84%E9%A1%B5%E9%9D%A2%20%EF%BC%8C%E6%89%8B%E6%9C%BA%E7%AB%AF%E8%BF%94%E5%9B%9E%E5%8A%A8%E6%80%81json%E6%95%B0%E6%8D%AE"><span style="color: #86ca5e;">第三种：pc端返回动态json数据，手机端也返回动态json数据</span></h2>
<p>这种方式主要是针对前后端分离的项目，我们自定义一个异常，在程序中用于抛出</p>
<p><span class="cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected" data-cke-widget-wrapper="1" data-cke-filter="off" data-cke-display-name="图像" data-cke-widget-id="3"><img class="has cke_widget_element" src="./images/Springboot异常处理和自定义错误页面14.png" alt="" width="554" height="236" data-cke-saved-src="./images/Springboot异常处理和自定义错误页面14.png" data-cke-widget-data="{&amp;quot;hasCaption&amp;quot;:false,&amp;quot;src&amp;quot;:&amp;quot;./images/Springboot异常处理和自定义错误页面14.png&amp;quot;,&amp;quot;alt&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;width&amp;quot;:&amp;quot;554&amp;quot;,&amp;quot;height&amp;quot;:&amp;quot;236&amp;quot;,&amp;quot;lock&amp;quot;:true,&amp;quot;align&amp;quot;:&amp;quot;none&amp;quot;,&amp;quot;classes&amp;quot;:{&amp;quot;has&amp;quot;:1}}" data-cke-widget-upcasted="1" data-cke-widget-keep-attr="0" data-widget="image" /></span></p>
<p style="margin-left: 0cm;">定义一个返回结果对象（也可以不用定义，直接使用map）存储异常信息</p>
<p style="margin-left: 0cm;"><span class="cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected" data-cke-widget-wrapper="1" data-cke-filter="off" data-cke-display-name="图像" data-cke-widget-id="2"><img class="has cke_widget_element" src="./images/Springboot异常处理和自定义错误页面15.png" alt="" width="531" height="260" data-cke-saved-src="./images/Springboot异常处理和自定义错误页面15.png" data-cke-widget-data="{&amp;quot;hasCaption&amp;quot;:false,&amp;quot;src&amp;quot;:&amp;quot;./images/Springboot异常处理和自定义错误页面15.png&amp;quot;,&amp;quot;alt&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;width&amp;quot;:&amp;quot;531&amp;quot;,&amp;quot;height&amp;quot;:&amp;quot;260&amp;quot;,&amp;quot;lock&amp;quot;:true,&amp;quot;align&amp;quot;:&amp;quot;none&amp;quot;,&amp;quot;classes&amp;quot;:{&amp;quot;has&amp;quot;:1}}" data-cke-widget-upcasted="1" data-cke-widget-keep-attr="0" data-widget="image" /><span class="cke_reset cke_widget_drag_handler_container" style="background: rgba(220,220,220,0.5); background-image: url('https://csdnimg.cn/release/blog_editor_html/release1.5.9/ckeditor/plugins/widget/images/handle.png');"><span class="cke_image_resizer" title="点击并拖拽以改变尺寸">​</span></span></span></p>
<p style="margin-left: 0cm;">定义一个全局异常处理器</p>
<src class="cke_widget_wrapper cke_widget_block cke_widget_codeSnippet cke_widget_wrapper_has cke_widget_selected" data-cke-widget-wrapper="1" data-cke-filter="off" data-cke-display-name="代码段" data-cke-widget-id="1">
<pre class="has cke_widget_element" data-cke-widget-data="{&amp;quot;code&amp;quot;:&amp;quot;/*ControllerAdvice用来配置需要进行异常处理的包和注解类型，\n 比如@ControllerAdvice(annotations = RestController.class)\n 只有类标有rescontrolle才会被拦截\n */\n@ControllerAdvice\npublic class MyExceptionHandler {\n    //自己创建的异常按照自己编写的信息返回即可\n    @ExceptionHandler(value = MyException.class)\n    @ResponseBody\n    public ErrorInfo&amp;lt;String&amp;gt; errorInfo(HttpServletRequest req, MyException e) {\n        ErrorInfo&amp;lt;String&amp;gt; r = new ErrorInfo&amp;lt;&amp;gt;();\n        r.setCode(ErrorInfo.ERROR);\n        r.setMessage(e.getMessage());\n        r.setData(\&amp;quot;测试数据\&amp;quot;);\n        r.setUrl(req.getRequestURL().toString());\n        return r;\n    }\n    //系统异常时返回的异常编号为 -1 ，返回的异常信息为 &ldquo;系统正在维护&rdquo;；不能将原始的异常信息返回\n    @ExceptionHandler(value = Exception.class)\n    @ResponseBody\n    public ErrorInfo&amp;lt;String&amp;gt; errorInfo(HttpServletRequest req, Exception e) {\n        ErrorInfo&amp;lt;String&amp;gt; r = new ErrorInfo&amp;lt;&amp;gt;();\n        r.setCode(ErrorInfo.ERROR);\n        r.setMessage(\&amp;quot;系统维护中\&amp;quot;);\n        return r;\n    }\n}\n&amp;quot;,&amp;quot;classes&amp;quot;:{&amp;quot;has&amp;quot;:1}}" data-cke-widget-upcasted="1" data-cke-widget-keep-attr="0" data-widget="codeSnippet"><code class="hljs">/*ControllerAdvice用来配置需要进行异常处理的包和注解类型，
 比如@ControllerAdvice(annotations = RestController.class)
 只有类标有rescontrolle才会被拦截
 */
@ControllerAdvice
public class MyExceptionHandler {
    //自己创建的异常按照自己编写的信息返回即可
    @ExceptionHandler(value = MyException.class)
    @ResponseBody
    public ErrorInfo&lt;String&gt; errorInfo(HttpServletRequest req, MyException e) {
        ErrorInfo&lt;String&gt; r = new ErrorInfo&lt;&gt;();
        r.setCode(ErrorInfo.ERROR);
        r.setMessage(e.getMessage());
        r.setData("测试数据");
        r.setUrl(req.getRequestURL().toString());
        return r;
    }
    //系统异常时返回的异常编号为 -1 ，返回的异常信息为 &ldquo;系统正在维护&rdquo;；不能将原始的异常信息返回
    @ExceptionHandler(value = Exception.class)
    @ResponseBody
    public ErrorInfo&lt;String&gt; errorInfo(HttpServletRequest req, Exception e) {
        ErrorInfo&lt;String&gt; r = new ErrorInfo&lt;&gt;();
        r.setCode(ErrorInfo.ERROR);
        r.setMessage("系统维护中");
        return r;
    }
}
</code></code></pre>

<p style="margin-left: 0cm;"><span class="cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected" data-cke-widget-wrapper="1" data-cke-filter="off" data-cke-display-name="图像" data-cke-widget-id="0"><img class="has cke_widget_element" src="./images/Springboot异常处理和自定义错误页面16.png" alt="" width="720" height="400" data-cke-saved-src="./images/Springboot异常处理和自定义错误页面16.png" data-cke-widget-data="{&amp;quot;hasCaption&amp;quot;:false,&amp;quot;src&amp;quot;:&amp;quot;./images/Springboot异常处理和自定义错误页面16.png&amp;quot;,&amp;quot;alt&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;width&amp;quot;:&amp;quot;720&amp;quot;,&amp;quot;height&amp;quot;:&amp;quot;400&amp;quot;,&amp;quot;lock&amp;quot;:true,&amp;quot;align&amp;quot;:&amp;quot;none&amp;quot;,&amp;quot;classes&amp;quot;:{&amp;quot;has&amp;quot;:1}}" data-cke-widget-upcasted="1" data-cke-widget-keep-attr="0" data-widget="image" /><span class="cke_reset cke_widget_drag_handler_container" style="background: rgba(220,220,220,0.5); background-image: url('https://csdnimg.cn/release/blog_editor_html/release1.5.9/ckeditor/plugins/widget/images/handle.png');"><span class="cke_image_resizer" title="点击并拖拽以改变尺寸">​<br /></span></span></span></p>

</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>