<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修SSO单点登录' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>SSO单点登录</center></div><div class='banquan'>原文出处:本文由博客园博主soldier_cnblogs提供。<br/>
原文连接:https://www.cnblogs.com/HuangJie-sol/p/11921376.html</div><br>
    <h1>单点登录系统介绍</h1>
<blockquote>
<p>单点登录（Single Sign On），简称为 SSO，是目前比较流行的企业业务整合的解决方案之一。SSO 的定义是在多个应用系统中，用户只需要登录一次就可以访问所有相互信任的应用系统。</p>
</blockquote>
<p>&nbsp;</p>
<p><img src="./images/SSO单点登录0.png" alt="" /></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h2>单点登录的实现原理</h2>
<p>实现单点登录，就是解决如何产生和存储那个信任，再就是其他系统如何验证这个信任的有效性。因此，也就需要解决以下两点：</p>
<ul>
<li>存储信任</li>
<li>验证信任</li>
</ul>
<p><img src="./images/SSO单点登录1.png" alt="" /></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h1>项目配置文件（SSM+Redis+Dubbo）</h1>
<src class="cnblogs_code" onclick="cnblogs_code_show('2a294c09-3ebe-4ba2-8f1c-60ff6e4605c1')"><img id="code_img_closed_2a294c09-3ebe-4ba2-8f1c-60ff6e4605c1" class="code_img_closed" src="./images/SSO单点登录2.png" alt="" /><img id="code_img_opened_2a294c09-3ebe-4ba2-8f1c-60ff6e4605c1" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('2a294c09-3ebe-4ba2-8f1c-60ff6e4605c1',event)" src="./images/SSO单点登录3.png" alt="" />
<src id="cnblogs_code_open_2a294c09-3ebe-4ba2-8f1c-60ff6e4605c1" class="cnblogs_code_hide">
<pre><code><span style="color: #0000ff;">&lt;?</span><span style="color: #ff00ff;">xml version="1.0" encoding="UTF-8"</span><span style="color: #0000ff;">?&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">beans </span><span style="color: #ff0000;">xmlns</span><span style="color: #0000ff;">="http://www.springframework.org/schema/beans"</span><span style="color: #ff0000;">
       xmlns:dubbo</span><span style="color: #0000ff;">="http://code.alibabatech.com/schema/dubbo"</span><span style="color: #ff0000;">
       xmlns:xsi</span><span style="color: #0000ff;">="http://www.w3.org/2001/XMLSchema-instance"</span><span style="color: #ff0000;">
       xsi:schemaLocation</span><span style="color: #0000ff;">="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://code.alibabatech.com/schema/dubbo
        http://code.alibabatech.com/schema/dubbo/dubbo.xsd"</span><span style="color: #0000ff;">&gt;</span>

    <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> 添加服务消费者的标志 </span><span style="color: #008000;">--&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">dubbo:application </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="ego-sso-web-consumer"</span><span style="color: #0000ff;">/&gt;</span>

    <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> 指定注册中心，有两个地址192.168.1.171、172.18.25.171 </span><span style="color: #008000;">--&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">dubbo:registry </span><span style="color: #ff0000;">address</span><span style="color: #0000ff;">="172.18.25.171:2181,172.18.25.171:2182,172.18.25.171:2183"</span><span style="color: #ff0000;"> protocol</span><span style="color: #0000ff;">="zookeeper"</span> <span style="color: #0000ff;">/&gt;</span>
    <span style="color: #008000;">&lt;!--</span><span style="color: #008000;">&lt;dubbo:registry address="192.168.1.171:2181,192.168.1.171:2182,192.168.1.171:2183" protocol="zookeeper" /&gt;</span><span style="color: #008000;">--&gt;</span>

    <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> spring容器中存在一个远程服务的代理对象 </span><span style="color: #008000;">--&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">dubbo:reference </span><span style="color: #ff0000;">interface</span><span style="color: #0000ff;">="com.soldier.ego.rpc.service.UserService"</span><span style="color: #ff0000;"> id</span><span style="color: #0000ff;">="userServiceProxy"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">dubbo:reference</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">beans</span><span style="color: #0000ff;">&gt;</span></code></pre>

<span class="cnblogs_code_collapse">applicationContext-dubbo.xml</span>
<src class="cnblogs_code" onclick="cnblogs_code_show('a252a356-58af-4338-b99a-15f590aa639b')"><img id="code_img_closed_a252a356-58af-4338-b99a-15f590aa639b" class="code_img_closed" src="./images/SSO单点登录2.png" alt="" /><img id="code_img_opened_a252a356-58af-4338-b99a-15f590aa639b" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('a252a356-58af-4338-b99a-15f590aa639b',event)" src="./images/SSO单点登录3.png" alt="" />
<src id="cnblogs_code_open_a252a356-58af-4338-b99a-15f590aa639b" class="cnblogs_code_hide">
<pre><code><span style="color: #0000ff;">&lt;?</span><span style="color: #ff00ff;">xml version="1.0" encoding="UTF-8"</span><span style="color: #0000ff;">?&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">beans </span><span style="color: #ff0000;">xmlns</span><span style="color: #0000ff;">="http://www.springframework.org/schema/beans"</span><span style="color: #ff0000;">
       xmlns:context</span><span style="color: #0000ff;">="http://www.springframework.org/schema/context"</span><span style="color: #ff0000;">
       xmlns:xsi</span><span style="color: #0000ff;">="http://www.w3.org/2001/XMLSchema-instance"</span><span style="color: #ff0000;">
       xsi:schemaLocation</span><span style="color: #0000ff;">="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd"</span><span style="color: #0000ff;">&gt;</span>

    <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> 加载cache.properties</span><span style="color: #008000;">--&gt;</span>
    <span style="color: #008000;">&lt;!--</span><span style="color: #008000;">&lt;context:property-placeholder location="classpath:cache.properties"&gt;&lt;/context:property-placeholder&gt;</span><span style="color: #008000;">--&gt;</span>

    <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> 实例化JedisCluster，连接redis集群，有两个地址192.168.1.174、172.18.25.174</span><span style="color: #008000;">--&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">bean </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="jedisCluster"</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">="redis.clients.jedis.JedisCluster"</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">constructor-arg </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="nodes"</span><span style="color: #0000ff;">&gt;</span>
            <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">set</span><span style="color: #0000ff;">&gt;</span>
                <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">bean </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="redis.clients.jedis.HostAndPort"</span><span style="color: #0000ff;">&gt;</span>
                    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">constructor-arg </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="host"</span><span style="color: #ff0000;"> value</span><span style="color: #0000ff;">="172.18.25.174"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">constructor-arg</span><span style="color: #0000ff;">&gt;</span>
                    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">constructor-arg </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="port"</span><span style="color: #ff0000;"> value</span><span style="color: #0000ff;">="6380"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">constructor-arg</span><span style="color: #0000ff;">&gt;</span>
                <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">bean</span><span style="color: #0000ff;">&gt;</span>
                <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">bean </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="redis.clients.jedis.HostAndPort"</span><span style="color: #0000ff;">&gt;</span>
                    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">constructor-arg </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="host"</span><span style="color: #ff0000;"> value</span><span style="color: #0000ff;">="172.18.25.174"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">constructor-arg</span><span style="color: #0000ff;">&gt;</span>
                    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">constructor-arg </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="port"</span><span style="color: #ff0000;"> value</span><span style="color: #0000ff;">="6381"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">constructor-arg</span><span style="color: #0000ff;">&gt;</span>
                <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">bean</span><span style="color: #0000ff;">&gt;</span>
                <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">bean </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="redis.clients.jedis.HostAndPort"</span><span style="color: #0000ff;">&gt;</span>
                    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">constructor-arg </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="host"</span><span style="color: #ff0000;"> value</span><span style="color: #0000ff;">="172.18.25.174"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">constructor-arg</span><span style="color: #0000ff;">&gt;</span>
                    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">constructor-arg </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="port"</span><span style="color: #ff0000;"> value</span><span style="color: #0000ff;">="6382"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">constructor-arg</span><span style="color: #0000ff;">&gt;</span>
                <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">bean</span><span style="color: #0000ff;">&gt;</span>
                <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">bean </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="redis.clients.jedis.HostAndPort"</span><span style="color: #0000ff;">&gt;</span>
                    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">constructor-arg </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="host"</span><span style="color: #ff0000;"> value</span><span style="color: #0000ff;">="172.18.25.174"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">constructor-arg</span><span style="color: #0000ff;">&gt;</span>
                    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">constructor-arg </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="port"</span><span style="color: #ff0000;"> value</span><span style="color: #0000ff;">="6383"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">constructor-arg</span><span style="color: #0000ff;">&gt;</span>
                <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">bean</span><span style="color: #0000ff;">&gt;</span>
                <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">bean </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="redis.clients.jedis.HostAndPort"</span><span style="color: #0000ff;">&gt;</span>
                    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">constructor-arg </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="host"</span><span style="color: #ff0000;"> value</span><span style="color: #0000ff;">="172.18.25.174"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">constructor-arg</span><span style="color: #0000ff;">&gt;</span>
                    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">constructor-arg </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="port"</span><span style="color: #ff0000;"> value</span><span style="color: #0000ff;">="6384"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">constructor-arg</span><span style="color: #0000ff;">&gt;</span>
                <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">bean</span><span style="color: #0000ff;">&gt;</span>
                <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">bean </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="redis.clients.jedis.HostAndPort"</span><span style="color: #0000ff;">&gt;</span>
                    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">constructor-arg </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="host"</span><span style="color: #ff0000;"> value</span><span style="color: #0000ff;">="172.18.25.174"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">constructor-arg</span><span style="color: #0000ff;">&gt;</span>
                    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">constructor-arg </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="port"</span><span style="color: #ff0000;"> value</span><span style="color: #0000ff;">="6385"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">constructor-arg</span><span style="color: #0000ff;">&gt;</span>
                <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">bean</span><span style="color: #0000ff;">&gt;</span>
            <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">set</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">constructor-arg</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">bean</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">beans</span><span style="color: #0000ff;">&gt;</span></code></pre>

<span class="cnblogs_code_collapse">applicationContext-redis.xml</span>
<src class="cnblogs_code" onclick="cnblogs_code_show('918adfcf-3fdd-4ed3-915b-65cd37ee516d')"><img id="code_img_closed_918adfcf-3fdd-4ed3-915b-65cd37ee516d" class="code_img_closed" src="./images/SSO单点登录2.png" alt="" /><img id="code_img_opened_918adfcf-3fdd-4ed3-915b-65cd37ee516d" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('918adfcf-3fdd-4ed3-915b-65cd37ee516d',event)" src="./images/SSO单点登录3.png" alt="" />
<src id="cnblogs_code_open_918adfcf-3fdd-4ed3-915b-65cd37ee516d" class="cnblogs_code_hide">
<pre><code><span style="color: #0000ff;">&lt;?</span><span style="color: #ff00ff;">xml version="1.0" encoding="UTF-8"</span><span style="color: #0000ff;">?&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">beans </span><span style="color: #ff0000;">xmlns</span><span style="color: #0000ff;">="http://www.springframework.org/schema/beans"</span><span style="color: #ff0000;">
       xmlns:context</span><span style="color: #0000ff;">="http://www.springframework.org/schema/context"</span><span style="color: #ff0000;">
       xmlns:xsi</span><span style="color: #0000ff;">="http://www.w3.org/2001/XMLSchema-instance"</span><span style="color: #ff0000;">
       xsi:schemaLocation</span><span style="color: #0000ff;">="http://www.springframework.org/schema/beans
                  http://www.springframework.org/schema/beans/spring-beans.xsd
                  http://www.springframework.org/schema/context
                  http://www.springframework.org/schema/context/spring-context.xsd"</span><span style="color: #0000ff;">&gt;</span>

    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">context:component-scan </span><span style="color: #ff0000;">base-package</span><span style="color: #0000ff;">="com.soldier.ego.sso.service.impl"</span> <span style="color: #0000ff;">/&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">beans</span><span style="color: #0000ff;">&gt;</span></code></pre>

<span class="cnblogs_code_collapse">applicationContext-service.xml</span>
<src class="cnblogs_code" onclick="cnblogs_code_show('c122b5fc-a9b9-4e8a-b8b7-41e6049868de')"><img id="code_img_closed_c122b5fc-a9b9-4e8a-b8b7-41e6049868de" class="code_img_closed" src="./images/SSO单点登录2.png" alt="" /><img id="code_img_opened_c122b5fc-a9b9-4e8a-b8b7-41e6049868de" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('c122b5fc-a9b9-4e8a-b8b7-41e6049868de',event)" src="./images/SSO单点登录3.png" alt="" />
<src id="cnblogs_code_open_c122b5fc-a9b9-4e8a-b8b7-41e6049868de" class="cnblogs_code_hide">
<pre><code><span style="color: #0000ff;">&lt;?</span><span style="color: #ff00ff;">xml version="1.0" encoding="UTF-8"</span><span style="color: #0000ff;">?&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">beans </span><span style="color: #ff0000;">xmlns</span><span style="color: #0000ff;">="http://www.springframework.org/schema/beans"</span><span style="color: #ff0000;">
       xmlns:context</span><span style="color: #0000ff;">="http://www.springframework.org/schema/context"</span><span style="color: #ff0000;">
       xmlns:mvc</span><span style="color: #0000ff;">="http://www.springframework.org/schema/mvc"</span><span style="color: #ff0000;">
       xmlns:xsi</span><span style="color: #0000ff;">="http://www.w3.org/2001/XMLSchema-instance"</span><span style="color: #ff0000;">
       xsi:schemaLocation</span><span style="color: #0000ff;">="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd
        http://www.springframework.org/schema/mvc
        http://www.springframework.org/schema/mvc/spring-mvc.xsd"</span><span style="color: #0000ff;">&gt;</span>

    <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> 扫描controller </span><span style="color: #008000;">--&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">context:component-scan </span><span style="color: #ff0000;">base-package</span><span style="color: #0000ff;">="com.soldier.ego.sso.controller"</span> <span style="color: #0000ff;">/&gt;</span>

    <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> mvc:annotation-driven </span><span style="color: #008000;">--&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">mvc:annotation-driven </span><span style="color: #0000ff;">/&gt;</span>

    <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> 静态资源映射 </span><span style="color: #008000;">--&gt;</span>
    <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> location:表示资源在项目的真正位置 </span><span style="color: #008000;">--&gt;</span>
    <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> mapping:访问路径 </span><span style="color: #008000;">--&gt;</span>
    <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> /css/** </span><span style="color: #008000;">--&gt;</span>
    <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> http://localhost:8080/css/a/b/c/hello.css </span><span style="color: #008000;">--&gt;</span>
    <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> / = http://localhost:8080/ </span><span style="color: #008000;">--&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">mvc:resources </span><span style="color: #ff0000;">location</span><span style="color: #0000ff;">="/css/"</span><span style="color: #ff0000;"> mapping</span><span style="color: #0000ff;">="/css/**"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">mvc:resources</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">mvc:resources </span><span style="color: #ff0000;">location</span><span style="color: #0000ff;">="/js/"</span><span style="color: #ff0000;"> mapping</span><span style="color: #0000ff;">="/js/**"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">mvc:resources</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">mvc:resources </span><span style="color: #ff0000;">location</span><span style="color: #0000ff;">="/images/"</span><span style="color: #ff0000;"> mapping</span><span style="color: #0000ff;">="/images/**"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">mvc:resources</span><span style="color: #0000ff;">&gt;</span>

    <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> 视图解析器 </span><span style="color: #008000;">--&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">bean </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="viewResovler"</span><span style="color: #ff0000;">
          class</span><span style="color: #0000ff;">="org.springframework.web.servlet.view.InternalResourceViewResolver"</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> 表示使用的视图技术是jsp </span><span style="color: #008000;">--&gt;</span>
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="viewClass"</span><span style="color: #ff0000;">
                  value</span><span style="color: #0000ff;">="org.springframework.web.servlet.view.JstlView"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">property</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> 前缀 </span><span style="color: #008000;">--&gt;</span>
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="prefix"</span><span style="color: #ff0000;"> value</span><span style="color: #0000ff;">="/WEB-INF/jsp/"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">property</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> 后缀 </span><span style="color: #008000;">--&gt;</span>
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="suffix"</span><span style="color: #ff0000;"> value</span><span style="color: #0000ff;">=".jsp"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">property</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">bean</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">beans</span><span style="color: #0000ff;">&gt;</span></code></pre>

<span class="cnblogs_code_collapse">springmvc.xml</span>
<src class="cnblogs_code" onclick="cnblogs_code_show('a2371344-af77-423e-b4d9-1877df5aa534')"><img id="code_img_closed_a2371344-af77-423e-b4d9-1877df5aa534" class="code_img_closed" src="./images/SSO单点登录2.png" alt="" /><img id="code_img_opened_a2371344-af77-423e-b4d9-1877df5aa534" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('a2371344-af77-423e-b4d9-1877df5aa534',event)" src="./images/SSO单点登录3.png" alt="" />
<src id="cnblogs_code_open_a2371344-af77-423e-b4d9-1877df5aa534" class="cnblogs_code_hide">
<pre><code><span style="color: #0000ff;">&lt;?</span><span style="color: #ff00ff;">xml version="1.0" encoding="UTF-8"</span><span style="color: #0000ff;">?&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">web-app </span><span style="color: #ff0000;">xmlns:xsi</span><span style="color: #0000ff;">="http://www.w3.org/2001/XMLSchema-instance"</span><span style="color: #ff0000;">
         xmlns</span><span style="color: #0000ff;">="http://java.sun.com/xml/ns/javaee"</span><span style="color: #ff0000;">
         xsi:schemaLocation</span><span style="color: #0000ff;">="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span><span style="color: #ff0000;">
         version</span><span style="color: #0000ff;">="2.5"</span><span style="color: #0000ff;">&gt;</span>
  <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">display-name</span><span style="color: #0000ff;">&gt;</span>ego-sso-web<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">display-name</span><span style="color: #0000ff;">&gt;</span>
  <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">welcome-file-list</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">welcome-file</span><span style="color: #0000ff;">&gt;</span>index.html<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">welcome-file</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">welcome-file</span><span style="color: #0000ff;">&gt;</span>index.htm<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">welcome-file</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">welcome-file</span><span style="color: #0000ff;">&gt;</span>index.jsp<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">welcome-file</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">welcome-file</span><span style="color: #0000ff;">&gt;</span>default.html<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">welcome-file</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">welcome-file</span><span style="color: #0000ff;">&gt;</span>default.htm<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">welcome-file</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">welcome-file</span><span style="color: #0000ff;">&gt;</span>default.jsp<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">welcome-file</span><span style="color: #0000ff;">&gt;</span>
  <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">welcome-file-list</span><span style="color: #0000ff;">&gt;</span>

  <span style="color: #008000;">&lt;!--</span><span style="color: #008000;">&lt;servlet-mapping&gt;</span><span style="color: #008000;">--&gt;</span>
  <span style="color: #008000;">&lt;!--</span><span style="color: #008000;">&lt;servlet-name&gt;default&lt;/servlet-name&gt;</span><span style="color: #008000;">--&gt;</span>
  <span style="color: #008000;">&lt;!--</span><span style="color: #008000;">&lt;url-pattern&gt;/favicon.ico&lt;/url-pattern&gt;</span><span style="color: #008000;">--&gt;</span>
  <span style="color: #008000;">&lt;!--</span><span style="color: #008000;">&lt;/servlet-mapping&gt;</span><span style="color: #008000;">--&gt;</span>

  <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> 以监听器的方式启动spring容器 </span><span style="color: #008000;">--&gt;</span>
  <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">listener</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">listener-class</span><span style="color: #0000ff;">&gt;</span>org.springframework.web.context.ContextLoaderListener<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">listener-class</span><span style="color: #0000ff;">&gt;</span>
  <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">listener</span><span style="color: #0000ff;">&gt;</span>

  <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> 指定spring的配置文件 </span><span style="color: #008000;">--&gt;</span>
  <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">context-param</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">param-name</span><span style="color: #0000ff;">&gt;</span>contextConfigLocation<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">param-name</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">param-value</span><span style="color: #0000ff;">&gt;</span>classpath:spring/applicationContext-*.xml<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">param-value</span><span style="color: #0000ff;">&gt;</span>
  <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">context-param</span><span style="color: #0000ff;">&gt;</span>

  <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> POST请求的乱码过滤器 </span><span style="color: #008000;">--&gt;</span>
  <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">filter</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">filter-name</span><span style="color: #0000ff;">&gt;</span>encodingFilter<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">filter-name</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">filter-class</span><span style="color: #0000ff;">&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">filter-class</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> 指定编码方式 </span><span style="color: #008000;">--&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">init-param</span><span style="color: #0000ff;">&gt;</span>
      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">param-name</span><span style="color: #0000ff;">&gt;</span>encoding<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">param-name</span><span style="color: #0000ff;">&gt;</span>
      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">param-value</span><span style="color: #0000ff;">&gt;</span>utf-8<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">param-value</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">init-param</span><span style="color: #0000ff;">&gt;</span>
  <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">filter</span><span style="color: #0000ff;">&gt;</span>
  <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> 映射filter </span><span style="color: #008000;">--&gt;</span>
  <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">filter-mapping</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">filter-name</span><span style="color: #0000ff;">&gt;</span>encodingFilter<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">filter-name</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">url-pattern</span><span style="color: #0000ff;">&gt;</span>/*<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">url-pattern</span><span style="color: #0000ff;">&gt;</span>
  <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">filter-mapping</span><span style="color: #0000ff;">&gt;</span>

  <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> springmvc的servlet </span><span style="color: #008000;">--&gt;</span>
  <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">servlet</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">servlet-name</span><span style="color: #0000ff;">&gt;</span>ego-sso-web<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">servlet-name</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">servlet-class</span><span style="color: #0000ff;">&gt;</span>org.springframework.web.servlet.DispatcherServlet<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">servlet-class</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> 指定springmvc的配置文件 </span><span style="color: #008000;">--&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">init-param</span><span style="color: #0000ff;">&gt;</span>
      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">param-name</span><span style="color: #0000ff;">&gt;</span>contextConfigLocation<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">param-name</span><span style="color: #0000ff;">&gt;</span>
      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">param-value</span><span style="color: #0000ff;">&gt;</span>classpath:spring/springmvc.xml<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">param-value</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">init-param</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> 让springmvc随系统启动而启动 </span><span style="color: #008000;">--&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">load-on-startup</span><span style="color: #0000ff;">&gt;</span>1<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">load-on-startup</span><span style="color: #0000ff;">&gt;</span>
  <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">servlet</span><span style="color: #0000ff;">&gt;</span>

  <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">servlet-mapping</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">servlet-name</span><span style="color: #0000ff;">&gt;</span>ego-sso-web<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">servlet-name</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> 不需要伪静态化</span><span style="color: #008000;">--&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">url-pattern</span><span style="color: #0000ff;">&gt;</span>/<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">url-pattern</span><span style="color: #0000ff;">&gt;</span>
  <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">servlet-mapping</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">web-app</span><span style="color: #0000ff;">&gt;</span></code></pre>

<span class="cnblogs_code_collapse">web.xml</span>
<p>&nbsp;</p>
<src class="cnblogs_code" onclick="cnblogs_code_show('5a98db72-eb71-4881-98fc-31bf38858d14')"><img id="code_img_closed_5a98db72-eb71-4881-98fc-31bf38858d14" class="code_img_closed" src="./images/SSO单点登录2.png" alt="" /><img id="code_img_opened_5a98db72-eb71-4881-98fc-31bf38858d14" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('5a98db72-eb71-4881-98fc-31bf38858d14',event)" src="./images/SSO单点登录3.png" alt="" />
<src id="cnblogs_code_open_5a98db72-eb71-4881-98fc-31bf38858d14" class="cnblogs_code_hide">
<pre><code><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> EgoResult <span style="color: #0000ff;">implements</span><span style="color: #000000;"> Serializable {

    </span><span style="color: #008000;">//</span><span style="color: #008000;">响应状态</span>
    <span style="color: #0000ff;">private</span><span style="color: #000000;"> Integer status;
    </span><span style="color: #008000;">//</span><span style="color: #008000;">响应数据</span>
    <span style="color: #0000ff;">private</span><span style="color: #000000;"> Object data;
    </span><span style="color: #008000;">//</span><span style="color: #008000;">响应消息</span>
    <span style="color: #0000ff;">private</span><span style="color: #000000;"> String msg;

    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> Integer getStatus() {
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> status;
    }

    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> setStatus(Integer status) {
        </span><span style="color: #0000ff;">this</span>.status =<span style="color: #000000;"> status;
    }

    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> Object getData() {
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> data;
    }

    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> setData(Object data) {
        </span><span style="color: #0000ff;">this</span>.data =<span style="color: #000000;"> data;
    }

    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> String getMsg() {
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> msg;
    }

    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> setMsg(String msg) {
        </span><span style="color: #0000ff;">this</span>.msg =<span style="color: #000000;"> msg;
    }

    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> EgoResult(Integer status, Object data, String msg) {
        </span><span style="color: #0000ff;">this</span>.status =<span style="color: #000000;"> status;
        </span><span style="color: #0000ff;">this</span>.data =<span style="color: #000000;"> data;
        </span><span style="color: #0000ff;">this</span>.msg =<span style="color: #000000;"> msg;
    }

    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> EgoResult(Integer status, String msg) {
        </span><span style="color: #0000ff;">this</span>.status =<span style="color: #000000;"> status;
        </span><span style="color: #0000ff;">this</span>.msg =<span style="color: #000000;"> msg;
    }

    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> EgoResult(Object data) {
        </span><span style="color: #0000ff;">this</span>.data =<span style="color: #000000;"> data;
        </span><span style="color: #0000ff;">this</span>.status = 200<span style="color: #000000;">;
        </span><span style="color: #0000ff;">this</span>.msg = "ok"<span style="color: #000000;">;
    }

    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> EgoResult() {
        </span><span style="color: #0000ff;">super</span><span style="color: #000000;">();
    }

    </span><span style="color: #008000;">/**</span><span style="color: #008000;">
     * 静态方法，返回rgoResult对象
     </span><span style="color: #008000;">*/</span>
    <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span><span style="color: #000000;"> EgoResult ok() {
        </span><span style="color: #0000ff;">return</span> <span style="color: #0000ff;">new</span> EgoResult(<span style="color: #0000ff;">null</span><span style="color: #000000;">);
    }
}</span></code></pre>

<span class="cnblogs_code_collapse">EgoResult.class</span>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h1>实现用户名唯一性验证</h1>
<h2>1、唯一性验证接口开发规范</h2>
<table border="0">
<tbody>
<tr>
<td><span style="font-size: 18px;">请求方法</span></td>
<td><span style="font-size: 18px;">GET</span></td>
</tr>
<tr>
<td><span style="font-size: 18px;">UR</span></td>
<td><span style="font-size: 18px;">http://sso.egou.com/user/check/{param}/{type}</span></td>
</tr>
<tr>
<td><span style="font-size: 18px;">参数说</span></td>
<td><span style="font-size: 18px;">格式如：zhangsan/1，其中 zhangsan 是校验的数据，type 为类型，可 </span><br /><span style="font-size: 18px;">选参数 1、2、3 分别代表 username、phone、email </span><br /><span style="font-size: 18px;">可选参数 callback：如果有此参数表示此方法为 jsonp 请求，需要支 </span><span style="font-size: 18px;">持 jsonp。</span></td>






</tr>
<tr>
<td><span style="font-size: 18px;">示例</span></td>
<td><span style="font-size: 18px;">http://sso.egou.com/user/check/zhangsan/1</span></td>






</tr>
<tr>
<td><span style="font-size: 18px;">返回</span></td>
<td><span style="font-size: 18px;">{ </span><br /><span style="font-size: 18px;">status: 200 //200 成功 </span><br /><span style="font-size: 18px;">msg: "OK"// 返回信息消息 </span><br /><span style="font-size: 18px;">data: false // 返回数据，true：数据可用，false：数据不可用 </span><br /><span style="font-size: 18px;">}</span></td>






</tr>






</tbody>






</table>
<h2>2、实现</h2>
<src class="cnblogs_code">
<pre><code><span style="color: #008000;">　　/**</span><span style="color: #008000;">
     * 处理用户名唯一性验证请求
     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> param     验证数据
     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> type      验证类型
     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> callback  回到函数
     *      MappingJacksonValue --&gt; 返回json，支持JSONP（其实是解决JS跨域调用数据的一种方案）
     *      required = false --&gt; 非必须
     *      @ResponseBody 异步的，不会进行跳转
     </span><span style="color: #008000;">*/</span><span style="color: #000000;">
    @RequestMapping(</span>"/user/check/{param}/{type}"<span style="color: #000000;">)
    @ResponseBody
    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> MappingJacksonValue loadPage(@PathVariable String param, @PathVariable Integer type,
                                        @RequestParam(required </span>= <span style="color: #0000ff;">false</span><span style="color: #000000;">) String callback) {
        EgoResult result </span>=<span style="color: #000000;"> ssoUserService.selectUserByCond(param, type);

        </span><span style="color: #008000;">//</span><span style="color: #008000;">  处理json响应数据格式</span>
        MappingJacksonValue jacksonValue = <span style="color: #0000ff;">new</span><span style="color: #000000;"> MappingJacksonValue(result);
        </span><span style="color: #0000ff;">if</span> (!<span style="color: #000000;">StringUtils.isEmpty(callback)) jacksonValue.setJsonpFunction(callback);

        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> jacksonValue;
    }</span></code></pre>

<src class="cnblogs_code" onclick="cnblogs_code_show('e2da49bb-f152-430c-9393-452515511529')"><img id="code_img_closed_e2da49bb-f152-430c-9393-452515511529" class="code_img_closed" src="./images/SSO单点登录2.png" alt="" /><img id="code_img_opened_e2da49bb-f152-430c-9393-452515511529" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('e2da49bb-f152-430c-9393-452515511529',event)" src="./images/SSO单点登录3.png" alt="" />
<src id="cnblogs_code_open_e2da49bb-f152-430c-9393-452515511529" class="cnblogs_code_hide">
<pre><code><span style="color: #000000;">@Service
</span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> SsoUserServiceImpl <span style="color: #0000ff;">implements</span><span style="color: #000000;"> SsoUserService {

    </span><span style="color: #008000;">//</span><span style="color: #008000;">注入的是远程服务的代理对象</span>
<span style="color: #000000;">    @Autowired
    </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> UserService userServiceProxy;

    @Override
    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> EgoResult selectUserByCond(String cond, Integer type) {
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> userServiceProxy.selectUserByCondService(cond, type);
    }
}</span></code></pre>

<span class="cnblogs_code_collapse">SsoUserService.class</span>
<src class="cnblogs_code" onclick="cnblogs_code_show('9f270d7e-4257-4fb7-926e-d55558fabf3a')"><img id="code_img_closed_9f270d7e-4257-4fb7-926e-d55558fabf3a" class="code_img_closed" src="./images/SSO单点登录2.png" alt="" /><img id="code_img_opened_9f270d7e-4257-4fb7-926e-d55558fabf3a" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('9f270d7e-4257-4fb7-926e-d55558fabf3a',event)" src="./images/SSO单点登录3.png" alt="" />
<src id="cnblogs_code_open_9f270d7e-4257-4fb7-926e-d55558fabf3a" class="cnblogs_code_hide">
<pre><code><span style="color: #000000;">@Service
</span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> UserServiceImpl <span style="color: #0000ff;">implements</span><span style="color: #000000;"> UserService {

    @Autowired
    </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> TbUserMapper tbUserMapper;

    @Override
    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> EgoResult selectUserByCondService(String cond, Integer type) {

        </span><span style="color: #008000;">//</span><span style="color: #008000;">动态产生where条件</span>
        TbUserExample example = <span style="color: #0000ff;">new</span><span style="color: #000000;"> TbUserExample();
        TbUserExample.Criteria criteria </span>=<span style="color: #000000;"> example.createCriteria();

        </span><span style="color: #008000;">//</span><span style="color: #008000;">封装查询条件</span>
        <span style="color: #0000ff;">if</span> (type.equals(1<span style="color: #000000;">)) {
            criteria.andUsernameEqualTo(cond);
        } </span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span> (type.equals(2<span style="color: #000000;">)) {
            criteria.andPhoneEqualTo(cond);
        } </span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span> (type.equals(3<span style="color: #000000;">)) {
            criteria.andEmailEqualTo(cond);
        }

        List</span>&lt;TbUser&gt; userList =<span style="color: #000000;"> tbUserMapper.selectByExample(example);

        </span><span style="color: #008000;">//</span><span style="color: #008000;">  创建EgoResult对象</span>
        EgoResult result = <span style="color: #0000ff;">new</span><span style="color: #000000;"> EgoResult();
        result.setStatus(</span>200<span style="color: #000000;">);
        result.setMsg(</span>"ok"<span style="color: #000000;">);
        </span><span style="color: #0000ff;">if</span> (userList!=<span style="color: #0000ff;">null</span> &amp;&amp; userList.size()&gt;0) result.setData(<span style="color: #0000ff;">false</span><span style="color: #000000;">);
        </span><span style="color: #0000ff;">else</span> result.setData(<span style="color: #0000ff;">true</span>);  <span style="color: #008000;">//</span><span style="color: #008000;">  用户名可用</span>

        <span style="color: #0000ff;">return</span><span style="color: #000000;"> result;
    }
}</span></code></pre>

<span class="cnblogs_code_collapse">UserServiceImpl.class</span>
<p>&nbsp;</p>
<h1>实现用户注册</h1>
<h2>1、用户注册接口开发规范</h2>
<table border="0">
<tbody>
<tr>
<td><span style="font-size: 18px;">请求方法</span></td>
<td><span style="font-size: 18px;">POST</span></td>
</tr>
<tr>
<td><span style="font-size: 18px;">URL</span></td>
<td><span style="font-size: 18px;">http://sso.egou.com/user/register</span></td>
</tr>
<tr>
<td><span style="font-size: 18px;">参数说明</span></td>
<td><span style="font-size: 18px;">username //用户名 </span><br /><span style="font-size: 18px;">password //密码 </span><br /><span style="font-size: 18px;">phone //手机号 </span><br /><span style="font-size: 18px;">email //邮箱</span></td>





</tr>
<tr>
<td><span style="font-size: 18px;">示例</span></td>
<td><span style="font-size: 18px;">http://sso.egou.com/user/register</span></td>





</tr>
<tr>
<td><span style="font-size: 18px;">返回值</span></td>
<td><span style="font-size: 18px;">{ </span><br /><span style="font-size: 18px;">status: 400 </span><br /><span style="font-size: 18px;">msg: "注册失败. 请校验数据后请再提交数据." </span><br /><span style="font-size: 18px;">data: null </span><br /><span style="font-size: 18px;">}</span></td>





</tr>





</tbody>





</table>
<p>&nbsp;</p>
<h2>2、实现</h2>
<src class="cnblogs_code">
<pre><code>    <span style="color: #008000;">/**</span><span style="color: #008000;">
     * 实现用户注册
     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> user  用户信息
     *      @ResponseBody 异步的，不会进行跳转
     </span><span style="color: #008000;">*/</span><span style="color: #000000;">
    @RequestMapping(value </span>= "/user/register", method =<span style="color: #000000;"> RequestMethod.POST)
    @ResponseBody
    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> EgoResult insertUser(TbUser user) {
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> ssoUserService.insertUserService(user);
    }</span></code></pre>

<src class="cnblogs_code" onclick="cnblogs_code_show('b58a80a3-7107-4319-af7a-df28ad6d89ae')"><img id="code_img_closed_b58a80a3-7107-4319-af7a-df28ad6d89ae" class="code_img_closed" src="./images/SSO单点登录2.png" alt="" /><img id="code_img_opened_b58a80a3-7107-4319-af7a-df28ad6d89ae" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('b58a80a3-7107-4319-af7a-df28ad6d89ae',event)" src="./images/SSO单点登录3.png" alt="" />
<src id="cnblogs_code_open_b58a80a3-7107-4319-af7a-df28ad6d89ae" class="cnblogs_code_hide">
<pre><code><span style="color: #000000;">@Service
</span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> SsoUserServiceImpl <span style="color: #0000ff;">implements</span><span style="color: #000000;"> SsoUserService {

    </span><span style="color: #008000;">//</span><span style="color: #008000;">注入的是远程服务的代理对象</span>
<span style="color: #000000;">    @Autowired
    </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> UserService userServiceProxy;

    @Override
    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> EgoResult insertUserService(TbUser user) {
        </span><span style="color: #008000;">//</span><span style="color: #008000;">  md5加密</span>
        String pwd =<span style="color: #000000;"> user.getPassword();
        String md5 </span>=<span style="color: #000000;"> DigestUtils.md5DigestAsHex(pwd.getBytes());
        user.setPassword(md5);
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> userServiceProxy.insertUserService(user);
    }
}</span></code></pre>

<span class="cnblogs_code_collapse">SsoUserServiceImpl.class</span>
<src class="cnblogs_code" onclick="cnblogs_code_show('c10e0255-161e-4597-ad7f-e743859eea5d')"><img id="code_img_closed_c10e0255-161e-4597-ad7f-e743859eea5d" class="code_img_closed" src="./images/SSO单点登录2.png" alt="" /><img id="code_img_opened_c10e0255-161e-4597-ad7f-e743859eea5d" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('c10e0255-161e-4597-ad7f-e743859eea5d',event)" src="./images/SSO单点登录3.png" alt="" />
<src id="cnblogs_code_open_c10e0255-161e-4597-ad7f-e743859eea5d" class="cnblogs_code_hide">
<pre><code><span style="color: #000000;">@Service
</span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> UserServiceImpl <span style="color: #0000ff;">implements</span><span style="color: #000000;"> UserService {

    @Autowired
    </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> TbUserMapper tbUserMapper;

    @Override
    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> EgoResult insertUserService(TbUser user) {

        EgoResult result </span>= <span style="color: #0000ff;">new</span><span style="color: #000000;"> EgoResult();

        </span><span style="color: #0000ff;">try</span><span style="color: #000000;"> {
            Date date </span>= <span style="color: #0000ff;">new</span><span style="color: #000000;"> Date();
            user.setCreated(date);
            user.setUpdated(date);
            tbUserMapper.insert(user);
            result.setStatus(</span>200<span style="color: #000000;">);
            result.setMsg(</span>"注册成功."<span style="color: #000000;">);
        } </span><span style="color: #0000ff;">catch</span><span style="color: #000000;"> (Exception e) {
            result.setStatus(</span>400<span style="color: #000000;">);
            result.setMsg(</span>"注册失败. 请校验数据后请再提交数据."<span style="color: #000000;">);
            e.printStackTrace();
        }

        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> result;
    }
}</span></code></pre>

<span class="cnblogs_code_collapse">UserServiceImpl.class</span>
<p>&nbsp;</p>
<h1>实现用户登录</h1>
<h2>1、用户登录接口开发规范</h2>
<table border="0">
<tbody>
<tr>
<td><span style="font-size: 18px;">请求方式</span></td>
<td><span style="font-size: 18px;">POST</span></td>
</tr>
<tr>
<td><span style="font-size: 18px;">URL</span></td>
<td><span style="font-size: 18px;">htt://sso.eou.com/user/l</span></td>
</tr>
<tr>
<td><span style="font-size: 18px;">参数说明</span></td>
<td><span style="font-size: 18px;">username //用户名 </span><br /><span style="font-size: 18px;">password //密码</span></td>




</tr>
<tr>
<td><span style="font-size: 18px;">示例</span></td>
<td><span style="font-size: 18px;">http://sso.egou.com/user/loginusername=zhangsan&amp;password=123</span></td>




</tr>
<tr>
<td><span style="font-size: 18px;">返回值</span></td>
<td><span style="font-size: 18px;">{ </span><br /><span style="font-size: 18px;">status: 200 </span><br /><span style="font-size: 18px;">msg: "OK" </span><br /><span style="font-size: 18px;">data: "fe5cb546aeb3ce1bf37abcb08a40493e"//登录成功，返</span><span style="font-size: 18px;">回 token </span><br /><span style="font-size: 18px;">}</span></td>




</tr>




</tbody>




</table>
<p>&nbsp;</p>
<h2>2、实现</h2>
<src class="cnblogs_code">
<pre><code>    <span style="color: #008000;">/**</span><span style="color: #008000;">
     * 实现用户登录
     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> username  用户名
     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> password  密码
     *      @ResponseBody 异步的，不会进行跳转
     </span><span style="color: #008000;">*/</span><span style="color: #000000;">
    @RequestMapping(value </span>= "/user/login", method =<span style="color: #000000;"> RequestMethod.POST)
    @ResponseBody
    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> EgoResult userLogin(String username, String password) {
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> ssoUserService.userLogin(username, password);
    }</span></code></pre>

<src class="cnblogs_code" onclick="cnblogs_code_show('9fa0315e-bdb3-4fd2-91c5-821f0ead611c')"><img id="code_img_closed_9fa0315e-bdb3-4fd2-91c5-821f0ead611c" class="code_img_closed" src="./images/SSO单点登录2.png" alt="" /><img id="code_img_opened_9fa0315e-bdb3-4fd2-91c5-821f0ead611c" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('9fa0315e-bdb3-4fd2-91c5-821f0ead611c',event)" src="./images/SSO单点登录3.png" alt="" />
<src id="cnblogs_code_open_9fa0315e-bdb3-4fd2-91c5-821f0ead611c" class="cnblogs_code_hide">
<pre><code><span style="color: #000000;">@Service
</span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> SsoUserServiceImpl <span style="color: #0000ff;">implements</span><span style="color: #000000;"> SsoUserService {

    </span><span style="color: #008000;">//</span><span style="color: #008000;">注入的是远程服务的代理对象</span>
<span style="color: #000000;">    @Autowired
    </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> UserService userServiceProxy;

    </span><span style="color: #008000;">//</span><span style="color: #008000;"> 注入JedisCluster集群访问对象</span>
<span style="color: #000000;">    @Autowired
    </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> JedisCluster jedisCluster;

    @Override
    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> EgoResult userLogin(String username, String password) {

        EgoResult result </span>= <span style="color: #0000ff;">new</span><span style="color: #000000;"> EgoResult();
        result.setStatus(</span>400<span style="color: #000000;">);
        result.setData(</span><span style="color: #0000ff;">null</span><span style="color: #000000;">);
        result.setMsg(</span>"用户名或密码错误."<span style="color: #000000;">);
        TbUser tbUser </span>=<span style="color: #000000;"> userServiceProxy.selectUserByUserNameService(username);

        </span><span style="color: #0000ff;">if</span> (tbUser != <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
            </span><span style="color: #008000;">//</span><span style="color: #008000;">对前端提交的密码进行加密</span>
            password =<span style="color: #000000;"> DigestUtils.md5DigestAsHex(password.getBytes());
            </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (password.equals(tbUser.getPassword())) {
                </span><span style="color: #008000;">//</span><span style="color: #008000;">  将当前登录用户对象，转为json字符串，保存到redis数据库</span>
                String userJson =<span style="color: #000000;"> JsonUtils.objectToJson(tbUser);
                String token </span>=<span style="color: #000000;"> UUID.randomUUID().toString();
                </span><span style="color: #008000;">//</span><span style="color: #008000;"> 将用户信息保存到redis数据库</span>
<span style="color: #000000;">                jedisCluster.set(token, userJson);
                </span><span style="color: #008000;">//</span><span style="color: #008000;">  设置token的有效期为30分钟</span>
                jedisCluster.expire(token, 1800<span style="color: #000000;">);

                result.setStatus(</span>200<span style="color: #000000;">);
                result.setMsg(</span>"登录成功."<span style="color: #000000;">);
                result.setData(token);
            }
        }

        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> result;
    }
}</span></code></pre>

<span class="cnblogs_code_collapse">SsoUserServiceImpl.class</span>
<src class="cnblogs_code" onclick="cnblogs_code_show('76cb0b6b-5672-4c44-a13c-34a743c7a82b')"><img id="code_img_closed_76cb0b6b-5672-4c44-a13c-34a743c7a82b" class="code_img_closed" src="./images/SSO单点登录2.png" alt="" /><img id="code_img_opened_76cb0b6b-5672-4c44-a13c-34a743c7a82b" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('76cb0b6b-5672-4c44-a13c-34a743c7a82b',event)" src="./images/SSO单点登录3.png" alt="" />
<src id="cnblogs_code_open_76cb0b6b-5672-4c44-a13c-34a743c7a82b" class="cnblogs_code_hide">
<pre><code><span style="color: #000000;">@Service
</span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> UserServiceImpl <span style="color: #0000ff;">implements</span><span style="color: #000000;"> UserService {

    @Autowired
    </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> TbUserMapper tbUserMapper;

    @Override
    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> TbUser selectUserByUserNameService(String username) {

        </span><span style="color: #008000;">//</span><span style="color: #008000;">动态产生where条件</span>
        TbUserExample example = <span style="color: #0000ff;">new</span><span style="color: #000000;"> TbUserExample();
        TbUserExample.Criteria criteria </span>=<span style="color: #000000;"> example.createCriteria();

        </span><span style="color: #008000;">//</span><span style="color: #008000;">封装查询条件</span>
<span style="color: #000000;">        criteria.andUsernameEqualTo(username);

        </span><span style="color: #008000;">//</span><span style="color: #008000;"> where username=?</span>
        List&lt;TbUser&gt; userList =<span style="color: #000000;"> tbUserMapper.selectByExample(example);

        </span><span style="color: #008000;">//</span><span style="color: #008000;">  因为用户名唯一</span>
        <span style="color: #0000ff;">if</span> (userList!=<span style="color: #0000ff;">null</span> &amp;&amp; userList.size()==1) <span style="color: #0000ff;">return</span> userList.get(0<span style="color: #000000;">);

        </span><span style="color: #0000ff;">return</span> <span style="color: #0000ff;">null</span><span style="color: #000000;">;
    }
}</span></code></pre>

<span class="cnblogs_code_collapse">UserServiceImpl.class</span>
<p>&nbsp;</p>
<h1>通过 Token 获得用户登录状态</h1>
<p>1、接口开发规范</p>
<table border="0">
<tbody>
<tr>
<td><span style="font-size: 18px;">请求方法</span></td>
<td><span style="font-size: 18px;">GET</span></td>
</tr>
<tr>
<td><span style="font-size: 18px;">URL</span></td>
<td><span style="font-size: 18px;">http://sso.egou.com/user/token/{token}</span></td>
</tr>
<tr>
<td><span style="font-size: 18px;">参数说明</span></td>
<td><span style="font-size: 18px;">token//用户登录凭证 </span><br /><span style="font-size: 18px;">callback//jsonp 回调方法 </span><br /><span style="font-size: 18px;">可选参数 callback：如果有此参数表示此方法为 jsonp 请求，需要支持 </span><span style="font-size: 18px;">jsonp。</span></td>


</tr>
<tr>
<td><span style="font-size: 18px;">示例</span></td>
<td><span style="font-size: 18px;">http://sso.egou.com/user/token/fe5cb546aeb3ce1bf37abcb08a40493e</span></td>


</tr>
<tr>
<td><span style="font-size: 18px;">返回值</span></td>
<td><span style="font-size: 18px;">{ </span><br /><span style="font-size: 18px;">status: 200 </span><br /><span style="font-size: 18px;">msg: "OK" </span><br /><span style="font-size: 18px;">data: "{"id":1,"username":"zhangzhijun","phone":"158</span><span style="font-size: 18px;">00807944", </span><br /><span style="font-size: 18px;">　　　 "email":"420840806@qq.com","created":1414119176000 </span><span style="font-size: 18px;">,"updated":1414119179000}" </span><br /><span style="font-size: 18px;">}</span></td>


</tr>


</tbody>


</table>
<p>&nbsp;</p>
<h2>2、实现</h2>
<src class="cnblogs_code">
<pre><code><span style="color: #008000;">/**</span><span style="color: #008000;">
     * 处理获得用户登录状态请求
     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> token     用户登录凭证 
     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> callback  回到函数
     *      MappingJacksonValue --&gt; 返回json，支持JSONP（其实是解决JS跨域调用数据的一种方案）
     *      required = false --&gt; 非必须
     *      @ResponseBody 异步的，不会进行跳转
     </span><span style="color: #008000;">*/</span><span style="color: #000000;">
    @RequestMapping(</span>"/user/token/{token}"<span style="color: #000000;">)
    @ResponseBody
    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> MappingJacksonValue userToken(@PathVariable String token,
                                         @RequestParam(required </span>= <span style="color: #0000ff;">false</span><span style="color: #000000;">) String callback) {
        EgoResult result </span>=<span style="color: #000000;"> ssoUserService.loadUserByToken(token);

        </span><span style="color: #008000;">//</span><span style="color: #008000;">  处理json响应数据格式</span>
        MappingJacksonValue jacksonValue = <span style="color: #0000ff;">new</span><span style="color: #000000;"> MappingJacksonValue(result);
        </span><span style="color: #0000ff;">if</span> (!<span style="color: #000000;">StringUtils.isEmpty(callback)) jacksonValue.setJsonpFunction(callback);

        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> jacksonValue;
    }</span></code></pre>

<src class="cnblogs_code" onclick="cnblogs_code_show('e3f8fc7f-d04d-474d-aa87-bf0720d2d1ba')"><img id="code_img_closed_e3f8fc7f-d04d-474d-aa87-bf0720d2d1ba" class="code_img_closed" src="./images/SSO单点登录2.png" alt="" /><img id="code_img_opened_e3f8fc7f-d04d-474d-aa87-bf0720d2d1ba" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('e3f8fc7f-d04d-474d-aa87-bf0720d2d1ba',event)" src="./images/SSO单点登录3.png" alt="" />
<src id="cnblogs_code_open_e3f8fc7f-d04d-474d-aa87-bf0720d2d1ba" class="cnblogs_code_hide">
<pre><code><span style="color: #000000;">@Service
</span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> SsoUserServiceImpl <span style="color: #0000ff;">implements</span><span style="color: #000000;"> SsoUserService {

    </span><span style="color: #008000;">//</span><span style="color: #008000;"> 注入JedisCluster集群访问对象</span>
<span style="color: #000000;">    @Autowired
    </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> JedisCluster jedisCluster;

    @Override
    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> EgoResult loadUserByToken(String token) {

        EgoResult result </span>= <span style="color: #0000ff;">new</span><span style="color: #000000;"> EgoResult();
        result.setStatus(</span>400<span style="color: #000000;">);
        result.setMsg(</span>"error"<span style="color: #000000;">);
        result.setData(</span><span style="color: #0000ff;">null</span><span style="color: #000000;">);

        String userJson </span>=<span style="color: #000000;"> jedisCluster.get(token);

        </span><span style="color: #0000ff;">if</span> (!<span style="color: #000000;">StringUtils.isEmpty(userJson)) {
            result.setStatus(</span>200<span style="color: #000000;">);
            result.setMsg(</span>"ok"<span style="color: #000000;">);
            result.setData(userJson);
        }

        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> result;
    }
}</span></code></pre>

<span class="cnblogs_code_collapse">SsoUserServiceImpl.class</span>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h1>实现安全退出</h1>
<h2>1、用户安全退出接口开发规范</h2>
<table border="0">
<tbody>
<tr>
<td><span style="font-size: 18px;">请求方法</span></td>
<td><span style="font-size: 18px;">GET</span></td>
</tr>
<tr>
<td><span style="font-size: 18px;">URL</span></td>
<td><span style="font-size: 18px;">http://sso.egou.com/user/logout/{token}</span></td>
</tr>
<tr>
<td><span style="font-size: 18px;">参数说明</span></td>
<td><span style="font-size: 18px;">token//用户登录凭证 </span><br /><span style="font-size: 18px;">callback//jsonp 回调方法 </span><br /><span style="font-size: 18px;">可选参数 callback：如果有此参数表示此方法为 jsonp 请求，需要支持jsonp。</span></td>

</tr>
<tr>
<td><span style="font-size: 18px;">示例</span></td>
<td><span style="font-size: 18px;">http://sso.egou.com/user/logout/fe5cb546aeb3ce1bf37abcb08a40493e</span></td>

</tr>
<tr>
<td><span style="font-size: 18px;">返回值</span></td>
<td><span style="font-size: 18px;">&nbsp;{</span><br /><span style="font-size: 18px;">status: 200 </span><br /><span style="font-size: 18px;">msg: "OK" </span><br /><span style="font-size: 18px;">data: "" </span><br /><span style="font-size: 18px;">}</span></td>

</tr>

</tbody>

</table>
<p>&nbsp;</p>
<h2>2、实现</h2>
<src class="cnblogs_code">
<pre><code><span style="color: #008000;">　　/**</span><span style="color: #008000;">
     * 处理用户退出登录的请求
     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> token     用户登录凭证
     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> callback  回到函数
     *      MappingJacksonValue --&gt; 返回json，支持JSONP（其实是解决JS跨域调用数据的一种方案）
     *      required = false --&gt; 非必须
     *      @ResponseBody 异步的，不会进行跳转
     </span><span style="color: #008000;">*/</span><span style="color: #000000;">
    @RequestMapping(</span>"/user/logout/{token}"<span style="color: #000000;">)
    @ResponseBody
    </span><span style="color: #0000ff;">public</span> MappingJacksonValue userLogout(@PathVariable String token, @RequestParam(required = <span style="color: #0000ff;">false</span><span style="color: #000000;">) String callback) {
        EgoResult result </span>=<span style="color: #000000;"> ssoUserService.deleteUserByToken(token);

        </span><span style="color: #008000;">//</span><span style="color: #008000;">  处理json响应数据格式</span>
        MappingJacksonValue jacksonValue = <span style="color: #0000ff;">new</span><span style="color: #000000;"> MappingJacksonValue(result);
        </span><span style="color: #0000ff;">if</span> (!<span style="color: #000000;">StringUtils.isEmpty(callback)) jacksonValue.setJsonpFunction(callback);

        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> jacksonValue;
    }</span></code></pre>

<src class="cnblogs_code" onclick="cnblogs_code_show('c2b55a36-854a-4a28-b6cd-c76d52613fcc')"><img id="code_img_closed_c2b55a36-854a-4a28-b6cd-c76d52613fcc" class="code_img_closed" src="./images/SSO单点登录2.png" alt="" /><img id="code_img_opened_c2b55a36-854a-4a28-b6cd-c76d52613fcc" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('c2b55a36-854a-4a28-b6cd-c76d52613fcc',event)" src="./images/SSO单点登录3.png" alt="" />
<src id="cnblogs_code_open_c2b55a36-854a-4a28-b6cd-c76d52613fcc" class="cnblogs_code_hide">
<pre><code><span style="color: #000000;">@Service
</span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> SsoUserServiceImpl <span style="color: #0000ff;">implements</span><span style="color: #000000;"> SsoUserService {

    </span><span style="color: #008000;">//</span><span style="color: #008000;"> 注入JedisCluster集群访问对象</span>
<span style="color: #000000;">    @Autowired
    </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> JedisCluster jedisCluster;

    @Override
    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> EgoResult deleteUserByToken(String token) {

        EgoResult result </span>= <span style="color: #0000ff;">new</span><span style="color: #000000;"> EgoResult();
        result.setStatus(</span>400<span style="color: #000000;">);
        result.setMsg(</span>"error"<span style="color: #000000;">);
        result.setData(</span><span style="color: #0000ff;">null</span><span style="color: #000000;">);

        </span><span style="color: #008000;">//</span><span style="color: #008000;">  删除redis数据</span>
        Long del =<span style="color: #000000;"> jedisCluster.del(token);

        </span><span style="color: #0000ff;">if</span> (!del.equals(0L<span style="color: #000000;">)) {
            result.setStatus(</span>200<span style="color: #000000;">);
            result.setMsg(</span>"ok"<span style="color: #000000;">);
            result.setData(</span>""<span style="color: #000000;">);
        }

        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> result;
    }
}</span></code></pre>

<span class="cnblogs_code_collapse">SsoUserServiceImpl.class</span>
<p>&nbsp;</p>
<h1>客户端使用Cookie保存用户登录状态-Token</h1>
<src class="cnblogs_code" onclick="cnblogs_code_show('906df4ab-a5ab-4f6f-bb2f-2c72f20e42ec')"><img id="code_img_closed_906df4ab-a5ab-4f6f-bb2f-2c72f20e42ec" class="code_img_closed" src="./images/SSO单点登录2.png" alt="" /><img id="code_img_opened_906df4ab-a5ab-4f6f-bb2f-2c72f20e42ec" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('906df4ab-a5ab-4f6f-bb2f-2c72f20e42ec',event)" src="./images/SSO单点登录3.png" alt="" />
<src id="cnblogs_code_open_906df4ab-a5ab-4f6f-bb2f-2c72f20e42ec" class="cnblogs_code_hide">
<pre><code><span style="color: #0000ff;">package</span><span style="color: #000000;"> com.soldier.ego.beans;

</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.http.Cookie;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.http.HttpServletRequest;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.http.HttpServletResponse;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.UnsupportedEncodingException;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> java.net.URLDecoder;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> java.net.URLEncoder;

</span><span style="color: #008000;">/**</span><span style="color: #008000;">
 * @ProjectName:ego
 * </span><span style="color: #808080;">@author</span><span style="color: #008000;">:soldier
 * @Email:583403411@qq.com
 * @create:19-11-24下午5:04
 * @Describe:Cookie工具类
 *</span><span style="color: #008000;">*/</span>
<span style="color: #0000ff;">public</span> <span style="color: #0000ff;">final</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> CookieUtils {

    </span><span style="color: #008000;">/**</span><span style="color: #008000;">
     * 得到Cookie的值, 不编码
     *
     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> request
     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> cookieName
     * </span><span style="color: #808080;">@return</span>
     <span style="color: #008000;">*/</span>
    <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span><span style="color: #000000;"> String getCookieValue(HttpServletRequest request, String cookieName) {
        </span><span style="color: #0000ff;">return</span> getCookieValue(request, cookieName, <span style="color: #0000ff;">false</span><span style="color: #000000;">);
    }

    </span><span style="color: #008000;">/**</span><span style="color: #008000;">
     * 得到Cookie的值,
     *
     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> request
     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> cookieName
     * </span><span style="color: #808080;">@return</span>
     <span style="color: #008000;">*/</span>
    <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> String getCookieValue(HttpServletRequest request, String cookieName, <span style="color: #0000ff;">boolean</span><span style="color: #000000;"> isDecoder) {
        Cookie[] cookieList </span>=<span style="color: #000000;"> request.getCookies();
        </span><span style="color: #0000ff;">if</span> (cookieList == <span style="color: #0000ff;">null</span> || cookieName == <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
            </span><span style="color: #0000ff;">return</span> <span style="color: #0000ff;">null</span><span style="color: #000000;">;
        }
        String retValue </span>= <span style="color: #0000ff;">null</span><span style="color: #000000;">;
        </span><span style="color: #0000ff;">try</span><span style="color: #000000;"> {
            </span><span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">int</span> i = 0; i &lt; cookieList.length; i++<span style="color: #000000;">) {
                </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (cookieList[i].getName().equals(cookieName)) {
                    </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (isDecoder) {
                        retValue </span>= URLDecoder.decode(cookieList[i].getValue(), "UTF-8"<span style="color: #000000;">);
                    } </span><span style="color: #0000ff;">else</span><span style="color: #000000;"> {
                        retValue </span>=<span style="color: #000000;"> cookieList[i].getValue();
                    }
                    </span><span style="color: #0000ff;">break</span><span style="color: #000000;">;
                }
            }
        } </span><span style="color: #0000ff;">catch</span><span style="color: #000000;"> (UnsupportedEncodingException e) {
            e.printStackTrace();
        }
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> retValue;
    }

    </span><span style="color: #008000;">/**</span><span style="color: #008000;">
     * 得到Cookie的值,
     *
     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> request
     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> cookieName
     * </span><span style="color: #808080;">@return</span>
     <span style="color: #008000;">*/</span>
    <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span><span style="color: #000000;"> String getCookieValue(HttpServletRequest request, String cookieName, String encodeString) {
        Cookie[] cookieList </span>=<span style="color: #000000;"> request.getCookies();
        </span><span style="color: #0000ff;">if</span> (cookieList == <span style="color: #0000ff;">null</span> || cookieName == <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
            </span><span style="color: #0000ff;">return</span> <span style="color: #0000ff;">null</span><span style="color: #000000;">;
        }
        String retValue </span>= <span style="color: #0000ff;">null</span><span style="color: #000000;">;
        </span><span style="color: #0000ff;">try</span><span style="color: #000000;"> {
            </span><span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">int</span> i = 0; i &lt; cookieList.length; i++<span style="color: #000000;">) {
                </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (cookieList[i].getName().equals(cookieName)) {
                    retValue </span>=<span style="color: #000000;"> URLDecoder.decode(cookieList[i].getValue(), encodeString);
                    </span><span style="color: #0000ff;">break</span><span style="color: #000000;">;
                }
            }
        } </span><span style="color: #0000ff;">catch</span><span style="color: #000000;"> (UnsupportedEncodingException e) {
            e.printStackTrace();
        }
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> retValue;
    }

    </span><span style="color: #008000;">/**</span><span style="color: #008000;">
     * 设置Cookie的值 不设置生效时间默认浏览器关闭即失效,也不编码
     </span><span style="color: #008000;">*/</span>
    <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> setCookie(HttpServletRequest request, HttpServletResponse response, String cookieName,
                                 String cookieValue) {
        </span><span style="color: #008000;">//</span><span style="color: #008000;">  -1：表示浏览器关闭时，清除这个cookie</span>
        setCookie(request, response, cookieName, cookieValue, -1<span style="color: #000000;">);
    }

    </span><span style="color: #008000;">/**</span><span style="color: #008000;">
     * 设置Cookie的值 在指定时间内生效,但不编码
     </span><span style="color: #008000;">*/</span>
    <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> setCookie(HttpServletRequest request, HttpServletResponse response, String cookieName,
                                 String cookieValue, </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> cookieMaxage) {
        setCookie(request, response, cookieName, cookieValue, cookieMaxage, </span><span style="color: #0000ff;">false</span><span style="color: #000000;">);
    }

    </span><span style="color: #008000;">/**</span><span style="color: #008000;">
     * 设置Cookie的值 不设置生效时间,但编码
     </span><span style="color: #008000;">*/</span>
    <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> setCookie(HttpServletRequest request, HttpServletResponse response, String cookieName,
                                 String cookieValue, </span><span style="color: #0000ff;">boolean</span><span style="color: #000000;"> isEncode) {
        setCookie(request, response, cookieName, cookieValue, </span>-1<span style="color: #000000;">, isEncode);
    }

    </span><span style="color: #008000;">/**</span><span style="color: #008000;">
     * 设置Cookie的值 在指定时间内生效, 编码参数
     </span><span style="color: #008000;">*/</span>
    <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> setCookie(HttpServletRequest request, HttpServletResponse response, String cookieName,
                                 String cookieValue, </span><span style="color: #0000ff;">int</span> cookieMaxage, <span style="color: #0000ff;">boolean</span><span style="color: #000000;"> isEncode) {
        doSetCookie(request, response, cookieName, cookieValue, cookieMaxage, isEncode);
    }

    </span><span style="color: #008000;">/**</span><span style="color: #008000;">
     * 设置Cookie的值 在指定时间内生效, 编码参数(指定编码)
     </span><span style="color: #008000;">*/</span>
    <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> setCookie(HttpServletRequest request, HttpServletResponse response, String cookieName,
                                 String cookieValue, </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> cookieMaxage, String encodeString) {
        doSetCookie(request, response, cookieName, cookieValue, cookieMaxage, encodeString);
    }

    </span><span style="color: #008000;">/**</span><span style="color: #008000;">
     * 删除Cookie带cookie域名
     </span><span style="color: #008000;">*/</span>
    <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> deleteCookie(HttpServletRequest request, HttpServletResponse response,
                                    String cookieName) {
        doSetCookie(request, response, cookieName, </span>"", -1, <span style="color: #0000ff;">false</span><span style="color: #000000;">);
    }

    </span><span style="color: #008000;">/**</span><span style="color: #008000;">
     * 设置Cookie的值，并使其在指定时间内生效
     *
     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> cookieMaxage cookie生效的最大秒数
     </span><span style="color: #008000;">*/</span>
    <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">final</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> doSetCookie(HttpServletRequest request, HttpServletResponse response,
                                          String cookieName, String cookieValue, </span><span style="color: #0000ff;">int</span> cookieMaxage, <span style="color: #0000ff;">boolean</span><span style="color: #000000;"> isEncode) {
        </span><span style="color: #0000ff;">try</span><span style="color: #000000;"> {
            </span><span style="color: #0000ff;">if</span> (cookieValue == <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
                cookieValue </span>= ""<span style="color: #000000;">;
            } </span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span><span style="color: #000000;"> (isEncode) {
                cookieValue </span>= URLEncoder.encode(cookieValue, "utf-8"<span style="color: #000000;">);
            }
            Cookie cookie </span>= <span style="color: #0000ff;">new</span><span style="color: #000000;"> Cookie(cookieName, cookieValue);
            </span><span style="color: #0000ff;">if</span> (cookieMaxage &gt; 0<span style="color: #000000;">)
                cookie.setMaxAge(cookieMaxage);
            </span><span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">null</span> != request) {<span style="color: #008000;">//</span><span style="color: #008000;"> 设置域名的cookie</span>
                String domainName =<span style="color: #000000;"> getDomainName(request);
                System.out.println(domainName);
                </span><span style="color: #0000ff;">if</span> (!"localhost"<span style="color: #000000;">.equals(domainName)) {
                    cookie.setDomain(domainName);
                }
            }
            cookie.setPath(</span>"/"<span style="color: #000000;">);
            response.addCookie(cookie);
        } </span><span style="color: #0000ff;">catch</span><span style="color: #000000;"> (Exception e) {
            e.printStackTrace();
        }
    }

    </span><span style="color: #008000;">/**</span><span style="color: #008000;">
     * 设置Cookie的值，并使其在指定时间内生效
     *
     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> cookieMaxage cookie生效的最大秒数
     </span><span style="color: #008000;">*/</span>
    <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">final</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> doSetCookie(HttpServletRequest request,
                                          HttpServletResponse response,
                                          String cookieName, String cookieValue,
                                          </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> cookieMaxage, String encodeString) {
        </span><span style="color: #0000ff;">try</span><span style="color: #000000;"> {
            </span><span style="color: #0000ff;">if</span> (cookieValue == <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
                cookieValue </span>= ""<span style="color: #000000;">;
            } </span><span style="color: #0000ff;">else</span><span style="color: #000000;"> {
                cookieValue </span>=<span style="color: #000000;"> URLEncoder.encode(cookieValue, encodeString);
            }
            Cookie cookie </span>= <span style="color: #0000ff;">new</span><span style="color: #000000;"> Cookie(cookieName, cookieValue);
            </span><span style="color: #0000ff;">if</span> (cookieMaxage &gt; 0<span style="color: #000000;">)
                cookie.setMaxAge(cookieMaxage);
            </span><span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">null</span> != request) {<span style="color: #008000;">//</span><span style="color: #008000;"> 设置域名的cookie</span>
                String domainName =<span style="color: #000000;"> getDomainName(request);
                System.out.println(domainName);
                </span><span style="color: #0000ff;">if</span> (!"localhost"<span style="color: #000000;">.equals(domainName)) {
                    cookie.setDomain(domainName);
                }
            }
            cookie.setPath(</span>"/"<span style="color: #000000;">);
            response.addCookie(cookie);
        } </span><span style="color: #0000ff;">catch</span><span style="color: #000000;"> (Exception e) {
            e.printStackTrace();
        }
    }

    </span><span style="color: #008000;">/**</span><span style="color: #008000;">
     * 得到cookie的域名
     </span><span style="color: #008000;">*/</span>
    <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">final</span><span style="color: #000000;"> String getDomainName(HttpServletRequest request) {
        String domainName </span>= <span style="color: #0000ff;">null</span><span style="color: #000000;">;

        String serverName </span>=<span style="color: #000000;"> request.getRequestURL().toString();
        </span><span style="color: #0000ff;">if</span> (serverName == <span style="color: #0000ff;">null</span> || serverName.equals(""<span style="color: #000000;">)) {
            domainName </span>= ""<span style="color: #000000;">;
        } </span><span style="color: #0000ff;">else</span><span style="color: #000000;"> {
            serverName </span>=<span style="color: #000000;"> serverName.toLowerCase();
            serverName </span>= serverName.substring(7<span style="color: #000000;">);
            </span><span style="color: #0000ff;">final</span> <span style="color: #0000ff;">int</span> end = serverName.indexOf("/");  <span style="color: #008000;">//</span><span style="color: #008000; text-decoration: underline;">http://www.ego.com/</span>
            serverName = serverName.substring(0<span style="color: #000000;">, end);


            </span><span style="color: #0000ff;">final</span> String[] domains = serverName.split("\\."<span style="color: #000000;">);
            </span><span style="color: #0000ff;">int</span> len =<span style="color: #000000;"> domains.length;
            </span><span style="color: #0000ff;">if</span> (len &gt; 3<span style="color: #000000;">) {

                </span><span style="color: #008000;">//</span><span style="color: #008000;"> www.xxx.com.cn</span>
                domainName = "." + domains[len - 3] + "." + domains[len - 2] + "." + domains[len - 1<span style="color: #000000;">];
            } </span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span> (len &lt;= 3 &amp;&amp; len &gt; 1<span style="color: #000000;">) {
                </span><span style="color: #008000;">//</span><span style="color: #008000;"> xxx.com or xxx.cn</span>
                domainName = "." + domains[len - 2] + "." + domains[len - 1<span style="color: #000000;">];
            } </span><span style="color: #0000ff;">else</span><span style="color: #000000;"> {
                domainName </span>=<span style="color: #000000;"> serverName;
            }
        }

        </span><span style="color: #0000ff;">if</span> (domainName != <span style="color: #0000ff;">null</span> &amp;&amp; domainName.indexOf(":") &gt; 0<span style="color: #000000;">) {
            String[] ary </span>= domainName.split("\\:"<span style="color: #000000;">);
            domainName </span>= ary[0<span style="color: #000000;">];
        }
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> domainName;
    }

}</span></code></pre>

<span class="cnblogs_code_collapse">CookieUtils.class</span>
<h2>1、登录按钮与注册按钮的定义</h2>
<src class="cnblogs_code">
<pre><code><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">li </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="fore1"</span><span style="color: #ff0000;"> id</span><span style="color: #0000ff;">="loginbar"</span><span style="color: #ff0000;"> clstag</span><span style="color: #0000ff;">="homepage|keycount|home2013|01b"</span><span style="color: #0000ff;">&gt;</span>您好！欢迎来到易购！<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">a </span><span style="color: #ff0000;">href</span><span style="color: #0000ff;">="javascript:login()"</span><span style="color: #0000ff;">&gt;</span>[登录]<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">a</span><span style="color: #0000ff;">&gt;</span><span style="color: #ff0000;">&amp;nbsp;</span><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">a </span><span style="color: #ff0000;">href</span><span style="color: #0000ff;">="javascript:register()"</span><span style="color: #0000ff;">&gt;</span>[免费注册]<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">a</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">li</span><span style="color: #0000ff;">&gt;</span></code></pre>

<src class="cnblogs_code">
<pre><code><span style="color: #0000ff;">function</span><span style="color: #000000;"> login() {
    </span><span style="color: #008000;">//</span><span style="color: #008000;">  页面跳转</span>
    <span style="color: #0000ff;">return</span> location.href = "http://localhost:8083/login"<span style="color: #000000;">;
}
</span><span style="color: #0000ff;">function</span><span style="color: #000000;"> register() {
    </span><span style="color: #008000;">//</span><span style="color: #008000;">  页面跳转</span>
    <span style="color: #0000ff;">return</span> location.href = "http://localhost:8083/register"<span style="color: #000000;">;
}</span></code></pre>

<h2>2、登录提交与注册提交</h2>
<src class="cnblogs_code" onclick="cnblogs_code_show('d40edb96-62ad-4742-8ae9-6abe8dc8a4e8')"><img id="code_img_closed_d40edb96-62ad-4742-8ae9-6abe8dc8a4e8" class="code_img_closed" src="./images/SSO单点登录2.png" alt="" /><img id="code_img_opened_d40edb96-62ad-4742-8ae9-6abe8dc8a4e8" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('d40edb96-62ad-4742-8ae9-6abe8dc8a4e8',event)" src="./images/SSO单点登录3.png" alt="" />
<src id="cnblogs_code_open_d40edb96-62ad-4742-8ae9-6abe8dc8a4e8" class="cnblogs_code_hide">
<pre><code>                    doLogin:<span style="color: #0000ff;">function</span><span style="color: #000000;">() {
                $.post(</span>"/user/login", $("#formlogin").serialize(),<span style="color: #0000ff;">function</span><span style="color: #000000;">(data){
                    </span><span style="color: #0000ff;">if</span> (data.status == 200<span style="color: #000000;">) {
                        alert(</span>"登录成功！"<span style="color: #000000;">);
                        </span><span style="color: #0000ff;">if</span> (redirectUrl == ""<span style="color: #000000;">) {
                            </span><span style="color: #008000;">//</span><span style="color: #008000;">重定向到ego的门户首页</span>
                            location.href = "http://localhost:8081/index.html"<span style="color: #000000;">;
                        } </span><span style="color: #0000ff;">else</span><span style="color: #000000;"> {
                            location.href </span>=<span style="color: #000000;"> redirectUrl;
                        }
                    } </span><span style="color: #0000ff;">else</span><span style="color: #000000;"> {
                        alert(</span>"登录失败，原因是：" +<span style="color: #000000;"> data.msg);
                        $(</span>"#loginname"<span style="color: #000000;">).select();
                    }
                });
            }</span></code></pre>

<span class="cnblogs_code_collapse">登录提交.js</span>
<src class="cnblogs_code" onclick="cnblogs_code_show('af1fbb26-1dbe-440a-8ff6-168971cedf41')"><img id="code_img_closed_af1fbb26-1dbe-440a-8ff6-168971cedf41" class="code_img_closed" src="./images/SSO单点登录2.png" alt="" /><img id="code_img_opened_af1fbb26-1dbe-440a-8ff6-168971cedf41" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('af1fbb26-1dbe-440a-8ff6-168971cedf41',event)" src="./images/SSO单点登录3.png" alt="" />
<src id="cnblogs_code_open_af1fbb26-1dbe-440a-8ff6-168971cedf41" class="cnblogs_code_hide">
<pre><code>            doSubmit:<span style="color: #0000ff;">function</span><span style="color: #000000;">() {
            $.post(</span>"/user/register",$("#personRegForm").serialize(), <span style="color: #0000ff;">function</span><span style="color: #000000;">(data){
                </span><span style="color: #0000ff;">if</span>(data.status == 200<span style="color: #000000;">){
                    alert(</span>'用户注册成功，请登录！'<span style="color: #000000;">);
                    location.href </span>= "/login"; <span style="color: #008000;">//</span><span style="color: #008000;">注册成功，跳转到登录页面</span>
                } <span style="color: #0000ff;">else</span><span style="color: #000000;"> {
                    alert(</span>"注册失败！"<span style="color: #000000;">);
                }
            });
        }</span></code></pre>

<span class="cnblogs_code_collapse">注册提交.js</span>
<h2>3、客户端校验登录状态与退出登录</h2>
<src class="cnblogs_code" onclick="cnblogs_code_show('a8d4a429-4eb3-4b89-b6b1-4f59ecda50d4')"><img id="code_img_closed_a8d4a429-4eb3-4b89-b6b1-4f59ecda50d4" class="code_img_closed" src="./images/SSO单点登录2.png" alt="" /><img id="code_img_opened_a8d4a429-4eb3-4b89-b6b1-4f59ecda50d4" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('a8d4a429-4eb3-4b89-b6b1-4f59ecda50d4',event)" src="./images/SSO单点登录3.png" alt="" />
<src id="cnblogs_code_open_a8d4a429-4eb3-4b89-b6b1-4f59ecda50d4" class="cnblogs_code_hide">
<pre><code>    checkLogin : <span style="color: #0000ff;">function</span><span style="color: #000000;">(){
        </span><span style="color: #0000ff;">var</span> _ticket = $.cookie("SSO_TOKEN"<span style="color: #000000;">);
        </span><span style="color: #0000ff;">if</span>(!<span style="color: #000000;">_ticket){
            </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> ;
        }
        $.ajax({
            url : </span>"http://localhost:8083/user/token/" +<span style="color: #000000;"> _ticket,
            dataType : </span>"jsonp"<span style="color: #000000;">,
            type : </span>"GET"<span style="color: #000000;">,
            success : </span><span style="color: #0000ff;">function</span><span style="color: #000000;">(data){
                </span><span style="color: #0000ff;">if</span>(data.status == 200<span style="color: #000000;">){
                    </span><span style="color: #0000ff;">var</span> username =<span style="color: #000000;"> data.data.username;
                    </span><span style="color: #008000;">//</span><span style="color: #008000;"> var html = username + "，欢迎来到淘淘！&lt;a href=\"http://www.taotao.com/user/logout.html\" class=\"link-logout\"&gt;[退出]&lt;/a&gt;";</span>
                    <span style="color: #0000ff;">var</span> html = username + "，欢迎来到淘淘！&lt;a href=\"javascript:TT.logout()\" class=\"link-logout\"&gt;[退出]&lt;/a&gt;"<span style="color: #000000;">;
                    $(</span>"#loginbar"<span style="color: #000000;">).html(html);
                }
            }
        });
    },

    logout: </span><span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
        </span><span style="color: #008000;">//</span><span style="color: #008000;">    获取本地保存的SSO_TOKEN</span>
        <span style="color: #0000ff;">var</span> _ticket = $.cookie("SSO_TOKEN"<span style="color: #000000;">);
        </span><span style="color: #0000ff;">if</span>(!<span style="color: #000000;">_ticket){
            </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> ;
        }

        $.ajax({
            url : </span>"http://localhost:8083/user/logout/" +<span style="color: #000000;"> _ticket,
            dataType : </span>"jsonp"<span style="color: #000000;">,
            type : </span>"GET"<span style="color: #000000;">,
            success : </span><span style="color: #0000ff;">function</span><span style="color: #000000;">(data){
                </span><span style="color: #0000ff;">if</span>(data.status == 200<span style="color: #000000;">){
                    location.href </span>= 'http://localhost:8081'<span style="color: #000000;">;
                }
            }
        });
    }</span></code></pre>

<span class="cnblogs_code_collapse">校验与退出登录.js</span>
<h2>4、修改SsoUserServiceImpl的两个方法</h2>
<src class="cnblogs_code" onclick="cnblogs_code_show('c351382a-26e1-4140-b85f-2af824443eaa')"><img id="code_img_closed_c351382a-26e1-4140-b85f-2af824443eaa" class="code_img_closed" src="./images/SSO单点登录2.png" alt="" /><img id="code_img_opened_c351382a-26e1-4140-b85f-2af824443eaa" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('c351382a-26e1-4140-b85f-2af824443eaa',event)" src="./images/SSO单点登录3.png" alt="" />
<src id="cnblogs_code_open_c351382a-26e1-4140-b85f-2af824443eaa" class="cnblogs_code_hide">
<pre><code><span style="color: #000000;">    @Override
    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> EgoResult userLogin(String username, String password,
                               HttpServletRequest request, HttpServletResponse response) {

        EgoResult result </span>= <span style="color: #0000ff;">new</span><span style="color: #000000;"> EgoResult();
        result.setStatus(</span>400<span style="color: #000000;">);
        result.setData(</span><span style="color: #0000ff;">null</span><span style="color: #000000;">);
        result.setMsg(</span>"用户名或密码错误."<span style="color: #000000;">);
        TbUser tbUser </span>=<span style="color: #000000;"> userServiceProxy.selectUserByUserNameService(username);

        </span><span style="color: #0000ff;">if</span> (tbUser != <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
            </span><span style="color: #008000;">//</span><span style="color: #008000;">对前端提交的密码进行加密</span>
            password =<span style="color: #000000;"> DigestUtils.md5DigestAsHex(password.getBytes());
            </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (password.equals(tbUser.getPassword())) {
                </span><span style="color: #008000;">//</span><span style="color: #008000;">  将当前登录用户对象，转为json字符串，保存到redis数据库</span>
                String userJsonStr =<span style="color: #000000;"> JsonUtils.objectToJson(tbUser);
                String token </span>=<span style="color: #000000;"> UUID.randomUUID().toString();
                </span><span style="color: #008000;">//</span><span style="color: #008000;"> 将用户信息保存到redis数据库</span>
<span style="color: #000000;">                jedisCluster.set(token, userJsonStr);
                </span><span style="color: #008000;">//</span><span style="color: #008000;">  设置token的有效期为30分钟</span>
                jedisCluster.expire(token, 1800<span style="color: #000000;">);

                </span><span style="color: #008000;">/**</span><span style="color: #008000;">
                 * 将token响应到客户端
                 </span><span style="color: #008000;">*/</span><span style="color: #000000;">
                CookieUtils.setCookie(request,response, </span>"SSO_TOKEN"<span style="color: #000000;">, token);

                result.setStatus(</span>200<span style="color: #000000;">);
                result.setMsg(</span>"登录成功."<span style="color: #000000;">);
                result.setData(token);
            }
        }

        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> result;
    }

    @Override
    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> EgoResult loadUserByToken(String token) {

        EgoResult result </span>= <span style="color: #0000ff;">new</span><span style="color: #000000;"> EgoResult();
        result.setStatus(</span>400<span style="color: #000000;">);
        result.setMsg(</span>"error"<span style="color: #000000;">);
        result.setData(</span><span style="color: #0000ff;">null</span><span style="color: #000000;">);

        String userJsonStr </span>=<span style="color: #000000;"> jedisCluster.get(token);

        </span><span style="color: #0000ff;">if</span> (!<span style="color: #000000;">StringUtils.isEmpty(userJsonStr)) {
            result.setStatus(</span>200<span style="color: #000000;">);
            result.setMsg(</span>"ok"<span style="color: #000000;">);
</span><span style="color: #008000;">//</span><span style="color: #008000;">            result.setData(userJsonStr);</span>
<span style="color: #000000;">
            TbUser tbUser </span>= JsonUtils.jsonToPojo(userJsonStr, TbUser.<span style="color: #0000ff;">class</span><span style="color: #000000;">);
            result.setData(tbUser);
        }

        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> result;
    }</span></code></pre>

<span class="cnblogs_code_collapse">userLogin(),loadUserByToken()</span>
<h2>5、修改controller中拦截登录的方法</h2>
<src class="cnblogs_code">
<pre><code>    <span style="color: #008000;">/**</span><span style="color: #008000;">
     * 实现用户登录
     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> username  用户名
     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> password  密码
     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> request   request对象是服务器对浏览器请求的封装
     * </span><span style="color: #808080;">@param</span><span style="color: #008000;"> response  response是服务器对服务器响应的封装
     *      @ResponseBody 异步的，不会进行跳转
     </span><span style="color: #008000;">*/</span><span style="color: #000000;">
    @RequestMapping(value </span>= "/user/login", method =<span style="color: #000000;"> RequestMethod.POST)
    @ResponseBody
    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> EgoResult userLogin(String username, String password,
                               HttpServletRequest request, HttpServletResponse response) {
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> ssoUserService.userLogin(username, password, request, response);
    }</span></code></pre>

<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>

</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>