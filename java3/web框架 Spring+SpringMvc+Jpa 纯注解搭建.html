<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修web框架 Spring+SpringMvc+Jpa 纯注解搭建' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>web框架 Spring+SpringMvc+Jpa 纯注解搭建</center></div><div class='banquan'>原文出处:本文由博客园博主你怪哉提供。<br/>
原文连接:https://www.cnblogs.com/webwei2017/p/11899074.html</div><br>
    <p>0.jar包依赖 maven&nbsp; pom.xml</p>
<src class="cnblogs_code">
<pre><code><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">properties</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">spring_version</span><span style="color: #0000ff;">&gt;</span>4.3.25.RELEASE<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">spring_version</span><span style="color: #0000ff;">&gt;</span>
  <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">properties</span><span style="color: #0000ff;">&gt;</span>

  <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">dependencies</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">dependency</span><span style="color: #0000ff;">&gt;</span>
      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">groupId</span><span style="color: #0000ff;">&gt;</span>org.springframework<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">groupId</span><span style="color: #0000ff;">&gt;</span>
      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">artifactId</span><span style="color: #0000ff;">&gt;</span>spring-webmvc<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">artifactId</span><span style="color: #0000ff;">&gt;</span>
      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">version</span><span style="color: #0000ff;">&gt;</span>${spring_version}<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">version</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">dependency</span><span style="color: #0000ff;">&gt;</span>

    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">dependency</span><span style="color: #0000ff;">&gt;</span>
      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">groupId</span><span style="color: #0000ff;">&gt;</span>javax.servlet<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">groupId</span><span style="color: #0000ff;">&gt;</span>
      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">artifactId</span><span style="color: #0000ff;">&gt;</span>javax.servlet-api<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">artifactId</span><span style="color: #0000ff;">&gt;</span>
      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">version</span><span style="color: #0000ff;">&gt;</span>3.1.0<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">version</span><span style="color: #0000ff;">&gt;</span>
      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">scope</span><span style="color: #0000ff;">&gt;</span>provided<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">scope</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">dependency</span><span style="color: #0000ff;">&gt;</span>

    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">dependency</span><span style="color: #0000ff;">&gt;</span>
      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">groupId</span><span style="color: #0000ff;">&gt;</span>com.fasterxml.jackson.core<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">groupId</span><span style="color: #0000ff;">&gt;</span>
      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">artifactId</span><span style="color: #0000ff;">&gt;</span>jackson-databind<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">artifactId</span><span style="color: #0000ff;">&gt;</span>
      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">version</span><span style="color: #0000ff;">&gt;</span>2.9.10<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">version</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">dependency</span><span style="color: #0000ff;">&gt;</span>

    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">dependency</span><span style="color: #0000ff;">&gt;</span>
      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">groupId</span><span style="color: #0000ff;">&gt;</span>org.springframework.data<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">groupId</span><span style="color: #0000ff;">&gt;</span>
      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">artifactId</span><span style="color: #0000ff;">&gt;</span>spring-data-jpa<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">artifactId</span><span style="color: #0000ff;">&gt;</span>
      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">version</span><span style="color: #0000ff;">&gt;</span>1.11.23.RELEASE<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">version</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">dependency</span><span style="color: #0000ff;">&gt;</span>

    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">dependency</span><span style="color: #0000ff;">&gt;</span>
      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">groupId</span><span style="color: #0000ff;">&gt;</span>org.hibernate<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">groupId</span><span style="color: #0000ff;">&gt;</span>
      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">artifactId</span><span style="color: #0000ff;">&gt;</span>hibernate-entitymanager<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">artifactId</span><span style="color: #0000ff;">&gt;</span>
      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">version</span><span style="color: #0000ff;">&gt;</span>3.6.10.Final<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">version</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">dependency</span><span style="color: #0000ff;">&gt;</span>

    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">dependency</span><span style="color: #0000ff;">&gt;</span>
      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">groupId</span><span style="color: #0000ff;">&gt;</span>org.hibernate<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">groupId</span><span style="color: #0000ff;">&gt;</span>
      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">artifactId</span><span style="color: #0000ff;">&gt;</span>hibernate-validator<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">artifactId</span><span style="color: #0000ff;">&gt;</span>
      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">version</span><span style="color: #0000ff;">&gt;</span>4.1.0.Final<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">version</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">dependency</span><span style="color: #0000ff;">&gt;</span>

    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">dependency</span><span style="color: #0000ff;">&gt;</span>
      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">groupId</span><span style="color: #0000ff;">&gt;</span>mysql<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">groupId</span><span style="color: #0000ff;">&gt;</span>
      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">artifactId</span><span style="color: #0000ff;">&gt;</span>mysql-connector-java<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">artifactId</span><span style="color: #0000ff;">&gt;</span>
      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">version</span><span style="color: #0000ff;">&gt;</span>6.0.6<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">version</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">dependency</span><span style="color: #0000ff;">&gt;</span>


    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">dependency</span><span style="color: #0000ff;">&gt;</span>
      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">groupId</span><span style="color: #0000ff;">&gt;</span>org.springframework<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">groupId</span><span style="color: #0000ff;">&gt;</span>
      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">artifactId</span><span style="color: #0000ff;">&gt;</span>spring-test<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">artifactId</span><span style="color: #0000ff;">&gt;</span>
      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">version</span><span style="color: #0000ff;">&gt;</span>${spring_version}<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">version</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">dependency</span><span style="color: #0000ff;">&gt;</span>

    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">dependency</span><span style="color: #0000ff;">&gt;</span>
      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">groupId</span><span style="color: #0000ff;">&gt;</span>junit<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">groupId</span><span style="color: #0000ff;">&gt;</span>
      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">artifactId</span><span style="color: #0000ff;">&gt;</span>junit<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">artifactId</span><span style="color: #0000ff;">&gt;</span>
      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">version</span><span style="color: #0000ff;">&gt;</span>RELEASE<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">version</span><span style="color: #0000ff;">&gt;</span>
      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">scope</span><span style="color: #0000ff;">&gt;</span>test<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">scope</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">dependency</span><span style="color: #0000ff;">&gt;</span>
  <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">dependencies</span><span style="color: #0000ff;">&gt;</span></code></pre>

<p>&nbsp;</p>
<p>&nbsp;</p>
<p>1.可被 servlet3.0 容器自动扫描加载的配置文件，位置不限，作用同 web.xml</p>
<src class="cnblogs_code">
<pre><code><span style="color: #0000ff;">package</span><span style="color: #000000;"> com.sw946.spring_demo.config;

</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.web.servlet.support.AbstractAnnotationConfigDispatcherServletInitializer;

</span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> WebAppInitializer <span style="color: #0000ff;">extends</span><span style="color: #000000;"> AbstractAnnotationConfigDispatcherServletInitializer {
    </span><span style="color: #0000ff;">protected</span> Class&lt;?&gt;[] getRootConfigClasses() {   <span style="color: #008000;">//</span><span style="color: #008000;"> spring容器的配置文件</span>
        <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">new</span> Class[]{SpringConfig.<span style="color: #0000ff;">class</span><span style="color: #000000;">};
    }

    </span><span style="color: #0000ff;">protected</span> Class&lt;?&gt;[] getServletConfigClasses() {    <span style="color: #008000;">//</span><span style="color: #008000;"> springMVC容器的配置文件</span>
        <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">new</span> Class[]{MvcConfig.<span style="color: #0000ff;">class</span><span style="color: #000000;">};
    }

    </span><span style="color: #0000ff;">protected</span> String[] getServletMappings() {   <span style="color: #008000;">//</span><span style="color: #008000;"> 被DisatcjerServlet接管的请求路径</span>
        <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">new</span> String[]{"/"<span style="color: #000000;">};
    }
}</span></code></pre>

<p>&nbsp;</p>
<p>2.spring容器的配置文件，管理 除被springMvc容器管理（如控制器） 以外的所有对象，可防止织入事务切面时不生效的情况发生</p>
<src class="cnblogs_code">
<pre><code><span style="color: #0000ff;">package</span><span style="color: #000000;"> com.sw946.spring_demo.config;

</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.context.annotation.ComponentScan;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.context.annotation.Configuration;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.stereotype.Controller;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.web.servlet.config.annotation.EnableWebMvc;

</span><span style="color: #008000;">//</span><span style="color: #008000;">申明为spring配置文件，spring若开启注解扫描，将会将此类作为spring容器配置的一部分</span>
<span style="color: #000000;">@Configuration
</span><span style="color: #008000;">//</span><span style="color: #008000;">开启注解扫描功能，并设置扫描范围，排除springMvc的配置文件和Controller组件</span>
@ComponentScan(basePackages = {"com.sw946.spring_demo"},excludeFilters = @ComponentScan.Filter({EnableWebMvc.<span style="color: #0000ff;">class</span>, Controller.<span style="color: #0000ff;">class</span><span style="color: #000000;">}))
</span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> SpringConfig {
}</span></code></pre>

<p>&nbsp;</p>
<p>3.springMvc容器的配置文件，仅管理自定义的控制器，与spring容器为互补</p>
<src class="cnblogs_code">
<pre><code><span style="color: #0000ff;">package</span><span style="color: #000000;"> com.sw946.spring_demo.config;

</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.context.annotation.ComponentScan;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.context.annotation.ComponentScan.Filter;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.context.annotation.Configuration;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.stereotype.Controller;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.web.servlet.config.annotation.DefaultServletHandlerConfigurer;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.web.servlet.config.annotation.EnableWebMvc;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.web.servlet.config.annotation.ViewResolverRegistry;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.web.servlet.config.annotation.WebMvcConfigurerAdapter;

@Configuration
</span><span style="color: #008000;">//</span><span style="color: #008000;">开启springMvc注解扫描功能</span>
<span style="color: #000000;">@EnableWebMvc
</span><span style="color: #008000;">//</span><span style="color: #008000;">仅扫描有@Controller注解的类纳入容器管理</span>
@ComponentScan(basePackages = "com.sw946.spring_demo",includeFilters = @Filter(Controller.<span style="color: #0000ff;">class</span>),useDefaultFilters = <span style="color: #0000ff;">false</span><span style="color: #000000;">)
</span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> MvcConfig <span style="color: #0000ff;">extends</span><span style="color: #000000;"> WebMvcConfigurerAdapter {
    @Override
    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> configureViewResolvers(ViewResolverRegistry registry) {     <span style="color: #008000;">//</span><span style="color: #008000;">配置视图解析器(可选)</span>
        registry.jsp("/", ".jsp"<span style="color: #000000;">);
    }

    </span><span style="color: #008000;">//</span><span style="color: #008000;">配置静态资源处理器，将对 / 路径下的静态资源请求映射为 对文件夹 classpath:/static/的请求，相比于默认静态资源处理器可指定映射到WEB-INFO的文件夹中（servlet默认规则下此目录不可访问）</span>
<span style="color: #000000;">　　@Override
    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> addResourceHandlers(ResourceHandlerRegistry registry) {
        registry.addResourceHandler(</span>"/**").addResourceLocations("classpath:/static/"<span style="color: #000000;">);
    }
}</span></code></pre>

<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>4.JPA（数据持久化层）的配置文件，本例使用hibernate + mysql, 持久化框架和数据均可替换，配置思路相同</p>
<src class="cnblogs_code">
<pre><code><span style="color: #0000ff;">package</span><span style="color: #000000;"> com.sw946.spring_demo.config;

</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.context.annotation.Bean;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.context.annotation.Configuration;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.data.jpa.repository.config.EnableJpaRepositories;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.jdbc.datasource.DriverManagerDataSource;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.orm.jpa.JpaTransactionManager;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.orm.jpa.JpaVendorAdapter;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.orm.jpa.vendor.Database;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.transaction.PlatformTransactionManager;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.transaction.annotation.EnableTransactionManagement;

</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.sql.DataSource;

@Configuration
</span><span style="color: #008000;">//</span><span style="color: #008000;">开启jpa注解扫描，并给定范围，jpa会为继承了JpaRepository接口的接口生成实现类</span>
@EnableJpaRepositories(basePackages = "com.sw946.spring_demo.repository"<span style="color: #000000;">)
</span><span style="color: #008000;">//</span><span style="color: #008000;">开启事务管理功能</span>
<span style="color: #000000;">@EnableTransactionManagement
</span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> JpaConfig {
    @Bean
    </span><span style="color: #0000ff;">public</span> DataSource productDB() {     <span style="color: #008000;">//</span><span style="color: #008000;">配置数据源,按实际要连接的数据库配置</span>
        DriverManagerDataSource ds = <span style="color: #0000ff;">new</span><span style="color: #000000;"> DriverManagerDataSource();
        ds.setDriverClassName(</span>"com.mysql.cj.jdbc.Driver"<span style="color: #000000;">);
        ds.setUrl(</span>"jdbc:mysql://localhost:3306/test?serverTimezone=UTC"<span style="color: #000000;">);
        ds.setUsername(</span>"admin"<span style="color: #000000;">);
        ds.setPassword(</span>"admin"<span style="color: #000000;">);
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> ds;
    }

    @Bean
    </span><span style="color: #0000ff;">public</span> JpaVendorAdapter jpaVendorAdapter() {    <span style="color: #008000;">//</span><span style="color: #008000;">配置ORM框架，这里为hibernate</span>
        HibernateJpaVendorAdapter adapter = <span style="color: #0000ff;">new</span><span style="color: #000000;"> HibernateJpaVendorAdapter();
        adapter.setDatabase(Database.MYSQL);
        adapter.setShowSql(</span><span style="color: #0000ff;">true</span><span style="color: #000000;">);
        adapter.setGenerateDdl(</span><span style="color: #0000ff;">false</span><span style="color: #000000;">);
        adapter.setDatabasePlatform(</span>"org.hibernate.dialect.MySQLDialect"<span style="color: #000000;">);
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> adapter;
    }

    @Bean
    </span><span style="color: #0000ff;">public</span> LocalContainerEntityManagerFactoryBean entityManagerFactory(DataSource dataSource, JpaVendorAdapter jpaVendorAdapter){   <span style="color: #008000;">//</span><span style="color: #008000;">配置实体管理器工厂</span>
        LocalContainerEntityManagerFactoryBean emf = <span style="color: #0000ff;">new</span><span style="color: #000000;"> LocalContainerEntityManagerFactoryBean();
        emf.setDataSource(dataSource);
        emf.setJpaVendorAdapter(jpaVendorAdapter);
        emf.setPackagesToScan(</span>"com.sw946.spring_demo.entity");  <span style="color: #008000;">//</span><span style="color: #008000;">给定实体类的扫描范围，会扫描@Entity注解的类</span>
        <span style="color: #0000ff;">return</span><span style="color: #000000;"> emf;
    }

    @Bean
    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> PlatformTransactionManager transactionManager(LocalContainerEntityManagerFactoryBean factoryBean) {
        </span><span style="color: #008000;">//</span><span style="color: #008000;">配置事务管理器，依赖于实体管理器</span>
        <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">new</span><span style="color: #000000;"> JpaTransactionManager(factoryBean.getObject());
    }
}</span></code></pre>

<p>&nbsp;</p>
<p>框架配置完成，下面为使用示例：</p>
<p>a.控制器（注意包的位置，根据扫描范围配置建立）</p>
<src class="cnblogs_code">
<pre><code><span style="color: #0000ff;">package</span><span style="color: #000000;"> com.sw946.spring_demo.controller;

</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> com.sw946.spring_demo.repository.GradeRepository;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.beans.factory.annotation.Autowired;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.stereotype.Controller;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.web.bind.annotation.RequestMapping;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.web.bind.annotation.ResponseBody;

@Controller
</span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> HomeController {
    @Autowired
    </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> GradeRepository gradeRepository;

    @RequestMapping(</span>"/home"<span style="color: #000000;">)
    @ResponseBody
    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> String home() {
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> gradeRepository.findLaster().toString();
    }
}</span></code></pre>

<p>&nbsp;</p>
<p>b.持久层(因示例简单，忽略服务层)</p>
<src class="cnblogs_code">
<pre><code><span style="color: #0000ff;">package</span><span style="color: #000000;"> com.sw946.spring_demo.repository;

</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> com.sw946.spring_demo.entity.Grade;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.data.jpa.repository.JpaRepository;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.data.jpa.repository.Query;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.stereotype.Repository;

</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.List;

@Repository
</span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">interface</span> GradeRepository <span style="color: #0000ff;">extends</span> JpaRepository&lt;Grade,String&gt;<span style="color: #000000;">{
    List</span>&lt;Grade&gt; findByIdLessThan(String id);    <span style="color: #008000;">//</span><span style="color: #008000;">方法名查询，jpa提供

    </span><span style="color: #008000;">//</span><span style="color: #008000;">JPql、原生sql查询</span>
    @Query(nativeQuery=<span style="color: #0000ff;">true</span>, value = "select * from grade order by id desc limit 0,1"<span style="color: #000000;">)
    Grade findLaster();
}</span></code></pre>

<src class="cnblogs_code">
<pre><code><span style="color: #0000ff;">package</span><span style="color: #000000;"> com.sw946.spring_demo.entity;

</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.persistence.Column;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.persistence.Entity;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.persistence.Id;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.Date;

@Entity
</span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> Grade {
    @Id
    </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> String id;
    </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> String name;

    @Column(name </span>= "create_time"<span style="color: #000000;">)
    </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> Date createTime;

    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> String getId() {
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> id;
    }

    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> setId(String id) {
        </span><span style="color: #0000ff;">this</span>.id =<span style="color: #000000;"> id;
    }

    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> String getName() {
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> name;
    }

    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> setName(String name) {
        </span><span style="color: #0000ff;">this</span>.name =<span style="color: #000000;"> name;
    }

    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> Date getCreateTime() {
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> createTime;
    }

    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> setCreateTime(Date createTime) {
        </span><span style="color: #0000ff;">this</span>.createTime =<span style="color: #000000;"> createTime;
    }

    @Override
    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> String toString() {
        </span><span style="color: #0000ff;">return</span> "Grade{" +
                "id='" + id + '\'' +
                ", name='" + name + '\'' +
                ", createTime=" + createTime +
                '}'<span style="color: #000000;">;
    }
}</span></code></pre>

<p>&nbsp;</p>
<p>c.数据库表</p>
<src class="cnblogs_code">
<pre><code><span style="color: #0000ff;">CREATE</span> <span style="color: #0000ff;">TABLE</span><span style="color: #000000;"> `grade` (
  `id` </span><span style="color: #0000ff;">int</span>(<span style="color: #800000; font-weight: bold;">11</span>) <span style="color: #808080;">NOT</span> <span style="color: #0000ff;">NULL</span><span style="color: #000000;"> AUTO_INCREMENT,
  `name` </span><span style="color: #0000ff;">varchar</span>(<span style="color: #800000; font-weight: bold;">50</span>) <span style="color: #0000ff;">DEFAULT</span> <span style="color: #0000ff;">NULL</span><span style="color: #000000;">,
  `create_time` </span><span style="color: #0000ff;">datetime</span> <span style="color: #0000ff;">DEFAULT</span> <span style="color: #0000ff;">NULL</span><span style="color: #000000;">,
  </span><span style="color: #0000ff;">PRIMARY</span> <span style="color: #0000ff;">KEY</span><span style="color: #000000;"> (`id`)
) ENGINE</span><span style="color: #808080;">=</span>InnoDB AUTO_INCREMENT<span style="color: #808080;">=</span><span style="color: #800000; font-weight: bold;">5</span> <span style="color: #0000ff;">DEFAULT</span> CHARSET<span style="color: #808080;">=</span><span style="color: #000000;">utf8;
</span><span style="color: #0000ff;">INSERT</span> <span style="color: #0000ff;">INTO</span> `grade` (`id`, `name`, `create_time`) <span style="color: #0000ff;">VALUES</span> (<span style="color: #ff0000;">'</span><span style="color: #ff0000;">1</span><span style="color: #ff0000;">'</span>, <span style="color: #ff0000;">'</span><span style="color: #ff0000;">2019</span><span style="color: #ff0000;">'</span>, <span style="color: #ff0000;">'</span><span style="color: #ff0000;">2019-11-18 15:50:41</span><span style="color: #ff0000;">'</span><span style="color: #000000;">);
</span><span style="color: #0000ff;">INSERT</span> <span style="color: #0000ff;">INTO</span> `grade` (`id`, `name`, `create_time`) <span style="color: #0000ff;">VALUES</span> (<span style="color: #ff0000;">'</span><span style="color: #ff0000;">4</span><span style="color: #ff0000;">'</span>, <span style="color: #ff0000;">'</span><span style="color: #ff0000;">2020</span><span style="color: #ff0000;">'</span>, <span style="color: #ff0000;">'</span><span style="color: #ff0000;">2019-11-18 17:32:56</span><span style="color: #ff0000;">'</span>);</code></pre>

<p>tomcat运行,访问 127.0.0.1:端口号/home ，即可看到数据库返回的json字符串，框架搭建完成！</p>

</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>