<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='ç”µè„‘,ç”µè„‘è®²è§£,ç”µè„‘æŠ€æœ¯,ç¼–ç¨‹,ç”µè„‘æ•…éšœç»´ä¿®SpringBootå®ç°ä¸Šä¼ ä¸‹è½½(äºŒ)' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>é¦–é¡µ</a></li>
</div><div onclick='hidden1()' >åˆ†äº«</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>SpringBootå®ç°ä¸Šä¼ ä¸‹è½½(äºŒ)</center></div><div class='banquan'>åŸæ–‡å‡ºå¤„:æœ¬æ–‡ç”±åšå®¢å›­åšä¸»è‹¥èŠ±äº¦æ™¨æ›¦æä¾›ã€‚<br/>
åŸæ–‡è¿æ¥:https://www.cnblogs.com/Ricardo-L-Song/p/11636849.html</div><br>
    è¿™ç¯‡å†™ä¸‹è½½ã€‚

**1.å®ç°æ€è·¯**
ä¸Šä¸€ç¯‡çš„æ•°æ®åº“è®¾è®¡ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå­—æ®µå§‹ç»ˆæ²¡æœ‰ç”¨åˆ°fileName,è¿™æ˜¯ç”¨æ¥ç»™Layerå¯¹è±¡å­˜å‚¨æ–‡ä»¶åçš„,ä»¥æ­¤æ¥å®Œæˆæ–‡ä»¶ä¸å¯¹è±¡çš„å¯¹åº”ï¼Œ
![image.png](https://img2018.cnblogs.com/blog/1821710/201910/1821710-20191008174340428-1740802360.png)


é¢„è§ˆ:
![image.png](https://img2018.cnblogs.com/blog/1821710/201910/1821710-20191008174340574-1458470807.png)



**2.Code**

Viewå±‚:
é¦–å…ˆæ˜¯åŠ è½½æ•°æ®è¡¨æ ¼å¼‚æ­¥çš„æ—¶å€™ æˆ‘ä»¬å°±è·å–åˆ°äº†fileNameï¼Œç„¶åé€šè¿‡è·å–å½“å‰è¡Œï¼Œæ¥è·å–å½“å‰çš„fileNameæ–‡ä»¶åã€‚
```
table.on('tool(test)', function(obj) { 

            var data = obj.data; //è·å¾—å½“å‰è¡Œæ•°æ®
            var layEvent = obj.event; //è·å¾— lay-event å¯¹åº”çš„å€¼ï¼ˆä¹Ÿå¯ä»¥æ˜¯è¡¨å¤´çš„ event å‚æ•°å¯¹åº”çš„å€¼ï¼‰
            var tr = obj.tr; //è·å¾—å½“å‰è¡Œ tr çš„DOMå¯¹è±¡
            $ = layui.jquery;
if (layEvent === 'download') { //åˆ é™¤

                var fileName = data.fileName;
             window.location="layer/download?fileName="+fileName;

            }
 });
```
ç„¶åä¸è®ºæ˜¯ä¸Šä¼ ä¸‹è½½ä½¿ç”¨ajaxéƒ½ä¸æ¨è(ä¸Šä¼ ä¸‹è½½éƒ½å±äºè·å–èµ„æºè¯·æ±‚ï¼Œaæ ‡ç­¾ç­‰å³å¯å®ç°ï¼Œè€Œajaxæ˜¯jså¼‚æ­¥çš„å°è£…è¯·æ±‚ï¼Œä¸¤è€…å®ç°ç›®æ ‡ä¸ä¸€æ ·)

è¿™é‡Œä½¿ç”¨window.locationæ¥å®ç°å¯¹æ–‡ä»¶çš„è¯·æ±‚ã€‚

ç„¶åæ˜¯Controllerå±‚:
```
 //ä¸‹è½½
    @RequestMapping(value = "Index/layer/download")
    @ResponseBody
    public Map<String,Object> downloadOne(HttpServletRequest req,HttpServletResponse response) throws IOException{
        String fileName = req.getParameter("fileName");// è®¾ç½®æ–‡ä»¶åï¼Œæ ¹æ®ä¸šåŠ¡éœ€è¦æ›¿æ¢æˆè¦ä¸‹è½½çš„æ–‡ä»¶å
//        String layerId = req.getParameter("layerId");
        String downloadDir = req.getSession().getServletContext().getRealPath("/") +"upload/";
//        String savePath = req.getSession().getServletContext().getRealPath("/") +"download/";
        downloadDir=downloadDir.substring(0,downloadDir.length()-1);
        downloadDir=downloadDir+"\\";//ä¸‹è½½ç›®å½•
        String realPath=downloadDir+fileName;//
        File file = new File(realPath);//ä¸‹è½½ç›®å½•åŠ æ–‡ä»¶åæ‹¼æ¥æˆrealpath
        if(file.exists()){ //åˆ¤æ–­æ–‡ä»¶çˆ¶ç›®å½•æ˜¯å¦å­˜åœ¨
//            response.setContentType("application/force-download");
            response.setHeader("Content-Disposition", "attachment;fileName=" + fileName);

            byte[] buffer = new byte[1024];
            FileInputStream fis = null; //æ–‡ä»¶è¾“å…¥æµ
            BufferedInputStream bis = null;

            OutputStream os = null; //è¾“å‡ºæµ
            try {
                os = response.getOutputStream();
                fis = new FileInputStream(file);
                bis = new BufferedInputStream(fis);
                int i = bis.read(buffer);
                while(i != -1){
                    os.write(buffer);
                    i = bis.read(buffer);
                }

            } catch (Exception e) {
                // TODO Auto-generated catch block
                e.printStackTrace();
            }
            System.out.println("----------file download" + fileName);
            try {
                bis.close();
                fis.close();
            } catch (IOException e) {
                // TODO Auto-generated catch block
                e.printStackTrace();
            }
        }


        return api.returnJson(2,"fail"+realPath+fileName);
    }
```
ä¸»è¦å°±æ˜¯è°ƒIOæµï¼Œç„¶åä¸‹è½½ç½¢äº†ï¼Œæ‹¼ä¸€ä¸‹è·¯å¾„å’Œæ–‡ä»¶åå³å¯

**3.æ•ˆæœä¸€è§ˆ**
![æ•ˆæœ.gif](https://img2018.cnblogs.com/blog/1821710/201910/1821710-20191008174344880-168350400.gif)


è§‰å¾—æœ‰ç”¨å°±ç»™é¢—å°ğŸ’—ğŸ’—å§~

**é¡¹ç›®ä»…ä¾›æµ‹è¯•å­¦ä¹ ä½¿ç”¨ï¼Œæ‹’ç»ä»»ä½•å½¢å¼çš„å•†ä¸šç”¨é€”ï¼Œè½¬ä¾µåˆ ã€‚
é¡¹ç›®æºç å…³æ³¨å…¬ä¼—å·Code In Javaï¼Œå›å¤"SpringBootä¸Šä¼ ä¸‹è½½"å³å¯è·å–ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰Javaå­¦ä¹ å›¾è°±ï¼Œæ•°æ®ç»“æ„ä¸ç®—æ³•èµ„æ–™ç­‰å„ç§èµ„æ–™éƒ½å¯ä»¥åœ¨åå°è·å–ã€‚**
å…³æ³¨å…¬ä¼—å·:Code In Java
èµ„æºï¼Œé¡¹ç›®ï¼Œé¢è¯•é¢˜ä¸€ç½‘æ‰“å°½
å¸Œæœ›ä¸ä½ æˆä¸ºJavaæŠ€æœ¯çš„åŒè·¯äºº

</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>